/*! Copyright (c) 2015 WhatsApp Inc.  All Rights Reserved. */
webpackJsonp([6],Array(1283).concat([function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){window.history.pushState({},"",window.location.href)}function s(){if(!Store.Conn.connected)return!1;var e=n(1469),t=Store.Msg.some(function(e){return 0===e.ack&&e.local&&e.isSentByMe}),i=Store.Chat.some(function(e){return!!e.composeContents.text});return t||i||e.hasText}var r=n(2),o=i(r),l=n(35),c=i(l),u=n(460),d=i(u),p=n(115),h=i(p),f=n(111),m=i(f),g=n(1732),v=i(g),y=n(8),E=n(45);_.defaults(window.Store,n(1673));var S=n(54),M=n(9),C=n(15),b=n(29),T=n(1535),P=n(1603),k=n(233),N=n(1687),w=n(1516),x=n(160),O=n(10),D=n(13),R=n(162),I=n(248),A=n(1686),L=n(1571),F=n(158),U=n(156),j=n(93),G=n(1727),B=n(1660),H=n(1639),V=n(0),q=n(1),W=n(242),z=W.parseCmd,Y=W.Cmd,K=n(234),Q=n(92),X=n(91),Z=n(47),J=n(46),$=n(1619),ee=n(21),te=n(61),ne=n(96);ne&&!function(){var e=n(247),t=n(246);Store.ProfilePicThumb.on("change:tag",function(n){n.tag||e.request(navigator.serviceWorker.controller,t.REMOVE_PP,n.id)["catch"](function(){})})}();var ie=[[document,"mousemove"],[document,"scroll"],[document,"keydown"],[window,"focus"],[window,"blur"],[window,"resize"]],ae=y.createClass({displayName:"Main",mixins:[x,U,j,F],propTypes:{apiCmd:y.PropTypes.array,apiCmdHandled:y.PropTypes.func.isRequired,animate:y.PropTypes.bool},statics:{hasPending:s},getInitialState:function(){return this.onBlur=this.safeDebounce(function(){if(document.activeElement===document.body){var e=Q.Manager.top;e&&e.uie.requestFocus()}},10),{drawerActive:!1}},componentWillMount:function(){var e=this;h["default"].uiActive=!0,h["default"].markAvailable(),this.regNativeListener(window,"click",function(t){var n=t.target;if(n&&"A"===n.nodeName&&n.hasAttribute("href")){var i=z(n.getAttribute("href"));e.execApiCmd(i)&&t.preventDefault()}},!0),te.supportsFeature(te.F.STATUS_V3_UI)&&Store.StatusV3.sync()},componentWillReceiveProps:function(e){e.apiCmd&&this.execApiCmd(e.apiCmd)},componentWillUnmount:function(){this.onBlur=null,G.trigger(A.Event+":"+A.Events.LOGGED_OUT),Z.canMuckHistory()&&window.history.back(),h["default"].uiActive=!1,this.clearIdleMonitor(),this.clearServerPropsQueryLoop()},componentDidMount:function(){if(G.trigger(A.Event+":"+A.Events.LOGGED_IN),this.props.apiCmd&&this.execApiCmd(this.props.apiCmd),Z.canMuckHistory()&&(window.history.pushState({},"",window.location.href),this.regNativeListener(window,"popstate",a)),this.beginIdleMonitor(!0),this.beginServerPropsQueryLoop(),this.addObserverAndRun(Store.Conn,"change:tos",this.showTOS),X.focus(E.findDOMNode(this)),S.isSafari){var e=b.getNUX(M.NUX.SAFARI_LIMITED_SUPPORT);(!e||e<e.maxViews)&&(this.safeDelay(function(){var e=l10n.t("whatsapp_safari_limited").replace("__chrome_homepage__",M.BROWSER_LINK.CHROME).replace("__firefox_homepage__",M.BROWSER_LINK.FIREFOX).replace("__opera_homepage__",M.BROWSER_LINK.OPERA);O.openModal(y.createElement(k,{onOK:O.closeModal.bind(O),okText:l10n.t("ok_got_it")},y.createElement("div",{dangerouslySetInnerHTML:{__html:e}})))},250),b.setNUX(M.NUX.SAFARI_LIMITED_SUPPORT,{views:1,maxViews:1}))}},execApiCmd:function(e){var t=(0,c["default"])(e,2),n=t[0],i=t[1];q.log("main:execApiCmd:"+n)(i),this.props.apiCmdHandled();var a=function(){switch(n){case Y.GROUP_INVITE:return O.openModal(y.createElement(H,{groupCode:i.code})),{v:!0};case Y.MSG_SEND:var e=i.text,t=i.phone;if(t){var a=ee.numberToWid(t);J.queryExist(a).then(function(e){return 200===e.status?Store.Chat.find(e.jid):o["default"].reject("Invalid number")}).then(function(t){return t.active&&e?void O.pasteChatTextInput(t,e):(e&&t.setComposeContents({text:e}),O.openChatFromUnread(t).then(function(e){e&&O.focusChatTextInput(t)}))})["catch"](function(e){O.openModal(y.createElement(k,{onOK:O.closeModal.bind(O),okText:l10n.t("web_ok")},l10n.t("msg_send_error")))})}else O.openModal(y.createElement($,{msgText:e}),"modal-flow");return{v:!0};default:return{v:!1}}}();return"object"==typeof a?a.v:void 0},beginIdleMonitor:function(e){var t=this;e=e?M.IDLE_TIMEOUT:0,this.idleMonitor=o["default"].loop(function(){return o["default"].delay(e).addCancelControl().then(function(){h["default"].markUnavailable(3e4);var n=void 0,i=new o["default"](function(e){n=e});return ie.forEach(function(e){var i=(0,c["default"])(e,2),a=i[0],s=i[1];t.regNativeListener(a,s,n)}),i.addCancelControl()["finally"](function(){ie.forEach(function(e){var i=(0,c["default"])(e,2),a=i[0],s=i[1];t.unregNativeListener(a,s,n)})}).then(function(){h["default"].markAvailable(),e=M.IDLE_TIMEOUT})})})["finally"](function(){t.idleMonitor=null})["catch"](o["default"].CancellationError,_.noop).endWithControls("cancel")},clearIdleMonitor:function(){this.idleMonitor&&this.idleMonitor.control.cancel()},beginServerPropsQueryLoop:function(){var e=this;this.serverPropsQueryLoop=R.setTimeout(function(){Store.Props.fetch()["catch"](D.WapDrop,_.noop),e.beginServerPropsQueryLoop()},V().add("1","days").valueOf())},clearServerPropsQueryLoop:function(){R.clearTimeout(this.serverPropsQueryLoop)},calculateConversationPaneScale:function(){if(!(this.refs.chatlist&&this.refs.container&&this.refs.conversation))return null;var e=E.findDOMNode(this.refs.chatlist),t=E.findDOMNode(this.refs.conversation),n=E.findDOMNode(this.refs.container);return t.clientWidth/(n.clientWidth-e.clientWidth)},onRightDrawerIn:function(){this.rightDrawerOut=!1,O.onPanesWillChange(3),this.setState({drawerActive:!0},O.onPanesDidChange.bind(O,3));var e=this.calculateConversationPaneScale();null!==e&&this.animateConversationPane(e)},onRightDrawerOut:function(){this.rightDrawerOut=!0;var e=this.calculateConversationPaneScale();null!==e&&this.animateConversationPane(e),1!==e&&(O.onPanesWillChange(2),this.setState({drawerActive:!1},O.onPanesDidChange.bind(O,2)))},onRightDrawerAnimationComplete:function(){this.state.drawerActive&&this.rightDrawerOut&&this.setState({drawerActive:!1})},animateConversationPane:function(e){(0,d["default"])(E.findDOMNode(this.refs.conversation),{scaleX:[1,e]},{duration:300,easing:[.1,.82,.25,1]})},onRotateFocus:function(e){var t=this,n=1;e&&(e.stopPropagation(),e.preventDefault(),n=e.shiftKey?-1:1,m["default"].flashFocus=Date.now());var i=_.toArray(E.findDOMNode(this).querySelectorAll("[data-tab]"));if(O.existsDrawerLeft(function(e){if(e){var n=E.findDOMNode(t.refs.chatlist);i=_.reject(i,function(e){return n.contains(e)})}}),O.existsDrawerMid(function(e){if(e){var n=E.findDOMNode(t.refs.conversation);n&&(i=_.reject(i,function(e){return n.contains(e)}))}}),i.length){i=_.sortBy(i,function(e){return parseInt(e.getAttribute("data-tab"),10)||0});var a=0,s=document.activeElement;s&&(a=I.ring(_.findIndex(i,function(e){return e.contains(s)})+n,i));var r=i[a];m["default"].flashFocus=Date.now(),r.restoreFocus?r.restoreFocus():X.focus(r)}},showTOS:function(){switch(Store.Conn.tos){case 1:case 2:O.openModal(y.createElement(B,null),void 0,void 0,!0);break;case 3:C.logout()}},render:function(){var e=this.state.drawerActive?"app three":"app two";this.props.animate||(e+=" no-animation"),S.isSafari&&(e+=" safari-fix");var t={tab:this.onRotateFocus,"shift+tab":this.onRotateFocus};return y.createElement(K,{state:K.State.INACTIVE,ref:"container",displayName:"Main"},y.createElement(m["default"],{handlers:t,className:e,onBlur:this.onBlur},y.createElement(N,null),y.createElement(w,null),y.createElement(v["default"],null),y.createElement("div",{className:"drawer-manager"},y.createElement(P,{direction:P.Dir.LEFT}),y.createElement(P,{direction:P.Dir.MID}),y.createElement(P,{direction:P.Dir.RIGHT,ref:"rightDrawer",onDrawerIn:this.onRightDrawerIn,onDrawerOut:this.onRightDrawerOut,onDrawerAnimationComplete:this.onRightDrawerAnimationComplete})),y.createElement(T,{ref:"chatlist",className:"pane pane-one"}),y.createElement(L,{ref:"conversation",animate:this.props.animate})))}});e.exports=ae},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){switch(t){case"text":return e.type===p["default"].TYPE.CHAT&&"url"!==e.subtype;case"image":return e.type===p["default"].TYPE.IMAGE;case"video":return e.type===p["default"].TYPE.VIDEO&&!e.isGif;case"gif":return e.type===p["default"].TYPE.VIDEO&&e.isGif;case"audio":return e.type===p["default"].TYPE.AUDIO;case"ptt":return e.type===p["default"].TYPE.PTT;case"document":return e.type===p["default"].TYPE.DOCUMENT;case"location":return e.type===p["default"].TYPE.LOCATION;case"vcard":return e.type===p["default"].TYPE.VCARD||e.type===p["default"].TYPE.MULTI_VCARD;case"url":return e.type===p["default"].TYPE.CHAT&&"url"===e.subtype;case void 0:return!1;default:return!1}}Object.defineProperty(t,"__esModule",{value:!0}),t.ChatProxy=void 0;var s=n(22),r=i(s),o=n(488),l=i(o),c=n(2),u=i(c),d=n(458),p=i(d),h=n(468),f=n(485),m=i(f),g=n(115),v=i(g),y=n(475),E=i(y),S=n(469),M=n(8),C=n(9),b=n(1),T=n(1498),P=n(1402),k=n(1497),N=n(1496),w=n(1495),x=n(1449),O=n(61),D=n(10),R=n(46),I=n(29),A=n(76),L=n(13),F=n(30),U=n(21),j=n(479),G=n(113).ActionToast,B=n(113).ActionType,H=n(465),V=3e5,q={GROUP:"group",BROADCAST:"broadcast",CHAT:"chat"},W={Collection:"Chat",props:{id:"string",t:"number",unreadCount:{type:"number","default":0},archive:"boolean",isReadOnly:"boolean",modifyTag:"number",muteExpiration:{type:"number","default":0},name:"string",notSpam:"boolean",pin:"number"},session:{createdLocally:"boolean",pendingAction:"number",formattedTitle:"string",active:"boolean",pausedTimerId:"number",presenceResendTimerId:"number",recording:"boolean",typing:"boolean",unreadDivider:"object",colors:"object",composeContents:{type:"object","default":function(){return{}}},popupPanels:"object",popupPositionChange:"number",squelch:"number",pendingSeenCount:{type:"number","default":0},markedUnread:"boolean",trusted:"boolean",canSend:"boolean",promises:{type:"object","default":function(){return{}}},ftsCache:{type:"object","default":function(){return{}}},composeQuotedMsg:"object",groupMetadata:"object",presence:"object",mute:"object",contact:"object",ackedProps:{type:"object","default":function(){return{}}}},initialize:function(){if(T.prototype.initialize.call(this),this._addQueue=new m["default"],this._sendQueue=new m["default"],this.msgs.msgLoadState.contextLoaded=!0,this.isVisible||(this.msgs.msgLoadState.noEarlierMsgs=!0),this.addChild("presence",Store.Presence.gadd(this.id)),this.addChild("mute",Store.Mute.gadd({id:this.id,expiration:this.muteExpiration})),this.addChild("contact",Store.Contact.gadd(this.id)),this.name&&!this.contact.name&&(this.contact.name=this.name),this.listenTo(this.contact,"change:name",this.updateTitle),this.isGroup&&(this.trusted=!0),this.isGroup||this.isBroadcast){var e;this.isBroadcast&&!Store.GroupMetadata.get(this.id)&&(e=!0),this.addChild("groupMetadata",Store.GroupMetadata.gadd(this.id)),this.listenTo(this.groupMetadata,"change:stale",this.updateReadOnly),this.listenTo(this.groupMetadata,"change:trusted change:stale",this.isTrusted),this.listenTo(this.groupMetadata.participants,"add remove reset",this.updateReadOnly),this.listenTo(this.groupMetadata.participants,"change:contact.formattedShortName",this.updateTitle),this.updateReadOnly();var t=this.id;this.listenTo(this,"change:isReadOnly",function(){this.isTrusted(),this.updateCanSend(),Store.ProfilePicThumb.update(t)["catch"](L.WapDrop,_.noop),Store.GroupMetadata.update(t)["catch"](L.WapDrop,_.noop)}),e&&Store.GroupMetadata.update(t)["catch"](L.WapDrop,_.noop)}else this.listenTo(this.presence,"change:isOnline",this._presenceOnlineChanged),this.listenTo(this.contact,"change:isMyContact",this.isTrusted),this.listenTo(Store.Blocklist,"add remove reset",this.updateCanSend);Store.Chat.notSpam[this.id]&&!this.notSpam&&this.sendNotSpam()["catch"](_.noop),Store.Chat.notSpam[this.id]=!!this.notSpam,this.notSpam||this.listenTo(this,"change:notSpam",this.onNotSpamChange),this.updateTitle(),this.isTrusted(),this.updateCanSend(),this.listenTo(this.msgs,"add",this.onNewMsg),this.listenTo(this.msgs,"remove_msgs",this.updateSortTime),this.listenTo(this.msgs,"bulk_add",this.addMediaMsgs),this.listenTo(this,"change:msgs",this.resetMediaMsgs),this._saveAssignedColors=_.debounce(this.saveAssignedColors,1e3),this.listenTo(this,"change:active",this.onActiveUpdate),this.pendingAction=0,this.listenTo(this,"change:pendingAction",this.onPendingActionUpdate),this.listenTo(this,"change:t change:modifyTag",this._clearFtsCache)},derived:{kind:{fn:function(){return U.isGroup(this.id)?q.GROUP:U.isBroadcast(this.id)?q.BROADCAST:U.isUser(this.id)?q.CHAT:void b.log("chat:unknown kind id:"+this.id)()}},isGroup:{fn:function(){return U.isGroup(this.id)}},isBroadcast:{fn:function(){return U.isBroadcast(this.id)}},isUser:{fn:function(){return U.isUser(this.id)}},isPSA:{fn:function(){return U.isPSA(this.id)}},hasUnread:{deps:["unreadCount"],fn:function(){return 0!==this.unreadCount}},isVisible:{deps:["createdLocally","msgs","msgsLength"],fn:function(){return this._isVisibleLatched?!0:U.isStatusV3(this.id)?!1:(this._isVisibleLatched=!this.createdLocally||this.msgs.some(function(e){return e.type!==p["default"].TYPE.E2E_NOTIFICATION}),this._isVisibleLatched)}},previewMessage:{deps:["msgs","msgsChanged"],fn:function(){for(var e=this.msgs.length-1;e>=0;e--){var t=this.msgs.at(e);if(t&&t.type!==p["default"].TYPE.E2E_NOTIFICATION)return t}return this.msgs.last()}}},addPendingAction:function(e){var t=this;if(e.isPending()){var n=function(){t.pendingAction--};e.then(n,n),this.pendingAction++}},addAndSendMsg:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,i=u["default"].resolve(e),a=this._addQueue.enqueue(i).then(function(e){var n=window.Store.Msg.add(e);return n.waitForPrep().then(function(){return t.msgs.add(n)})}),s=n?a.then(n)["return"](a):a,r=this.sendMsg(s);return[a,r]},sendMsg:function(e){return this._sendQueue.enqueue(e).then(function(e){return window.Store.Msg.send(e)})},onActiveUpdate:function(){this.isGroup&&this.active&&(this.squelch=-1),this.presence.chatActive=this.active},onPendingActionUpdate:function(){this.pendingAction<0&&(b.log("chat:onPendingActionUpdate pendingAction value is invalid")(),this.pendingAction=0)},onNotSpamChange:function(){Store.Chat.notSpam[this.id]=this.notSpam,this.isTrusted(),this.notSpam&&this.stopListening(this,"change:notSpam")},hasMaybeSentMsgToChat:function(){return _.some(this.getAllMsgs(),function(e){return e.isSentByMe})},isTrusted:function(){var e=void 0;return this.isGroup?e=O.supportsFeature(O.F.SPAM)?this.isReadOnly||this.notSpam||this.groupMetadata.isTrusted():this.groupMetadata.isTrusted():this.isBroadcast?e=!0:this.isUser&&(e=O.supportsFeature(O.F.SPAM)?this.notSpam||this.contact.isMyContact:!0),!e&&this.hasMaybeSentMsgToChat()&&(e=!0),this.trusted=e},updateTitle:function(){this.isBroadcast?this.formattedTitle=this.contact.name||this.groupMetadata.participants.map(function(e){return e.contact.formattedShortName}).join(", "):this.isUser?this.formattedTitle=this.contact.getFormattedUser():this.isGroup&&(this.formattedTitle=this.contact.name)},title:function(){return this.isGroup?this.formattedTitle||l10n.t("unknown_subject"):this.formattedTitle},sendExit:function(){var e=this;if(!this.isGroup)return u["default"].reject(new L.ActionError);if(this.promises.sendExit)return this.promises.sendExit;this.promises.sendExit=R.leaveGroup(this.id);var t=new B(l10n.t("action_group_exiting")),n=this.promises.sendExit.then(function(e){return 200===e.status?new B(l10n.t("action_group_exited")):e.status>=400?new B(l10n.t("action_group_exit_failed")):void 0})["catch"](function(e){return b.error("models:chat:sendExit dropped")(e),new B(l10n.t("action_group_exit_failed"),l10n.t("action_try_again"),this.sendExit.bind(this))});return D.openToast(M.createElement(G,{id:G.genId(),initialAction:t,pendingAction:n})),this.promises.sendExit.bind(this).then(function(e){200!==e.status||e._duplicate||this.exit()})["finally"](function(){e.promises.sendExit=null})},canExit:function(){return O.supportsFeature(O.F.GROUP_EXIT)},exit:function(){this.isGroup&&(this.groupMetadata.participants.remove(Store.Conn.me),this.isReadOnly=!0)},sendDelete:function(){var e=this;if(this.promises.sendDelete)return this.promises.sendDelete;var t=this.msgs.last(),n=t?t.id:void 0;this.promises.sendDelete=R.sendConversationDelete(this.id,n);var i,a=this.kind;switch(a){case q.GROUP:i=l10n.t("action_group_deleting");break;case q.BROADCAST:i=l10n.t("action_broadcast_deleting");break;case q.CHAT:i=l10n.t("action_chat_deleting")}i=new B(i);var s=this.promises.sendDelete.bind(this).then(function(e){if(200===e.status)switch(a){case q.GROUP:return new B(l10n.t("action_group_deleted"));case q.BROADCAST:return new B(l10n.t("action_broadcast_deleted"));case q.CHAT:return new B(l10n.t("action_chat_deleted"))}else if(e.status>=400)switch(a){case q.GROUP:return new B(l10n.t("action_group_delete_failed"));case q.BROADCAST:return new B(l10n.t("action_broadcast_delete_failed"));case q.CHAT:return new B(l10n.t("action_chat_delete_failed"))}})["catch"](function(e){b.error("models:chat:sendDelete dropped")(e);var t=void 0;switch(a){case q.GROUP:t=l10n.t("action_group_delete_failed");break;case q.BROADCAST:t=l10n.t("action_broadcast_delete_failed");break;case q.CHAT:t=l10n.t("action_chat_delete_failed")}return new B(t,l10n.t("action_try_again"),this.sendDelete.bind(this))});return D.openToast(M.createElement(G,{id:G.genId(),initialAction:i,pendingAction:s})),this.promises.sendDelete.bind(this).then(function(e){if(200===e.status&&!e._duplicate){var n=this.msgs.last();t===n?this["delete"](!0):this.deleteMsgsBeforeMsgInclusive(t)}})["finally"](function(){e.promises.sendDelete=null})},updateCanSend:function(){return this.isReadOnly?this.canSend=!1:this.isUser?this.canSend=!(this.contact.isBlocked()||this.isPSA):this.canSend=!0},canDelete:function(){return O.supportsFeature(O.F.DELETE)},canClear:function(){return O.supportsFeature(O.F.CHAT_CLEAR)},sendClear:function(e){var t=this;if(this.promises.sendClear)return this.promises.sendClear;var n=this.msgs.last(),i=n?n.id:void 0;this.promises.sendClear=R.sendConversationClear(this.id,i,!e);var a=new B(l10n.t("action_chat_clearing")),s=this.promises.sendClear.then(function(e){return 200===e.status?new B(l10n.t("action_chat_cleared")):e.status>=400?new B(l10n.t("action_chat_clear_failed")):void 0})["catch"](function(n){return b.error("models:chat:sendClear dropped")(n),new B(l10n.t("action_chat_clear_failed"),l10n.t("action_try_again"),t.sendClear.bind(t,e))});return D.openToast(M.createElement(G,{id:G.genId(),initialAction:a,pendingAction:s})),this.promises.sendClear.then(function(i){200!==i.status||i._duplicate||t.deleteMsgsBeforeMsgInclusive(n,e)})["finally"](function(){t.promises.sendClear=null})},"delete":function(e){T.prototype["delete"].call(this),Store.Chat.remove(this.id),this.cancelPendingPromises(),this.presence["delete"](),this.mute["delete"](),this.deleteMsgs(),D.clearChat(this),this.groupMetadata&&this.groupMetadata["delete"](),this.mediaMsgs&&this.mediaMsgs["delete"](),this.linkMsgs&&this.linkMsgs["delete"](),this.docMsgs&&this.docMsgs["delete"](),this.starredMsgs&&(this.starredMsgs["delete"](),this.starredMsgs.stopListening(),this.starredMsgs.reset())},isDirty:function(){return 0!==this.unreadCount},resetMediaMsgs:function(){this.mediaMsgs&&(this.mediaMsgs["delete"](),this.mediaMsgs.queryMedia(this)),this.linkMsgs&&(this.linkMsgs["delete"](),this.linkMsgs.queryLinks(this)),this.docMsgs&&(this.docMsgs["delete"](),this.docMsgs.queryDocs(this))},addMediaMsgs:function(e,t){if(e){var n=_.isArray(e)?e:[e],i=[],a=[],s=[];n.forEach(function(e){e.createLinks(),e.isMedia&&i.push(e),e.hasLink&&a.push(e),e.isDoc&&s.push(e)}),this.mediaMsgs&&i.length&&this.mediaMsgs.add(i,t),this.linkMsgs&&a.length&&this.linkMsgs.add(a,t),this.docMsgs&&s.length&&this.docMsgs.add(s,t)}},onNewMsg:function(e){if(e&&"i"!==e.eventType){var t={};if(t.t=e.t,this.promises.updateSortTime&&this.promises.updateSortTime.cancel(),this.archive&&(t.archive=!1),this.promises.setArchive&&this.promises.setArchive.cancel(),e.isSentByMe||(this.presence.handle({id:this.id,participant:e.author,type:"available"}),"a"!==e.eventType&&"d"!==e.eventType||(t.unreadCount=this.unreadCount+1||1)),e.isSentByMeFromWeb?this.setAndKeepPrevious(t,e.promises.sendPromise):this.set(t),!e.isSentByMe)switch(e.eventType){case"d":case"a":"d"===e.eventType&&D.alertNewMsg(e),this.msgs.length<C.MSG_PRELOAD_THRESHOLD&&this.loadEarlierMsgs()["catch"](L.E404,_.noop)["catch"](function(e){b.log("chat:onNewMsg failed")(),b.log(e)()});break;case"s":if("gp2"===e.type&&"add"===e.subtype&&_.head(e.recipients)===Store.Conn.me&&!this.contact.name)return;D.alertNewMsg(e)}}},setPin:function(e,t){var n=this;this.promises.setPin&&this.promises.setPin.cancel();var i=void 0,a=void 0;e?i=Math.round(+new Date/1e3):a=this.pin;var s=R.sendConversationPin(this.id,i,a).cancellable(),r=new B(e?l10n.t("action_chat_pinning"):l10n.t("action_chat_unpinning"));t=t||G.genId();var o=s.then(function(i){var a=void 0;return 200===i.status?(a=e?l10n.t("action_chat_pinned"):l10n.t("action_chat_unpinned"),new B(a,l10n.t("action_undo"),n.setPin.bind(n,!e,t))):405===i.status?new B(l10n.t("action_chat_pin_failed_405")):i.status>=400?new B(e?l10n.t("action_chat_pin_failed"):l10n.t("action_chat_unpin_failed")):void 0})["catch"](function(i){b.error("models:chat:setPin dropped")(i);var a=e?l10n.t("action_chat_pin_failed"):l10n.t("action_chat_unpin_failed");return new B(a,l10n.t("action_try_again"),n.setPin.bind(n,e,t))});return D.openToast(M.createElement(G,{id:t,initialAction:r,pendingAction:o})),this.promises.setPin=s.bind(this).then(function(e){200!==e.status||e._duplicate||(this.pin=i)})["finally"](function(){n.promises.setPin=null})},setArchive:function(e,t){var n=this;if(this.archive===e)return u["default"].reject(new L.ActionError);if(this.promises.setArchive)return this.promises.setArchive;var i=this.getLastMsgKeyForAction(),a=R.sendConversationArchive(this.id,e,i).cancellable(),s=new B(e?l10n.t("action_chat_archiving"):l10n.t("action_chat_unarchiving"));t=t||G.genId();var r=a.then(function(i){var a=void 0;return 200===i.status?(a=e?l10n.t("action_chat_archived"):l10n.t("action_chat_unarchived"),new B(a,l10n.t("action_undo"),n.setArchive.bind(n,!e,t))):i.status>=400?new B(e?l10n.t("action_chat_archive_failed"):l10n.t("action_chat_unarchive_failed")):void 0})["catch"](function(i){b.error("models:chat:setArchive dropped")(i);var a=e?l10n.t("action_chat_archive_failed"):l10n.t("action_chat_unarchive_failed");return new B(a,l10n.t("action_try_again"),n.setArchive.bind(n,e,t))});return D.openToast(M.createElement(G,{id:t,initialAction:s,pendingAction:r})),this.promises.setArchive=a.bind(this).then(function(t){200!==t.status||t._duplicate||(this.archive=e)})["finally"](function(){n.promises.setArchive=null})},canPin:function(){return O.supportsFeature(O.F.PIN)},canArchive:function(){return this.isBroadcast?O.supportsFeature(O.F.ARCHIVE_BROADCAST):O.supportsFeature(O.F.ARCHIVE)},sendSeen:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!0;if(this.markedUnread||0===this.unreadCount)return u["default"].resolve();if(!v["default"].available&&e)return this.listenTo(v["default"],"change:available",this.sendSeen),u["default"].resolve();this.stopListening(v["default"],"change:available",this.sendSeen);var t=this.unreadCount-this.pendingSeenCount,n=-1===this.unreadCount&&-1===t;if(0>=t&&!n)return u["default"].resolve();this.disableUnreadAnchor=!0,this.pendingSeenCount=this.unreadCount;var i=this,a=function(){i.pendingSeenCount=i.pendingSeenCount-t,i.pendingSeenCount<0&&(b.error("models:chat:sendSeen unread "+i.unreadCount+" pending: "+i.pendingSeenCount+" delta: "+t)(),i.pendingSeenCount=0)},s=this.lastReceivedKey;return O.gte([0,4])?R.sendConversationSeen(this.id,s,t).bind(this).then(function(e){return a(),200!==e.status||e._duplicate||this.markSeen(t),e})["catch"](L.WapDrop,function(e){a(),b.error("models:chat:sendConversationSeen dropped")()}):(a(),this.markSeen(t),R.sendConversationSeen(this.id,s,t).bind(this).then(function(e){return e})["catch"](L.WapDrop,function(e){b.error("models:chat:sendConversationSeen dropped")()}))},markSeen:function(e){e&&"number"==typeof e?e>0&&e<=this.unreadCount?this.unreadCount=this.unreadCount-e:-1===e&&this.unreadCount<=0&&(this.unreadCount=0):this.unreadCount=0,this.unreadMsgAnchor=void 0,this.markedUnread=!1},markUnread:function(e,t){var n=this;if(e?this.active&&(this.markedUnread=!0):this.markedUnread=!1,this.promises.markUnread)return this.promises.markUnread;this.promises.markUnread=e?this.sendUnseen():this.sendSeen();var i=new B(e?l10n.t("action_chat_marking_unread"):l10n.t("action_chat_marking_read"));t=t||G.genId();var a=this.promises.markUnread.then(function(i){if(200===i.status){var a=e?l10n.t("action_chat_marked_unread"):l10n.t("action_chat_marked_read");return new B(a,l10n.t("action_undo"),n.markUnread.bind(n,!e,t))}return i.status>=400?new B(e?l10n.t("action_chat_mark_unread_failed"):l10n.t("action_chat_mark_read_failed")):void 0})["catch"](function(i){var a=e?l10n.t("action_chat_mark_unread_failed"):l10n.t("action_chat_mark_read_failed");return new B(a,l10n.t("action_try_again"),n.markUnread.bind(n,e,t))});return D.openToast(M.createElement(G,{id:t,initialAction:i,pendingAction:a})),this.promises.markUnread["finally"](function(){n.promises.markUnread=null})},canMarkUnseen:function(){return O.supportsFeature(O.F.CHAT_MARK_UNSEEN)},sendUnseen:function(){var e=this,t=this.msgs.last(),n=t?t.id:void 0;return R.sendConversationUnseen(this.id,n).then(function(t){return 200===t.status?e.markUnseen():e.markedUnread=!1,t})},markUnseen:function(){this.active&&(this.markedUnread=!0),this.unreadCount=-1},markRecording:function(){if((this.presence.isOnline||this.isGroup)&&!this.recording){var e=this.id;R.sendChatstateRecording(e).then(function(t){t.status>=400&&b.error("models:chat send presence recording error "+e)()})["catch"](L.WapDrop,_.noop),this.presenceResendTimerId=_.delay(this._resendPresence.bind(this),C.PRESENCE_RESEND_WAIT)}this.pausedTimerId&&(clearTimeout(this.pausedTimerId),this.unset("pausedTimerId")),this.recording=!0,this.typing=!1},markComposing:function(){if((this.presence.isOnline||this.isGroup)&&!this.typing){var e=this.id;R.sendChatstateComposing(e).then(function(t){t.status>=400&&b.error("models:chat send presence composing error "+e)()})["catch"](L.WapDrop,_.noop),this.presenceResendTimerId=_.delay(this._resendPresence.bind(this),C.PRESENCE_RESEND_WAIT)}this.typing=!0,this.pausedTimerId&&clearTimeout(this.pausedTimerId),this.pausedTimerId=_.delay(this.markPaused.bind(this),C.SEND_PAUSED_WAIT)},markPaused:function(){if((this.presence.isOnline||this.isGroup)&&(this.typing||this.recording)){var e=this.id;R.sendChatstatePaused(e).then(function(t){t.status>=400&&b.error("models:chat send presence paused error "+e)()})["catch"](L.WapDrop,_.noop)}this.presenceResendTimerId&&(clearTimeout(this.presenceResendTimerId),this.unset("presenceResendTimerId")),this.pausedTimerId&&(clearTimeout(this.pausedTimerId),this.unset("pausedTimerId")),this.typing=this.recording=!1},_resendPresence:function(){var e=this.id;if(this.recording)R.sendChatstateRecording(e).then(function(t){t.status>=400&&b.error("models:chat send presence resend recording error "+e)()})["catch"](L.WapDrop,_.noop);else{if(!this.typing)return void this.unset("presenceResendTimerId");R.sendChatstateComposing(e).then(function(t){t.status>=400&&b.error("models:chat send presence resend composing error "+e)()})["catch"](L.WapDrop,_.noop)}this.presenceResendTimerId=_.delay(this._resendPresence.bind(this),C.PRESENCE_RESEND_WAIT)},_messageSent:function(){this.presenceResendTimerId&&(clearTimeout(this.presenceResendTimerId),this.unset("presenceResendTimerId")),this.pausedTimerId&&(clearTimeout(this.pausedTimerId),this.unset("pausedTimerId")),this.typing=!1},_presenceOnlineChanged:function(){this.presence.isOnline?this._resendPresence():this.presenceResendTimerId&&(clearTimeout(this.presenceResendTimerId),this.unset("presenceResendTimerId"))},handleGroupAction:function(e,t,n){var i;switch(e){case"subject":return void(this.contact.name=n.subject);case"add":case"promote":case"demote":var a="promote"===e;return i=_.map(n.participants,function(e){return{id:e,isAdmin:a}}),void this.groupMetadata.participants.add(i,{merge:!0});case"remove":return i=this.groupMetadata.participants,void _.each(n.participants,function(e){i.remove(e)});case"modify":return;case"invite":return void(n.code?this.groupMetadata.inviteCode=n.code:b.error("model:chat:handleGroupAction:invalid invite code: "+n.code+" for "+this.id)());default:return}},setComposeContents:function(e){this.composeContents=e},preload:function(){1===this.msgs.length&&this.loadEarlierMsgs()["catch"](L.E404,_.noop)["catch"](function(e){b.log("chat:preload failed")(),b.log(e)()})},onEmptyMRM:function(){b.log("models:Chat:removeMsg 0 messages left, querying...")(),this.loadEarlierMsgs()["catch"](L.E404,_.noop)["catch"](function(e){b.log("chat:onEmptyMRM failed")(),b.log(e)()})},loadEarlierMsgs:function(e){return e||(e=this.msgs),e.msgLoadState.noEarlierMsgs?u["default"].resolve():e.msgLoadState.isLoadingEarlierMsgs?e.loadEarlierPromise:this._loadMsgs("before",e).then(function(t){return _.isArray(t)&&t.length<C.PAGE_SIZE&&(e.msgLoadState.noEarlierMsgs=!0),t})},isMostRecentCMC:function(e){return this.msgs===e},loadRecentMsgs:function(e){return e||(e=this.msgs),this.isMostRecentCMC(e)?u["default"].resolve():e.msgLoadState.isLoadingRecentMsgs?e.loadRecentPromise:this._loadMsgs("after",e)},_loadMsgs:function(e,t){var n;n="after"===e?t.last():t.head();var i={};return n?i=n.id.clone():i.remote=this.id,i.count=C.PAGE_SIZE,i.direction=e,this._loadMsgsPromise(n,t,Store.Msg.findQuery(i),e)},_loadMsgsPromise:function(e,t,n,i){"after"===i?t.msgLoadState.isLoadingRecentMsgs=!0:"before"===i?t.msgLoadState.isLoadingEarlierMsgs=!0:"around"===i&&(t.msgLoadState.isLoadingAroundMsgs=!0);var a=this.regCancellablePromise(n)["finally"](function(){var n=e&&e.msgChunk!==t;t.msgLoadState.contextLoaded=!0,n&&(e.msgChunk.msgLoadState.contextLoaded=!0),"after"===i?t.msgLoadState.isLoadingRecentMsgs=!1:"before"===i?t.msgLoadState.isLoadingEarlierMsgs=!1:"around"===i&&(t.msgLoadState.isLoadingAroundMsgs=!1)})["catch"](function(e){return b.error("chat:loadMsgs:error "+e)(),404===e?u["default"].reject(new L.E404):u["default"].reject(e)});return"after"===i?t.loadRecentPromise=a:"before"===i?t.loadEarlierPromise=a:"around"===i&&(t.loadAroundPromise=a),a},getSearchContext:function(e,t){var n=this,i=void 0,a=void 0;e instanceof p["default"]?i=e:e instanceof F&&(a=e);var s=i?i.msgChunk:void 0,r=(0,l["default"])(C.PAGE_SIZE/3*2);if(!s||!s.msgLoadState.contextLoaded){s||(s=new P,this.msgChunks.push(s),i&&s.add(i));var o=i?i.id.clone():a.clone();o.count=r;var c=function(){if(i)return i.msgChunk;var e=Store.Msg.get(a);return e&&e.msgChunk?e.msgChunk:s};this._loadMsgsPromise(i,s,Store.Msg.getContext(o,c),"around").then(function(e){var t=c();t!==s&&n.notifyMsgCollectionMerge(t,s,t);var o=e[0],l=a?Store.Msg.get(a):i;l&&_.isArray(o)&&o.length<r&&(l.msgChunk.msgLoadState.noEarlierMsgs=!0,l.msgChunk!==s&&(s.msgLoadState.noEarlierMsgs=!0))})["catch"](function(){t&&(t.isQuotedMsgAvailable=!1)})}return{collection:s,msg:i,key:a,highlightMsg:!0}},sendStarMsgs:function(e,t){var n=this;return this.promises.sendStarMsgs?this.promises.sendStarMsgs:this.promises.sendStarMsgs=R.sendMessageStarred(this.id,_.map(e,function(e){return e.id}),t).then(function(n){return 200===n.status&&(_.forEach(e,function(e){e.set("star",t)}),t?Store.AllStarredMsgs.add(e):Store.AllStarredMsgs.remove(e)),n})["finally"](function(){n.promises.sendStarMsgs=null})},sendRevokeMsgs:function(e,t){var n=this;return this.promises.sendRevokeMsgs?this.promise.sendRevokeMsgs:this.promises.sendRevokeMsgs=u["default"].all(e.map(function(e){return e.sendRevoke(t)}))["finally"](function(){n.promises.sendRevokeMsgs=null;
})},sendNotSpam:function(e,t){var n=this;if(!O.supportsFeature(O.F.SPAM))return u["default"].resolve();if(this.notSpam)return u["default"].resolve();if(this.notSpam=!0,this.promises.sendNotSpam)return this.promises.sendNotSpam;if(this.promises.sendNotSpam=R.sendConversationNotSpam(this.id),e){var i=new B(l10n.t("action_mark_as_not_spam"));t=t||G.genId();var a=this.promises.sendNotSpam.then(function(e){return 200===e.status?new B(l10n.t("action_marked_as_not_spam")):e.status>=400?new B(l10n.t("action_mark_as_not_spam_failed")):void 0})["catch"](function(i){return b.error("models:chat:sendNotSpam dropped")(i),new B(l10n.t("action_mark_as_not_spam_failed"),l10n.t("action_try_again"),n.sendNotSpam(e,t))});D.openToast(M.createElement(G,{id:t,initialAction:i,pendingAction:a}))}return this.promises.sendNotSpam["finally"](function(){n.promises.sendNotSpam=null})},sendSpamReport:function(e){var t=this;if(this.promises.sendSpamReport)return this.promises.sendSpamReport;this.promises.sendSpamReport=R.sendSpamReport(this.id);var n=new B(l10n.t("action_spam_report"));e=e||G.genId();var i=this.promises.sendSpamReport.then(function(e){return 200===e.status?new B(l10n.t("action_spam_reported")):e.status>=400?new B(l10n.t("action_spam_report_failed")):void 0})["catch"](function(n){return b.error("models:chat:sendSpamReport dropped")(n),new B(l10n.t("action_spam_report_failed"),l10n.t("action_try_again"),t.sendSpamReport.bind(t,e))});return D.openToast(M.createElement(G,{id:e,initialAction:n,pendingAction:i})),this.promises.sendSpamReport["finally"](function(){t.promises.sendSpamReport=null})},sendDeleteMsgs:function(e){var t=this;return this.promises.sendDeleteMsgs?this.promises.sendDeleteMsgs:this.promises.sendDeleteMsgs=R.sendMessageDelete(this.id,_.map(e,function(e){return e.id}),!0).then(function(t){return 200===t.status&&_.forEach(e,function(e){e["delete"]()}),t})["finally"](function(){t.promises.sendDeleteMsgs=null})},deleteMsgs:function(e,t){var n=this;this.getAllCMCs().forEach(function(i){i.filter(function(e){return!t||a(e,t)}).filter(function(t){return(e||!t.star)&&!t.isPersistent}).forEach(function(e){e["delete"]()}),0===i.length&&i!==n.msgs&&n.removeMsgsCollection(i)}),this.unreadCount=0},deleteMsgsOlderThan:function(e,t,n){var i=this.msgs,s=_.head(i.models);if(s&&!(s.t>=e)){if(s=_.last(i.models),s.t<e)return void this.deleteMsgs(t,n);var r=function(i){return i&&(n&&!a(i,n)||i.star&&!t||i.t>=e||i.isPersistent)};this.deleteMsgsPartial(r)}},deleteMsgsBeforeMsgInclusive:function(e,t){if(e&&this.msgs.get(e.id)){var n=this.msgs.indexOf(e),i=function(e,i){return e.msgChunk===this.msgs&&i>n||t&&e.star||e.isPersistent};this.deleteMsgsPartial(i)}},deleteMsgsPartial:function(e){var t=this,n=this.unreadCount;if(this.getAllCMCs().forEach(function(n){var i=n.filter(function(n,i,a){return!e.apply(t,[n,i,a])});n.remove(i),i.forEach(function(e){e["delete"]()})}),_.clone(this.msgChunks).forEach(function(e){0===e.length&&t.removeMsgsCollection(e)}),this.msgs.length>0){var i=n>this.msgs.length?this.msgs.length:n;this.unreadCount=i,this.msgs.msgLoadState.noEarlierMsgs=!0}},getFirstMsgWithStatus:function(){return _.find(this.msgs.models,function(e){return!e.isNotification&&(e.isSentByMe||e.type===p["default"].TYPE.PTT)})},getFirstMsgFromMe:function(){return _.find(this.msgs.models,function(e){return!e.isNotification&&e.isSentByMe})},getLastReceivedMsg:function(){for(var e=this.msgs.length-1;e>=0;e--){var t=this.msgs.at(e);if(t&&(!t.local||t.ack>0))return t}},getLastMsgKeyForAction:function(){var e=this.msgs.last();return e?!this.lastReceivedKey||e.id.fromMe&&e.local&&0===e.ack?e.id:this.lastReceivedKey:void 0},getLastTimestampMsg:function(){for(var e=this.msgs.length-1;e>=0;e--){var t=this.msgs.at(e);if(t&&"i"!==t.eventTypeFromMsgType())return t}},createMessageFromText:function(e){if(e=_.trim(e),""===e)return null;var t=this.id,n=Store.Conn.me,i=new F({from:n,to:t,id:p["default"].newTag(),participant:void 0,selfDir:"out"}),a={id:i,body:e,type:"chat",subtype:null,t:A.globalUnixTime(),from:n,to:t,self:"out",local:!0,ack:0};return new p["default"](a)},sendMessage:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments[2],i=arguments[3];if(e=_.trim(e),""===e)return u["default"].resolve();this._messageSent();var a=this.id,s=Store.Conn.me,r=new F({from:s,to:a,id:p["default"].newTag(),participant:void 0,selfDir:"out"}),o=n&&n.contextInfo(this.id),l=_.defaults({id:r,body:e,type:"chat",subtype:t&&!_.isEmpty(t)?"url":null,t:A.globalUnixTime(),from:s,to:a,self:"out",local:!0,ack:0},t,o,{mentionedJidList:i}),c=new p["default"](l),d=Store.Msg.send(c);return this.msgs.add(c),d},sendContact:function(e){var t=H.cleanValue(e.formattedName),n="BEGIN:VCARD\nVERSION:3.0\nN:"+H.getName(e)+"\nFN:"+t+"\nTEL;type=CELL;waid="+e.userid+":"+U.formattedUser(e.userid)+"\nEND:VCARD",i={ack:0,body:n,from:Store.Conn.me,id:new F({from:Store.Conn.me,to:this.id,id:p["default"].newTag(),participant:void 0,selfDir:"out"}),local:!0,self:"out",subtype:e.formattedName,t:A.globalUnixTime(),to:this.id,type:"vcard",isNewMsg:!0};this.addAndSendMsg(i)},forwardMessages:function(e){var t=this,n=this.id,i=this.contact;if(i.isUser&&i.isBlocked())return u["default"].reject(new L.ContactBlocked("Forwarded to contact is blocked",i));var a=[];return u["default"].each(e,function(e){if(e.isMMS)return(0,h.forwardMediaMsg)(e,t);var i=_.omit(e.toJSON(),"quotedMsg"),a=new F({from:Store.Conn.me,to:n,id:p["default"].newTag(),participant:void 0,selfDir:"out"});return _.assign(i,{id:a,from:Store.Conn.me,t:A.globalUnixTime(),to:n,ack:0,participant:void 0,local:!0,self:"out",isNewMsg:!0,star:!1}),t.addAndSendMsg(i)})["return"](a)},updateReadOnly:function(){this.isGroup&&!this.groupMetadata.stale&&(this.isReadOnly=!this.groupMetadata.participants.get(Store.Conn.me)),this.isBroadcast&&this.updateTitle()},sortMsgs:function(e){var t=_.map(e,function(e){var t=e.msgChunk;return{msg:e,chunkT:t.models[0].t,index:t.indexOf(e)}});return _(t).orderBy(["chunkT","index"]).map("msg").value()},_updateAssignedColor:function(){if(this.colors){var e=this.groupMetadata.participants;if(0!==e.size){var t=this.colors,n=_.difference(_.keys(t),e.map("id").map(j));n.forEach(function(e){delete t[e]}),n.length&&this._saveAssignedColors()}}},loadAssignedColors:function(){return this.groupMetadata&&this.listenTo(this.groupMetadata.participants,"remove reset",this._updateAssignedColor),I.getGroupParticipantAssignedColor(this.id)||{}},saveAssignedColors:function(){var e=this.colors;e&&I.setGroupParticipantAssignedColor(this.id,e)},assignedColor:function(e){var t,n=this,i=this.colors||(this.colors=this.loadAssignedColors()),a=j(e);if(t=i[a])return t;var s=function(){var e={};_.forEach(i,function(t,n){e[t]?e[t].push(n):e[t]=[n]});for(var s=Number.POSITIVE_INFINITY,r=1;r<C.NUM_COLORS;r++){if(!e[r]){t=r;break}e[r].length<s&&(s=e[r].length,t=r)}return i[a]=t,n._saveAssignedColors(),{v:t}}();return"object"==typeof s?s.v:void 0},setSubject:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments[1];if(t=t.trim(),!t)return u["default"].reject(new L.ActionError);if(t===this.contact.name)return u["default"].reject(new L.ActionError);var i=R.changeSubject(this.id,t),a=this.contact.name,s=new B(l10n.t("action_group_renaming"));n=n||G.genId();var r=i.then(function(i){return 200===i.status?new B(l10n.t("action_group_renamed",{subject:t}),l10n.t("action_undo"),e.setSubject.bind(e,a,n)):i.status>=400?new B(l10n.t("action_group_rename_failed")):void 0})["catch"](function(i){return b.error("models:chat:setSubject dropped")(i),new B(l10n.t("action_group_rename_failed"),l10n.t("action_try_again"),e.setSubject.bind(e,t,n))});return D.openToast(M.createElement(G,{id:n,initialAction:s,pendingAction:r})),i.then(function(n){200!==n.status||n._duplicate||(e.contact.name=t)})},unstarAll:function(){this.getAllMsgs().forEach(function(e){e&&(e.star=!1)}),Store.AllStarredMsgs.remove(this.getAllMsgs())},constructMediaMsgs:function(e){if(!e)return this.getMediaMsgs();var t=void 0;return this.getMediaMsgs().contains(e)||e.msgChunk===this.msgs?(t=this.getMediaMsgs(),t.hasMediaAfter=!1):t=new k,t.contains(e)||(e.msgChunk?t.add(e.msgChunk.filter(function(e){return e.isMedia})):t.add(e)),t},fts:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments[2];if(1===n){var a=this.ftsCache[e];if(a)return a;var s=Store.Msg.search(e,n,i,this.id);this.ftsCache[e]=s;var r=function(){t.ftsCache[e]=null};return _.delay(r,V),s["catch"](r),s}return Store.Msg.search(e,n,i,this.id)},_clearFtsCache:function(){this.ftsCache={}},updateSortTime:function(){var e=this;this.promises.updateSortTime||(this.promises.updateSortTime=this.regCancellablePromise(u["default"].delay(0)).then(function(){var t=e.getLastTimestampMsg();return t?(e.t=t.t,u["default"].resolve()):e.msgs.msgLoadState.noEarlierMsgs?(e.t=void 0,u["default"].resolve()):e.pendingMsgs?u["default"].resolve():e.loadEarlierMsgs()}).then(function(t){if(t){var n=e.getLastTimestampMsg();e.t=n?n.t:void 0}})["catch"](_.noop)["finally"](function(){e.promises.updateSortTime=void 0}))},removeFromCollection:function(e){e.star&&this.starredMsgs&&this.starredMsgs.remove(e),e.isMedia&&this.mediaMsgs?this.mediaMsgs.remove(e):e.hasLink&&this.linkMsgs?this.linkMsgs.remove(e):e.isDoc&&this.docMsgs&&this.docMsgs.remove(e)},getMediaMsgs:function(){return this.mediaMsgs||(this.mediaMsgs=new k),this.mediaMsgs},getLinkMsgs:function(){return this.linkMsgs||(this.linkMsgs=new N),this.linkMsgs},getDocMsgs:function(){return this.docMsgs||(this.docMsgs=new w),this.docMsgs},getStarredMsgs:function(){var e=this;return this.starredMsgs||(this.starredMsgs=new x,this.starredMsgs.parent=this,this.starredMsgs.add(Store.AllStarredMsgs.filter(function(t){return t.chat===e}))),this.starredMsgs},setAndKeepPrevious:function(e,t){var n=this,i=(0,r["default"])(e);i.forEach(function(e){e in n.ackedProps||(n.ackedProps[e]=n[e])}),t["finally"](function(){i.forEach(function(e){delete n.ackedProps[e]})}),this.set(e)},getAckedPhoneProps:function(){return{wid:this.id,mute:this.mute.expiration,active:this.active,isReadOnly:this.isReadOnly,modifyTag:this.modifyTag,unreadCount:this.unreadCount,archive:"archive"in this.ackedProps?this.ackedProps.archive:this.archive,notSpam:"notSpam"in this.ackedProps?this.ackedProps.notSpam:this.notSpam,pin:"pin"in this.ackedProps?this.ackedProps.pin:this.pin}}},z=(0,S.genMirrorMask)(W),Y=T.extend(W,{mirrorMask:z});Y.KIND=q,t["default"]=Y;t.ChatProxy=(0,E["default"])(W,z)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{found:!1};if(e===t)return n.found=!0,"";if(e instanceof HTMLImageElement)return e.alt;if(e.nodeType===Node.TEXT_NODE)return e.nodeValue;for(var i=y["default"].formatDelim(e)||"",s="",r=0;r<e.childNodes.length&&(s+=a(e.childNodes[r],t,n),!n.found);)r++;return i?""+i+s+i:s}function s(e,t,n,i,a,r){if(n>i)return-1;var o,l=Math.round((n+i)/2),c=e[l],u=c.offsetLeft-a;if(u>=t)o=r;else{if(u+c.clientWidth>t)return l;o=!r}return o?s(e,t,n,l-1,a,r):s(e,t,l+1,i,a,r)}function r(e,t){for(var n=0,i=e.childNodes,a=0;a<i.length;a++){var s=i[a];if(s===t)break;n+=s.clientWidth}return n}Object.defineProperty(t,"__esModule",{value:!0}),t.EMOJI_SIZE=void 0;var o=n(16),l=i(o),c=n(4),u=i(c),d=n(20),p=i(d),h=n(19),f=i(h),m=n(10),g=i(m),v=n(1428),y=i(v),_=n(44),E=i(_),S=n(1384),M=i(S),C=n(1377),b=i(C),T=n(8),P=i(T),k=n(45),N=i(k),w=n(1480),x=i(w),O=n(54),D=n(1510),R=n(161),I=t.EMOJI_SIZE={SMALL:"SMALL",LARGE:"LARGE"},A=4096,L=function(e){function t(){var e,n,i,o;(0,u["default"])(this,t);for(var c=arguments.length,d=Array(c),h=0;c>h;h++)d[h]=arguments[h];return n=i=(0,p["default"])(this,(e=t.__proto__||(0,l["default"])(t)).call.apply(e,[this].concat(d))),i.state={text:(0,R.removeFEOF)(i.props.text),ellipsified:null},i.registeredListener=!1,i.registerResizeListener=function(){i.registeredListener||(i.registeredListener=!0,i.props.listeners.add(window,"resize",i.recompute),i.props.listeners.add(g["default"],"resize",i.recompute))},i.unregisterResizeListener=function(){i.registeredListener&&(i.registeredListener=!1,i.props.listeners.remove(window,"resize",i.recompute),i.props.listeners.remove(g["default"],"resize",i.recompute))},i.containsEmoji=function(){return(0,R.containsEmoji)((i.state.text||"").substring(0,A))},i.recompute=i.props.debounce(function(){i.setState({ellipsified:null},i.ellipsify)},10),i.ellipsifyCheck=function(){return i.containsEmoji()&&i.ellipsify()},i.ellipsify=function(){var e=N["default"].findDOMNode(i);if(e){var t=e.querySelectorAll("img");if(t.length){var n=void 0,o=0;if(n=e.clientWidth){if(n===e.scrollWidth)return;o=0}else{var l=e.parentNode;if(l.clientWidth===l.scrollWidth)return;o=r(l,e),n=l.clientWidth-o}var c=l10n.isRTL()===i.props.dirMismatch,u=s(t,c?n:0,0,t.length-1,c?o:0,c);if(!(0>u)){var d=t[u],p=10;p-=Math.floor(p/4);var h=s(t,c?n-p:p,0,u,c?o:0,c);h>-1&&(d=t[h]),i.setState({ellipsified:a(e,d)})}}}},i.componentWillMount=function(){O.isWebkit&&i.props.ellipsify&&i.containsEmoji()&&i.registerResizeListener()},i.componentDidMount=function(){O.isWebkit&&i.props.ellipsify&&i.props.listeners.uiIdle(i.ellipsifyCheck)},i.componentWillReceiveProps=function(e){var t=e.text,n=(0,R.removeFEOF)(t);i.setState({text:n});var a=i.props.ellipsify;if(O.isWebkit&&a&&n!==i.state.text){var s=(n||"").substring(0,A);(0,R.containsEmoji)(s)?(i.recompute(),i.registerResizeListener()):(i.setState({ellipsified:null}),i.unregisterResizeListener())}},i.render=function(){if(!i.state.text)return null;var e=i.state.ellipsified;e||(e=i.props.ellipsify?(i.state.text||"").substring(0,A):i.state.text);var t="inherit"===i.props.direction?null:i.props.direction||"auto",n={className:(0,E["default"])(i.props.className,{emojitext:!i.props.className,ellipsify:!!i.props.ellipsify,"inverse-text-direction":i.props.dirMismatch,"selectable-text":i.props.selectable}),dir:t,title:i.props.titlify?i.state.text:void 0},a=i.props,s=a.element,r=a.formatters;return P["default"].createElement(s,n,(0,M["default"])(e,r,D.JSXSerializer),i.state.ellipsified?"…":null)},o=n,(0,p["default"])(i,o)}return(0,f["default"])(t,e),t}(P["default"].PureComponent);L.defaultProps={element:"span",emojiSize:I.SMALL,formatters:S.Configuration.EmojiOnly()},t["default"]=(0,b["default"])((0,x["default"])(L))},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(22),s=i(a),r=n(94),o=i(r),l=n(236),c=i(l),u=n(489),d=i(u),p=n(35),h=i(p),f=n(1),m=n(13),g=n(10),v=n(18),y={async:function(e,t){var n=e.split(".").slice(-1),i=(0,h["default"])(n,1),a=i[0];return this._asyncKey(a,e,t)},asyncState:function(e,t){var n=this,i=v.mapValues(e,function(e,t){return n._asyncKey(t,e)});for(var a in t)void 0===i[a]&&(i[a]=t[a]);return i},_asyncKey:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.props,i=t.split("."),a=this._getAsyncIndex(i),s=i.slice(0,a),r=(0,d["default"])(s),o=r[0],l=r.slice(1),c=i.slice(a+1),u=n[i[0]];return a&&(u=this._getObservable(e,o,l,n,i[a])),u?v.isFunction(u.on)||v.isFunction(u.off)?this._asyncObserver(e,i,l,u,c):f.trace("asyncMixin path resolved to non-observable: "+t):f.trace("asyncMixin path resolved to nonexistent state! path: "+t)},_getObservable:function(e,t,n,i,a){var s=n.length?i[t].getp(n):i[t];return s?Store[a].get(s):null},_asyncObserver:function(e,t,n,i,a){var s=this;i.stale&&this._loadStale(i);var r="change:"+a.join("."),o=function(){return s.setOrQueueState((0,c["default"])({},e,i.getp(a)))};return i.on(r,o),i.isState&&i._uiObservers++,this._asyncs=this._asyncs||{},this._asyncs[e]={key:e,splitPath:t,basePath:n,observable:i,callback:o,eventKey:r},i.getp(a)},_loadStale:function(e){var t=this;g.uiBusy?!function(){var n=t._waAsyncIdle||(t._waAsyncIdle=[]),i=function a(){e.getCollection().find(e.id)["catch"](m.WapDrop,v.noop),t._waAsyncIdle&&(v.pull(t._waAsyncIdle,a),0===t._waAsyncIdle.length&&(t._waAsyncIdle=null))};g.once("ui_idle",i),n.push(i)}():e.getCollection().find(e.id)["catch"](m.WapDrop,v.noop)},componentWillMount:function(){this.__willMount=!0,this.__stateQueue&&(this.setState(v.assign.apply(v,[{}].concat((0,o["default"])(this.__stateQueue)))),this.__stateQueue=void 0)},setOrQueueState:function(e){this.__willMount?this.setState(e):(this.__stateQueue=this.__stateQueue||[],this.__stateQueue.push(e))},_observersMatch:function(e,t,n,i){return n[e]!==i[e]?!1:!t.length||n[e].getp(t)===i[e].getp(t)},componentWillReceiveProps:function(e){var t=this;if(this._asyncs){var n={};v.forIn(this._asyncs,function(i,a){var s=i.splitPath,r=i.basePath,o=(0,h["default"])(s,1),l=o[0];if(!t._observersMatch(l,r,t.props,e)){var c=i.observable,u=i.callback,d=i.eventKey;c.off(d,u),c.isState&&c._uiObservers--,n[a]=t._asyncKey(a,s.join("."),e)}}),(0,s["default"])(n).length&&this.setOrQueueState(n)}},componentWillUnmount:function(){this._waAsyncUnmount=!0,this._waAsyncIdle&&v.forIn(this._waAsyncIdle,function(e){g.off("ui_idle",e)}),this._asyncs&&v.forIn(this._asyncs,function(e){var t=e.observable,n=e.callback,i=e.eventKey;t.off(i,n),t.isState&&t._uiObservers--})},_getAsyncIndex:function(e){for(var t=1;t<e.length;++t)if(e[t].charAt(0).toLowerCase()!==e[t].charAt(0))return t;return 0}};e.exports=y},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){if(e.dataTransfer){try{if(!e.dataTransfer.dropEffect)return}catch(e){return}e.dataTransfer.effectAllowed&&(e.nativeEvent.dataTransfer.dropEffect="copy")}}var s=n(236),r=i(s),o=n(8),l=n(44),c={LEFT:"left",MID:"mid",RIGHT:"right"},u=o.createClass({displayName:"Drawer",propTypes:{children:o.PropTypes.node.isRequired,id:o.PropTypes.string,variant:o.PropTypes.string,noContainer:o.PropTypes.bool,position:o.PropTypes.oneOf(_.values(c)),onDragLeave:o.PropTypes.func,onDrop:o.PropTypes.func,onDragOver:o.PropTypes.func},getDefaultProps:function(){return{position:"left"}},statics:{RIGHT:"right",LEFT:"left",MID:"mid"},getInitialState:function(){return{isDragging:!1}},isDragDropDrawer:function(){return this.props.onDragOver&&this.props.onDragLeave&&this.props.onDrop},onDragOver:function(e){e.preventDefault(),this.isDragDropDrawer()&&(a(e),this.state.isDragging||(this.props.onDragOver(e),this.setState({isDragging:!0})))},onDrop:function(e){e.preventDefault(),e.stopPropagation(),this.setState({isDragging:!1}),this.props.onDrop(e)},onDragLeave:function(e){e.preventDefault(),e.stopPropagation(),this.state.isDragging&&(this.setState({isDragging:!1}),this.props.onDragLeave(e))},render:function(){var e,t=this.props,n=l(this.props.className,"drawer",(0,r["default"])({},"drawer-"+t.id,!!t.id));if(this.isDragDropDrawer()){var i=this.state.isDragging?{}:{display:"none"};e=o.createElement("div",{key:"mask",className:"drag-drop-mask",style:i,onDragLeave:this.onDragLeave,onDrop:this.onDrop})}return o.createElement("div",{className:n,onDragOver:this.onDragOver},e,t.children)}});u.Position=c,e.exports=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(112),s=i(a),r=n(114),o=i(r),l=n(8),c=n(44),u=l.createClass({displayName:"DrawerBody",propTypes:{classes:l.PropTypes.string,info:l.PropTypes.bool,wide:l.PropTypes.bool},getDefaultProps:function(){return{info:!1,wide:!1}},render:function(){var e=this.props,t=e.classes,n=e.info,i=e.wide,a=(0,o["default"])(e,["classes","info","wide"]),r=c("drawer-body",t,{"drawer-body-info":n,"drawer-body-wide":i});return l.createElement("div",(0,s["default"])({className:r},a),this.props.children)}});e.exports=u},function(e,t,n){"use strict";var i=n(8),a=n(463),s=n(44),r=n(1411),o=r.MenuBar,l=n(110),c={SMALL:"small",LARGE:"large",POPUP:"popup",OFFSET:"offset"},u=i.createClass({displayName:"DrawerHeader",propTypes:{children:i.PropTypes.node,title:i.PropTypes.string,onBack:i.PropTypes.func,onCancel:i.PropTypes.func,a8n:i.PropTypes.string,type:i.PropTypes.oneOf(_.values(c)).isRequired,menu:i.PropTypes.element},render:function(){var e=this.props,t=e.title,n=e.onBack,r=e.onCancel,u=e.type,d=e.children,p=null;if(t){var h=void 0,f=null,m={textAlign:"initial"};u===c.SMALL?(h={fontWeight:400,fontSize:16,lineHeight:"21px"},m.width=54):u===c.LARGE?(h={fontWeight:500,fontSize:19,lineHeight:"normal"},f={backgroundColor:"transparent",padding:"0px"},m.width=54):(h={fontWeight:500,fontSize:19,lineHeight:"19px"},m.width=48,m.opacity=.7);var g=s("icon btn-close-drawer",{"icon-back":u===c.SMALL,"icon-back-light":u!==c.SMALL}),v=n?i.createElement("span",{className:g,"data-a8n":a.key("btn-closer-drawer"),onClick:n}):null,y=s("icon btn-close-drawer",{"icon-x":u===c.SMALL,"icon-x-light":u!==c.SMALL}),_=r?i.createElement("span",{className:y,"data-a8n":a.key("btn-closer-drawer"),onClick:r}):null,E=s({"pane-header":u===c.LARGE},"drawer-title"),S=this.props.menu?i.createElement("span",{className:"pane-list-controls"},i.createElement(o,{key:"drawer-header"},i.createElement(l,{transitionName:"btn"},this.props.menu))):null;p=i.createElement("div",{className:E,style:f},i.createElement("div",{style:m,className:"drawer-title-action"},v,_),i.createElement("span",{"data-a8n":a.key(this.props.a8n),className:"drawer-title-body",style:h},t),S)}var M=s({"drawer-header":u===c.LARGE,"drawer-header-small":u===c.SMALL,"drawer-header-offset":u===c.OFFSET,"drawer-header-popup":u===c.POPUP});return i.createElement("header",{className:M},p,d)}});u.Type=c,e.exports=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(13),o={rejectOnUnmount:function(){var e=this;return this._reject?this._reject:(this._reject=new s["default"](function(t,n){e._rejectFn=n}),this._reject["catch"](_.noop),this._isMounted===!1&&this._rejectFn(new r.Unmount),this._reject)},componentWillUnmount:function(){this._isMounted=!1,this._rejectFn&&this._rejectFn(new r.Unmount)}};e.exports=o},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t,n,i,a){this.hasEngaged=!1,this.hasDisengaged=!1,this.source=e,this.cb=n,this.capture=i,this.wrapper=a,"function"==typeof e.on?(this.useOnOff=!0,this.event=t):(this.useOnOff=!1,this.event=E["default"].prefix(t,e))}Object.defineProperty(t,"__esModule",{value:!0});var s=n(112),r=i(s),o=n(16),l=i(o),c=n(20),u=i(c),d=n(19),p=i(d),h=n(4),f=i(h),m=n(6),g=i(m);t["default"]=function(e){var t,n;return n=t=function(t){function n(){var e,t,i,a;(0,f["default"])(this,n);for(var s=arguments.length,r=Array(s),o=0;s>o;o++)r[o]=arguments[o];return t=i=(0,u["default"])(this,(e=n.__proto__||(0,l["default"])(n)).call.apply(e,[this].concat(r))),i.listeners=new N(function(){i.forceUpdate()}),a=t,(0,u["default"])(i,a)}return(0,p["default"])(n,t),(0,g["default"])(n,[{key:"componentDidMount",value:function(){this.listeners._markMounted()}},{key:"componentWillUnmount",value:function(){this.listeners._markUnmounted()}},{key:"_getComponent",value:function(){return C._getComponent.call(this)}},{key:"render",value:function(){return k["default"].createElement(e,(0,r["default"])({ref:C.HOCRef},this.props,{listeners:this.listeners}))}}]),n}(k["default"].Component),t.displayName="Listener("+(0,M["default"])(e)+")",n};var v=n(10),y=i(v),_=n(238),E=i(_),S=n(1425),M=i(S),C=n(1387),b=n(1),T=i(b),P=n(8),k=i(P);a.prototype={engage:function(){if(!this.hasEngaged&&!this.hasDisengaged){this.hasEngaged=!0;var e=this.source,t=this.event,n=this.wrapper||this.cb;this.useOnOff?(e.on(t,n),"function"==typeof e.incObservers&&e.incObservers()):e.addEventListener(t,n,this.capture)}},disengage:function(){if(!this.hasDisengaged&&(this.hasDisengaged=!0,this.hasEngaged)){var e=this.source,t=this.event,n=this.wrapper||this.cb;this.useOnOff?(e.off(this.event,n),"function"==typeof e.decObservers&&e.decObservers()):e.removeEventListener(t,n,this.capture)}},represents:function(e,t,n,i){if(this.source!==e)return!1;if(this.event!==t)return!1;if(this.cb!==n)return!1;if(i&&"object"==typeof i){var a=this.capture;return a&&"object"==typeof a?a.passive===i.passive&&a.capture===i.capture:!1}return this.capture===i}};var N=function(){function e(t){(0,f["default"])(this,e),this._mounted=!1,this._unmounted=!1,this._listeners=null,this._rerender=t}return(0,g["default"])(e,[{key:"_add",value:function(e){return this._unmounted?void T["default"].warn("Listener added after unmounting")():(this._listeners?this._listeners.push(e):this._listeners=[e],void(this._mounted&&e.engage()))}},{key:"_markMounted",value:function(){this._mounted=!0;var e=this._listeners;if(e)for(var t=0;t<e.length;t++)e[t].engage()}},{key:"_markUnmounted",value:function(){this._unmounted=!0;var e=this._listeners;if(e)for(var t=0;t<e.length;t++)e[t].disengage()}},{key:"add",value:function(e,t,n,i){this._add(new a(e,t,n,i,n?void 0:this._rerender))}},{key:"addOnce",value:function(e,t,n,i){var s=arguments,r=this,o=new a(e,t,n,i,function(){o.disengage(),n?n.apply(null,s):r._rerender()});this._add(o)}},{key:"addAndRun",value:function(e,t,n,i){this.add(e,t,n,i),this._unmounted||n()}},{key:"remove",value:function(e,t,n,i){var a=this._listeners;if(a){for(var s=0;s<a.length;s++){var r=a[s];r.represents(e,t,n,i)&&r.disengage()}this._listeners=a.filter(function(e){return!e.hasDisengaged})}}},{key:"uiIdle",value:function(e){var t=this;y["default"].uiBusy?!function(){var n=new a(y["default"],"ui_idle",e,void 0,function(){n.disengage(),e()});t._add(n)}():e()}}]),e}()},function(e,t,n){"use strict";function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function a(e){return e&&e.__esModule?e:{"default":e}}function s(e,t,n){function i(e){t.call(this,e)}for(var a={_ProxyState$ComponentName:{value:e},proxyBitMask:{value:(0,k.genBitMask)(t.prototype.mirrorMask,n)}},s=function(e){var t=n[e];a[t]={enumerable:!0,get:function(){return this._ProxyState$state.get(t)},set:function(e){this._ProxyState$state.set(t,e)}}},r=0;r<n.length;r++)s(r);return i.prototype=(0,S["default"])(t.prototype,a),i.prototype.constructor=i,i}Object.defineProperty(t,"__esModule",{value:!0});var r=n(112),o=a(r),l=n(236),c=a(l),u=n(16),d=a(u),p=n(20),h=a(p),f=n(19),m=a(f),g=n(4),v=a(g),y=n(6),_=a(y),E=n(80),S=a(E);t["default"]=function(e){var t,n,i=e.name,a=e.CONCERNS,s=e.WEAK_CONCERNS;if(!a&&!s)throw new Error("StateHOC wrapping class with no concerns, check "+i);var r=[];if(a)for(var l in a)r.push(new D(i,l,a[l],!0));if(s)for(var u in s){if(a.hasOwnProperty(u))throw new Error('Component has marked "'+u+'" as both a normal and weak concern, check '+i);r.push(new D(i,u,s[u],!1))}return n=t=function(t){function n(e){(0,v["default"])(this,n);var t=(0,h["default"])(this,(n.__proto__||(0,d["default"])(n)).call(this,e));t.rr=function(e,n){t.setState((0,c["default"])({},e.name,new e.whitelistedProxyClass(n)))};for(var i=t.state={},a=0;a<r.length;a++){var s=r[a],o=s.name;i[o]=s.attachConcern(e[o],t.rr)}return t}return(0,m["default"])(n,t),(0,_["default"])(n,[{key:"componentWillReceiveProps",value:function(e){for(var t=this.props,n=null,i=0;i<r.length;i++){var a=r[i],s=a.name;t[s]!==e[s]&&(a.detachConcern(t[s],this.rr),n||(n={}),n[s]=a.attachConcern(e[s],this.rr))}n&&this.setState(n)}},{key:"componentWillUnmount",value:function(){for(var e=this.props,t=0;t<r.length;t++){var n=r[t];n.detachConcern(e[n.name],this.rr)}}},{key:"_getComponent",value:function(){return b._getComponent.call(this)}},{key:"render",value:function(){return C["default"].createElement(e,(0,o["default"])({ref:b.HOCRef},this.props,this.state))}}]),n}(C["default"].Component),t.displayName="State("+(0,w["default"])(e)+")",n};var M=n(8),C=a(M),b=n(1387),T=n(77),P=a(T),k=n(469),N=n(1425),w=a(N),x=n(1680),O=i(x),D=function(){function e(t,n,i,a){(0,v["default"])(this,e),this.componentName=t,this.name=n,this.isStrong=a;var r=O[""+n[0].toUpperCase()+n.slice(1)+"Proxy"];if(!r)throw new Error('Unknown StateHOC concern type "'+n+'"');this.proxyClass=r,this.whitelistedProxyClass=s(t,r,i)}return(0,_["default"])(e,[{key:"getModel",value:function(e){var t=e instanceof this.proxyClass?e._ProxyState$state:e;if(!t)throw new Error(this.componentName+" was not supplied the "+this.name+" model.");if(!(t instanceof P["default"]))throw new Error(this.componentName+" given invalid object for "+this.name+": "+t);return t}},{key:"attachConcern",value:function(e,t){var n=this.getModel(e);n.incObservers(!this.isStrong);var i=new this.whitelistedProxyClass(n);return n.mirror.addListener(t,i.proxyBitMask,this,n),i}},{key:"detachConcern",value:function(e,t){var n=this.getModel(e);n.decObservers(),n.mirror.removeListener(t)}}]),e}()},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(1395),m=i(f),g=n(1448),v=(i(g),n(1378)),y=i(v),_=n(1542),E=i(_),S=n(44),M=n(8),C=n(157),b=n(21),T=n(13),P=n(464),k={SMALL:"SMALL",MEDIUM:"MEDIUM",LARGE:"LARGE",AUTO:"AUTO",NONE:"NONE"},N={LOW:"LOW",HIGH:"HIGH"},w=function(e){function t(e){(0,o["default"])(this,t);var n=(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).call(this,e));n.state={loading:!0},n.onLoad=function(e){n.state.loading&&n.setState({loading:!1}),n.props.onLoad&&n.props.onLoad()},n.onError=function(e){e instanceof T.ServerStatusError&&n.props.profilePicThumb.onError(e.status),n.state.loading&&n.setState({loading:!1})};var i=e.profilePicThumb.imgFull;return i&&P.isCached(i)&&(n.state={loading:!1}),n}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){var e=this.props,t=e.profilePicThumb,n=e.loader,i=this.state.loading,a=S("avatar-image",{"is-loaded":!i}),s=void 0;return n&&i&&(t.stale||t.imgFull)&&(s=M.createElement("div",{className:"avatar-spinner-container"},M.createElement(C,{size:50,stroke:3}))),M.createElement("div",{className:"avatar-body"},M.createElement(m["default"],{src:t.imgFull,hasPrivacyChecks:!0,crossOrigin:!1,className:a,onLoad:this.onLoad,onError:this.onError}),s)}}]),t}(M.PureComponent);w.CONCERNS={profilePicThumb:["imgFull","stale"]};var x=(0,y["default"])(w),O=function(e){function t(e){(0,o["default"])(this,t);var n=(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).call(this,e));n.state={loading:!0},n.onLoad=function(e){n.state.loading&&n.setState({loading:!1}),n.props.onLoad&&n.props.onLoad()},n.onError=function(e){e instanceof T.ServerStatusError&&n.props.profilePicThumb.onError(e.status),n.state.loading&&n.setState({loading:!1})};var i=e.profilePicThumb.img;return i&&P.isCached(i)&&(n.state={loading:!1}),n}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){var e=this.props,t=e.profilePicThumb,n=e.loader,i=this.state.loading,a=S("avatar-image",{"is-loaded":!i}),s=void 0;return n&&i&&(t.stale||t.img)&&(s=M.createElement("div",{className:"avatar-spinner-container"},M.createElement(C,{size:50,stroke:3}))),M.createElement("div",{className:"avatar-body"},M.createElement(m["default"],{src:t.img,hasPrivacyChecks:!0,crossOrigin:!1,className:a,onLoad:this.onLoad,onError:this.onError}),s)}}]),t}(M.PureComponent);O.CONCERNS={profilePicThumb:["img","stale"]};var D=(0,y["default"])(O),R=function(e){switch(e){case k.SMALL:return 49;case k.MEDIUM:return 100;case k.LARGE:return 200;case k.NONE:return;default:return e}},I=function(e){var t=e.id,n=e.size,i=e.quality,a=e.className,s=e.loader,r=e.onClick,o=e.onLoad,l=e.quoted;n=n||k.SMALL,i=i||N.LOW;var c={height:R(n),width:R(n)};r&&(c.cursor="pointer");var u=S("avatar",a,{"icon-user-default":b.isUser(t),"icon-user-default-square":b.isUser(t)&&l,"icon-group-default":b.isGroup(t),"icon-broadcast-default":b.isBroadcast(t),"icon-psa-default":b.isPSA(t)}),d=function(){var e=null,n=Store.ProfilePicThumb.get(t);return n&&(e=i===N.HIGH?M.createElement(x,{profilePicThumb:n,loader:s,onLoad:o}):M.createElement(D,{profilePicThumb:n,loader:s,onLoad:o})),M.createElement("div",{className:u,style:c,onClick:r},e)};return M.createElement(E["default"],{id:t,onComplex:d},M.createElement("div",{className:u,
style:c,onClick:r}))};e.exports=I,e.exports.Size=k,e.exports.Quality=N},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){return t?e+" · "+l10n.t("status_v3"):e}var s=n(1371),r=i(s),o=n(458),l=i(o),c=n(8),u=n(1392),d=n(10),p=n(21),h=n(44),f=n(1),m=function(e){var t=e.msg,n=e.chat,i=e.displaySelf,s=e.className,o=e.disableClick,m=e.quoted,g=n||t.chat;f.assert(g,"author-with-no-chat")();var v=g?g.assignedColor(t.sender):1,y=t.senderObj,E=h("message-author color-"+v,s,{"message-author-image":(t.type===l["default"].TYPE.VIDEO||t.type===l["default"].TYPE.IMAGE)&&!m,"message-author-location":t.type===l["default"].TYPE.LOCATION&&!m&&!t.isLive}),S=o?_.noop:function(){Store.Chat.find(t.sender).then(function(e){d.openChatFromUnread(e).then(function(t){t&&d.focusChatTextInput(e)})})},M=o?null:"text-clickable",C=void 0;return i?C=c.createElement(r["default"],{text:a(l10n.t("web_you"),t.isStatusV3)}):y.name?(C=[c.createElement("span",{className:h("author-name",M),key:"author",onClick:S},c.createElement(r["default"],{text:a(y.name,t.isStatusV3)}))],y.isVerified&&C.push(c.createElement("span",{key:"verified",className:"icon-psa-verified"}))):(C=[c.createElement("span",{className:h("number",M),key:t.id+"-number",onClick:S},a(p.formattedUser(y.id),t.isStatusV3))],t.isStatusV3||C.push(c.createElement("span",{className:h("ellipsify","screen-name",M),key:t.id+"-push-name",onClick:S},c.createElement(r["default"],{className:"screen-name-text",direction:"auto",text:y.notifyName})))),c.createElement("h3",{className:E},c.createElement(u,{className:"multi-token"},C))};m.shouldRender=function(e){return!e.isSentByMe&&e.isGroupMsg},m.propTypes={msg:c.PropTypes.instanceOf(l["default"]).isRequired,displaySelf:c.PropTypes.bool,disableClick:c.PropTypes.bool,quoted:c.PropTypes.bool,className:c.PropTypes.string},e.exports=m},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(458),s=i(a),r=n(8),o=n(1392),l=n(1592),c=n(44),u=n(76),d=n(10),p=n(61),h=r.createClass({displayName:"Meta",propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired},openInfoDrawer:function(){d.msgInfoDrawer(this.props.msg)},render:function(){var e,t,n=this.props.msg,i=n.broadcast||n.star?(n.type===s["default"].TYPE.IMAGE||n.type===s["default"].TYPE.VIDEO||n.type===s["default"].TYPE.AUDIO)&&!n.caption:null;if(n.broadcast){var a=c("icon-s",{"icon-broadcast-light":i,"icon-broadcast":!i});e=r.createElement("span",{className:a})}if(n.star){var d=c("icon-s",{"icon-star-light":i,"icon-star":!i&&n.isSentByMe,"icon-star-in":!i&&!n.isSentByMe});t=r.createElement("span",{className:d})}var h=n.isSentByMe?r.createElement(l,{msg:this.props.msg}):null,f=n.isSentByMe&&p.supportsFeature(p.F.MESSAGE_INFO);return r.createElement("div",{className:f?"message-meta text-clickable":"message-meta",onClick:f?this.openInfoDrawer:null},t,e,r.createElement(o,null,r.createElement("span",{className:"message-datetime"},n.t?u.timestampStr(n.t):null)),h)}});e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(111),s=i(a),r=n(8),o=n(45),l=n(463),c=n(158),u=n(44),d=n(92),p=r.createClass({displayName:"MenuItem",mixins:[c],propTypes:{children:r.PropTypes.node.isRequired,a8n:r.PropTypes.string.isRequired,action:r.PropTypes.func,tooltip:r.PropTypes.node,filePickerMimes:r.PropTypes.string,onFilePick:r.PropTypes.func},getInitialState:function(){return{hover:!1,focus:!1}},componentWillMount:function(){this.props.filePickerMimes&&this.regNativeListener(window,"focus",this.onWindowFocus)},onMouseEnter:function(){this.setState({hover:!0})},onMouseLeave:function(){this.setState({hover:!1})},onFocus:function(){this.setState({focus:!0})},onBlur:function(){this.setState({focus:!1})},preventDefault:function(e){e.preventDefault()},onAction:function(e){if(e.isTrusted&&!e.repeat){var t=this.props,n=t.action,i=t.filePickerMimes;if(n){var a=n(e);if(i)return void(this.active=!0);var s=this.context.uim;s&&(a===!1&&s.pop(!1,!1),s.uie.requestDismiss())}}},triggerInput:function(){o.findDOMNode(this.refs.filePicker).click()},onWindowFocus:function(e){this.active&&this.onFilePick()},onFilePick:function(e){if(this.props.onFilePick){this.props.onFilePick(e);var t=this.context.uim;t&&t.uie.requestDismiss()}},render:function(){var e=this.props,t=e.children,n=e.tooltip,i=e.filePickerMimes,a=this.state,o=a.hover,c=a.focus;n=(o||c)&&n?n:null;var d={enter:this.onAction},p=u("menu-item menu-shortcut",{"highlighted-menu-item":o||c}),f=void 0;return i&&(f=r.createElement(h,{mime:i,ref:"filePicker",onPick:this.onFilePick})),_.isString(t)&&(t=r.createElement("a",{className:"ellipsify",title:t},t)),r.createElement(s["default"],{component:"li",className:p,handlers:d,"data-a8n":l.key(this.props.a8n),onContextMenu:this.preventDefault,onMouseDown:this.preventDefault,onClick:this.onAction,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onFocus:this.onFocus,onBlur:this.onBlur},t,n,f)}});p.contextTypes={uim:r.PropTypes.instanceOf(d)};var h=r.createClass({displayName:"FilePicker",propTypes:{mime:r.PropTypes.string.isRequired,multiple:r.PropTypes.bool,onPick:r.PropTypes.func.isRequired},getDefaultProps:function(){return{multiple:!0}},render:function(){return r.createElement("input",{accept:this.props.mime,type:"file",multiple:this.props.multiple,style:{display:"none"},onClick:function(e){return e.stopPropagation()},onChange:this.props.onPick})}});e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(){return++m}var s=n(236),r=i(s),o=n(1),l=n(8),c=n(44),u=n(110),d=n(92),p=n(234),h={DEFAULT_PUSH:"flow-transition-drawer-push",DEFAULT_POP:"flow-transition-drawer-pop",NONE:"none"},f={PUSH:"push",POP:"pop"},m=0,g={getInitialState:function(){return{_stack:[],_activeKey:void 0,_transition:void 0}},defaultTransition:function(e){var t,n=_.isFunction(this.getDefaultTransition)?this.getDefaultTransition():{};return _.assign((t={},(0,r["default"])(t,f.PUSH,h.DEFAULT_PUSH),(0,r["default"])(t,f.POP,h.DEFAULT_POP),t),n)[e]},push:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.defaultTransition(f.PUSH),n=this.state._stack.concat(e),i=a();this.setState({_stack:n,_transition:t,_activeKey:i})},pop:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.defaultTransition(f.POP),t=_.dropRight(this.state._stack);if(t.length){var n=a();this.setState({_stack:t,_transition:e,_activeKey:n})}else this.endFlow()},endFlow:function(e){this.context.uim.uie.requestDismiss(e)},render:function(){var e=this,t=this.state,n=t._stack,i=t._transition,a=t._activeKey,s=_.last(n);o.assert(!!s,"empty-flow",s)(),s=l.createElement(p,{displayName:"FlowDrawer"+a,key:a,escapable:!0,requestDismiss:function(){return e.pop()}},s);var r=c("flow-drawer-container");return l.createElement(u,{transitionName:i,className:r},s)}};g.Transition=h,g.Dir=f,g.contextTypes={uim:l.PropTypes.instanceOf(d)},e.exports=g},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t,n,i){return(0,c["default"])(n,(0,o["default"])(e,t),i)}Object.defineProperty(t,"__esModule",{value:!0}),t.Configuration=void 0,t["default"]=a;var s=n(1696);Object.defineProperty(t,"Configuration",{enumerable:!0,get:function(){return i(s)["default"]}});var r=n(1509),o=i(r),l=n(1722),c=i(l)},function(e,t,n){"use strict";function i(e,t){this.list=e,this.selected=_.reduce(e,function(e,t,n){return e[n]=!1,e},{}),this.getter=t||function(e){return e}}var a=n(56);_.assign(i.prototype,a,{init:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!_.isEmpty(this.selected)){if(_.isEmpty(t))return void this.unsetAll();var n=_.reduce(t,function(t,n,i){var a=e.list.indexOf(n);t[i]=a>-1&&e.selected[a]},{});this.selected=n,this.list=t}},unsetAll:function(){var e=this;_.forEach(this.selected,function(t,n){t&&e.set(n,!1)})},reset:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!0;_.forEach(this.selected,function(n,i){n&&e.trigger(e.getter(e.list[i]),!0,!0,t)})},set:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:!0;if(this.list.length){var i=Math.min(Math.max(e,-1),this.list.length-1),a=i>-1?this.list[i]:void 0;a&&(this.selected[i]&&!t||!this.selected[i]&&t)&&(this.selected[i]=t,this.trigger(this.getter(a),t,n))}},setVal:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:!0,i=_.indexOf(this.list,e);-1===i&&(i=this.list.length,this.list.push(e),this.selected[i]=!1),this.set(i,t,n)},setFirst:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!0;_.isEmpty(this.list)||this.set(0,!0,e)},setLast:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!0;_.isEmpty(this.list)||this.set(this.list.length-1,!0,e)},getSelected:function(){var e=this;return _.reduce(this.list,function(t,n,i){return e.selected[i]&&t.push(n),t},[])},isSelected:function(e){return!!this.selected[this.list.indexOf(e)]}}),e.exports=i},function(e,t,n){"use strict";function i(e,t){this.list=e,this.index=-1,this.value=void 0,this.getter=t||function(e){return e}}var a=n(56);_.assign(i.prototype,a,{init:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!1,n=void 0,i=void 0;if(this.list=e,this.value){if(_.isEmpty(e))return void this.unset();if(n=_.indexOf(e,this.value),n>-1){if(n===this.index)return;i=!0,t=!1}else n=t&&this.index>-1?Math.min(Math.max(this.index,0),e.length-1):-1,i=n>-1;this.set(n,t,i)}},unset:function(){this.value&&this.trigger(this.getter(this.value),!1),this.value=void 0,this.index=-1},reset:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!0;this.index<0||this.value&&this.trigger(this.getter(this.value),"focus",e)},set:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:!0;if(this.list.length){var i=Math.min(Math.max(e,-1),this.list.length-1),a=this.value,s=i>-1?this.list[i]:void 0;s?(this.trigger(this.getter(s),t?"focus":"select"),this.value=s):n&&(this.value=void 0),n&&a&&a!==s&&this.trigger(this.getter(a),!1),this.index=i}},getVal:function(){return this.value},setVal:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!0,n=_.indexOf(this.list,e);n>-1?this.set(n,t):(this.unset(),this.value=e)},setFirst:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!0;_.isEmpty(this.list)||this.set(0,e)},setLast:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!0;_.isEmpty(this.list)||this.set(this.list.length-1,e)},setPrev:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!0;_.isEmpty(this.list)||this.set(this.prev(),e)},setNext:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!0;_.isEmpty(this.list)||this.set(this.next(),e)},prev:function(){return _.isEmpty(this.list)?-1:-1===this.index?-1:this.index-1},next:function(){return _.isEmpty(this.list)?-1:Math.min(this.index+1,this.list.length-1)}}),e.exports=i},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){return function(n){n?"function"==typeof n._getComponent?t[e]=n._getComponent():t[e]=n:t[e]=void 0}}function s(){var e=this.refs.component;return"function"==typeof e._getComponent?e._getComponent():e}Object.defineProperty(t,"__esModule",{value:!0}),t.HOCRef=void 0,t.GetRef=a,t._getComponent=s;var r=n(8);i(r),t.HOCRef="component"},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(112),s=i(a),r=n(114),o=i(r),l=n(1371),c=i(l),u=n(8),d=n(157),p=n(44),h=function(e){var t=e.className,n=p("empty-icon",t);return u.createElement("div",{className:"empty-icon-container"},u.createElement("span",{className:n}))},f=function(e){var t=e.icon,n=e.title,i=e.text,a=e.className,r=e.children,l=(0,o["default"])(e,["icon","title","text","className","children"]),d=n?u.createElement("div",{className:"empty-title"},n):null,h=i?u.createElement(c["default"],{element:"div",className:"empty-text",text:i}):null,f=p("empty",a);return u.createElement("div",(0,s["default"])({className:f},l),t,d,h,r)},m=function(){var e=u.createElement(h,{className:"icon-empty-blocked"});return u.createElement(f,{icon:e,title:l10n.t("blocked_empty"),text:l10n.t("add_blocked_description")})},g=function(){var e=u.createElement(h,{className:"icon-empty-archived"});return u.createElement(f,{icon:e,title:l10n.t("archived_empty")})},v=function(){return u.createElement(f,{className:"empty-top",text:l10n.t("search_no_chats_or_contacts")})},y=function(){return u.createElement(f,{className:"empty-top",text:l10n.t("searching_chats_contacts_messages")})},_=function(){return u.createElement(f,{className:"empty-top",text:l10n.t("searching_messages")})},E=function(){return u.createElement(f,{className:"empty-top",text:l10n.t("search_no_contacts")})},S=function(){return u.createElement(f,{className:"empty-top",text:l10n.t("search_no_groups")})},M=function(){return u.createElement(f,{className:"empty-top",text:l10n.t("search_no_messages")})},C=function(){return u.createElement(f,{text:l10n.t("no_chats")})},b=function(){return u.createElement(f,{text:l10n.t("no_contacts")})},T=function(){return u.createElement(f,{text:l10n.t("no_groups")})},P=function(e){return u.createElement(f,{className:"empty-top",text:l10n.t("chat_search_prompt",{chatName:e})})},k=void 0;k=function(){return u.createElement(f,{text:l10n.t("all_chats_archived")})};var N=function(){return u.createElement(f,{text:l10n.t("no_starred_messages")})},w=function(){return u.createElement(f,{text:l10n.t("no_media")})},x=function(){return u.createElement(f,{text:l10n.t("no_links")})},O=function(){return u.createElement(f,{text:l10n.t("no_docs")})},D=function(){return u.createElement(f,null,u.createElement(d,{size:50,stroke:4}))};e.exports={Blocked:m,Archived:g,Search:v,SearchContacts:E,SearchGroups:S,SearchMessages:M,ListChats:C,ListContacts:b,ListGroups:T,AllArchived:k,StarredMsgs:N,MediaMsgs:w,LinkMsgs:x,DocMsgs:O,Loading:D,Searching:y,SearchingMessages:_,BeforeSearchMessages:P}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Component=void 0;var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(1377),m=i(f),g=n(1513),v=i(g),y=n(8),_=n(45),E=n(44),S=n(10),M=n(18),C=n(1548),b=72,T="data-list-scroll-container",P="data-list-scroll-offset",k=function(e){function t(e){(0,o["default"])(this,t);var n=(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).call(this,e));return n.scrollTop=0,n.offsetTop=0,n.bodyHeight=0,n.pointerEvents=!0,n.enablePointerEvents=M.debounce(function(){S.setUiBusy(!1),n.pointerEvents=!1,_.findDOMNode(n.refs.viewport).style.pointerEvents="auto",n.props.onPointerEventsOn&&n.props.onPointerEventsOn()},150),n.onScroll=function(){n.animationFrame?n.hanging=!0:(n.hanging=!1,n.animationFrame=window.requestAnimationFrame(n._onScroll))},n._onScroll=function(){var e=n.state.scrollTarget;n.disablePointerEvents(),e&&(n.scrollTop=e.scrollTop);var t=n.getPhysicalIndexes(n.props),i=t.firstPhysicalIndex,a=t.lastPhysicalIndex,s=void 0;for(s=i;a>s;s++){var r=n.props.data[s].key;if(!n.renderedItems[r])break}return s===a?(n.animationFrame=void 0,void(n.hanging&&n.onScroll())):void n.setState({firstPhysicalIndex:i,lastPhysicalIndex:a},function(){n.animationFrame=void 0,n.hanging&&n.onScroll()})},n.state={scrollTarget:void 0,firstPhysicalIndex:0,lastPhysicalIndex:0},n}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentWillReceiveProps",value:function(e){if(void 0!==e.scrollTop&&this.state.scrollTarget&&(this.state.scrollTarget.scrollTop=e.scrollTop),this.props.scrollTarget!==e.scrollTarget||this.props.height!==e.height||this.props.data.length!==e.data.length)this.initialize(e);else{var t=this.state,n=t.firstPhysicalIndex,i=t.lastPhysicalIndex,a=this.getFirstVisibleIndex(e.height);(n>a||a>i)&&this.setState(this.getPhysicalIndexes(e))}}},{key:"componentDidMount",value:function(){var e=this;this.props.listeners.addAndRun(window,"resize",function(){return e.initialize()})}},{key:"componentWillUnmount",value:function(){this.cancelScroll(),this.enablePointerEvents.cancel()}},{key:"initialize",value:function(e){var t=e?e:this.props;if(this.cancelScroll(),this.state.scrollTarget){var n=v["default"]?{passive:!0}:void 0;this.props.listeners.remove(this.state.scrollTarget,"scroll",this.onScroll,n)}for(var i=_.findDOMNode(this),a=void 0,s=i,r=0;5>r;r++){if(s instanceof HTMLElement&&s.hasAttribute(T)){a=s;break}s=s&&s.parentNode}var o=void 0;s=i;for(var l=0;r>l;l++){if(s instanceof HTMLElement&&s.hasAttribute(P)){o=s;break}s=s&&s.parentNode}if(!a)throw new Error("list scroll container not found");var c=v["default"]?{passive:!0}:void 0;this.props.listeners.add(a,"scroll",this.onScroll,c),this.scrollTop=a.scrollTop,this.offsetTop=o?o.offsetTop:0,this.bodyHeight=a.clientHeight;var u=this.getPhysicalIndexes(t),d=u.firstPhysicalIndex,p=u.lastPhysicalIndex;return this.renderedItems={},this.setState({scrollTarget:a,firstPhysicalIndex:d,lastPhysicalIndex:p}),a}},{key:"getFirstVisibleIndex",value:function(e){return Math.floor(Math.max(this.scrollTop-this.offsetTop,0)/e)}},{key:"getPhysicalIndexes",value:function(e){var t=this.getFirstVisibleIndex(e.height),n=Math.max(this.offsetTop-this.scrollTop,0),i=Math.max(this.bodyHeight-n,0),a=Math.min(Math.ceil(i/e.height),e.data.length),s=Math.max(t-e.extraItems,0),r=Math.min(t+a+e.extraItems,e.data.length);return{firstPhysicalIndex:s,lastPhysicalIndex:r}}},{key:"cancelScroll",value:function(){this.animationFrame&&(window.cancelAnimationFrame(this.animationFrame),this.animationFrame=void 0,this.hanging=!1)}},{key:"disablePointerEvents",value:function(){this.enablePointerEvents(),this.pointerEvents||(this.props.onPointerEventsOff&&this.props.onPointerEventsOff(),_.findDOMNode(this.refs.viewport).style.pointerEvents="none",S.setUiBusy(!0),this.pointerEvents=!0)}},{key:"getComponents",value:function(){var e=this,t=this.props,n=t.height,i=t.data,a=this.state,s=a.firstPhysicalIndex,r=a.lastPhysicalIndex,o={};return M(i).forEach(function(e,t){o[e.key]=t}).slice(s,r).forEach(function(t){e.renderedItems[t.key]=t}),M.sortBy(this.renderedItems,"key").map(function(e){return y.createElement(C,{key:e.key,rowHeight:n,className:0===o[e.key]?"first":void 0,zIndex:i.length-o[e.key]-1,rowNumber:o[e.key]},e)})}},{key:"render",value:function(){var e=this.props,t=e.data,n=e.height,i=e.className,a=e.animate,s={container:{},viewport:{height:t.length*n}},r={container:E("infinite-list",i,{"infinite-list-animate":a&&!this.animationFrame}),viewport:"infinite-list-viewport"};return y.createElement("div",{className:r.container,style:s.container},y.createElement("div",{className:r.viewport,ref:"viewport",style:s.viewport},this.getComponents()))}}]),t}(y.Component);k.defaultProps={animate:!1,scrollTarget:null,className:null,data:null,height:b,extraItems:30},k.DEFAULT_HEIGHT=b,k.SCROLL_ATTR=T,k.SCROLL_OFFSET_ATTR=P;t.Component=k;t["default"]=(0,m["default"])(k)},function(e,t,n){"use strict";var i=n(8),a=n(45),s=n(158),r=n(44),o={CONTAIN:"contain",COVER:"cover",SCALE_DOWN:"scaleDown",ZOOM_IN:"zoomIn"},l=i.createClass({displayName:"ObjectFit",mixins:[s],propTypes:{children:i.PropTypes.node.isRequired,type:i.PropTypes.oneOf(_.values(o)).isRequired,size:i.PropTypes.shape({width:i.PropTypes.number.isRequired,height:i.PropTypes.number.isRequired}),style:i.PropTypes.object,zoomIn:i.PropTypes.shape({factor:i.PropTypes.number,translateX:i.PropTypes.number,translateY:i.PropTypes.number}),onObjectLoad:i.PropTypes.func},statics:{TYPES:o},getInitialState:function(){return{style:this.props.size,className:"object-fit",computed:!1}},componentDidMount:function(){if(!this.shouldUseNativeObjectFit()){this.initialize();var e=this;this.regNativeListener(window,"resize",function(){e.initialize()})}},componentWillReceiveProps:function(e){this.initialize(e)},initialize:function(e){var t=this;this.shouldUseNativeObjectFit()||(e=e||this.props,e.size&&this.setState(this[e.type](e.size.width,e.size.height,e.zoomIn),function(){_.isFunction(t.props.onObjectLoad)&&t.props.onObjectLoad(t.refs.object.firstChild)}))},shouldUseNativeObjectFit:function(){return!1},cover:function(e,t){var n=a.findDOMNode(this),i=n.clientWidth,s=n.clientHeight,r=e,o=t,l=0,c=0;return r!==i&&(o*=i/r,r=i,o>s&&(l=s/2-o/2)),s>o&&(r*=s/o,o=s,r>i&&(c=i/2-r/2)),{style:{width:r,height:o,top:l,left:c,position:"absolute"},className:"object-fit object-fit-cover",computed:!0}},contain:function(e,t){var n=a.findDOMNode(this),i=n.clientWidth,s=n.clientHeight,r=e,o=t,l=0,c=0,u=r/i,d=o/s;return u>d?(o*=i/r,r=i,s>o&&(l=s/2-o/2)):(r*=s/o,o=s,i>r&&(c=i/2-r/2)),{style:{width:r,height:o,top:l,left:c,position:"absolute"},className:"object-fit object-fit-contain",computed:!0}},scaleDown:function(e,t){var n=a.findDOMNode(this),i=n.clientWidth,s=n.clientHeight,r=t,o=e;return r>s&&(r=s,o=e*(s/t)),o>i&&(o=i,r=t*(i/e)),{style:{width:o,height:r},className:"object-fit object-fit-scaledown",computed:!0}},zoomIn:function(e,t,n){var i=this.scaleDown(e,t);return i.className+=" object-fit-zoomin",i.style.transition="transform 300ms cubic-bezier(.1,.82,.25,1)",n&&(i.style.transform="translateX("+n.translateX+"px) translateY("+n.translateY+"px) scale("+n.factor+")"),i},render:function(){if(this.shouldUseNativeObjectFit())return i.createElement("div",{className:"native-scale-down"},this.props.children);var e=this.state.computed?this.state.style:{visibility:"hidden"};return i.createElement("div",{style:this.props.style,className:r(this.state.className)},i.createElement("div",{style:e,ref:"object"},this.props.children))}});e.exports=l},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){var t=h["default"].findLast(e,function(e){return e.body&&e.mediaData&&(e.type===l["default"].TYPE.IMAGE||e.type===l["default"].TYPE.VIDEO)});return t&&t.mediaData.preview}Object.defineProperty(t,"__esModule",{value:!0}),t.StatusV3Proxy=void 0;var s=n(2),r=i(s),o=n(458),l=i(o),c=n(475),u=i(c),d=n(469),p=n(18),h=i(p),f=n(1498),m=n(9),g=n(1),v=n(46),y={Collection:"StatusV3",props:{id:"string",t:"number",unreadCount:"number",totalCount:"number",pic:"object",_msgs:{type:"array","default":function(){return[]}}},session:{readKeys:{type:"object","default":function(){return{}}},contact:"object"},derived:{renderedThumbnail:{deps:["msgsChanged","pic","totalCount"],fn:function(){return this.msgs.length===this.totalCount?a(this.msgs.models):this.pic?this.pic:a(this.msgs.models)}}},initialize:function(){f.prototype.initialize.call(this),this.addChild("contact",Store.Contact.gadd(this.id)),this._msgs.length>0&&(Store.StatusV3.addStatusMessages(this.id,this._msgs),this._msgs=[])},"delete":function(){f.prototype["delete"].call(this),Store.StatusV3.remove(this.id)},onEmptyMRM:function(){var e=this;g.log("models:StatusV3:removeMsg 0 messages left, querying...")(),this.loadMore()["catch"](function(t){404===t&&e["delete"]()})},loadMore:function(){var e=this;return this.msgs.msgLoadState.noEarlierMsgs?r["default"].resolve():this.msgs.msgLoadState.isLoadingEarlierMsgs?this.msgs.loadEarlierPromise:Store.StatusV3.loadMore(this.id,m.PAGE_SIZE,this.msgs.last()).then(function(t){return h["default"].isArray(t)&&t.length<m.PAGE_SIZE&&(e.msgs.msgLoadState.noEarlierMsgs=!0),t})["catch"](function(t){404===t&&e["delete"]()})},handleReadStatus:function(e){this.readKeys[e]||(this.readKeys[e]=!0,this.unreadCount>0?this.unreadCount--:g.error("statusv3:"+this.id+":new read key but unreadCount 0")())},sendReadStatus:function(e,t){var n=this;return v.sendStatusSeen(e,t).then(function(t){200===t.status&&n.handleReadStatus(e)})},sendMute:function(e){var t=this;return v.sendStatusMute(this.id,e).then(function(n){200===n.status&&(t.contact.statusMute=e)})}},_=(0,d.genMirrorMask)(y),E=f.extend(y,{mirrorMask:_});t["default"]=E;t.StatusV3Proxy=(0,u["default"])(y,_)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(112),s=i(a),r=n(114),o=i(r),l=n(8),c=i(l),u=n(44),d=i(u),p=function(e){var t=e.children,n=e.className,i=(0,o["default"])(e,["children","className"]);return c["default"].createElement("span",(0,s["default"])({className:(0,d["default"])("hidden-token",n)},i),"⁠⁠⁠⁠",t,"⁠⁠⁠⁠⁠")};e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(237),s=i(a),r=n(460),o=i(r),l=n(1371),c=i(l),u=n(111),d=i(u),p=n(8),h=n(45),f=n(1396),m=n(1379),g=n(1529),v=n(1372),y=n(156),E=n(44),S=n(1403),M=n(91),C=n(9),b={SMALL:"small",DEFAULT:"default"},T=p.createClass({displayName:"Contact",mixins:[v,y],propTypes:{contact:p.PropTypes.instanceOf(s["default"]).isRequired,onClick:p.PropTypes.func,mouseDownAsClick:p.PropTypes.bool,onDelete:p.PropTypes.func,onContext:p.PropTypes.func,contextEnabled:p.PropTypes.func,contextMenu:p.PropTypes.bool,admin:p.PropTypes.bool,active:p.PropTypes.object,className:p.PropTypes.string,secondary:p.PropTypes.node,type:p.PropTypes.oneOf(_.values(b)),showNotifyName:p.PropTypes.bool,searchText:p.PropTypes.string},getInitialState:function(){var e=this.props.contact,t=this.props.active,n={formattedName:this.async("contact.formattedName"),pendingAction:this.async("contact.pendingAction"),active:t?t.value===e:!1,contextMenu:!1};return this.props.showNotifyName&&(n.notifyName=this.async("contact.notifyName")),n},componentWillMount:function(){this.props.active&&this.addObserver(this.props.active,this.props.contact.id.toString(),this.onActiveChange)},onActiveChange:function(e,t){if("focus"===e){var n=h.findDOMNode(this);M.focus(n),t&&S.scrollIntoViewIfNeeded(n)}this.setState({active:!!e})},contextEnabled:function(){return!1},onDelete:function(e){e.stopPropagation(),this.props.onDelete(e,this.props.contact)},onClick:function(e){_.isFunction(this.props.onClick)&&this.props.onClick(e,this.props.contact)},onMouseDown:function(e){0===e.button&&this.onClick(e)},onEnter:function(e){e.preventDefault(),e.stopPropagation(),this.onClick(e)},onContext:function(e){return this.state.contextMenu?void this.setState({contextMenu:!1}):(this.props.onContext(e,this.props.contact,this.onContextClose),void this.setState({contextMenu:!0}))},onContextClose:function(){this.setState({contextMenu:!1})},indicateFocus:function(e){if(!(Date.now()-(d["default"].flashFocus||0)>200)){var t=h.findDOMNode(this.refs.cell);(0,o["default"])(t,"stop"),(0,o["default"])(t,{backgroundColor:["#e9eaeb","#cbdde7"]},{duration:1300,easing:[.19,.69,.01,.99],complete:this.onBlur})}},onBlur:function(e){var t=h.findDOMNode(this.refs.cell);t&&((0,o["default"])(t,"stop"),t.style.backgroundColor="")},render:function(){var e=this.props,t=e.contact,n=e.secondary,i=e.onContext,a=e.onDelete,s=e.contextEnabled,r=e.contextMenu,o=e.admin,l=e.showNotifyName,u=e.className;u=E("contact",u,{active:!!this.state.active});var h=void 0,v=void 0,y=void 0;if(!t.name&&l&&this.state.notifyName&&(y=p.createElement("span",{className:"ellipsify screen-name"},p.createElement(c["default"],{className:"screen-name-text",direction:"auto",text:this.state.notifyName}))),o&&(v=p.createElement("div",{className:"chat-meta"},p.createElement("div",{className:"chat-marker chat-marker-admin"},l10n.t("web_group_admin")))),a){var _=E("icon",{"icon-x-alt-small":this.props.type===b.SMALL,"icon-x-alt":this.props.type!==b.SMALL});h=p.createElement("div",{className:"chat-controls"},p.createElement("button",{className:_,onClick:this.onDelete}))}n||(n=C.STATUS_V2?p.createElement(g,{status:t.status}):null),i&&(i=this.onContext);var S=this.props.type===b.SMALL?26:m.Size.DEFAULT,M=p.createElement("div",{className:"chat-avatar"},p.createElement(m,{id:t.id,size:S})),T={enter:this.onEnter},P=this.props.mouseDownAsClick;return p.createElement(d["default"],{handlers:T,onFocus:this.indicateFocus,onBlur:this.onBlur},p.createElement(f,{id:t.id,ref:"cell",className:u,contextEnabled:s||this.contextEnabled,contextMenu:r,pendingAction:this.state.pendingAction,detail:h,image:M,primary:this.state.formattedName,searchText:this.props.searchText,primaryDetail:v,secondary:n,secondaryDetail:y,onClick:P?null:this.onClick,onMouseDown:P?this.onMouseDown:null,onContext:i}))}});T.Type=b,e.exports=T},function(e,t,n){"use strict";var i=n(8),a=n(158),s=n(44),r=i.createClass({displayName:"CheckBox",mixins:[a],propTypes:{checked:i.PropTypes.bool.isRequired,onChange:i.PropTypes.func.isRequired,disabled:i.PropTypes.bool},onToggle:function(e){e&&e.stopPropagation(),this.props.onChange()},render:function(){var e=s("checkbox",{checked:this.props.checked,unchecked:!this.props.checked,disabled:this.props.disabled});return i.createElement("div",{className:"checkbox-container",onClick:this.onToggle},i.createElement("div",{className:e,ref:"checkbox"},i.createElement("div",{className:"checkmark"})))}});e.exports=r},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t,n,i){this.key=e,this.src=t,this.crossOrigin=n,this.noXHR=i,this.isHttp="/"===t[0]||O.isHttp(t),this.hasPrivacyChecks=!0,this.promise=null,this.retainCount=0,this.generation=0}function s(e){var t=e.src,n=e.crossOrigin,i=e.noXHR,s=e.hasPrivacyChecks;n=!!n,i=!!i;var r="CO:"+(n?"y":"n")+",XHR:"+(i?"y":"n")+","+t,l=F[r];if(l)return l.retainCount++,l.generation=0,s||(l.hasPrivacyChecks=!1),l;var u=new a(r,t,n,i);return F[r]=u,u.retainCount++,u.promise=c["default"].loop(function(e){var n=u.generation++;if(n>L)throw new x.GaveUpRetry("Too many image retries "+u.src);return D.expDelaySec(n,60,0).then(function(){return u.hasPrivacyChecks&&!S["default"].phoneActive&&n>0?(C["default"].log("ImageTag wait for phoneActive")(),N.waitForBBEvent(S["default"],"change:phoneActive",A.matches({phoneActive:!0}))):k.waitForOnline}).cancellable().then(function(){return 0===n||!u.isHttp||u.noXHR?!0:w.get(t).timeout(3e4,"imageTagRetryTimeout").then(function(e){var t=e.status;if(t>=200&&400>t)return!0;if(t>=500)return!1;throw new x.ServerStatusError(null,u.src,t)},function(){return!1})}).then(function(t){return t?I.loadImage(u.src,u.crossOrigin).then(function(t){t.src="",e()})["catch"](function(){if(!u.isHttp)throw new x.ImageError("Invalid Data URI",u.src)}):void 0})}).cancellable()["finally"](function(){o(u)}),u.promise["catch"](function(e){C["default"].log("ImageTag:retainQuery for "+r+" failed because: "+e)(e)}),u}function r(e){--e.retainCount<=0&&(o(e),e.promise.cancel())}function o(e){e===F[e.key]&&delete F[e.key]}Object.defineProperty(t,"__esModule",{value:!0}),t.Component=void 0;var l=n(2),c=i(l),u=n(16),d=i(u),p=n(4),h=i(p),f=n(6),m=i(f),g=n(20),v=i(g),y=n(19),_=i(y),E=n(115),S=i(E),M=n(1),C=i(M),b=n(1444),T=i(b),P=n(8),k=n(78),N=n(40),w=n(95),x=n(13),O=n(47),D=n(63),R=n(9),I=n(464),A=n(18),L=10,F={},U=function(e){function t(e){(0,h["default"])(this,t);var n=(0,v["default"])(this,(t.__proto__||(0,d["default"])(t)).call(this,e));return n.state=n._initSrc(e),n}return(0,_["default"])(t,e),(0,m["default"])(t,[{key:"componentWillReceiveProps",value:function(e){this.props.src!==e.src&&this.setState(this._initSrc(e))}},{key:"_initSrc",value:function(e){var t=e.src;if(t){if(I.isCached(t))return{src:t};this.ensureLoaded(e)}return{src:null}}},{key:"componentWillUnmount",value:function(){this.ensureLoadedQuery&&r(this.ensureLoadedQuery)}},{key:"ensureLoaded",value:function(e){var t=this,n=this.ensureLoadedQuery,i=this.ensureLoadedQuery=s(e);n&&r(n),n!==i&&i.promise.checkpoint(this.props.rejectOnUnmount()).then(function(){i===t.ensureLoadedQuery&&(t.setState({src:t.props.src}),t.props.onLoaded&&t.props.onLoaded())})["catch"](x.ImageError,x.ServerStatusError,x.GaveUpRetry,function(e){i===t.ensureLoadedQuery&&(t.props.rejectOnUnmount().isRejected()||t.props.onError&&t.props.onError(e))})["catch"](x.Unmount,c["default"].CancellationError,A.noop);
}},{key:"render",value:function(){var e=this.state.src,t=this.props,n=t.onLoad,i=t.alt,a=t.onClick,s=t.onMouseMove,r=t.style,o=t.className,l=t.draggable;return e||(e=R.ONE_BY_ONE_TRANS_GIF,n=void 0),l=!!l,P.createElement("img",{src:e,alt:i,onLoad:n,onClick:a,onMouseMove:s,style:r,draggable:l,className:o})}}]),t}(P.Component);U.defaultProps={crossOrigin:!0};t.Component=U;t["default"]=(0,T["default"])(U)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(44),m=i(f),g=n(1371),v=i(g),y=n(8),_=i(y),E=n(110),S=i(E),M=n(157),C=i(M),b=n(1384),T=function(e){function t(){var e,n,i,a;(0,o["default"])(this,t);for(var r=arguments.length,l=Array(r),c=0;r>c;c++)l[c]=arguments[c];return n=i=(0,d["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(l))),i.state={hover:!1,contextMenu:!1},i.onMenuClick=function(e){var t=i.props,n=t.contextEnabled,a=t.onContext;n()&&(e.stopPropagation(),e.preventDefault(),a&&a({anchor:e.target}))},i.onContextMenu=function(e){var t=i.props,n=t.contextEnabled,a=t.onContext;n()&&(e.stopPropagation(),e.preventDefault(),a&&a({event:e}))},i.openContextMenu=function(){i.props.contextEnabled()&&i.setState({contextMenu:!0},function(){i.refs.context.click()})},i.mouseOver=function(){i.state.hover||i.props.contextMenu||!i.props.contextEnabled()||i.setState({hover:!0})},i.mouseEnter=function(){i.state.hover||i.props.contextMenu||!i.props.contextEnabled()||i.setState({hover:!0})},i.mouseLeave=function(){i.state.hover&&i.setState({hover:!1})},a=n,(0,d["default"])(i,a)}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentWillUpdate",value:function(e){this.props.contextMenu&&this.state.contextMenu&&!e.contextMenu&&this.setState({contextMenu:!1})}},{key:"onMenuMouseDown",value:function(e){e.stopPropagation()}},{key:"render",value:function(){var e=this.props.contextMenu||this.state.contextMenu,t=e||this.state.hover,n=(0,m["default"])(this.props.className,{chat:!0,hover:t}),i=null,a=null;this.props.pendingAction?a=_["default"].createElement("div",{className:"btn-context icon-spinner"},_["default"].createElement(C["default"],{size:18,stroke:6})):t&&(i=_["default"].createElement("span",{className:"icon icon-down btn-context",key:"icon-context",ref:"context",onMouseDown:this.onMenuMouseDown,onClick:this.onMenuClick}));var s=this.props.detail?_["default"].createElement("div",{className:"chat-body chat-detail"},this.props.detail):null,r=null,o="chat-title";this.props.isVerified&&(r=_["default"].createElement("span",{className:"icon-psa-verified"}),o+=" chat-title-verified");var l=this.props.primary?_["default"].createElement("div",{className:o},_["default"].createElement(v["default"],{text:this.props.primary,direction:"auto",formatters:b.Configuration.Highlight(this.props.searchText?[this.props.searchText]:[]),titlify:!0,ellipsify:!0}),r):null,c=_["default"].createElement(S["default"],{transitionName:"pop"},a),u=_["default"].createElement(S["default"],{transitionName:"pop-fast-chat",className:"context-container"},t?i:null),d=void 0,p=void 0;return this.props.secondary?(d=_["default"].createElement("div",{className:"chat-main"},l,this.props.primaryDetail),p=_["default"].createElement("div",{className:"chat-secondary"},this.props.secondary,_["default"].createElement("div",{className:"chat-meta"},this.props.secondaryDetail,c,u))):(d=_["default"].createElement("div",{className:"chat-main"},l,this.props.primaryDetail,c,u),p=this.props.secondaryDetail?_["default"].createElement("div",{className:"chat-secondary"},_["default"].createElement("div",{className:"chat-status"}),_["default"].createElement("div",{className:"chat-meta"},this.props.secondaryDetail)):null),_["default"].createElement("div",{className:n,style:this.props.style,onClick:this.props.onClick,onMouseDown:this.props.onMouseDown,onContextMenu:this.props.contextEnabled()?this.onContextMenu:null,onMouseEnter:this.state.hover?null:this.mouseEnter,onMouseOver:this.state.hover?null:this.mouseOver,onMouseLeave:this.state.hover?this.mouseLeave:null},this.props.image,_["default"].createElement("div",{className:"chat-body"},d,p),s)}}]),t}(_["default"].PureComponent);e.exports=T},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(112),s=i(a),r=n(114),o=i(r),l=n(8),c=n(10),u=n(92),d=l.createClass({displayName:"UIEMenu",propTypes:{contextMenu:l.PropTypes.object.isRequired},componentDidMount:function(){var e=this,t=this.props.contextMenu,n=t.menu,i=(0,o["default"])(t,["menu"]);c.openContextMenu(n,(0,s["default"])({},i),this.context.uim,function(t){return e.element=t})},componentWillUnmount:function(){c.closeContextMenu(this.context.uim)},getElement:function(){return this.element},render:function(){return null}});d.contextTypes={uim:l.PropTypes.instanceOf(u)},e.exports=d},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(112),s=i(a),r=n(114),o=i(r),l=n(8),c=n(463),u=n(1436),d=n(44),p=l.createClass({displayName:"DrawerSection",propTypes:{children:l.PropTypes.node.isRequired,title:l.PropTypes.node,subtitle:l.PropTypes.node,titleOnClick:l.PropTypes.func,footer:l.PropTypes.node,classes:l.PropTypes.string,onMouseDown:l.PropTypes.func,noContainer:l.PropTypes.bool,a8n:l.PropTypes.string},getDefaultProps:function(){return{noContainer:!1}},render:function(){var e=this.props,t=e.children,n=e.title,i=e.subtitle,a=e.footer,r=e.classes,p=e.onMouseDown,h=e.noContainer,f=e.titleOnClick,m=e.a8n,g=(0,o["default"])(e,["children","title","subtitle","footer","classes","onMouseDown","noContainer","titleOnClick","a8n"]),v=d(r,"drawer-section",{well:!!n});if(!n)return l.createElement("div",{className:v},t);var y=i?i:null,_=t;return!h&&_&&(_=l.createElement("div",{className:"drawer-section-body"},t)),l.createElement("div",(0,s["default"])({className:v,onMouseDown:p},g),l.createElement(u,{classes:"drawer-section-title",side:y,ellipsify:!0,"data-a8n":c.key(m),onClick:f},n),_,a)}});e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(458),s=i(a),r=n(8),o=n(10),l=n(233),c=r.createClass({displayName:"MediaMissingModal",propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired},render:function(){var e=void 0,t=void 0;switch(this.props.msg.type){case s["default"].TYPE.VIDEO:e=l10n.t("missing_video_title"),t=l10n.t("missing_video_text");break;case s["default"].TYPE.AUDIO:e=l10n.t("missing_audio_title"),t=l10n.t("missing_audio_text");break;case s["default"].TYPE.IMAGE:e=l10n.t("missing_photo_title"),t=l10n.t("missing_photo_text");break;case s["default"].TYPE.DOCUMENT:e=l10n.t("missing_document_title"),t=l10n.t("missing_document_text")}return r.createElement(l,{title:e,onOK:o.closeModal.bind(o),okText:l10n.t("web_ok")},t)}});e.exports=c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(236),s=i(a),r=n(8),o=n(44),l=r.createClass({displayName:"Modal",propTypes:{type:r.PropTypes.oneOf(["compact","box","tower"]),classes:r.PropTypes.string,title:r.PropTypes.string,children:r.PropTypes.node.isRequired},getDefaultProps:function(){return{classes:"",type:"compact"}},statics:{COMPACT:"compact",BOX:"box",TOWER:"tower"},render:function(){var e=this.props.title?r.createElement("div",{className:"popup-title",dir:"auto"},this.props.title):null,t=o("popup",this.props.classes,(0,s["default"])({},"popup-"+this.props.type,this.props.type!==l.COMPACT));return r.createElement("div",{className:"backdrop"},r.createElement("div",{className:"popup-container"},r.createElement("div",{className:t},r.createElement("div",{className:"popup-body"},e,r.createElement("div",{className:"popup-contents"},this.props.children)))))}});e.exports=l},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(458),s=i(a),r=n(8),o=n(233),l=n(10),c=r.createClass({displayName:"RemoteUpload",propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired},render:function(){var e,t;switch(this.props.msg.type){case s["default"].TYPE.IMAGE:e=l10n.t("retry_upload_photo_title"),t=l10n.t("retry_upload_photo_text");break;case s["default"].TYPE.VIDEO:e=l10n.t("retry_upload_video_title"),t=l10n.t("retry_upload_video_text");break;case s["default"].TYPE.AUDIO:case s["default"].TYPE.PTT:e=l10n.t("retry_upload_audio_title"),t=l10n.t("retry_upload_audio_text");break;case s["default"].TYPE.DOCUMENT:e=l10n.t("retry_upload_doc_title"),t=l10n.t("retry_upload_doc_text");break;default:e=l10n.t("retry_upload_media_title"),t=l10n.t("retry_upload_media_text")}return r.createElement(o,{title:e,onOK:l.closeModal.bind(l),okText:l10n.t("web_ok")},t)}});e.exports=c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(458),s=i(a),r=n(77),o=n(459),l=(0,r.defineState)("MsgLoad",{props:{noEarlierMsgs:"boolean",isLoadingEarlierMsgs:"boolean",isLoadingRecentMsgs:"boolean",isLoadingAroundMsgs:"boolean",contextLoaded:"boolean"}}),c=l.MsgLoad,u=l.MsgLoadProxy,d=o.extend({model:s["default"],initialize:function(){o.prototype.initialize.call(this),this.msgLoadState=new c({noEarlierMsgs:!1,isLoadingEarlierMsgs:!1,isLoadingRecentMsgs:!1,isLoadingAroundMsgs:!1,contextLoaded:!1}),this.listenTo(this,"add remove reset sort",this.triggerChangeLast)},"delete":function(){this.stopListening(),o.prototype["delete"].call(this),this.msgLoadState["delete"]()},triggerChangeLast:function(){var e=this.last();this._last!==e&&(this._last=e,this.trigger("change:last",e))},add:function(e,t){var n=this,i=o.prototype.add.apply(this,arguments),a=Store.Msg.add(i,t);return _.isArray(a)?a.forEach(function(e){n.isModel(e)&&(e.msgChunk=n)}):this.isModel(a)&&(a.msgChunk=this),i&&this.trigger("bulk_add",i,t),i},remove:function(e,t){var n=o.prototype.remove.apply(this,arguments),i=t?t.silent:!1;if(n&&!i){var a=_.isArray(n)?n:[n];this.trigger("remove_msgs",a,t)}return n},replace:function(e){var t=this;this.msgLoadState=e.msgLoadState,this.loadRecentPromise=e.loadRecentPromise,this.loadEarlierPromise=e.loadEarlierPromise,this.loadAroundPromise=e.loadAroundPromise,this.set(e.models,{silent:!0,merge:!1}),e.models.forEach(function(e){t.isModel(e)&&(e.msgChunk=t)}),this.trigger("bulk_add",e.models)}});d.MsgLoad=c,d.MsgLoadProxy=u,e.exports=d},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(460),o=i(r),l={scrollIntoViewIfNeeded:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!0,n=arguments[2];if(_.isFunction(e.scrollIntoViewIfNeeded))return e.scrollIntoViewIfNeeded(t);n=n||e.parentNode;var i=window.getComputedStyle(n,null),a=parseInt(i.getPropertyValue("border-top-width")),s=e.offsetTop-n.offsetTop<n.scrollTop,r=e.offsetTop-n.offsetTop+e.clientHeight-a>n.scrollTop+n.clientHeight,o=s&&!r;return(s||r)&&t&&(n.scrollTop=e.offsetTop-n.offsetTop-n.clientHeight/2-a+e.clientHeight/2),!s&&!r||t||e.scrollIntoView(o),!(s||r)},scrollIntoView:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!0,n=arguments[2];n=n||e.parentNode;var i=window.getComputedStyle(n,null),a=parseInt(i.getPropertyValue("border-top-width")),s=e.offsetTop-n.offsetTop<n.scrollTop,r=e.offsetTop-n.offsetTop+e.clientHeight-a>n.scrollTop+n.clientHeight,o=s&&!r;return t?n.scrollTop=e.offsetTop-n.offsetTop-n.clientHeight/2-a+e.clientHeight/2:e.scrollIntoView(o),!(s||r)},scrollAt:function(e,t,n){n=n||{};var i=n.pos||"center",a=n.duration||1e3;t=t||e.offsetParent;var r=n.offset||0;switch(i){case"top":return t.scrollTop=e.offsetTop+r,s["default"].resolve();case"bottom":return t.scrollTop=e.offsetTop+e.clientHeight-t.clientHeight,s["default"].resolve();case"center":return n.animate?((0,o["default"])(e,"stop"),(0,o["default"])(t,"stop"),(0,o["default"])(e,"scroll",{duration:a,container:t,offset:(e.clientHeight-t.clientHeight)/2,easing:n.easing})):(t.scrollTop=e.offsetTop+e.clientHeight/2-t.clientHeight/2,s["default"].resolve());case"offset":return n.animate?((0,o["default"])(e,"stop"),(0,o["default"])(t,"stop"),(0,o["default"])(e,"scroll",{duration:a,container:t,offset:-r,easing:n.easing})):(t.scrollTop=e.offsetTop-r,s["default"].resolve())}return s["default"].resolve()}};e.exports=l},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments[2];return function(i){function a(){return(0,l["default"])(this,a),(0,p["default"])(this,(a.__proto__||(0,r["default"])(a)).apply(this,arguments))}return(0,f["default"])(a,i),(0,u["default"])(a,null,[{key:"match",value:function(i){return(0,y["default"])(i,e,t,n)}}]),a}(g["default"])}Object.defineProperty(t,"__esModule",{value:!0});var s=n(16),r=i(s),o=n(4),l=i(o),c=n(6),u=i(c),d=n(20),p=i(d),h=n(19),f=i(h);t["default"]=a;var m=n(1415),g=i(m),v=n(1430),y=i(v)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(8),s=i(a),r=n(1476),o=i(r),l=n(1442),c=i(l),u=n(110),d=i(u),p=n(467),h=i(p),f=n(44),m=i(f),g=n(157),v=i(g),y=n(1431),_=i(y),E=n(111),S=i(E),M=n(234),C=i(M),b=n(1397),T=i(b),P=s["default"].createClass({displayName:"TextInput",propTypes:{placeholder:s["default"].PropTypes.string,value:s["default"].PropTypes.string,error:s["default"].PropTypes.string,lowProfile:s["default"].PropTypes.bool,multiline:s["default"].PropTypes.bool,supportsEmoji:s["default"].PropTypes.bool,onChange:s["default"].PropTypes.func.isRequired,onBlur:s["default"].PropTypes.func,onFocus:s["default"].PropTypes.func,onEnter:s["default"].PropTypes.func,onFiles:s["default"].PropTypes.func,maxLength:s["default"].PropTypes.number,showRemaining:s["default"].PropTypes.bool,editable:s["default"].PropTypes.bool,spellCheck:s["default"].PropTypes.bool,focusOnMount:s["default"].PropTypes.bool,className:s["default"].PropTypes.oneOfType([s["default"].PropTypes.string,s["default"].PropTypes.arrayOf(s["default"].PropTypes.string),s["default"].PropTypes.objectOf(s["default"].PropTypes.bool)]),lockable:s["default"].PropTypes.bool,pending:s["default"].PropTypes.bool,onCancel:s["default"].PropTypes.func,onSave:s["default"].PropTypes.func,onError:s["default"].PropTypes.func,validate:s["default"].PropTypes.func},getDefaultProps:function(){return{maxLength:25,editable:!0}},getInitialState:function(){return{active:!1,locked:this.props.lockable,emojiPicker:!1}},componentDidMount:function(){this.props.focusOnMount&&this.restoreFocus()},onEmojiPicker:function(e){e&&(e.preventDefault(),e.stopPropagation());var t=s["default"].createElement(c["default"],{onEmoji:this.onEmoji,onFocusRelease:this.restoreFocus});this.setState({emojiPicker:{menu:t,menuDirection:{y:h["default"].Direction.Y.TOP},type:h["default"].Type.EMOJI_PICKER,anchor:e.target}}),this.restoreFocus()},emojiPickerClose:function(){this.setState({emojiPicker:!1})},restoreEmojiPickerFocus:function(){this.refs.emojiPickerUIE&&this.refs.emojiPickerUIE.getRef()&&this.refs.emojiPickerUIE.getRef().getElement()&&this.refs.emojiPickerUIE.getRef().getElement().restoreFocus()},onEmoji:function(e){this.refs.inputLine.restoreFocus(!1),this.refs.inputLine.replaceSelection(e)},onEnter:function(e){this.props.lockable&&this.onSaveAndLock(),this.props.onEnter&&!this.props.multiline&&(e.persist(),this.props.onEnter(e))},onChange:function(e){this.props.onChange&&this.props.onChange(e)},restoreFocus:function(){this.refs.inputLine&&this.refs.inputLine.restoreFocus()},onBlur:function(e){this.state.active&&this.setState({active:!1}),this.props.onBlur&&this.props.onBlur(e)},onFocus:function(e){e.stopPropagation(),this.state.active||this.setState({active:!0}),this.props.onFocus&&this.props.onFocus(e);var t=this.refs.uiTextInput;t&&t.raiseToTop()},onUnlock:function(e){this.setState({locked:!1})},onSaveAndLock:function(e){var t=!(!this.props.lowProfile&&this.props.error);this.props.validate&&t&&(t=this.props.validate(this.props.value)),t?(this.props.onSave&&this.props.onSave(),this.setState({locked:!0})):this.props.onError&&this.props.onError()},onCancel:function(){this.props.onCancel&&this.props.onCancel(),this.setState({locked:!0})},render:function(){var e=this.props.editable&&!this.state.locked,t=e&&!!this.props.error&&!this.props.lowProfile,n=_["default"].multibyteLength(this.props.value||""),i=this.props.maxLength-n<50&&e,a={container:(0,m["default"])("text-input",this.props.className,{"no-placeholder":!this.props.placeholder,active:e}),label:(0,m["default"])("label-text",{"label-text-float":!!this.props.value}),inputWrapper:(0,m["default"])("input-wrapper",{"input-text-error":t,"input-text-active":this.state.active,locked:this.state.locked}),infoWrapper:(0,m["default"])("input-info-strip",{"input-text-error":t,"input-text-active":this.state.active})},r=this.props.showRemaining?s["default"].createElement("div",{className:"control-button-container char-counter"},s["default"].createElement("div",{className:"char-counter"},i?this.props.maxLength-n:null)):null,l=e&&this.props.supportsEmoji?s["default"].createElement("button",{className:"icon icon-emoji icon-emoji-input",onClick:this.onEmojiPicker}):void 0,c=void 0;this.props.lockable&&(this.props.pending?c=s["default"].createElement("div",{className:"icon icon-spinner"},s["default"].createElement(v["default"],{size:18,stroke:6})):this.state.locked?this.props.editable&&(c=s["default"].createElement("span",{className:"lock-icon icon icon-pencil",onClick:this.onUnlock,key:"btn-edit",title:l10n.t("edit_button")})):c=s["default"].createElement("span",{className:"lock-icon icon icon-checkmark",onClick:this.onSaveAndLock,key:"btn-done",title:l10n.t("click_to_save_esc_to_cancel")}),c=s["default"].createElement(d["default"],{transitionName:"pop",component:"div",className:"control-button-container"},c));var u=this.props.lowProfile?null:s["default"].createElement("div",{className:a.infoWrapper},s["default"].createElement("div",{className:"error-text"},t?this.props.error:null)),p=void 0;if(this.props.lockable&&!this.state.locked){var h=void 0;this.state.emojiPicker&&(h=s["default"].createElement(C["default"],{displayName:"EmojiPicker",escapable:!0,popable:!0,ref:"emojiPickerUIE",requestDismiss:this.emojiPickerClose,requestFocus:this.restoreEmojiPickerFocus},s["default"].createElement(T["default"],{contextMenu:this.state.emojiPicker}))),p=s["default"].createElement(C["default"],{displayName:"TextInput",escapable:!0,requestFocus:this.restoreFocus,requestDismiss:this.onCancel},s["default"].createElement("div",null,h))}else!this.props.lockable&&this.state.emojiPicker&&(p=s["default"].createElement(C["default"],{displayName:"EmojiPicker",escapable:!0,popable:!0,ref:"emojiPickerUIE",requestDismiss:this.emojiPickerClose,requestFocus:this.restoreEmojiPickerFocus},s["default"].createElement(T["default"],{contextMenu:this.state.emojiPicker})));return s["default"].createElement(S["default"],{className:a.container,onFocus:this.restoreFocus},s["default"].createElement("span",{className:a.label},this.props.placeholder),s["default"].createElement("div",{className:"input-spacer"}),s["default"].createElement("div",{className:a.inputWrapper,"data-trump-dominateparent":"click"},s["default"].createElement(o["default"],{ref:"inputLine",value:this.props.value,className:"input-text",multiline:this.props.multiline,onChange:this.onChange,onFocus:this.onFocus,onBlur:this.onBlur,onEnter:this.onEnter,onFiles:this.props.onFiles,focusOnChange:!1,spellCheck:this.props.spellCheck,maxLength:this.props.maxLength,showRemaining:this.props.showRemaining,editable:this.props.editable&&!this.state.locked}),s["default"].createElement("div",{className:"textinput-controls"},c,s["default"].createElement(d["default"],{transitionName:"pop",component:"div",className:"control-button-container"},l),r)),u,p)}});e.exports=P},function(e,t,n){"use strict";var i=n(8),a=n(44),s=n(463),r=i.createClass({displayName:"DrawerListItem",propTypes:{onClick:i.PropTypes.func,iconClass:i.PropTypes.string,className:i.PropTypes.string,a8n:i.PropTypes.string.isRequired},render:function(){var e=this.props,t=e.onClick,n=e.iconClass,r=e.className,o=e.children,l=n?i.createElement("div",{className:"chat-avatar"},i.createElement("div",{className:"avatar"},i.createElement("span",{className:a("icon",n)}))):null;return i.createElement("div",{className:a("chat",r),"data-ignore-capture":"any"},i.createElement("div",{className:"chat-cell",onClick:t,"data-a8n":s.key(this.props.a8n)},l,i.createElement("div",{className:"chat-body"},i.createElement("div",{className:"chat-main"},i.createElement("div",{className:"chat-title"},i.createElement("span",{className:"emojitext ellipsify",dir:"auto"},o))))))}});e.exports=r},function(e,t,n){"use strict";var i=n(8),a=n(9),s=n(233),r=n(10),o=n(54),l={GUIDE_ALLOW:"guide-allow",GUIDE_UNBLOCK:"guide-unblock",GUIDE_NONE:"guide-none"},c={CHROME_MEDIA_ERROR:"__chrome_media_error__",FIREFOX_LOCK:"__firefox_lock__",OPERA_MEDIA:"__opera_media__"},u=i.createClass({displayName:"GuidePopup",propTypes:{title:i.PropTypes.string.isRequired,desc:i.PropTypes.string.isRequired,browserPrefixDesc:i.PropTypes.bool.isRequired,type:i.PropTypes.oneOf(_.values(l)).isRequired,onConfirm:i.PropTypes.func,onCancel:i.PropTypes.func},statics:{TYPE:l},getDefaultProps:function(){return{browserPrefixDesc:!0,type:l.GUIDE_NONE,onConfirm:r.closeModal.bind(r)}},componentDidMount:function(){var e=this.getDescription(),t=this.refs.description;e.indexOf(c.CHROME_MEDIA_ERROR)>-1&&(t.innerHTML=t.innerHTML.replace(c.CHROME_MEDIA_ERROR,'<span class="chrome-media-icon"></span>')),e.indexOf(c.FIREFOX_LOCK)>-1&&(t.innerHTML=t.innerHTML.replace(c.FIREFOX_LOCK,'<span class="firefox-lock-icon"></span>')),e.indexOf(c.OPERA_MEDIA)>-1&&(t.innerHTML=t.innerHTML.replace(c.OPERA_MEDIA,'<span class="opera-media-icon"></span>'))},getDescription:function(){var e=this.props.desc+"_"+o.browser;return this.props.browserPrefixDesc&&l10n.hasT(e)?l10n.t(e):l10n.t(this.props.desc)},render:function(){var e="popup-guide";if(o.browser===a.BROWSER_TYPE.CHROME)switch(o.os){case a.OS_TYPE.MAC:e+=" popup-guide-mac";break;case a.OS_TYPE.CHROMEOS:e+=" popup-guide-chrome";break;case a.OS_TYPE.WINDOWS:}var t=null;this.props.type!==l.GUIDE_NONE&&o.browser===a.BROWSER_TYPE.CHROME&&(t=i.createElement("div",{className:"round"},i.createElement("div",{className:"round-body "+this.props.type})));var n=this.props.onCancel?l10n.t("learn_more"):void 0;return i.createElement(s,{title:l10n.t(this.props.title),classes:e,onOK:this.props.onConfirm,okText:l10n.t("ok_got_it"),onCancel:this.props.onCancel,cancelText:n},t,i.createElement("div",{className:"text text-tip",ref:"description"},this.getDescription()))}});e.exports=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Mode=void 0;var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(460),m=i(f),g=n(1370),v=(i(g),n(1437)),y=i(v),_=n(1526),E=i(_),S=n(1378),M=i(S),C=n(1377),b=i(C),T=n(111),P=i(T),k=n(1455),N=i(k),w=n(1522),x=i(w),O=n(1387),D=n(18),R=i(D),I=n(1386),A=(i(I),n(233)),L=i(A),F=n(1551),U=i(F),j=n(8),G=n(45),B=n(1396),H=n(1379),V=n(1462),q=n(1537),W=n(1458),z=n(1549),Y=n(1459),K=n(9),Q=n(10),X=n(44),Z=n(1403),J=n(1507),$=n(13),ee=n(1397),te=n(234),ne=n(91),ie=n(159),ae=t.Mode={LAST:"last",INFO:"info"},se=function(e){function t(){var e,n,i,a;(0,o["default"])(this,t);for(var r=arguments.length,l=Array(r),c=0;r>c;c++)l[c]=arguments[c];return n=i=(0,d["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(l))),i.hoverCounter=0,i.onActiveChange=function(e,t){if("focus"===e){var n=G.findDOMNode(i);ne.focus(n),t&&Z.scrollIntoViewIfNeeded(n)}i.setState({active:!!e})},i.contextEnabled=function(){var e=i.props,t=e.chat,n=e.noContext;return!n&&(t.mute.canMute()||t.canArchive()||t.canDelete()||t.canExit())},i.onMenu=function(e){if(i.state.contextMenu)return void i.setState({contextMenu:void 0});var t=i.props.chat,n=[];t.canArchive()&&n.push(j.createElement(q,{key:"archive",onArchive:i.onArchive,chat:t._ProxyState$state})),t.mute.canMute()&&n.push(j.createElement(V,{key:"mute",onMute:i.onMute,chat:t._ProxyState$state})),t.canDelete()&&n.push(j.createElement(W,{key:"delete",onDeleteOrExit:i.onDeleteOrExit,chat:t._ProxyState$state})),t.canPin()&&n.push(j.createElement(U["default"],{key:"pin",onPinOrUnpin:i.onPinOrUnpin,chat:t})),t.canMarkUnseen()&&n.push(j.createElement(z,{key:"mark_unread",onMarkUnread:i.onMarkUnread,chat:t._ProxyState$state})),e.event&&e.event.persist(),i.setState({contextMenu:{menu:n,event:e.event,anchor:e.anchor}})},i.removeContext=function(){i.setState({contextMenu:void 0})},i.onMute=function(e){Q.muteChat(Store.Chat.get(i.props.chat.id),e,i)},i.onArchive=function(e){Q.archiveChat(Store.Chat.get(i.props.chat.id),e)},i.onDeleteOrExit=function(){Q.deleteOrExitChat(Store.Chat.get(i.props.chat.id),i)},i.onPinOrUnpin=function(e){!e||Store.Chat.filter(function(e){return e.pin}).length<3?Q.pinChat(Store.Chat.get(i.props.chat.id),e):Q.openModal(j.createElement(L["default"],{onOK:Q.closeModal.bind(Q),okText:ie.t("web_ok")},ie.t("action_chat_pin_failed_405")))},i.onMarkUnread=function(e){Q.markChatUnread(Store.Chat.get(i.props.chat.id),e)},i.onClick=function(e){R["default"].isFunction(i.props.onClick)&&i.props.onClick(e,Store.Chat.get(i.props.chat.id))},i.onMouseDown=function(e){0===e.button&&i.onClick(e)},i.onEnter=function(e){e.preventDefault(),e.stopPropagation(),P["default"].flashFocus=Date.now(),i.onClick(e)},i.onDragEnter=function(e){if(i.props.chat.canSend){var t=e.dataTransfer;R["default"].includes(t.types,K.DRAG_TYPE_FILE)&&(0===i.hoverCounter&&i.setState({dragging:!0}),i.hoverCounter+=1)}},i.onDragLeave=function(e){if(i.props.chat.canSend){var t=e.dataTransfer;R["default"].includes(t.types,K.DRAG_TYPE_FILE)&&(i.hoverCounter-=1,0===i.hoverCounter&&i.setState({dragging:!1}))}},i.onDrop=function(e){var t=i.props.chat;if(t.canSend){i.setState({dragging:!1});var n=e.dataTransfer;(R["default"].includes(n.types,K.DRAG_TYPE_FILE)||R["default"].includes(n.types,"text/uri-list")||R["default"].includes(n.types,"text/html"))&&J.getFiles(e,0).then(function(e){Q.openChatFromUnread(Store.Chat.get(t.id)).then(function(n){n&&Q.attachMediaDrawer(Store.Chat.get(t.id),e)})})["catch"]($.MediaDragDropError,function(e){Q.openChatFromUnread(Store.Chat.get(t.id)).then(function(n){n&&Q.pasteChatTextInput(Store.Chat.get(t.id),e.src)})})}},i.indicateFocus=function(e){if(!(Date.now()-(P["default"].flashFocus||0)>200)){var t=G.findDOMNode(i.cell);(0,m["default"])(t,"stop"),(0,m["default"])(t,{backgroundColor:["#e9eaeb","#cbdde7"]},{duration:1300,easing:[.19,.69,.01,.99],complete:i.onBlur})}},i.onBlur=function(e){var t=G.findDOMNode(i.cell);t&&((0,m["default"])(t,"stop"),t.style.backgroundColor="")},i.openContextMenu=function(){i.cell.openContextMenu()},a=n,(0,d["default"])(i,a)}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentWillMount",value:function(){this.initActiveListeners(this.props),this.setState({dragging:!1,contextMenu:void 0})}},{key:"componentWillReceiveProps",value:function(e){this.initActiveListeners(e,this.props)}},{key:"initActiveListeners",value:function(e,t){if(t){var n=t.listeners,i=t.active,a=t.chat;n.remove(i,a.id,this.onActiveChange)}var s=e.listeners,r=e.active,o=e.chat;e.active&&s.add(r,o.id,this.onActiveChange),this.setState({active:r&&r.value&&r.value.id===o.id})}},{key:"render",value:function(){var e=this.props,t=e.chat,n=e.mode,i=e.secondary,a=e.className;a=X(a,{unread:t.hasUnread,active:!!this.state.active,"chat-drag":this.state.dragging});var s=void 0,r=void 0,o=void 0;switch(n){case ae.LAST:s=j.createElement(N["default"],{chat:t}),i||(i=j.createElement(x["default"],{chat:t}),r=j.createElement(E["default"],{chat:t,mute:t.mute})),o={enter:this.onEnter},o[ie.LR("right","left")]=this.openContextMenu;break;case ae.INFO:i||(i=t.isGroup?j.createElement(Y,{presence:t.presence,groupMetadata:t.groupMetadata,location:"list"}):j.createElement(y["default"],{presence:t.presence,chatstate:t.presence.chatstate,location:"list"})),o={enter:this.onEnter}}var l=j.createElement("div",{className:"chat-avatar"},j.createElement(H,{id:t.id,size:H.Size.NONE})),c=this.props.mouseDownAsClick,u=void 0;this.state.contextMenu&&(u=j.createElement(te,{displayName:"ChatContextMenu",escapable:!0,popable:!0,requestDismiss:this.removeContext},j.createElement(ee,{contextMenu:this.state.contextMenu})));var d=t.contact&&t.contact.isVerified;return j.createElement(P["default"],{handlers:o,onFocus:this.indicateFocus,onBlur:this.onBlur,className:"chat-drag-cover",onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave,onDrop:this.onDrop},j.createElement(B,{id:t.id,ref:(0,O.GetRef)("cell",this),className:a,contextEnabled:this.contextEnabled,pendingAction:t.pendingAction,contextMenu:!!this.state.contextMenu,image:l,primary:t.title(),searchText:this.props.searchText,primaryDetail:s,secondary:i,secondaryDetail:r,isVerified:t.isPSA||d,onClick:c?void 0:this.onClick,onMouseDown:c?this.onMouseDown:void 0,onContext:this.onMenu}),u)}}]),t}(j.PureComponent);se.CONCERNS={chat:["id","formattedTitle","hasUnread","isReadOnly","isGroup","pendingAction","canSend","isPSA","contact","presence","groupMetadata","mute"]},se.defaultProps={mode:ae.LAST},t["default"]=(0,b["default"])((0,M["default"])(se))},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Component=void 0;var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(8),m=n(45),g=n(1480),v=n(157),y=n(234),_=n(91),E=n(159),S=n(44),M=n(110),C=function(e){function t(){var e,n,i,a;(0,o["default"])(this,t);for(var r=arguments.length,l=Array(r),c=0;r>c;c++)l[c]=arguments[c];return n=i=(0,d["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(l))),i.state={searchText:"",isSearching:!1},i.onBlur=function(){i.props.setTimeout(function(){i.state.searchText||i.onCancel()},0)},i.onChange=function(e){e.target instanceof HTMLInputElement&&!function(){var t=e.target.value;i.setState({searchText:t},function(){i.props.onSearch(t)})}()},i.onCancel=function(){i.refs.input&&(i.refs.input.blur(),i.setState({searchText:"",isSearching:!1}),i.props.onSearch(""))},i.onReset=function(e){e.stopPropagation(),i.focus(),i.setState({searchText:""}),i.props.onSearch("")},i.onSearchOn=function(){i.setState({isSearching:!0}),i.props.setTimeout(i.focus,0)},i.focus=function(){_.focus(i.refs.input)},a=n,(0,d["default"])(i,a)}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentWillReceiveProps",value:function(e){this.state.isSearching&&!this.state.searchText&&(m.findDOMNode(this).contains(document.activeElement)||this.onCancel())}},{key:"componentWillUnmount",value:function(){this.onCancel()}},{key:"isAtBeginning",value:function(){var e=this.refs.input;return 0===e.selectionStart&&0===e.selectionEnd}},{key:"isAtEnd",value:function(){var e=this.refs.input,t=e.value.length;return e.selectionStart===t&&e.selectionEnd===t}},{key:"render",value:function(){var e=this.props,t=e.loading,n=e.placeholder,i=e.spellCheck,a=this.state,s=a.isSearching,r=a.searchText,o=null;s&&(t?o=f.createElement("button",{className:"btn-context icon-spinner icon-x-alt",key:"icon-clear-search",onClick:this.onReset},f.createElement(v,{size:20,stroke:5})):r.length&&(o=f.createElement("button",{className:"icon icon-x-alt",key:"icon-clear-search",onClick:this.onReset})));var l=void 0;s&&(l=f.createElement(y,{displayName:"ListSearch",escapable:!0,requestDismiss:this.onCancel,requestFocus:this.focus}));var c=s?this.onCancel:this.onSearchOn,u=S("pane-subheader","pane-list-subheader","subheader-search",{active:s});return f.createElement("div",{className:u},f.createElement("button",{className:"icon icon-search-morph",onMouseDown:c},f.createElement("div",{className:"icon icon-back-blue"}),f.createElement("div",{className:"icon icon-search"})),f.createElement(M,{transitionName:"pop"},o),f.createElement("div",{className:"input-placeholder"
},r?null:n),f.createElement("label",{htmlFor:"input-chatlist-search",className:"cont-input-search"},f.createElement("input",{type:"text",ref:"input",className:"input input-search","data-tab":2,dir:"auto",spellCheck:i,title:n,value:r,onBlur:this.onBlur,onFocus:s?null:this.onSearchOn,onChange:s?this.onChange:null})),l)}}]),t}(f.Component);C.defaultProps={placeholder:E.t("search_or_start_new_chat")};t.Component=C;t["default"]=g(C)},function(e,t,n){"use strict";var i=n(8),a=n(1392),s=n(157),r=i.createClass({displayName:"Pending",render:function(){return i.createElement("div",{className:"media-state-controls"},i.createElement("button",{className:"icon-media icon-media-disabled"},i.createElement(s,{size:50,stroke:3})))}}),o=i.createClass({displayName:"PendingCancel",render:function(){return i.createElement("div",{className:"media-state-controls"},i.createElement("button",{className:"icon-xl icon-media-cancel"},i.createElement(s,{size:50,stroke:3})))}}),l=i.createClass({displayName:"Cancel",render:function(){return i.createElement("div",{className:"media-state-controls"},i.createElement("button",{className:"icon-xl icon-media-download"}))}}),c=i.createClass({displayName:"Download",propTypes:{filesize:i.PropTypes.number,onClick:i.PropTypes.func},render:function(){var e=this.props.onClick||null,t=this.props.filesize||0;return t>0?i.createElement("div",{className:"media-state-controls"},i.createElement("button",{className:"btn-meta",onClick:e},i.createElement("span",{className:"icon-xl icon-media-download-noborder"}),i.createElement(a,null,l10n.filesize(this.props.filesize)))):i.createElement("div",{className:"media-state-controls"},i.createElement("button",{className:"icon-xl icon-media-download",onClick:e}))}}),u=i.createClass({displayName:"Upload",propTypes:{filesize:i.PropTypes.number.isRequired},render:function(){return this.props.filesize>0?i.createElement("div",{className:"media-state-controls"},i.createElement("button",{className:"btn-meta"},i.createElement("span",{className:"icon-xl icon-media-upload-noborder"}),i.createElement(a,null,l10n.filesize(this.props.filesize)))):i.createElement("div",{className:"media-state-controls"},i.createElement("button",{className:"icon-xl icon-media-upload"}))}}),d=i.createClass({displayName:"Play",render:function(){return i.createElement("div",{className:"media-state-controls"},i.createElement("button",{className:"icon-xl icon-media-play"}))}}),p=i.createClass({displayName:"Missing",render:function(){var e;switch(this.props.msg.type){case"image":e=l10n.t("missing_photo_title");break;case"video":e=l10n.t("missing_video_title");break;case"audio":e=l10n.t("missing_audio_title")}return i.createElement("div",{className:"media-state-controls"},i.createElement("button",{className:"btn-meta missing-text"},e))}});e.exports={Pending:r,Cancel:l,PendingCancel:o,Download:c,Upload:u,Play:d,Missing:p}},function(e,t,n){"use strict";var i=n(8),a=n(110),s=n(463),r=n(44),o=n(234),l=i.createClass({displayName:"MenuBar",propTypes:{children:i.PropTypes.node},render:function(){return i.createElement("div",{className:"menu menu-horizontal"},this.props.children)}}),c=i.createClass({displayName:"MenuBarItem",propTypes:{icon:i.PropTypes.string.isRequired,title:i.PropTypes.string.isRequired,children:i.PropTypes.node,transitionName:i.PropTypes.string,onClick:i.PropTypes.func,a8n:i.PropTypes.string.isRequired},getDefaultProps:function(){return{transitionName:"dropdown"}},getInitialState:function(){return{active:!1}},onOpen:function(e){this.setState({active:!0})},onClose:function(e){this.setState({active:!1})},clickHandler:function(e){this.props.onClick&&this.props.onClick(e),e.isDefaultPrevented()||this.state.active||this.onOpen(e)},render:function(){var e=this,t=this.props,n=t.children,l=t.icon,c=t.transitionName,u=t.title,d=this.state.active,p=void 0;n&&d&&(p=i.createElement(o,{displayName:"MenuBarMenuItem",escapable:!0,popable:!0,requestDismiss:function(){return e.onClose()}},i.Children.only(n)));var h={container:r("menu-item",{active:d}),icon:"icon icon-"+l};return i.createElement("div",{"data-a8n":s.key(this.props.a8n),className:h.container},i.createElement("button",{className:h.icon,onMouseDown:this.clickHandler,title:u}),i.createElement(a,{transitionName:c},p))}});e.exports={MenuBar:l,MenuBarItem:c}},function(e,t){"use strict";e.exports=function(e){return!e.getModifierState("Shift")&&!e.getModifierState("Alt")&&!e.getModifierState("Control")}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(){switch(l["default"].SHOW_GIF_SEARCH){case"giphy":return u;case"tenor":default:return d}}Object.defineProperty(t,"__esModule",{value:!0}),t.GIPHY_LOCALES=t.BRAND_NAMES=t.GifInfo=t.TENOR=t.GIPHY=t.GAP_SIZE=t.TARGET_GIF_HEIGHT=void 0;var s=n(4),r=i(s);t.gifProvider=a;var o=n(9),l=i(o),c=t.TARGET_GIF_HEIGHT=130,u=(t.GAP_SIZE=6,t.GIPHY="giphy"),d=t.TENOR="tenor",p=0;t.GifInfo=function h(e,t,n,i,a,s,o){(0,r["default"])(this,h),this.rank=e,this.gifId=++p,this.url=t,this.previewUrl=n||t,this.nonVideoUrl=i,this.width=a,this.widthStr=a+"px",this.ratioStr=Math.ceil(100*c/a)+"%",this.attribution=s,this.trending=o},t.BRAND_NAMES={giphy:"GIPHY",tenor:"Tenor"},t.GIPHY_LOCALES=["es","pt","id","fr","ar","tr","th","vi","de","it","ja","zh-CN","zh-TW","ru","ko","pl","nl","ro","hu","sv","cs","hi","bn","da","fa","tl","fi","iw","ms","no","uk"]},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.PresenceProxy=t["default"]=t.ChatstateProxy=t.Chatstate=void 0;var a=n(2),s=i(a),r=n(77),o=i(r),l=n(9),c=n(1),u=n(21),d=n(239),p=n(46),h=n(76),f=1500,m=2e3,g=(0,r.defineState)("Chatstate",{props:{id:"string",type:{type:"string",values:["available","unavailable","composing","recording"]},t:{type:"number",allowNull:!0},deny:"boolean"},session:{updateTime:"number",_expireTimerId:["number",!1,0]}}),v=g.Chatstate,y=g.ChatstateProxy;t.Chatstate=v,t.ChatstateProxy=y;var E=d.extend({model:v}),S=(0,r.defineState)("Presence",{Collection:"Presence",props:{id:"string"},session:{isOnline:"boolean",stale:["boolean",!1,!0],hasData:["boolean",!1,!1],isSubscribed:["boolean",!1,!1],withholdDisplay:["boolean",!1,!0],forceDisplay:["boolean",!1,!1],chatActive:["boolean",!1,!1],withholdDisplayTimer:"number",forceDisplayTimer:"number"},children:{chatstate:v},collections:{chatstates:E},derived:{isGroup:{fn:function(){return u.isGroup(this.id)}},isUser:{fn:function(){return u.isUser(this.id)}}},initialize:function(){o["default"].prototype.initialize.call(this),this.isGroup?(this.chatstate.set({id:"",type:"unavailable"}),this.listenTo(this.chatstates,"add change",_.debounce(function(){var e,t=!1;this.chatstates.forEach(function(n){"composing"!==n.type&&"recording"!==n.type||e&&!(e.updateTime<n.updateTime)||(e=n),t=t||"unavailable"!==n.type}),this.set({isOnline:t,chatstate:{id:e?e.id:"",type:e?e.type:"unavailable"}})}))):(this.chatstate.set({id:this.id}),this.listenTo(this.chatstate,"change:type",function(){this.isOnline="unavailable"!==this.chatstate.type})),this.listenTo(this,"change:chatActive",this.onChatActiveChange)},"delete":function(){o["default"].prototype["delete"].call(this),Store.Presence.remove(this.id),this.chatstate["delete"](),this.chatstates.forEach(function(e){e["delete"]()})},handle:function(e){"undefined"==typeof e.type?e.type=this.chatstate.type||"unavailable":"paused"===e.type&&(e.type="available"),this.isGroup&&"available"!==e.type&&(e.updateTime=Date.now());var t;if(this.isGroup){if(e.id=e.participant,e.participant=void 0,!e.id)return;t=this.chatstates.add(e,{merge:!0})}else t=this.chatstate.set(e);t._expireTimerId&&clearTimeout(t._expireTimerId),"composing"===t.type||"recording"===t.type?t._expireTimerId=_.delay(this._expireComposing,l.PRESENCE_COMPOSING_TIMEOUT,t):t._expireTimerId=0;var n=this.forceDisplay||this.isOnline||this.isUser&&!this.chatstate.deny;this.set({hasData:!0,forceDisplay:n})},_expireComposing:function(e){var t=e.type;"composing"===t||"recording"===t?e.type="available":c.error("models:presence:expireComposing "+t)()},reset:function(){this.hasData=!1,this.isGroup?this.chatstates.forEach(function(e){e.type="unavailable"}):this.isUser&&(this.chatstate.unset("t"),this.chatstate.unset("deny")),this.chatstate.set({id:this.isGroup?"":this.id,type:"unavailable",t:void 0,deny:void 0})},isActive:function(){var e=this.chatstate.type;return this.hasData&&("composing"===e||"recording"===e)},getFormattedString:function(){if(!this.hasData)return null;if(this.isGroup){var e=this.chatstate.id;if(!e)return null;var t=Store.Contact.get(e);if(!t)return null;var n=t.formattedShortName;return"composing"===this.chatstate.type?l10n.t("web_conversation_name_is_composing",{participant:n}):l10n.t("web_conversation_name_is_recording",{participant:n})}if(!this.isUser)return null;var i=this.chatstate;switch(i.type){case"available":return l10n.t("web_conversation_contact_online");case"composing":return l10n.t("web_conversation_is_composing");case"recording":return l10n.t("web_conversation_is_recording");case"unavailable":return i.deny||!i.t?null:h.lastSeenStr(i.t)}},onChatActiveChange:function(){var e=this.chatActive;e?(this.hasData?this.withholdDisplay=!1:this.withholdDisplayTimer=_.delay(function(e){e.set({withholdDisplay:!1,withholdDisplayTimer:0})},f,this),this.forceDisplayTimer=_.delay(function(e){e.set({forceDisplay:!0,forceDisplayTimer:0})},m,this)):(this.withholdDisplayTimer&&(clearTimeout(this.withholdDisplayTimer),this.withholdDisplayTimer=0),this.forceDisplayTimer&&(clearTimeout(this.forceDisplayTimer),this.forceDisplayTimer=0))},subscribe:function(){return this.isSubscribed?s["default"].resolve():this.isUser?this.update():this.isGroup?(this.isSubscribed=!0,s["default"].all([this.update(),p.presenceSubscribe(this.id)]).bind(this)["catch"](function(e){return this.isSubscribed=!1,s["default"].reject(e)})):s["default"].resolve()}}),M=S.Presence,C=S.PresenceProxy;t["default"]=M,t.PresenceProxy=C},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(4),s=i(a),r=n(6),o=i(r),l=n(472),c=i(l),u=function(){function e(){(0,s["default"])(this,e)}return(0,o["default"])(e,null,[{key:"match",value:function(e,t){(0,c["default"])(!1,"Subclasses of `Mutator` must override `match()`")}},{key:"mutate",value:function(e,t,n){return e}}]),e}();u.nestable=!0,u.format=!0,u.fragment=!1,u.compatibility=!1,u.mutates=!1,t["default"]=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(8),o=n(10),l=n(13),c=n(1407),u=n(1),d={start:function(e){var t=this;if("camera"!==e&&"microphone"!==e)return void u.error("mediaCapture:start incompatible type given")();var n=new s["default"](function(i,a){var s=!1;t.timeout=setTimeout(function(){var t="camera"===e?"guide_desktop_camera_title":"guide_desktop_mic_title",n="camera"===e?"guide_desktop_camera_description":"guide_desktop_mic_description";s=!0,o.openModal(r.createElement(c,{title:t,desc:n,type:c.TYPE.GUIDE_ALLOW}))},1e3);var u="camera"===e?{video:!0}:{audio:!0};navigator.getUserMedia(u,function(e){s&&o.closeModal(),clearTimeout(t.timeout),i(e)},function(e){var i=_.isString(e)?e:e.name,r=l.GUM[i]||l.GUM.GUMError;clearTimeout(t.timeout),a(new r),n&&!n.isPending()&&s&&o.closeModal()})});return n},stop:function(e){if(_.isFunction(e.stop))e.stop();else for(var t=e.getTracks(),n=0;n<t.length;n++)t[n].stop()}};e.exports=d},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(8),m=i(f),g=n(1),v=i(g),y=n(458),_=i(y),E=n(1378),S=i(E),M=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"getClasses",value:function(){var e=this.props.msg;switch(e.type){case"location":case"video":case"audio":case"vcard":case"document":case"ciphertext":case"unknown":case"image":return"icon icon-status icon-status-"+(e.isGif?"gif":e.type);case _["default"].TYPE.CALL_LOG:return"miss_video"===e.subtype?"icon icon-status icon-status-miss_video":"icon icon-status icon-status-miss";case"ptt":var t=4===e.ack?"blue":e.isSentByMe?"gray":"green";return"icon icon-status icon-status-"+e.type+"-"+t;default:v["default"].log('chat:getClasses Invalid msg type:"'+e.type+'"')()}return""}},{key:"render",value:function(){return m["default"].createElement("span",{className:this.getClasses()})}}]),t}(m["default"].PureComponent);M.CONCERNS={msg:["ack","isGif","type","subtype","isSentByMe"]},t["default"]=(0,S["default"])(M)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(1377),m=i(f),g=n(1370),v=(i(g),n(458)),y=(i(v),n(1497)),_=(i(y),n(1387)),E=n(8),S=n(9),M=n(18),C=n(44),b=n(235),T=n(10),P=n(1399),k=n(157),N=n(1461),w=n(1388),x=(n(1385),n(159)),O=function(e){function t(){var e,n,i,a;(0,o["default"])(this,t);for(var r=arguments.length,l=Array(r),c=0;r>c;c++)l[c]=arguments[c];return n=i=(0,d["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(l))),i.onScroll=function(e){i.handleScroll(e.target)},i.handleScroll=M.throttle(function(e){var t=i.props.mediaMsgs;t.hasMediaBefore&&e.scrollTop+S.SCROLL_FUDGE>e.scrollHeight-e.clientHeight&&i.queryMedia(M.head(t.models))},100),a=n,(0,d["default"])(i,a)}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentWillMount",value:function(){this.props.mediaMsgs.hasMediaBefore&&this.queryMedia()}},{key:"componentDidMount",value:function(){this.props.listeners.add(this.props.mediaMsgs,"add remove reset"),this.props.listeners.add(this.props.mediaMsgs,"query_media_before")}},{key:"componentWillUnmount",value:function(){this.handleScroll.cancel()}},{key:"queryMedia",value:function(e){var t=this,n=this.props.mediaMsgs;n.hasMediaBefore&&this.props.listeners.uiIdle(function(){n.queryMedia(t.props.chat,e)})}},{key:"render",value:function(){var e=this,t=this.props.mediaMsgs,n=this.props,i=n.fullCollection,a=n.selectedMessages,s=t.map(function(n,s){var r=null;return!e.props.fullCollection&&s>=t.length-6&&s<=t.length-4&&(r="media-canvas-second-row"),E.createElement(I,{msg:n,hoverEvent:i,selectable:e.props.selectable,selectedMessages:a,onMessageSelect:e.props.onMessageSelect,className:r,key:n.id})});s.reverse(),i||(s=M.slice(s,0,6));var r=C("media-gallery",{"drawer-media-gallery":i,"media-gallery-empty":0===t.length});if(t.queryMediaBefore&&(i||s.length<6)){var o=C("more","media-canvas-component",{"media-canvas-second-row":!i&&s.length>=3,"media-canvas-first":0===t.length});s.push(E.createElement("div",{className:o,key:"spinner"},E.createElement(k,{stroke:6,size:24,className:"spinner-muted"})))}if(0===t.length){if(i)return t.queryMediaBefore?E.createElement("div",{className:"drawer-media-gallery drawer-body"},E.createElement(w.Loading,null)):E.createElement(w.MediaMsgs,null);t.queryMediaBefore||t.hasMediaBefore||(r=C(r,"media-gallery-empty"),s=[x.t("no_media")])}else for(var l=0;6>l;l++)s.push(E.createElement("div",{className:"media-canvas-empty",key:"empty"+l}));return E.createElement("div",{onScroll:this.onScroll,className:r},s)}}]),t}(E.Component),D=function(e){function t(){(0,o["default"])(this,t);var e=(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments));R.call(e);var n=e.props,i=n.msg,a=n.selectedMessages;return e.state={selected:!(!a||!a.isSelected(i))},e}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentDidMount",value:function(){this.props.selectedMessages&&this.props.listeners.add(this.props.selectedMessages,this.props.msg.id.toString(),this.onSelectChange)}},{key:"render",value:function(){var e=this.props.msg,t=e.mediaData,n=t.type===b.TYPE.IMAGE&&t.renderableUrl?this.onDragStart:null,i=C("media-canvas-component",this.props.className);return E.createElement(N,{classes:i,onClick:this.onClick,hoverEvent:this.props.hoverEvent,selectable:this.props.selectable,selected:this.state.selected,onMessageSelect:this.props.onMessageSelect,onDragStart:n,msg:e,imgRef:(0,_.GetRef)("img",this)})}}]),t}(E.Component),R=function(){var e=this;this.onSelectChange=function(t){e.state.selected!==t&&e.setState({selected:t})},this.onClick=function(t){var n=e.props,i=n.msg,a=n.selectable,s=n.onMessageSelect,r=i.mediaData;if(a&&s)return void s(i,!e.state.selected);if(r.mediaStage===b.STAGE.ERROR_MISSING)return void T.openModal(E.createElement(P,{msg:i}));t&&t.stopPropagation();var o=void 0,l=i.id;r.type===b.TYPE.IMAGE&&!function(){var t=e.img;o=function(e){return l.equals(e)&&t?t:null}}(),T.mediaViewerModal(i,o)},this.onDragStart=function(t){t.nativeEvent.dataTransfer.setData(S.DRAG_TYPE_LOCAL_IMAGE,!0),t.nativeEvent.dataTransfer.setData("text/uri-list",e.props.msg.mediaData.renderableUrl)}},I=(0,m["default"])(D);e.exports=(0,m["default"])(O)},function(e,t){"use strict";e.exports=function(e,t){for(var n=e.childNodes,i=0;i<n.length;++i)if(n[i]===t)return i;return-1}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1452),s=i(a),r=(0,s["default"])({FORWARD:void 0,BACKWARD:void 0});e.exports=function(e,t){var n=window.getSelection();if(!n||!n.rangeCount)return null;var i=n.getRangeAt(0);if(!i.collapsed)return null;var a=i.startContainer,s=i.startOffset;if(a===e){var o=a.childNodes,l=o.length;if(t===r.FORWARD&&s>l||t===r.BACKWARD&&!s)return null;var c=t===r.BACKWARD?1:0,u=o[s-c];return u instanceof Element?u:null}var d=a.length===s;if(t===r.BACKWARD&&s)return null;if(t===r.FORWARD&&!d)return null;var p=t===r.BACKWARD?"previousSibling":"nextSibling",h=a[p];return h instanceof Element?h:null},e.exports.Direction=r},function(e,t,n){"use strict";var i=n(8),a=i.createClass({displayName:"SectionHeader",propTypes:{header:i.PropTypes.string.isRequired},render:function(){return i.createElement("div",{className:"list-title"},this.props.header)}});e.exports=a},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(458),s=i(a),r=n(18),o=n(8),l=n(45),c=n(15),u=n(93),d=n(158),p=n(160),h=n(10),f=n(54),m=n(9),g=o.createClass({displayName:"VideoTag",mixins:[u,d,p],propTypes:{msg:o.PropTypes.instanceOf(s["default"]).isRequired,poster:o.PropTypes.string,style:o.PropTypes.object,className:o.PropTypes.string,controls:o.PropTypes.bool,width:o.PropTypes.number,height:o.PropTypes.number,onClick:o.PropTypes.func,onPlay:o.PropTypes.func,onError:o.PropTypes.func,autoPlay:o.PropTypes.bool,loop:o.PropTypes.bool,muted:o.PropTypes.bool,onLoad:o.PropTypes.func,onResize:o.PropTypes.func,startTime:o.PropTypes.number},componentDidMount:function(){var e=l.findDOMNode(this),t=this.props.msg.mediaData;t.isGif||(this.regNativeListener(e,"playing",this.onPlaying),this.regCmd("mediaPlaying",this.onOtherPlaying)),this.regNativeListener(e,"error",this.onPlayerError,!0),(f.isGecko||f.isSafari)&&(this.props.autoPlay?this.startCheckForSuccess():this.regNativeListener(e,"play",this.startCheckForSuccess)),this.props.msg.canSendPlayed()&&this.regNativeListener(e,"timeupdate",this.onTimeUpdate),this.regNativeListener(e,"loadedmetadata",this.setStartTime)},componentDidUpdate:function(e){e.startTime!==this.props.startTime&&this.setStartTime()},onTimeUpdate:function(){var e=l.findDOMNode(this);(e.currentTime/e.duration>.5||e.currentTime>10)&&(this.props.msg.sendPlayed(),this.unregNativeListener(e,"timeupdate",this.onTimeUpdate))},startCheckForSuccess:function(){this.checkIteration=0,this.checkForSuccessInterval=this.safeInterval(this.checkForSuccess,250)},clearCheckForSuccess:function(){this.checkForSuccessInterval&&(this.clearSafeInterval(this.checkForSuccessInterval),delete this.checkForSuccessInterval,delete this.checkIteration)},checkForSuccess:function(){if(c.state===c.STATE.CONNECTED){if(this.checkIteration++,this.checkIteration>240)return void this.onPlayerError({target:{src:this.props.src,error:{code:window.MediaError.MEDIA_ERR_NETWORK}}});var e=l.findDOMNode(this),t=e.buffered;t&&t.length&&t.end(0)>0&&this.onPlaying({target:e})}},onPlayerError:function(e){this.clearCheckForSuccess(),this.props.onError&&this.props.onError(e)},onOtherPlaying:function(e){e!==this&&l.findDOMNode(this).pause()},onPlaying:function(e){this.clearCheckForSuccess(),h.mediaPlaying(this),this.props.onPlay&&this.props.onPlay(e)},setStartTime:function(){if((0,r.isNumber)(this.props.startTime)){var e=l.findDOMNode(this);e.currentTime=this.props.startTime}},render:function(){var e=this.props.msg.mediaData,t=e.streamable&&!e.renderableUrl?m.VIDEO_STREAM_URL+"?key="+this.props.msg.id.toString():e.renderableUrl;return o.createElement("video",{src:t,poster:this.props.poster,style:this.props.style,width:this.props.width,height:this.props.height,className:this.props.className,onClick:this.props.onClick,controls:this.props.controls,autoPlay:this.props.autoPlay,loop:this.props.loop,muted:this.props.muted,onEnded:this.props.onEnded,onLoadStart:this.props.onLoad},this.props.children)}});e.exports=g},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(458),s=i(a),r=n(8),o=n(1439),l=n(1379),c=n(156),u=n(1376),d=l.Size,p=r.createClass({displayName:"ProfileImage",mixins:[c,u],propTypes:{size:r.PropTypes.oneOfType([r.PropTypes.number,r.PropTypes.oneOf(_.values(d))]),waid:r.PropTypes.string,thumb:r.PropTypes.string,className:r.PropTypes.string,quoted:r.PropTypes.bool},componentWillMount:function(){var e=this,t=this.props.waid;t&&Store.ProfilePicThumb.find(t).checkpoint(this.rejectOnUnmount()).then(function(t){e.addObserverAndRun(t,"change:img",function(){e.setState({img:t.img})})})["catch"](_.noop)},render:function(){return this.state.img?r.createElement(l,{id:this.props.waid,className:this.props.className,quoted:this.props.quoted,size:this.props.size}):r.createElement(o,{className:this.props.className,thumb:this.props.thumb,type:s["default"].TYPE.VCARD,quoted:this.props.quoted,shade:!1})}});p.Size=d,e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(112),s=i(a),r=n(2),o=i(r),l=n(458),c=i(l),u=n(460),d=i(u),p=n(1371),h=i(p),f=n(8),m=n(45),g=n(1403),v=n(1),y=n(156),E=n(235),S=n(10),M=n(93),C=n(233),b=n(1489),T=n(1443),P=n(1382),k=n(1401),N=n(1394),w=n(1579),x=n(1474),O=n(1440),D=n(1584),R=n(466),I=new(n(487)),A=n(1385),L=n(1397),F=n(234),U=n(1281),j=n(44),G=n(61),B=n(9),H=n(110),V={FRONT:"front",MID:"mid",END:"end",SINGLE:"single"},q=f.createClass({displayName:"Wrapper",mixins:[y,M],propTypes:{msg:f.PropTypes.instanceOf(c["default"]).isRequired,position:f.PropTypes.oneOf(_.values(V)),displayType:f.PropTypes.oneOf(_.values(B.DISP_TYPE)),isMsgVisible:f.PropTypes.func,hideMsgInfo:f.PropTypes.bool,selectable:f.PropTypes.bool,selectedMessages:f.PropTypes.instanceOf(A),current:f.PropTypes.bool,onMessageSelect:f.PropTypes.func,tailOverride:f.PropTypes.oneOf(["left","right"]),isFocusedMsg:f.PropTypes.bool},getDefaultProps:function(){return{displayType:B.DISP_TYPE.CONVERSATION}},getInitialState:function(){return{contextMenu:!1,hover:!1,highlighting:!1,selected:this.props.selectedMessages?this.props.selectedMessages.isSelected(this.props.msg):!1}},componentWillReceiveProps:function(e){this.props.isFocusedMsg&&!e.isFocusedMsg&&(this.unregCmd("scroll_to_focused_msg",this.scrollMsg),this.unregCmd("flash_focused_msg",this.flashFocusedMsg)),!this.props.isFocusedMsg&&e.isFocusedMsg&&(this.regCmd("scroll_to_focused_msg",this.scrollMsg),this.regCmd("flash_focused_msg",this.flashFocusedMsg))},shouldComponentUpdate:function(e,t){return U(this,e,t)},componentWillMount:function(){var e=this,t=this.props.msg;t.mayFail()&&(G.supportsFeature(G.F.RESEND_ICON)||t.type===c["default"].TYPE.PTT)&&(this.addObserver(t,"change:isFailed",function(){return e.forceUpdate()}),this.addObserver(t,"change:mediaData.mediaStage",function(){return e.forceUpdate()})),this.props.isFocusedMsg&&(this.regCmd("scroll_to_focused_msg",this.scrollMsg),this.regCmd("flash_focused_msg",this.flashFocusedMsg)),t.typeCanChange()&&this.addObserver(t,"change:type",function(){return e.forceUpdate()}),"video"===t.type&&t.mayBeForwardable()&&!t.canForward()&&this.addObserver(t,"change:ack",function(){return e.forceUpdate()})},componentDidMount:function(){this.props.selectedMessages&&this.addObserver(this.props.selectedMessages,this.props.msg.id.toString(),this.onSelectChange)},componentWillUnmount:function(){var e=m.findDOMNode(this.refs.bubble);e&&(0,d["default"])(e,"finish",!0)},scrollMsg:function(e,t){v.info("scroll msg")(),v.info(t)();var n=m.findDOMNode(this);n?v.info("node found")():v.info("node not found!")(),v.info("calling DOM.scrollAt ")(),g.scrollAt(n,null,t).then(e)},flashFocusedMsg:function(e){this.highlight(e)},highlight:function(e){var t=this,n=this.refs.highlightTail,i=this.refs.bubble;if(n&&i){this.setState({highlighting:!0}),this.highlightAnimation&&(this.didCancel=!0,this.highlightAnimation.cancel());var a=m.findDOMNode(n),s=m.findDOMNode(i);this.highlightAnimation=(this.highlightAnimation||o["default"].resolve()).then(function(){var e=250,n=250,i=(0,d["default"])(a,{opacity:[1,0]},{duration:e}),r=(0,d["default"])(a,{opacity:[0,1]},{duration:e,delay:n}),l=t.props.msg.isSentByMe?"#dcf8c6":"#ffffff",c=t.props.msg.isSentByMe?"#b3cba1":"#cccccc",u=(0,d["default"])(s,{backgroundColor:[c,l]},{duration:e}),p=(0,d["default"])(s,{backgroundColor:[l,c]},{duration:e,delay:n});return o["default"].all([i,r,u,p])}).cancellable().then(function(){t.onHighlightComplete(e)})["catch"](o["default"].CancellationError,function(){(0,d["default"])(a,"stop",!0),(0,d["default"])(s,"stop",!0)})["finally"](function(){t.didCancel?t.didCancel=!1:t.highlightAnimation=void 0})}},onHighlightComplete:function(e){this.setState({highlighting:!1},function(){e&&e()})},resend:function(){var e=this.props.msg;return e.isMMS&&!G.supportsFeature(G.F.MEDIA_RETRY)?void S.openModal(f.createElement(k,{msg:e})):void e.resend()["catch"](function(e){v.log("wrapper:resend failure: "+e)()})},openSingleForwardFlow:function(){return this._openForwardFlow(!1)},openForwardFlow:function(){return this._openForwardFlow(!0)},_openForwardFlow:function(e){var t,n=this.props.msg;if(n.type===c["default"].TYPE.CIPHERTEXT?t=l10n.t("err_unsent_forward_text_decrypting"):n.type===c["default"].TYPE.REVOKED?t=l10n.t("err_unsent_forward_text_revoked"):n.isUnsentMedia&&(t=l10n.t("err_unsent_forward_text")),t)S.openModal(f.createElement(C,{title:l10n.t("err_unsent_forward_title"),onOK:S.closeModal.bind(S),okText:l10n.t("web_ok")},t));else{if(e&&this.props.displayType===B.DISP_TYPE.CONVERSATION)return void this.onSelectClick();S.openModal(f.createElement(T,{msgs:[this.props.msg]}),"modal-flow")}},openInfoDrawer:function(){S.msgInfoDrawer(this.props.msg)},openContactChat:function(){Store.Chat.find(this.props.msg.author).then(function(e){S.openChatFromUnread(e).then(function(t){t&&S.focusChatTextInput(e)})})},mouseEnter:function(){!this.state.hover&&this.contextEnabled()&&this.setState({hover:!0})},mouseLeave:function(){this.state.hover&&this.contextEnabled()&&this.setState({hover:!1})},contextMenu:function(e){e.stopPropagation()},contextEnabled:function(){return!this.props.msg.isNotification},removeContext:function(){this.setState({contextMenu:!1})},onDeleteMessage:function(){var e=this,t=function(){var t=e.props.msg;S.closeModal(),S.sendDeleteMsgs(t.chat,[t])},n=l10n.t("delete_message_confirmation");S.openModal(f.createElement(C,{onOK:t,okText:l10n.t("web_delete"),onCancel:S.closeModal.bind(S),cancelText:l10n.t("web_cancel")},f.createElement(h["default"],{text:n})))},onRevokeMessage:function(){var e=this.props.msg;S.openModal(f.createElement(b,{chat:e.chat,msgList:[e]}))},onReplyMessage:function(){var e=this.props.msg,t=e.chat;t.composeQuotedMsg=e,S.focusChatTextInput(t)},onPrivateReplyMessage:function(){var e=this.props.msg;Store.Chat.find(e.sender).then(function(e){return o["default"].props({ok:S.openChatBottom(e),chat:e})}).then(function(t){var n=t.ok,i=t.chat;n&&(i.composeQuotedMsg=e,S.focusChatTextInput(i))})},onDownload:function(){R.initDownload(this.props.msg)},onStarMessage:function(){var e=this.props.msg;S.sendStarMsgs(e.chat,[e])},onUnstarMessage:function(){var e=this.props.msg;S.sendUnstarMsgs(e.chat,[e])},onMenu:function(e){if(e.stopPropagation(),e.preventDefault(),e.isTrusted&&this.state.contextMenu)return void this.setState({contextMenu:!1});var t=this.props.msg,n=[];t.isSentByMe&&G.supportsFeature(G.F.MESSAGE_INFO)&&this.props.displayType!==B.DISP_TYPE.MSG_INFO&&n.push(f.createElement(P,{key:"info",a8n:"mi-msg-info",action:this.openInfoDrawer},l10n.t("message_info"))),t.canReply()&&n.push(f.createElement(P,{key:"reply",a8n:"mi-msg-reply",action:this.onReplyMessage},l10n.t("reply"))),t.mediaData&&t.mediaData.renderableUrl&&n.push(f.createElement(P,{key:"download",a8n:"mi-msg-download",action:this.onDownload},l10n.t("web_button_download"))),t.canForward()&&n.push(f.createElement(P,{key:"forward",a8n:"mi-msg-forward",action:this.openForwardFlow},l10n.t("forward_message"))),t.canStar()&&(t.star?n.push(f.createElement(P,{key:"star",a8n:"mi-msg-unstar",action:this.onUnstarMessage},l10n.t("unstar_message"))):n.push(f.createElement(P,{key:"star",a8n:"mi-msg-star",action:this.onStarMessage},l10n.t("star_message")))),G.supportsFeature(G.F.MESSAGE_DELETE)&&n.push(f.createElement(P,{key:"delete",a8n:"mi-msg-delete",action:this.onDeleteMessage},l10n.t("delete_message"))),t.isGroupMsg&&t.author&&!t.isSentByMe&&n.push(f.createElement(P,{key:"author",a8n:"mi-msg-author",action:this.openContactChat},l10n.t("message_author",{author:t.displayName()}))),t.canRevoke()&&n.push(f.createElement(P,{key:"revoke",a8n:"mi-msg-revoke",action:this.onRevokeMessage},l10n.t("revoke_message"))),this.setState({contextMenu:{menu:n,anchor:e.target,classes:"dropdown-compact"}})},contextOpen:function(){var e=this.refs.context;e&&e.click()},contextClose:function(){this.setState({contextMenu:!1})},getMsgComponent:function(){var e=this.props,t=e.msg,n=e.position,i=e.displayType,a=e.isMsgVisible,s=i!==B.DISP_TYPE.STARRED_MSGS&&!!t.quotedMsg||!(n===V.MID||n===V.END),r=void 0;if(G.supportsFeature(G.F.REPLIES_IN)){var o=t.quotedMsgObj();o&&(r=f.createElement(O,{msg:o,key:o.id.toString(),rootMsg:t,displayType:i,chat:t.chat}))}return f.createElement(x,{msg:t,ref:"component",quotedMsg:r,displayAuthor:s,displayType:i,isMsgVisible:a})},onSelectClick:function(e){e&&e.stopPropagation(),this.props.onMessageSelect(this.props.msg,!this.state.selected)},onSelectChange:function(e){this.state.selected!==e&&this.setState({selected:e})},onDoubleClick:function(e){var t=this.props.msg;if(t.canReply()&&!this.props.selectable){var n=function(e,t){for(var n=t.parentNode;null!==n;){if(n===e)return!0;n=n.parentNode}return!1};n(this.refs.bubble,e.target)||(t.chat.composeQuotedMsg=t,S.focusChatTextInput(t.chat),this.highlight())}},render:function(){var e,t=this.props,n=t.msg,i=t.position,a=t.displayType,r=a===B.DISP_TYPE.CONVERSATION;(this.state.hover&&!this.state.highlighting||this.props.current||this.state.contextMenu)&&(e=f.createElement(D,(0,s["default"])({},this.props,{key:"icon-context",ref:"context",onClick:this.onMenu})));var o,l=n.mediaData?n.mediaData.mediaStage:"NA";n.isFailed&&l===E.STAGE.ERROR_MISSING?o=f.createElement(w,{onResend:_.noop,errMsg:l10n.t("unsent_media_not_on_phone")}):n.type===c["default"].TYPE.PTT&&n.isFailed&&l===E.STAGE.PREPARING?o=f.createElement(w,{onResend:_.noop,errMsg:l10n.t("ptt_failed")}):G.supportsFeature(G.F.RESEND_ICON)&&r&&n.isFailed&&l!==E.STAGE.REMOTE_UPLOADING?o=f.createElement(w,{onResend:this.resend,errMsg:l10n.t("resend_message")}):!n.isUnsentMedia||l!==E.STAGE.ERROR_MISSING&&l!==E.STAGE.ERROR_UNSUPPORTED||(o=f.createElement(w,{onResend:_.noop,errMsg:l10n.t("send_failed")}));var u=!n.isNotification&&this.props.selectable?f.createElement("div",{className:"msg-select",onClick:this.onSelectClick
},f.createElement(N,{onChange:this.onSelectClick,checked:this.state.selected})):null,d=i===V.MID||i===V.END,p=I.match(n.body),h=n.type===c["default"].TYPE.CHAT&&1===p.length&&_.first(p)[0].length===n.body.length,m="message-"+(n.mediaData&&n.mediaData.isGif?c["default"].TYPE.IMAGE:n.type),g=n.type===c["default"].TYPE.CIPHERTEXT||n.type===c["default"].TYPE.REVOKED||n.type===c["default"].TYPE.UNKNOWN,v=n.type===c["default"].TYPE.CHAT&&!n.linkPreview,y=n.chat&&n.chat.isPSA,S={wrapper:j("msg",{"msg-continuation":i===V.FRONT||i===V.MID,"msg-group":n.isGroupMsg&&!d,"msg-psa":a!==B.DISP_TYPE.STARRED_MSGS&&y,selected:this.state.selected}),container:j("message "+m,{"message-system":n.isNotification,"message-out":!n.isNotification&&n.isSentByMe,"message-in":!n.isNotification&&!n.isSentByMe,hover:this.state.contextMenu||this.state.hover,tail:!(y||this.props.tailOverride||i!==V.FRONT&&i!==V.SINGLE),"tail-override-left":"left"===this.props.tailOverride,"tail-override-right":"right"===this.props.tailOverride,"message-chat":v||g,"message-code":h,"message-placeholder":g})},M=void 0;M=this.state.contextMenu?"none":"rtl"===n.dir||void 0===n.dir&&l10n.isRTL()?"pop-fast-reverse":"pop-fast";var C=f.createElement("span",{className:"tail-container highlight",ref:"highlightTail"}),b=void 0;this.state.contextMenu&&(b=f.createElement(F,{displayName:"MsgContextMenu",escapable:!0,popable:!0,requestDismiss:this.contextClose},f.createElement(L,{contextMenu:this.state.contextMenu})));var T=void 0;return r&&!this.props.selectable&&n.canForward()&&(n.isMedia||n.linkPreview)&&(T=f.createElement("div",{className:"icon icon-forward-chat btn-forward-chat",onClick:this.openSingleForwardFlow})),f.createElement("div",{className:S.wrapper,onDoubleClick:this.onDoubleClick},f.createElement(H,{transitionName:"delay-leave"},u),f.createElement("div",{className:S.container,ref:"bubble"},f.createElement("div",{onContextMenu:this.contextMenu,onMouseOver:this.mouseEnter,onMouseEnter:this.mouseEnter,onMouseLeave:this.mouseLeave},f.createElement("span",{className:"tail-container"}),"  ",C,"                      ",o,this.getMsgComponent(),f.createElement(H,{transitionName:M},e)),T),b)}});q.Position=V,e.exports=q},function(e,t){"use strict";function n(e){return"string"==typeof e?e:e?e.displayName||e.name||"Component":"Component"}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=n},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.GroupMetadataProxy=t["default"]=void 0;var a=n(2),s=i(a),r=n(237),o=i(r),l=n(77),c=i(l),u=n(8),d=n(1),p=n(239),h=n(474),f=n(46),m=n(10),g=n(61),v=n(13),y=n(9),_=n(461),E=n(113).ActionToast,S=n(113).ActionType,M=(0,l.defineState)("Participant",{props:{id:"string",isAdmin:"boolean"},session:{contact:"object"},initialize:function(){c["default"].prototype.initialize.call(this),this.addChild("contact",Store.Contact.gadd(this.id))},"delete":function(){c["default"].prototype["delete"].call(this)}}),C=M.Participant,b=p.extend(h,{model:C,comparator:function(e,t){return o["default"].Comparator(e.contact,t.contact)},initialize:function(){this.listenTo(this,"change:contact.name",this.sort),this.listenTo(m,"locale_change",this.sort)},"delete":function(){this.invokeMap("delete"),this.stopListening(),this.reset()},addParticipant:function(e,t){var n=this;if(this.get(e.id))return m.openToast(u.createElement(_,{id:_.genId(),msg:l10n.t("action_participant_failed_already_added",{participant:e.formattedShortName})})),s["default"].reject(new v.ActionError);if(!this.canAdd())return s["default"].reject(new v.ActionError);var i=f.addParticipant(this.parent.id,e.id),a=new S(l10n.t("action_participant_adding",{participant:e.formattedShortName}));t=t||E.genId();var r=i.then(function(t){return 200===t.status?new S(l10n.t("action_participant_added",{participant:e.formattedShortName})):404===t.status?new S(l10n.t("action_participant_add_failed")+" "+l10n.t("action_participant_failed_404")):401===t.status?new S(l10n.t("action_participant_add_failed")+" "+l10n.t("action_participant_failed_401")):403===t.status?new S(l10n.t("action_participant_add_failed")+" "+l10n.t("action_participant_failed_403")):void 0})["catch"](function(i){return d.error("models:groupMetadata:participantCollection:addParticipant dropped")(i),new S(l10n.t("action_participant_add_failed"),l10n.t("action_try_again"),n.addParticipant.bind(n,e,t))});return m.openToast(u.createElement(E,{id:t,initialAction:a,pendingAction:r})),i},removeParticipant:function(e,t){var n=this;if(!this.canRemove(e))return s["default"].reject(new v.ActionError);var i=f.removeParticipant(this.parent.id,e.id),a=new S(l10n.t("action_participant_removing",{participant:e.contact.formattedShortName}));t=t||E.genId();var r=i.then(function(t){return 200===t.status?new S(l10n.t("action_participant_removed",{participant:e.contact.formattedShortName})):404===t.status?new S(l10n.t("action_participant_remove_failed")+" "+l10n.t("action_participant_failed_404")):401===t.status?new S(l10n.t("action_participant_remove_failed")+" "+l10n.t("action_participant_failed_401")):403===t.status?new S(l10n.t("action_participant_remove_failed")+" "+l10n.t("action_participant_failed_403")):void 0})["catch"](function(i){return d.error("models:groupMetadata:participantCollection:removeParticipant dropped")(i),new S(l10n.t("action_participant_remove_failed"),l10n.t("action_try_again"),n.removeParticipant.bind(n,e,t))});return m.openToast(u.createElement(E,{id:t,initialAction:a,pendingAction:r})),i},promoteParticipant:function(e,t){var n=this;if(!this.canPromote(e))return s["default"].reject(new v.ActionError);var i=f.promoteParticipant(this.parent.id,e.id),a=new S(l10n.t("action_participant_promoting",{participant:e.contact.formattedShortName}));t=t||E.genId();var r=i.then(function(t){return 200===t.status?new S(l10n.t("action_participant_promoted",{participant:e.contact.formattedShortName})):404===t.status?new S(l10n.t("action_participant_promote_failed")+" "+l10n.t("action_participant_failed_404")):401===t.status?new S(l10n.t("action_participant_promote_failed")+" "+l10n.t("action_participant_failed_401")):403===t.status?new S(l10n.t("action_participant_promote_failed")+" "+l10n.t("action_participant_failed_403")):void 0})["catch"](function(i){return d.error("models:groupMetadata:participantCollection:removeParticipant dropped")(i),new S(l10n.t("action_participant_promote_failed"),l10n.t("action_try_again"),n.promoteParticipant.bind(n,e,t))});return m.openToast(u.createElement(E,{id:t,initialAction:a,pendingAction:r})),i},canAdd:function(){return g.supportsFeature(g.F.GROUP_ADD_PARTICIPANT)?!!this.iAmAdmin():!1},canPromote:function(e){return g.supportsFeature(g.F.GROUP_PROMOTE_PARTICIPANT)&&e?Store.Conn.me===e.id?!1:this.iAmAdmin()?!e.isAdmin:!1:!1},canRemove:function(e){return g.supportsFeature(g.F.GROUP_REMOVE_PARTICIPANT)&&e?Store.Conn.me===e.id?!1:!!this.iAmAdmin():!1},canVerifyIdentity:function(e){return g.supportsFeature(g.F.QUERY_IDENTITY)&&e?Store.Conn.me===e.id?!1:!!e.contact.plaintextDisabled:!1},iAmMember:function(){return 1===this.where({id:Store.Conn.me}).length},iAmAdmin:function(){return 1===this.where({id:Store.Conn.me,isAdmin:!0}).length}}),T=(0,l.defineState)("GroupMetadata",{Collection:"GroupMetadata",props:{id:"string",creation:"number",owner:"string"},session:{stale:["boolean",!1,!0],trusted:["boolean",!1,!0],inviteCode:"string",promises:{type:"object","default":function(){return{}}}},derived:{groupInviteLink:{deps:["inviteCode"],fn:function(){return this.inviteCode?""+y.GROUP_INVITE_LINK_URL+this.inviteCode:null}}},collections:{participants:b},"delete":function(){c["default"].prototype["delete"].call(this),Store.GroupMetadata.remove(this.id),this.participants["delete"]()},canSetSubject:function(){return g.supportsFeature(g.F.GROUP_SET_SUBJECT)?!!this.participants.iAmMember():!1},initialize:function(){c["default"].prototype.initialize.call(this),this.listenTo(this.participants,"change:isAdmin change:contact.isMyContact sort remove reset",this.isTrusted),this.listenTo(this,"change:owner",this.isTrusted),this.isTrusted(),this.listenTo(this.participants,"add remove reset",this.onParticipantChange)},isTrusted:function(){if(this.stale)return this.trusted;if(!this.owner)return this.trusted=!1;if(this.owner===Store.Conn.me)return this.trusted=!0;var e=Store.Contact.get(this.owner);if(e&&e.isMyContact)return this.trusted=!0;for(var t=this.participants.models,n=0,i=t.length;i>n;++n){var a=t[n];if(a.isAdmin&&a.id!==Store.Conn.me&&a.contact.isMyContact)return this.trusted=!0}return this.trusted=!1},onParticipantChange:function(){Store.Contact.get(this.id).unset("_capabilities"),Store.GroupMetadata.trigger("group_participant_change",this.id)},groupInviteCode:function(){var e=this;return this.promises.groupInviteCode?this.promises.groupInviteCode:this.promises.groupInviteCode=f.groupInviteCode(this.id).then(function(t){var n=t.status,i=t.code;return 200===n&&(e.inviteCode=i),n})["finally"](function(){e.promises.groupInviteCode=null})},revokeGroupInvite:function(){var e=this;return this.promises.revokeGroupInvite?this.promises.revokeGroupInvite:this.promises.revokeGroupInvite=f.revokeGroupInvite(this.id).then(function(t){var n=t.status,i=t.code;return 200===n&&(e.inviteCode=i),n})["finally"](function(){e.promises.revokeGroupInvite=null})}}),P=T.GroupMetadata,k=T.GroupMetadataProxy;t["default"]=P,t.GroupMetadataProxy=k},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StatusProxy=t["default"]=void 0;var i=n(77),a=(0,i.defineState)("Status",{Collection:"Status",props:{id:"string",status:"string"},session:{stale:["boolean",!1,!0]}}),s=a.Status,r=a.StatusProxy;t["default"]=s,t.StatusProxy=r},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(e=e.replace(E,""),e=e.replace(x,""),e=e.replace(I,"$1"),e=e.replace(A,"$1"),!D.test(e)&&O.test(e)){for(var n,i=t.getRangeAt(0).startContainer,a=0;5>a&&!(n=i.getAttribute&&i.getAttribute("data-id"));a++)i=i.parentNode;var s=Store.Msg.get(n);if(s){var r="["+g.timeStr(s.t)+"]",o=s.senderObj.formattedUser;e=b+r+" "+o+": "+T+e}}e=e.replace(R,"");var l=e.match(O);return l&&1===l.length&&(e=e.replace(O,"")),e=e.replace(O,"\n$1"),"\n"===e.charAt(0)&&(e=e.slice(1)),e}function s(e){var t=_.range(e.rangeCount).map(function(t){return e.getRangeAt(t).cloneContents()}).map(l).join("");return a(t,e)}function r(e){var t={},n=_.range(e.rangeCount).map(function(t){return e.getRangeAt(t).cloneContents()}).map(function(e){return c(e,t)}).join("");return(0,h["default"])({text:a(n,e),jids:t})}function o(e){var t=_.range(e.rangeCount).map(function(t){return e.getRangeAt(t).cloneContents()}).map(l).join("");if(t.indexOf(S)>-1){var n=_.compact(t.match(C));if(n.length)return n.join("\n").replace(M,"")}return t}function l(e){return e instanceof HTMLImageElement?e.alt:e.nodeType===Node.TEXT_NODE?e.nodeValue:_.map(e.childNodes,l).join("")}function c(e,t){if(e instanceof HTMLImageElement)return e.alt;if(e.nodeType===Node.TEXT_NODE)return e.nodeValue;if(d(e)){var n=e.getAttribute("data-jid");return t[n]=!0,"@"+f.user(n)}var i=u(e)||"",a=_.map(e.childNodes,function(e){return c(e,t)}).join("");return i?""+i+a+i:a}function u(e){switch(e.tagName){case"CODE":return"```";case"STRONG":return"*";case"EM":return"_";case"DEL":return"~";default:return""}}function d(e){return e&&e instanceof HTMLSpanElement&&e.hasAttribute("data-jid")&&e.getAttribute("data-display")===m.NodeToEmoji(e)}var p=n(25),h=i(p),f=n(21),m=n(161),g=n(76),v="​",y="⁠",E=new RegExp(v,"g"),S=""+v+y+v,M=new RegExp(""+S),C=new RegExp("(?:"+S+"|^)(.+?)(?:"+S+"|$)","g"),b=y+y,T=y+y+y,P=b+"([^"+y+"]+)"+T,k=y+y+y+y,N=y+y+y+y+y,w=k+"[^"+y+"]+"+N,x=new RegExp(w,"g"),O=new RegExp(P,"g"),D=new RegExp("^"+P),R=new RegExp(P+"$"),I=new RegExp("^[^"+y+"]+"+N+"(.*)","g"),A=new RegExp("(.*)"+k+"[^"+y+"]+$","g");e.exports={asPlainText:s,asRichText:r,formatDelim:u,extractIsolatedBlocks:o}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){for(var n=0,i=e[n];n<e.length;i=e[++n])if("text/plain"===i.type)return i;return null}var s=n(2),r=i(s),o=n(4),l=i(o),c=n(6),u=i(c),d=/\r\n/g,p=function(){function e(t){var n=this;(0,l["default"])(this,e),this.hasText=function(){return n.types.some(function(e){return"text/plain"===e})},this.hasType=function(e){return-1!==n.types.indexOf(e)},this.data=t,this.types=t.types?Array.prototype.slice.call(t.types):[]}return(0,u["default"])(e,[{key:"getItems",value:function(){var e=this;if(this.data.items)return Array.prototype.slice.call(this.data.items);var t=this._getFileTypes();return this.types.map(function(n){return{type:n,data:e.data.getData(n),kind:t.indexOf(n)>=0?"string":"file"}})}},{key:"_getFileTypes",value:function(){return Array.prototype.slice.call(this.data.files).map(function(e){var t=e.type;return t})}},{key:"getText",value:function(){return this._getText().then(function(e){return e?e.replace(d,"\n"):null})}},{key:"_getText",value:function(){var e=this.data;if(e.getData)return r["default"].resolve(e.getData("text/plain"));var t=this.data.items,n=a(t,"text/plain");return n?new r["default"](function(e){return n.getAsString(e)}):r["default"].resolve()}},{key:"getFiles",value:function(){return this.data.items?Array.prototype.slice.call(this.data.items).filter(function(e){var t=e.kind;return"file"===t}).map(function(e){return e.getAsFile()}).filter(function(e){return!!e}):Array.prototype.slice.call(this.data.files||[])}},{key:"hasFiles",value:function(){return this.data.items?Array.prototype.slice.call(this.data.items).some(function(e){var t=e.kind;return"file"===t}):!!Array.prototype.slice.call(this.data.files||[]).length}}]),e}();e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments[3],a=[],s=void 0;for(t.lastIndex=0;s=t.exec(e);)(s=i?i(s,t):s)&&a.push((0,r["default"])(s,n));return a}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=a;var s=n(1697),r=i(s)},function(e,t,n){"use strict";var i=n(473),a={multibyteLength:function(e){return i.ucs2.decode(e).length},multibyteSubstr:function(e,t,n){var a=i.ucs2.decode(e);if("undefined"==typeof n)a=a.slice(t);else{if(0>=n)return"";a=a.slice(t,t+n)}return i.ucs2.encode(a)}};e.exports=a},function(e,t,n){"use strict";var i=n(8),a=n(44),s=n(116).MIMETYPES,r=_.pickBy(s,function(e){return"document"===e.msgType}),o=i.createClass({displayName:"AttachMediaTypeFile",propTypes:{mimeType:i.PropTypes.string,filename:i.PropTypes.string},render:function(){var e=this.props,t=e.mimeType,n=e.filename,s="icon-doc";return r[t]&&(s=a(s,r[t].icon)),i.createElement("div",{className:"media-element-container"},i.createElement("div",{className:"media-element"},i.createElement("div",{className:"media-document"},i.createElement("div",{className:s}),i.createElement("div",{className:"media-document-text"},n))))}});e.exports=o},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(8),m=i(f),g=n(458),v=(i(g),n(44)),y=i(v),_=n(1378),E=i(_),S=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){var e=this.props.msg.ack,t=(0,y["default"])("icon icon-ack",{"icon-status-time":1>e,"icon-status-check":1===e,"icon-status-dblcheck":2===e,"icon-status-dblcheck-ack":e>2});return m["default"].createElement("span",{className:t})}}]),t}(m["default"].PureComponent);S.CONCERNS={msg:["ack"]},t["default"]=(0,E["default"])(S)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1395),s=i(a),r=n(163),o=i(r),l=n(9),c=i(l),u=n(8),d=n(1382),p=n(1569),h=n(1487),f=n(1390),m=n(1400),g=n(1613),v=n(463),y=n(157),E=n(233),S=n(234),M=n(1397),C=n(1),b=n(158),T=n(10),P=n(44),k=n(110),N={GROUP:"group",PROFILE:"profile"},w=u.createClass({displayName:"PhotoPicker",mixins:[b],propTypes:{startImage:u.PropTypes.string,type:u.PropTypes.oneOf(_.values(N)).isRequired,id:u.PropTypes.string,pending:u.PropTypes.bool,className:u.PropTypes.oneOfType([u.PropTypes.string,u.PropTypes.arrayOf(u.PropTypes.string),u.PropTypes.objectOf(u.PropTypes.bool)]),readOnly:u.PropTypes.bool,onImageSet:u.PropTypes.func.isRequired},statics:{Type:N},getInitialState:function(){return{img:this.props.startImage,hover:!1,contextMenu:!1}},componentWillReceiveProps:function(e){e.startImage&&this.props.startImage!==e.startImage?this.setState({img:e.startImage}):this.props.startImage!==e.startImage&&this.setState({img:e.startImage,imageSize:void 0})},onUpload:function(e){var t=this.refs.imageInput;return t.click(),!0},removeImage:function(){this.props.onImageSet(),T.closeModal()},onRemove:function(e){var t=this.props.type===N.GROUP?l10n.t("remove_group_icon"):l10n.t("remove_profile_photo");T.openModal(u.createElement(E,{onOK:this.removeImage,okText:l10n.t("remove"),onCancel:T.closeModal.bind(T),cancelText:l10n.t("web_cancel")},t))},onView:function(){var e=this.refs.imageContainer,t=function(t){t(e)};T.openModalMedia(u.createElement(h,{contact:Store.Contact.get(this.props.id),animateBorderRadius:!0,getZoomNode:t}),"profile-viewer")},onImageReceived:function(e,t){var n=this;return e?void o["default"].loadImage(e).then(function(i){n.setState({img:e}),n.props.onImageSet(e,t)})["catch"](function(e){C.error("PhotoPicker:onImageReceived failed to load image: "+e)();var t=n.props.type===N.GROUP?l10n.t("action_group_icon_set_failed"):l10n.t("action_profile_set_failed");T.openModal(u.createElement(E,{onOK:T.closeModal.bind(T)},t))}):void this.setState({img:null,imageSize:void 0})},onImagePick:function(e){var t=this;this.contextClose();var n=e.target.files[0];if(!n)return!1;var i=URL.createObjectURL(n);o["default"].loadImage(i).then(function(e){e.width<c["default"].MIN_PIC_SIDE||e.height<c["default"].MIN_PIC_SIDE?T.openModal(u.createElement(E,{onOK:T.closeModal.bind(T)},l10n.t("profile_or_group_image_too_small",{size:c["default"].MIN_PIC_SIDE,_plural:c["default"].MIN_PIC_SIDE}))):T.openModal(u.createElement(m,{type:m.BOX},u.createElement(g,{img:n,onFinished:t.onImageReceived,onRetake:t.onUpload})))})["catch"](function(e){var n=t.props.type===N.GROUP?l10n.t("action_group_icon_set_failed"):l10n.t("action_profile_set_failed");T.openModal(u.createElement(E,{onOK:T.closeModal.bind(T)},n))})["finally"](function(){URL.revokeObjectURL(i)}),e.target.value=""},onImageClick:function(e){if(this.props.readOnly)return void(this.state.img&&this.onView());e.stopPropagation(),e.preventDefault();var t=[];this.props.id&&this.state.img&&t.push(u.createElement(d,{a8n:"mi-view-photo",key:"view",action:this.onView},l10n.t("view_photo"))),navigator.getUserMedia&&t.push(u.createElement(p,{key:"take",onImageTake:this.onImageReceived})),t.push(u.createElement(d,{a8n:"mi-upload-photo",key:"upload",action:this.onUpload},l10n.t("upload_photo"))),this.state.img&&t.push(u.createElement(d,{a8n:"mi-remove-photo",key:"remove",action:this.onRemove},l10n.t("remove_photo"))),e.persist(),this.setState({contextMenu:{menu:t,event:e}})},contextClose:function(){this.setState({contextMenu:!1})},onMouseOver:function(e){this.state.hover||this.setState({hover:!0})},onMouseEnter:function(e){this.state.hover||this.setState({hover:!0})},onMouseLeave:function(e){this.state.hover&&this.setState({hover:!1})},onLoad:function(e){var t=e.target.clientWidth,n=e.target.clientHeight;this.setState({imageSize:{width:t,height:n}})},render:function(){var e;this.state.img&&(e=u.createElement(f,{type:f.TYPES.COVER,size:this.state.imageSize},u.createElement(s["default"],{src:this.state.img,crossOrigin:!1,style:{height:"100%",width:"100%"},onLoad:this.onLoad})));var t;(this.props.pending||this.state.img&&!this.state.imageSize)&&(t=u.createElement("div",{className:"avatar-spinner-container"},u.createElement(y,{size:50,stroke:3})));var n=null;if(!this.props.pending&&!this.props.readOnly&&(!this.state.img||this.state.imageSize)&&(!this.state.img||this.state.contextMenu||this.state.hover)){var i;switch(this.props.type){case N.GROUP:i=this.state.img?l10n.t("change_group_icon"):l10n.t("add_group_icon");break;case N.PROFILE:i=this.state.img?l10n.t("change_profile_photo"):l10n.t("add_profile_photo")}n=u.createElement("div",{className:"avatar-overlay",key:"avatar-overlay"},u.createElement("span",{className:"icon icon-camera-light"}),u.createElement("div",{"data-a8n":v.key("avatar-text"),className:"avatar-overlay-text"},i))}var a=P("avatar","avatar-l","draggable-container",{"icon-group-default":this.props.type!==N.PROFILE,"icon-user-default":this.props.type===N.PROFILE}),r=this.props.readOnly||this.props.pending||!this.state.imageSize&&this.state.img?_.noop:this.onImageClick,o=void 0;this.state.contextMenu&&(o=u.createElement(S,{displayName:"PhotoPickerContextMenu",escapable:!0,popable:!0,requestDismiss:this.contextClose},u.createElement(M,{contextMenu:this.state.contextMenu})));var l=P("avatar-picker",this.props.className);return u.createElement("div",{className:l},u.createElement("div",{className:a,onClick:r,onMouseOver:this.onMouseOver,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,ref:"imageContainer",dir:"ltr"},u.createElement("div",{className:"avatar-body"},e),u.createElement(k,{transitionName:"fade"},t,n)),u.createElement("input",{ref:"imageInput",type:"file",accept:"image/gif,image/jpeg,image/jpg,image/png",style:{display:"none"},onChange:this.onImagePick}),o)}});e.exports=w},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(94),s=i(a),r=n(117),o=i(r),l=n(4),c=i(l),u=n(6),d=i(u),p=function(){},h=function(){function e(){(0,c["default"])(this,e),this.internalHandlers=new o["default"]}return(0,d["default"])(e,[{key:"initialize",value:function(e){this.ctx=e}},{key:"registerHandler",value:function(e,t){this.internalHandlers.set(e,t)}},{key:"unregisterHandler",value:function(e){this.internalHandlers["delete"](e)}},{key:"handle",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return(this.internalHandlers.get(e)||p).apply(void 0,(0,s["default"])(t))}}]),e}();e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(112),s=i(a),r=n(114),o=i(r),l=n(8),c=n(44),u=l.createClass({displayName:"Row",propTypes:{side:l.PropTypes.node,ellipsify:l.PropTypes.bool,classes:l.PropTypes.string,onClick:l.PropTypes.func},getDefaultProps:function(){return{ellipsify:!1}},render:function(){var e=this.props,t=e.onClick,n=e.side,i=e.ellipsify,a=e.classes,r=e.children,u=(0,o["default"])(e,["onClick","side","ellipsify","classes","children"]),d=c("row",a,{clickable:t}),p=c("row-main",{ellipsify:i}),h=n?l.createElement("div",{className:"row-side"},n):null;return l.createElement("div",(0,s["default"])({className:d,onClick:t},u),l.createElement("div",{className:"row-body"},l.createElement("div",{className:p},r),h))}});e.exports=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(8),m=i(f),g=n(1371),v=i(g),y=n(1378),_=i(y),E=n(1414),S=(i(E),function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){var e=this.props.presence,t=void 0;return"list"===this.props.location?(t=e.getFormattedString(),t?m["default"].createElement(v["default"],{ellipsify:!0,titlify:!0,text:t}):null):(t=e.withholdDisplay?this.props.placeholder:e.getFormattedString()||(e.forceDisplay?"":this.props.placeholder),t?m["default"].createElement("div",{className:"chat-status ellipsify"},m["default"].createElement(v["default"],{ellipsify:!0,titlify:!0,text:t})):null)}}]),t}(m["default"].PureComponent));S.CONCERNS={presence:["withholdDisplay","forceDisplay","hasData"],chatstate:["type","deny","t"]},t["default"]=(0,_["default"])(S)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(1371),m=i(f),g=n(458),v=(i(g),n(1384)),y=n(8),_=n(1472),E=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){var e=this.props.msg,t=e.mentionMap(),n=v.Configuration.TrustedConversation(t);return y.createElement("div",{className:"image-caption message-text","data-id":e.id},y.createElement(_,{msg:e}),y.createElement(m["default"],{direction:e.dir,dirMismatch:!(!e.dir||e.rtl===l10n.isRTL()),selectable:!0,text:e.caption,formatters:n}))}}]),t}(y.PureComponent);e.exports=E},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(236),s=i(a),r=n(458),o=i(r),l=n(8),c=n(1392),u=n(76),d=n(44),p=n(47),h=l.createClass({displayName:"PreviewImage",propTypes:{duration:l.PropTypes.oneOfType([l.PropTypes.string,l.PropTypes.number]),shade:l.PropTypes.bool,thumb:l.PropTypes.string,className:l.PropTypes.string,type:l.PropTypes.oneOf([o["default"].TYPE.AUDIO,o["default"].TYPE.LOCATION,o["default"].TYPE.VIDEO,o["default"].TYPE.PTT,o["default"].TYPE.VCARD]).isRequired,quoted:l.PropTypes.bool},getDefaultProps:function(){return{shade:!0}},getIconClassNames:function(){return this.props.type===o["default"].TYPE.VIDEO?"icon-sm icon-video-inv":void 0},getClassNames:function(){var e=this.props.type===o["default"].TYPE.VCARD||this.props.type===o["default"].TYPE.PTT;return d("preview",this.props.className,(0,s["default"])({"icon-user-default":e,"icon-user-default-square":e&&this.props.quoted},"preview-"+this.props.type+" no-image",!this.props.thumb))},getStyles:function(){var e=this.props.thumb;return e?p.isHttp(e)?{backgroundImage:'url("'+e+'")'}:{backgroundImage:'url("data:image/jpeg;base64,'+e+'")'}:{}},render:function(){var e=u.durationStr(this.props.duration),t=this.props.shade?l.createElement("span",{className:"shade"}):null,n=this.props.type===o["default"].TYPE.AUDIO?l.createElement("div",{className:"icon icon-audio-file"}):l.createElement("div",{className:"preview-image",style:this.getStyles()});return l.createElement("div",{className:this.getClassNames()},n,t,l.createElement("span",{className:"meta meta-audio"},l.createElement("span",{className:this.getIconClassNames()}),l.createElement(c,null,e)))}});e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(458),s=i(a),r=n(1370),o=i(r),l=n(1417),c=i(l),u=n(1371),d=i(u),p=n(1384),h=n(8),f=n(10),m=n(1392),g=n(462),v=n(1380),y=n(1280),_=n(1423),E=n(76),S=n(465),M=n(1372),C=n(44),b=n(110),T=n(9),P=n(1474),k=n(234),N=s["default"].TYPE,w=N.CHAT,x=N.IMAGE,O=N.VIDEO,D=N.LOCATION,R=N.DOCUMENT,I=N.VCARD,A=N.AUDIO,L=N.MULTI_VCARD,F=h.createClass({displayName:"QuotedMsg",mixins:[M,y],propTypes:{msg:h.PropTypes.instanceOf(s["default"]).isRequired,chat:h.PropTypes.instanceOf(o["default"]).isRequired,onOmit:h.PropTypes.func,rootMsg:h.PropTypes.instanceOf(s["default"]),displayType:h.PropTypes.string},getInitialState:function(){var e={hover:!1,quotedMsgPreview:!1};return this.props.msg.isMMS&&(e.renderableUrl=this.async("msg.mediaData.renderableUrl"),e.preview=this.async("msg.mediaData.preview")),e},onClick:function(){var e=this.props,t=e.rootMsg,n=e.msg;if(!n.isStatusV3){if(t&&!t.isQuotedMsgAvailable)return void this.setState({quotedMsgPreview:!0});var i=n.id,a=n.chat,s=a.getSearchContext(Store.Msg.get(i)||i,t);s&&(s.slideToMsg=!0),f.openChatAt(a,s)}},onMouseOver:function(e){this.hoverable()&&this.setState({hover:!0})},onMouseEnter:function(e){this.hoverable()&&this.setState({hover:!0})},onMouseLeave:function(e){this.state.hover&&this.setState({hover:!1})},hoverable:function(){return!this.state.hover&&this.props.rootMsg&&!this.props.msg.isStatusV3},render:function(){var e=this,t=this.props,n=t.msg,i=t.displayType,a=t.chat,s=a.assignedColor(n.sender),r=i===T.DISP_TYPE.CONVERSATION,o=h.createElement(v,{msg:n,className:"quoted-msg-bubble-ptt-author",chat:a,quoted:!0,displaySelf:n.sender===Store.Conn.me,disableClick:!0}),l=[];n.hasSymbol()&&l.push(h.createElement(c["default"],{msg:n,key:"msg-symbol"})),[O,A].indexOf(n.type)>-1&&!n.isGif&&!n.caption&&l.push(E.durationStr(n.duration)+" "),[x,O,w].indexOf(n.type)>-1?l.push(h.createElement(d["default"],{formatters:p.Configuration.Format(n.mentionMap()),text:g.msgText(n,!1),direction:"auto",key:"status"})):l.push(h.createElement(d["default"],{formatters:p.Configuration.Format(n.mentionMap()),text:g.msgText(n),direction:"auto",key:"status"}));var u=null,f=this.props.rootMsg;if(this.state.quotedMsgPreview&&f){var y=C("quoted-msg-preview",f.isSentByMe?"right":"left",{"chat-msg":n.type===w});u=h.createElement(k,{displayName:"QuotedMsgPreview",escapable:!0,popable:!0,requestDismiss:function(){return e.setState({quotedMsgPreview:!1})}},h.createElement("div",{className:y},h.createElement(P,{msg:n}),h.createElement("div",{className:"nib-wrapper"},h.createElement("div",{className:"nib"}))))}var M=void 0,N="quoted-msg-image";switch(n.type){case x:case O:case R:var F=n.mediaData,U=F.type===x&&F.renderableUrl?F.renderableUrl:F.preview&&F.preview.url();U&&(M=h.createElement("div",{style:{backgroundImage:"url("+U+")"},className:N}));break;case D:n.body&&(M=h.createElement("div",{style:{backgroundImage:"url(data:image/jpeg;base64,"+n.body+")"},className:N}));break;case w:n.thumbnail&&(M=h.createElement("div",{style:{backgroundImage:'url("data:image/jpeg;base64,'+n.thumbnail+'")'},className:N}));break;case I:M=h.createElement(_,{waid:n.getVCardThumbnailWAid(),size:_.Size.NONE,thumb:n.body&&S.thumbnail(n.body),quoted:!0,className:N});break;case L:M=h.createElement(_,{className:N,quoted:!0})}var j=C("quoted-msg",{"quoted-msg-hover":this.state.hover}),G=this.props.onOmit?h.createElement("div",{style:{display:"flex",flex:"0 0 auto"}},M,h.createElement("div",{className:"btn-background"},h.createElement("button",{className:"icon icon-x",onClick:this.props.onOmit}))):M&&h.createElement("div",{className:"quoted-msg-image-wrapper"},M);return h.createElement("div",{onMouseOver:r?this.onMouseOver:null,onMouseEnter:r?this.onMouseEnter:null,onMouseLeave:r?this.onMouseLeave:null},h.createElement(b,{transitionName:"quoted-msg-preview",className:"quoted-msg-preview-wrapper"},u),h.createElement("div",{className:j,onClick:r?this.onClick:null},h.createElement("div",{className:"quoted-msg-status"},h.createElement("span",{className:"bg-color-"+s+" quoted-msg-color-bar"}),h.createElement("div",{className:"quoted-msg-info"},h.createElement("div",null,o,h.createElement("div",{className:"message-text quoted-msg-text"},h.createElement(m,null,l))))),G))}});e.exports=F},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(460),s=i(a),r=n(458),o=i(r),l=n(1371),c=i(l),u=n(111),d=i(u),p=n(8),h=n(45),f=n(156),m=n(1424),g=n(44),v=n(76),y=n(1403),_=n(1379),E=n(21),S=n(91),M=n(1385),C=n(9),b=p.createClass({displayName:"StarredMsg",mixins:[f],propTypes:{msg:p.PropTypes.instanceOf(o["default"]).isRequired,isMsgVisible:p.PropTypes.func,selectable:p.PropTypes.bool,selectedMessages:p.PropTypes.instanceOf(M),onMessageSelect:p.PropTypes.func,currSelection:p.PropTypes.object,activeSelection:p.PropTypes.object,onClickMsg:p.PropTypes.func.isRequired,multiMedia:p.PropTypes.bool},getInitialState:function(){var e=this.props.currSelection,t=this.props.activeSelection,n=this.props.msg;return{hover:!1,current:e?e.value===n:!1,active:t?t.value===n:!1,focus:!1}},componentWillMount:function(){var e=this.props.msg,t=this.props.currSelection;t&&this.addObserver(t,e.id.toString(),this.onSelectionChange);
var n=this.props.activeSelection;n&&this.addObserver(n,e.id.toString(),this.onActiveChange)},onSelectionChange:function(e,t){var n="focus"===e;if(n){var i=h.findDOMNode(this);S.focus(i),t&&y.scrollIntoViewIfNeeded(i)}this.setState({current:n})},onActiveChange:function(e){if("focus"===e){var t=h.findDOMNode(this);S.focus(t),y.scrollIntoViewIfNeeded(t)}this.setState({active:!!e})},mouseOver:function(){this.state.hover||this.setState({hover:!0})},mouseEnter:function(){this.state.hover||this.setState({hover:!0})},mouseLeave:function(){this.state.hover&&this.setState({hover:!1})},onEnter:function(e){e.stopPropagation(),e.preventDefault(),this.props.onClickMsg(this.props.msg)},openContextMenu:function(e){this.refs.wrapper.contextOpen()},onFocus:function(e){this.setState({focus:!0}),this.indicateFocus(e)},onBlur:function(e){this.finishFocusIndication(e),this.setState({focus:!1})},indicateFocus:function(e){if(!(Date.now()-(d["default"].flashFocus||0)>200)){var t=this.refs.row,n=this.state.active?"#d6d7d8":"#e2e3e3";(0,s["default"])(t,"stop"),(0,s["default"])(t,{backgroundColor:[n,"#cbdde7"]},{duration:1300,easing:[.19,.69,.01,.99],complete:this.finishFocusIndication})}},finishFocusIndication:function(e){var t=this.refs.row;t&&((0,s["default"])(t,"stop"),t.style.backgroundColor="")},render:function(){var e=this,t=this.props,n=t.msg,i=t.selectedMessages,a=n.senderObj.formattedName,s=n.chat.isUser?Store.Contact.get(n.to).formattedName?Store.Contact.get(n.to).formattedName:E.formattedUser(n.to):n.chat.title(),r=g("starred-msg-wrapper",{hover:this.state.hover,current:this.state.current&&this.state.focus,active:this.state.active}),o=this.props.multiMedia?null:p.createElement("div",{className:"starred-msg-title"},p.createElement("div",{className:"starred-title-main"},p.createElement(_,{id:n.senderObj.id,size:26}),p.createElement(c["default"],{className:"starred-msg-author",text:a,direction:"auto",ellipsify:!0,titlify:!0}),p.createElement("span",{className:"starred-title-divider"}),p.createElement(c["default"],{className:"starred-msg-chat",text:s,direction:"auto",ellipsify:!0,titlify:!0})),p.createElement("div",{className:"starred-title-meta"},v.relativeStr(n.t)),p.createElement("div",{className:"icon icon-chevron-right-alt"})),l={enter:this.onEnter};l[l10n.LR("right","left")]=this.openContextMenu;var u=this.props.selectable||this.state.hover&&this.props.multiMedia;return p.createElement(d["default"],{handlers:l,onFocus:this.onFocus,onBlur:this.onBlur},p.createElement("div",{ref:"row",className:r,onClick:function(){return e.props.onClickMsg(n,i&&!i.isSelected(n))},onMouseEnter:this.state.hover?null:this.mouseEnter,onMouseOver:this.state.hover?null:this.mouseOver,onMouseLeave:this.state.hover?this.mouseLeave:null},o,p.createElement(m,{msg:n,key:n.id,ref:"wrapper",current:this.state.current&&this.state.focus,displayType:C.DISP_TYPE.STARRED_MSGS,isMsgVisible:this.props.isMsgVisible,selectable:u,selectedMessages:i,onMessageSelect:this.props.onMessageSelect,position:m.Position.END,tailOverride:"left"})))}});e.exports=b},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(8),s=i(a),r=n(45),o=i(r),l=n(44),c=i(l),u=n(29),d=i(u),p=n(460),h=i(p),f=n(110),m=i(f),g=n(1281),v=i(g),y=n(41),E=i(y),S=n(156),M=i(S),C=n(1605),b=i(C),T=n(1478),P=n(91),k=n(1403),N=i(k),w=n(161),x=i(w),O=n(1604),D=i(O),R=n(477),I=i(R),A=n(111),L=i(A),F=n(1695),U=i(F),j=n(1413),G=1e3,B=100,H=85,V=62,q=27,W=62,z=33,Y=5,K=15,Q=.7*W,X=1.5*W,Z=s["default"].createClass({displayName:"EmojiPanel",mixins:[M["default"]],propTypes:{onEmoji:s["default"].PropTypes.func.isRequired,onGif:s["default"].PropTypes.func,onFocusRelease:s["default"].PropTypes.func},lastScrollTop:0,fastScroll:!1,lastClickTime:0,lastFocusedSection:null,getInitialState:function(){var e=this.props.onGif?T.ExtendedTabs:T.TabsOrdered,t=void 0;t=this.props.onGif&&T.Tab[d["default"].getLastEmojiTab()]===T.Tab.GIFS?T.Tab.GIFS:T.Tab.RECENT;var n=_.uniq(_.filter(Store.RecentEmoji.models.map(function(e){return x["default"].emojiMap[e["char"]]})));return n.length||(n=null),{tabs:e,selected:t,recentEmojis:n,searchText:null,showSearchInput:!0,scrolledToTop:!0}},componentWillMount:function(){this.handleScroll=_.throttle(this._handleScroll,B)},componentDidMount:function(){this.uiIdle(this.restoreFocus);var e=this.state.selected.key;this.uiIdle(function(){new E["default"].WebcEmojiOpen({webcEmojiOpenTab:e}).commit()})},componentWillUnmount:function(){d["default"].setLastEmojiTab(this.state.selected.key),this.handleScroll.cancel()},shouldComponentUpdate:function(e,t){return(0,v["default"])(this,e,t)},getCurrentTabFromScroll:function(e){var t=this;return _.findLast(T.TabsOrdered,function(n){var i=o["default"].findDOMNode(t.refs[n.key]);return e.scrollTop+H>=i.offsetTop})},onScroll:function(){this.handleScroll()},_handleScroll:function(){if(!(this.state.selected!==T.Tab.GIFS&&this.state.searchText||Date.now()-this.lastClickTime<G)){var e={},t=this.refs.scrollContainer,n=this.state.selected===T.Tab.GIFS?T.Tab.GIFS:this.getCurrentTabFromScroll(t);n!==this.state.selected&&(e.selected=n,this.lastFocusedSection=null);var i=t.scrollTop,a=0>=i;a!==this.state.scrolledToTop&&(e.scrolledToTop=a);var s=this.lastScrollTop-i,r=Math.abs(s)>Y;this.fastScroll=Math.abs(s)>K,0>s?this.state.showSearchInput&&(i>Q&&r||this.lastScrollTop<Q&&i>=Q)&&(e.showSearchInput=!1):this.state.showSearchInput||(r||X>i)&&(e.showSearchInput=!0),this.state.selected===T.Tab.GIFS&&this.refGifPanel.animateOnScroll(t),this.lastScrollTop=i,_.isEmpty(e)||this.setState(e)}},scrollToPanel:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=this.refs[e.key];if(i){var a=o["default"].findDOMNode(i);t?(N["default"].scrollAt(a,a.parentNode,{pos:"offset",duration:300,animate:!0,easing:[.99,.13,.13,.99],offset:n}),this.lastScrollTop=a.offsetTop):N["default"].scrollAt(a,a.parentNode,{pos:"offset",offset:n})}},onSelectTab:function(e){this.lastClickTime=Date.now();var t=this.state.tabs.indexOf(this.state.selected),n=this.state.tabs.indexOf(e),i=t>=n||!!this.state.searchText||e===T.Tab.GIFS,a=this.state.searchText,s=this.state.searchResults;n!==t&&e!==T.Tab.GIFS&&(a=null,s=null),this.lastFocusedSection=null,this.setState({selected:e,showSearchInput:i,searchText:a,searchResults:s})},onEmoji:function(e){this.props.onEmoji(e),Store.RecentEmoji.increment(e)},restoreFocus:function(){this.lastFocusedSection?this.lastFocusedSection.restoreFocus():this.refs.searchInput&&this.state.showSearchInput&&this.focusSearchInput()},onRotateFocus:function(e){var t=!1;e&&(this.stopEvent(e),t=!!e.shiftKey,L["default"].flashFocus=Date.now()),this.searchInputHasFocus()?this.state.selected===T.Tab.GIFS?t?this.onSelectTab(T.Tab.RECENT):this.props.onFocusRelease():t?this.props.onFocusRelease():this.onSelectTab(T.Tab.GIFS):this.focusSearchInput()},setRefGifPanel:function(e){this.refGifPanel=e},getPanelContent:function(){var e=this;return this.state.selected===T.Tab.GIFS?s["default"].createElement(b["default"],{ref:this.setRefGifPanel,onGif:this.props.onGif,searchText:this.state.searchText}):this.state.searchResults?s["default"].createElement("div",{className:"emoji-panel-section",key:T.Tab.SEARCH_RESULT.key,ref:T.Tab.SEARCH_RESULT.key},s["default"].createElement(D["default"],{tab:T.Tab.SEARCH_RESULT,ref:"emojiTab-SEARCH_RESULT",key:this.state.searchText,emojiList:this.state.searchResults,focusPrevSection:this.focusPrevSection,onFocusRelease:this.props.onFocusRelease,scrollEmojiIntoViewIfNeeded:this.scrollEmojiIntoViewIfNeeded,onEmoji:this.onEmoji})):_.map(T.TabsOrdered,function(t){var n;return n=t===T.Tab.RECENT?e.state.recentEmojis:I["default"][t.key],s["default"].createElement("div",{className:"emoji-panel-section",key:t.key,ref:t.key},s["default"].createElement(D["default"],{tab:t,ref:"emojiTab-"+t.key,emojiList:n,onEmoji:e.onEmoji,scrollEmojiIntoViewIfNeeded:e.scrollEmojiIntoViewIfNeeded,focusPrevSection:e.focusPrevSection,focusNextSection:e.focusNextSection,onFocusRelease:e.props.onFocusRelease,onSetSearchText:e.onSetSearchText}))})},componentDidUpdate:function(e,t){var n=t.selected!==this.state.selected,i=t.searchText!==this.state.searchText,a=Date.now()-this.lastClickTime>=G;if(n){if(this.state.selected!==T.Tab.GIFS&&!a){var s=0;this.state.showSearchInput&&(s=V),this.scrollToPanel(this.state.selected,!0,s),this.restoreFocus()}}else i?this.state.searchText?this.refs.scrollContainer.scrollTop=0:this.refs.scrollContainer.scrollTop=this.scrollTopBeforeSearch:(!a&&this.state.showSearchInput&&this.scrollToPanel(this.state.selected,!0,V),this.restoreFocus())},stopEvent:function(e){e&&(e.preventDefault(),e.stopPropagation())},searchInputHasFocus:function(){var e=document.activeElement;return e?e===this.refs.searchInput:!1},focusSearchInput:function(){if(this.refs.searchInput&&!(this.searchInputHasFocus()||((0,P.focus)(this.refs.searchInput),Date.now()-(L["default"].flashFocus||0)>200))){var e=o["default"].findDOMNode(this.refs.searchContainer);(0,h["default"])(e,"stop"),(0,h["default"])(e,{backgroundColor:["#e0e1e2","#d9f3ff"]},{duration:1300,easing:[.24,.91,.01,.99]})}},onSearchDown:function(){var e=this.getSectionToFocus();e.focusRow(this.getEmojiRowNumberToFocus(e)),this.lastFocusedSection=e},getEmojiRowNumberToFocus:function(e){var t=o["default"].findDOMNode(e),n=this.refs.scrollContainer.scrollTop-t.offsetTop-q;return this.state.showSearchInput&&(n=n+W+z),0>n?0:Math.floor(n/T.EMOJI_HEIGHT)},onSearchEnter:function(e){var t=this.getSectionToFocus();t.keyboardSelectRow(e,this.getEmojiRowNumberToFocus(t)),this.lastFocusedSection=t},getSectionToFocus:function(){return this.state.searchText?this.refs["emojiTab-SEARCH_RESULT"]:this.state.selected===T.Tab.RECENT?this.getFirstSectionWithEmoji():this.refs["emojiTab-"+this.state.selected.key]},getFirstSectionWithEmoji:function(){if(this.state.searchText)return this.refs["emojiTab-SEARCH_RESULT"];var e=this.refs["emojiTab-RECENT"];return this.state.recentEmojis?e:this.refs["emojiTab-SMILEYS_PEOPLE"]},scrollEmojiIntoViewIfNeeded:function(e){e.offsetTop-this.refs.scrollContainer.scrollTop<W&&N["default"].scrollIntoView(e,!0,this.refs.scrollContainer)},focusPrevSection:function(e,t){var n=_.findIndex(this.state.tabs,e);if(n--,n>=0){var i=this.state.tabs[n],a=this.refs["emojiTab-"+i.key],s=i===T.Tab.RECENT&&this.state.recentEmojis,r=i===T.Tab.SEARCH_RESULT&&this.state.searchResults,o=i!==T.Tab.RECENT&&i!==T.Tab.SEARCH_RESULT;s||r||o?(a&&a.focusLastRow(t),this.lastFocusedSection=a):(L["default"].flashFocus=Date.now(),this.focusSearchInput())}else L["default"].flashFocus=Date.now(),this.focusSearchInput()},focusNextSection:function(e,t){var n=_.findIndex(this.state.tabs,e);if(n++,n<this.state.tabs.length){var i=this.state.tabs[n],a=this.refs["emojiTab-"+i.key];a&&a.focusFirstRow(t),this.lastFocusedSection=a}},clearSearchText:function(){this.setState({searchText:null,searchResults:null})},getSearchBox:function(){var e=void 0;if(this.state.showSearchInput){var t=void 0,n=void 0;this.state.selected===T.Tab.GIFS?(t=l10n.t("search_gifs",{service:j.BRAND_NAMES[(0,j.gifProvider)()]}),n={}):(t=l10n.t("search_emoji"),n={enter:this.onSearchEnter,down:this.onSearchDown});var i=null;this.state.searchText&&(i=s["default"].createElement("span",{className:"icon icon-x-alt-small",onClick:this.clearSearchText}));var a=(0,c["default"])("emoji-search-row",{"emoji-search-row-shade":!this.state.scrolledToTop});e=s["default"].createElement(L["default"],{handlers:n,"data-tab":4,className:a,key:this.state.showSearchInput,onFocus:this.focusSearchInput},s["default"].createElement("label",{ref:"searchContainer",className:"emoji-search-row-input"},s["default"].createElement("div",{className:"input-container"},s["default"].createElement("input",{ref:"searchInput",className:"input input-search input-emoji-search",type:"text",dir:"auto",value:this.state.searchText||"",title:t,placeholder:t,onMouseDown:function(e){e.stopPropagation()},onChange:this.onSearch}),i)))}else e=null;var r=this.fastScroll?"emoji-search-slide-away-fast":"emoji-search-slide-away";return s["default"].createElement(m["default"],{transitionName:r},e)},onSearch:function(e){this.stopEvent(e);var t=void 0,n=e.target.value;0===n.length?(n=null,t=null):t=(0,U["default"])(n),null===this.state.searchText&&(this.scrollTopBeforeSearch=this.refs.scrollContainer.scrollTop),this.setState({searchText:n,searchResults:t})},preventBlur:function(e){this.stopEvent(e),this.restoreFocus()},render:function(){var e=this,t=this.state.tabs,n=t.indexOf(this.state.selected),i=t.map(function(t){var n=(0,c["default"])("menu-tab",{active:e.state.selected===t});return s["default"].createElement("button",{className:n,onClick:function(){return e.onSelectTab(t)},key:t.key,title:t.title()},s["default"].createElement("span",{className:"icon "+t.css}))}),a=l10n.isRTL()?-1:1,r={width:100/i.length+"%",transform:"translateX("+100*n*a+"%)"},o=this.getSearchBox(),l=this.getPanelContent(),u=(0,c["default"])("emoji-panel-body-container",{hasSearchBox:!!o}),d={tab:this.onRotateFocus,"shift+tab":this.onRotateFocus};return s["default"].createElement(L["default"],{handlers:d},s["default"].createElement("div",{className:"emoji-panel k"},s["default"].createElement("div",{className:"menu-tabs menu-tabs-emoji emoji-panel-header","data-active-tab":this.state.selected.key},s["default"].createElement("div",{style:r,className:"menu-tabs-marker"}),i),s["default"].createElement("div",{className:u,onMouseDown:this.preventBlur},o,s["default"].createElement("div",{className:"emoji-panel-body",onScroll:this.onScroll,ref:"scrollContainer"},l))))}});e.exports=Z},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(236),s=i(a),r=n(13),o=i(r),l=n(458),c=i(l),u=n(8),d=n(1383),p=n(233),h=n(10),f=n(1445),m=u.createClass({displayName:"ForwardMessageFlow",mixins:[d],propTypes:{msgs:u.PropTypes.arrayOf(u.PropTypes.instanceOf(c["default"])).isRequired,onFoward:u.PropTypes.func},getDefaultTransition:function(){var e;return e={},(0,s["default"])(e,d.Dir.PUSH,d.Transition.NONE),(0,s["default"])(e,d.Dir.POP,d.Transition.NONE),e},componentWillMount:function(){var e=l10n.t("forward_message_to",{_plural:this.props.msgs.length||1}),t=_.head(this.props.msgs)&&_.head(this.props.msgs).chat;this.push(u.createElement(f,{onChat:this.onForwardConfirmed,excludeChat:t,title:e}))},onForwardConfirmed:function(e){var t=this;Store.Chat.forwardMessagesToChats(this.props.msgs,e)["catch"](o["default"].ForwardError,function(e){t.showMediaSendError(e.reasons)}),this.endFlow(),_.isFunction(this.props.onForward)&&this.props.onForward(this.props.msgs),h.openChatFromUnread(_.head(e))},showMediaSendError:function(e){var t=e.map(function(e){var t=e.chat,n=e.reason;return u.createElement("p",{key:t.id},t.formattedTitle," : ",n)});h.openModal(u.createElement(p,{onOK:h.closeModal.bind(h),okText:l10n.t("web_ok")},t),void 0)}});e.exports=m},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(112),s=i(a),r=n(2),o=i(r),l=n(16),c=i(l),u=n(4),d=i(u),p=n(6),h=i(p),f=n(20),m=i(f),g=n(19),v=i(g),y=n(8),_=i(y),E=n(1387),S=n(13),M=i(S),C=n(18),b=i(C),T=n(1425),P=i(T);t["default"]=function(e){var t,n;return n=t=function(t){function n(){var e,t,i,a;(0,d["default"])(this,n);for(var s=arguments.length,r=Array(s),l=0;s>l;l++)r[l]=arguments[l];return t=i=(0,m["default"])(this,(e=n.__proto__||(0,c["default"])(n)).call.apply(e,[this].concat(r))),i.isUnmounted=!1,i.rejectOnUnmount=function(){return i.rejectPromise?i.rejectPromise:(i.rejectPromise=new o["default"](function(e,t){i.rejector=t}),i.rejectPromise["catch"](b["default"].noop),i.isUnmounted&&i.rejector(new M["default"].Unmount),i.rejectPromise)},a=t,(0,m["default"])(i,a)}return(0,v["default"])(n,t),(0,h["default"])(n,[{key:"componentWillUnmount",value:function(){this.isUnmounted=!0,this.rejectPromise&&this.rejector(new M["default"].Unmount)}},{key:"_getComponent",value:function(){return E._getComponent.call(this)}},{key:"render",value:function(){return _["default"].createElement(e,(0,s["default"])({ref:E.HOCRef,rejectOnUnmount:this.rejectOnUnmount},this.props))}}]),n}(_["default"].Component),t.displayName="Promise("+(0,P["default"])(e)+")",n}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(16),o=i(r),l=n(4),c=i(l),u=n(6),d=i(u),p=n(20),h=i(p),f=n(19),m=i(f),g=n(460),v=i(g),y=n(1409),_=i(y),E=n(1370),S=(i(E),n(237)),M=i(S),C=n(1389),b=i(C),T=n(111),P=i(T),k=n(8),N=n(45),w=n(18),x=window.Store,O=n(1400),D=n(10),R=n(1373),I=n(1375),A=n(1374),L=n(1523),F=n(1388),U=n(1421),j=n(1386),G=n(1385),B=n(91),H=n(159),V=n(61),q=n(1531),W=n(1387),z=W.GetRef,Y=function(e){function t(){var e,n,i,a;(0,c["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return n=i=(0,h["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),i.filteredData=null,i.state={searchText:""},i.handleSelect=function(e,t){i.selectedChats.setVal(e,t),i.active.setVal(e)},i.onCancelSelection=function(){i.selectedChats.unsetAll()},i.onSearch=function(e){i.filteredData=null,i.setState({searchText:e})},i.onFocusList=function(e){e.preventDefault(),e.stopPropagation(),P["default"].flashFocus=Date.now(),i.active.setFirst()},i.indicateSearchFocus=function(e){if(i.active.unset(),!(Date.now()-(P["default"].flashFocus||0)>200)&&i.search){var t=N.findDOMNode(i.search);(0,v["default"])(t,"stop"),(0,v["default"])(t,{backgroundColor:["#fbfbfb","#D9F3FF"]},{duration:1600,easing:[.19,.69,.01,.99]})}},i.onNext=function(e){e.preventDefault(),e.stopPropagation(),i.active.setNext()},i.onPrev=function(e){e.stopPropagation(),e.preventDefault();var t=i.active.prev();t>-1?i.active.setPrev():(i.active.unset(),P["default"].flashFocus=Date.now(),B.focus(i.search))},i.onChat=function(){s["default"].map(i.selectedChats.getSelected(),function(e){return e instanceof M["default"]?x.Chat.find(e.id):e}).then(function(e){i.props.onChat(e)})},a=n,(0,h["default"])(i,a)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentWillMount",value:function(){this.active=new j(this.getData(),function(e){return e.id}),this.selectedChats=new G([],function(e){return e.id})}},{key:"getFrequentContacts",value:function(){var e=this.state.searchText;return e||!V.supportsFeature(V.F.FREQUENT_CONTACTS)?[]:x.Contact.frequentContacts(null,this.props.excludeChat)}},{key:"getFilteredChats",value:function(){var e=this.state.searchText;return e?(e=H.accentFold(e),x.Chat.filter(function(t){return t.canSend&&t.isVisible&&t.contact.searchMatch(e)})):x.Chat.filter(function(e){return e.canSend&&e.isVisible})}},{key:"getFilteredContacts",value:function(){var e=x.Contact.getFilteredContacts(),t=this.state.searchText;return t?(t=H.accentFold(t),e.filter(function(e){return e.searchMatch(t)})):e}},{key:"getFilteredData",value:function(){if(this.filteredData)return this.filteredData;var e={},t=w.compact(w.map(this.getFrequentContacts(),function(t){var n=t.isGroup?x.Chat.get(t.id):t;return n&&(e[n.id]=!0),n})),n=w.compact(w.map(this.getFilteredChats(),function(t){var n=t.isGroup?t:t.contact;return e[n.id]?null:(e[n.id]=!0,n)})),i=w.compact(w.map(this.getFilteredContacts(),function(t){return e[t.id]?null:t}));return this.filteredData={frequentContactsData:t,chatsData:n,contactsData:i}}},{key:"getFilteredItems",value:function(){var e=this,t=[],n=this.getFilteredData(),i=n.frequentContactsData,a=n.chatsData,s=n.contactsData;return i.length&&t.push(k.createElement(U,{key:"frequent-contacts-header",header:H.t("web_frequent_contacts")})),w.forEach(i,function(n){t.push(k.createElement(L,{key:n.id,chat:n,active:e.active,selections:e.selectedChats,onSelect:e.handleSelect}))}),a.length&&t.push(k.createElement(U,{key:"chat-header",header:H.t("web_recent_chats")})),w.forEach(a,function(n){t.push(k.createElement(L,{key:n.id,chat:n,active:e.active,selections:e.selectedChats,onSelect:e.handleSelect}))}),s.length&&t.length&&t.push(k.createElement(U,{key:"contact-header",header:H.t("web_other_contacts")})),w.forEach(s,function(n){t.push(k.createElement(L,{key:n.id,chat:n,active:e.active,selections:e.selectedChats,onSelect:e.handleSelect}))}),t}},{key:"getData",value:function(){var e=this.getFilteredData(),t=e.frequentContactsData,n=e.chatsData,i=e.contactsData;return w.concat(t,n,i)}},{key:"getList",value:function(){var e=this.getFilteredItems();return 0===e.length?null:k.createElement(b["default"],{data:e,height:72,extraItems:4})}},{key:"onCancel",value:function(){D.closeModal()}},{key:"render",value:function(){var e=this.getList();this.active.init(this.getData()),e||(e=this.state.searchText?k.createElement(F.Search,null):k.createElement(F.ListChats,null));var t={down:this.onFocusList},n={down:this.onNext,up:this.onPrev};return k.createElement(O,{type:O.TOWER},k.createElement(R,{key:"chat-modal",onCancel:this.onCancel},k.createElement(I,{title:this.props.title,type:I.Type.POPUP,onCancel:this.onCancel}),k.createElement(P["default"],{handlers:t,onFocus:this.indicateSearchFocus},k.createElement(_["default"],{ref:z("search",this),onSearch:this.onSearch,placeholder:H.t("search")})),k.createElement(A,{"data-list-scroll-container":!0},k.createElement(P["default"],{handlers:n,className:"column"},k.createElement("div",{className:"chatlist column"},e))),k.createElement(q,{selections:this.selectedChats,onForward:this.onChat})))}}]),t}(k.Component);e.exports=Y},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(237),s=i(a),r=n(8),o=n(1486),l=n(1386),c=n(1393),u=n(1421),d=n(1388),p=n(156),h=n(44),f=r.createClass({displayName:"ContactsModal",mixins:[p],propTypes:{title:r.PropTypes.string.isRequired,contacts:r.PropTypes.arrayOf(r.PropTypes.instanceOf(s["default"])),filter:r.PropTypes.func,onCancel:r.PropTypes.func.isRequired,onSelect:r.PropTypes.func.isRequired},getDefaultProps:function(){return{filter:function(e){return Store.Contact.isFilteredContact(e)}}},getInitialState:function(){return this.selection=new l([],function(e){return e.id}),{searchFilter:void 0}},componentWillMount:function(){this.props.contacts||this.addObserver(Store.Contact,"add remove change:name")},onSelect:function(e,t){var n=t.props.contact;this.props.filter(n)===!0&&this.props.onSelect(n)},onSearch:function(e){this.setState({searchFilter:e})},render:function(){var e=this.props,t=e.title,n=e.onCancel,i=e.filter,a=e.onSelect,s=l10n.accentFold(this.state.searchFilter),l=this.props.contacts||Store.Contact,p=l.filter(function(e){return i(e)&&(!s||s&&e.searchMatch(s))}),f=[];if(p.length){this.selection.init(p.filter(function(e){return i(e)===!0}));for(var m=void 0,g=void 0,v=p.length>10,y=0;y<p.length;y++){m=p[y],v&&m.header!==g&&f.push(r.createElement(u,{key:m.header,header:m.header}));var E=_.isString(i(m)),S=void 0;y<p.length-1&&p[y+1].header!==m.header&&(S="last");var M=void 0;E&&(M=r.createElement("div",{className:"chat-status ellipsify",title:i(m)},i(m)),S=h(S,"member")),f.push(r.createElement(c,{contact:m,active:this.selection,className:S,secondary:M,onClick:E?void 0:_.once(a.bind(null,m)),key:m.id})),g=m.header}}else f=r.createElement(d.SearchContacts,null);return r.createElement(o,{title:t,selection:this.selection,onSearch:this.onSearch,searchPlaceholder:l10n.t("search_contacts"),onSelect:this.onSelect,onCancel:n},f)}});e.exports=f},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.MuteProxy=t["default"]=void 0;var a=n(2),s=i(a),r=n(77),o=i(r),l=n(8),c=n(1),u=n(21),d=n(46),p=n(10),h=n(61),f=n(13),m=n(162),g=n(113).ActionToast,v=n(113).ActionType,y=n(0),E=(0,r.defineState)("Mute",{props:{id:"string",expiration:{type:"number","default":0}},session:{_unmuteTimer:"string",promises:{type:"object","default":function(){return{}}}},derived:{isMuted:{deps:["expiration"],fn:function(){return!!this.expiration}}},initialize:function(){o["default"].prototype.initialize.call(this),this.expiration&&this.mute(this.expiration)},setMute:function(e,t){(e||this.expiration)&&e!==this.expiration&&(e?this.mute(e,t):this.unmute(t))},mute:function C(e,t,n){var i=this;if(!_.isNumber(e))return c.log("models:Mute:mute called with invalid expiration "+e)(),s["default"].reject(new f.ActionError);e=Math.round(e),e>2e9&&c.log("models:Mute:mute called with wrong units?"+this.id+" exp:"+e)();var C=function(){this.isMuted&&this._clearUnmuteTimer();var t=e-y().unix();c.log("models:Mute:mute "+this.id+" duration:"+t)(),this._unmuteTimer=m.setTimeout(this.unmute.bind(this),1e3*e),this.set({expiration:e})}.bind(this),a=u.isGroup(this.id);if(t){if(this.promises.mute)return this.promises.mute;this.promises.mute=d.sendConversationMute(this.id,e,this.expiration);var r=new v(a?l10n.t("action_group_muting"):l10n.t("action_chat_muting"));n=n||g.genId();var o=this.promises.mute["catch"](function(s){c.error("models:Mute:mute dropped")(s);var r=a?l10n.t("action_group_mute_failed"):l10n.t("action_chat_mute_failed");throw new v(r,l10n.t("action_try_again"),i.mute.bind(i,e,t,n))}).then(function(e){if(200===e.status){var s=a?l10n.t("action_group_muted"):l10n.t("action_chat_muted");return new v(s,l10n.t("action_undo"),i.unmute.bind(i,t,n))}if(e.status>=400)throw new v(a?l10n.t("action_group_mute_failed"):l10n.t("action_chat_mute_failed"))});return p.openToast(l.createElement(g,{id:n,initialAction:r,pendingAction:o})),this.promises.mute.then(function(e){200!==e.status||e._duplicate||C()})["finally"](function(){i.promises.mute=null})}return C(),s["default"].resolve()},canMute:function(){return h.supportsFeature(h.F.MUTE)&&u.isGroup(this.id)||h.supportsFeature(h.F.MUTE_1_1)&&u.isUser(this.id)},_clearUnmuteTimer:function(){m.clearTimeout(this._unmuteTimer),this.unset("_unmuteTimer"),this.expiration=0},unmute:function b(e,t){var n=this,b=function(){c.log("models:Mute:unmute "+this.id)(),this._clearUnmuteTimer()}.bind(this),i=u.isGroup(this.id);if(e){if(this.promises.unmute)return this.promises.unmute;this.promises.unmute=d.sendConversationMute(this.id,!1,this.expiration);var a=new v(i?l10n.t("action_group_unmuting"):l10n.t("action_chat_unmuting"));t=t||g.genId();var r=this.promises.unmute["catch"](function(a){c.error("models:Mute:unmute dropped")(a);var r=i?l10n.t("action_group_unmute_failed"):l10n.t("action_chat_unmute_failed");return s["default"].reject(new v(r,l10n.t("action_try_again"),n.unmute.bind(n,e,t)))}).then(function(e){if(200===e.status)return new v(i?l10n.t("action_group_unmuted"):l10n.t("action_chat_unmuted"));if(e.status>=400)throw new v(i?l10n.t("action_group_unmute_failed"):l10n.t("action_chat_unmute_failed"))});return p.openToast(l.createElement(g,{id:t,initialAction:a,pendingAction:r})),this.promises.unmute.then(function(e){200!==e.status||e._duplicate||b()})["finally"](function(){n.promises.unmute=null})}return b(),s["default"].resolve()},"delete":function(){o["default"].prototype["delete"].call(this),Store.Mute.remove(this.id),this._clearUnmuteTimer()}}),S=E.Mute,M=E.MuteProxy;t["default"]=S,t.MuteProxy=M},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ProfilePicThumbProxy=t["default"]=void 0;var a=n(2),s=i(a),r=n(77),o=n(8),l=n(9),c=n(1),u=n(46),d=n(61),p=n(13),h=n(47),f=n(21),m=n(10),g=n(113).ActionToast,v=n(113).ActionType,y=n(96),_=n(29),E={SINGLE:"SINGLE",GROUP:"GROUP"},S=(0,r.defineState)("ProfilePicThumb",{Collection:"ProfilePicThumb",props:{id:"string",tag:"string",raw:"string",eurl:"string"},session:{stale:["boolean",!1,!0]},derived:{img:{deps:["tag","raw","stale","eurl"],fn:function(){if(this.raw)return"data:image/jpeg;base64,"+this.raw;if(!this.tag&&this.stale)return null;if(this.tag)return this.generateUrl("s")}},imgFull:{deps:["tag","raw","stale","eurl"],fn:function(){if((this.raw||!this.tag)&&this.stale)return null;if(!this.raw&&this.tag)return this.generateUrl("l")}},fallbackType:{deps:["id"],fn:function(){return f.isUser(this.id)?E.SINGLE:f.isGroup(this.id)?E.GROUP:E.GROUP}}},onError:function(e){switch(e){case 410:this.update()}},generateUrl:function(e){var t={t:e,u:this.id,i:this.tag};return y&&(this.eurl&&(t.e=this.eurl),t.ref=_.ref,t.tok=_.tok),h.build(l.PP_URL,t)},canSet:function(){return f.isGroup(this.id)&&d.supportsFeature(d.F.GROUP_SET_PIC)?!0:!(!f.isUser(this.id)||this.id!==Store.Conn.me||!d.supportsFeature(d.F.SET_PROFILE_PIC))},setPicture:function(e,t,n){var i=this;if(!this.canSet())return s["default"].reject(new p.ActionError);var a=u.sendSetPicture(this.id,e,t),r=new v(this.id===Store.Conn.me?l10n.t("action_profile_setting"):l10n.t("action_group_icon_setting"));n=n||g.genId();var l=a["catch"](function(e){throw c.error("models:ProfilePicThumb:setPicture dropped")(e),new v(i.id===Store.Conn.me?l10n.t("action_profile_set_failed"):l10n.t("action_group_icon_set_failed"))}).then(function(a){if(200===a.status)return new v(i.id===Store.Conn.me?l10n.t("action_profile_set"):l10n.t("action_group_icon_set"));if(a.status>=400){var s=i.id===Store.Conn.me?l10n.t("action_profile_set_failed"):l10n.t("action_group_icon_set_failed");return new v(s,l10n.t("action_try_again"),i.setPicture.bind(i,e,t,n))}});return m.openToast(o.createElement(g,{id:n,initialAction:r,pendingAction:l})),a.bind(this).then(function(e){200!==e.status||e._duplicate||(this.tag=e.tag)})},canDelete:function(){return f.isGroup(this.id)&&d.supportsFeature(d.F.GROUP_SET_PIC)&&this.tag?!0:!!(f.isUser(this.id)&&this.id===Store.Conn.me&&d.supportsFeature(d.F.SET_PROFILE_PIC)&&this.tag)},deletePicture:function(e){var t=this;if(!this.canDelete())return s["default"].reject(new p.ActionError);var n=u.deletePicture(this.id),i=new v(this.id===Store.Conn.me?l10n.t("action_profile_removing"):l10n.t("action_group_icon_removing"));e=e||g.genId();var a=n["catch"](function(e){throw c.error("models:ProfilePicThumb:deletePicture dropped")(e),new v(t.id===Store.Conn.me?l10n.t("action_profile_remove_failed"):l10n.t("action_group_icon_remove_failed"))}).then(function(n){if(200===n.status)return new v(t.id===Store.Conn.me?l10n.t("action_profile_removed"):l10n.t("action_group_icon_removed"));if(n.status>=400){var i=t.id===Store.Conn.me?l10n.t("action_profile_remove_failed"):l10n.t("action_group_icon_remove_failed");return new v(i,l10n.t("action_try_again"),t.deletePicture.bind(t,e))}});return m.openToast(o.createElement(g,{id:e,initialAction:i,pendingAction:a})),n.bind(this).then(function(e){200!==e.status||e._duplicate||(this.tag=void 0)})}}),M=S.ProfilePicThumb,C=S.ProfilePicThumbProxy;M.FALLBACK=E,t["default"]=M,t.ProfilePicThumbProxy=C},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(458),o=i(r),l=n(459),c=n(15),u=n(61),d=n(1),p=n(9),h=l.extend({model:o["default"],initialize:function(){var e=this;l.prototype.initialize.call(this),this.isSynced=!1,this.syncPromise=null,this.listenTo(c,"change:stream",function(){c.stream===c.STREAM.DISCONNECTED?e.isSynced=!1:c.stream===c.STREAM.CONNECTED&&e["delete"]()})},comparator:function(e,t){return t.t-e.t},process:function(e,t,n,i){i?this["delete"]():this.update(e,t,n)},sync:function(e){if(this.isSynced)return s["default"].resolve();if(this.syncPromise)return this.syncPromise;if(!u.supportsFeature(u.F.FULL_TEXT_SEARCH))return s["default"].resolve();var t=this;if(u.supportsFeature(u.F.STARRED_PAGINATION)){var n=this.last()&&this.last().id;this.syncPromise=Store.Msg.getStarred(e,p.PAGE_SIZE,n).then(function(e){e.length&&t.add(e,{silent:!0}),e.length<p.PAGE_SIZE&&(t.isSynced=!0),t.trigger("sync")})["catch"](function(e){d.error("starred msg sync error: ",e)()})["finally"](function(){t.syncPromise=null})}else this.syncPromise=Store.Msg.getStarred().then(function(e){t.set(e),t.synced=!0,t.trigger("sync")})["catch"](function(e){d.error("starred msg sync error: ",e)()})["finally"](function(){t.syncPromise=null});return this.trigger("sync"),this.syncPromise;
},update:function(e,t,n){var i=this;if(this.isSynced){var a=this.syncPromise||s["default"].resolve();this.syncPromise=a.then(function(){if(e){var a=t.length>0?Store.Msg.incrementalStarredUpdate(t):s["default"].resolve([]);return a.then(function(e){i.add(e.concat(n),{silent:!0}),_.forEach(t,function(e){e.chat.starredMsgs&&e.chat.starredMsgs.add(e)}),i.trigger("sync")})["catch"](function(e){d.error("models:starred:update:error: ",e)()})}return i.filter(function(e){return!e.star}).forEach(function(e){i.remove(e.id),e.chat.starredMsgs&&e.chat.starredMsgs.remove(e.id)}),s["default"].resolve()})["finally"](function(){i.syncPromise=null})}},add:function(e,t){this.isModel(e)&&this.get(e)||(l.prototype.add.call(this,e,t),!this.parent&&e&&(Array.isArray(e)?_.forEach(e,function(e){return e.chat.starredMsgs&&e.chat.starredMsgs.add(e)}):e.chat.starredMsgs&&e.chat.starredMsgs.add(e)),Store.StarredGifMsgs.add(e))},remove:function(e,t){this.isModel(e)&&!this.get(e)||(l.prototype.remove.call(this,e,t),this.parent?Store.AllStarredMsgs.remove(e,t):e&&(Array.isArray(e)?_.forEach(e,function(e){return e.chat.starredMsgs&&e.chat.starredMsgs.remove(e)}):e.chat.starredMsgs&&e.chat.starredMsgs.remove(e)),Store.StarredGifMsgs.remove(e))},"delete":function(){this.synced=!1,l.prototype["delete"].call(this)}});e.exports=h},function(e,t){"use strict";function n(e){return function(t,n){var i=2*e.length+t[1].length,a=t[0].length-i;return a>0&&(t.index+=a,t[0]=t[0].slice(a)),n.lastIndex--,t}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=n},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(4),s=i(a),r=n(6),o=i(r),l=n(472),c=i(l),u=function(){function e(){(0,s["default"])(this,e)}return(0,o["default"])(e,null,[{key:"onMutator",value:function(e,t,n,i,a){(0,c["default"])(!1,"Subclasses of `Serializer` must override `onMutator()`")}},{key:"onRoot",value:function(e,t){(0,c["default"])(!1,"Subclasses of `Serializer` must override `onRoot()`")}},{key:"onText",value:function(e,t){(0,c["default"])(!1,"Subclasses of `Serializer` must override `onText()`")}},{key:"onDelimiter",value:function(e,t){(0,c["default"])(!1,"Subclasses of `Serializer` must override `onDelimiter()`")}}]),e}();t["default"]=u},function(e,t){"use strict";function n(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=n);return t}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=n},,function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a,s,r=n(16),o=i(r),l=n(4),c=i(l),u=n(6),d=i(u),p=n(20),h=i(p),f=n(19),m=i(f),g=n(8),v=i(g),y=n(44),_=i(y),E=n(237),S=(i(E),n(1371)),M=i(S),C=n(1378),b=i(C);t["default"]=(0,b["default"])((s=a=function(e){function t(){return(0,c["default"])(this,t),(0,h["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"render",value:function(){var e=this.props.contact,t=(0,_["default"])("chat-status-name",{number:!e.name});return v["default"].createElement(M["default"],{text:e.formattedShortName,direction:"auto",className:t})}}]),t}(v["default"].PureComponent),a.CONCERNS={contact:["formattedShortName","name"]},s))},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(8),m=i(f),g=n(1370),v=(i(g),n(458)),y=(i(v),n(76)),_=i(y),E=n(0),S=i(E),M=n(1377),C=i(M),b=n(1378),T=i(b),P=n(10),k=i(P),N=function(e){function t(){var e,n,i,a;(0,o["default"])(this,t);for(var r=arguments.length,l=Array(r),c=0;r>c;c++)l[c]=arguments[c];return n=i=(0,d["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(l))),i.state={updater:!1},i.listening=!1,i.rerender=function(){i.setState({updater:!i.state.updater})},a=n,(0,d["default"])(i,a)}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentWillMount",value:function(){this.maybeRegMidnight()}},{key:"componentWillReceiveProps",value:function(){this.maybeRegMidnight()}},{key:"maybeRegMidnight",value:function(){var e=this.props,t=e.listeners,n=e.msg,i=(0,S["default"])().startOf("day").subtract(7,"day");n.t>=i.unix()?this.listening||(this.listening=!0,t.add(k["default"],"midnight",this.rerender)):this.listening&&(this.listening=!1,t.remove(k["default"],"midnight",this.rerender))}},{key:"render",value:function(){return m["default"].createElement("div",{className:"chat-meta"},m["default"].createElement("span",{className:"chat-time"},_["default"].relativeStr(this.props.msg.t)))}}]),t}(m["default"].PureComponent);N.CONCERNS={msg:["t"]};var w=(0,C["default"])((0,T["default"])(N)),x=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){var e=this.props.chat;return e.previewMessage?m["default"].createElement(w,{msg:e.previewMessage}):null}}]),t}(m["default"].PureComponent);x.CONCERNS={chat:["previewMessage"]};var O=(0,T["default"])(x);t["default"]=function(e){var t=e.chat,n=e.msg;return t?m["default"].createElement(O,{chat:t}):n?m["default"].createElement(w,{msg:n}):void 0}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1389),s=i(a),r=n(111),o=i(r),l=n(8),c=n(45),u=n(1393),d=n(1421),p=n(1386),h=l.createClass({displayName:"ContactList",propTypes:{contacts:l.PropTypes.array.isRequired,onClick:l.PropTypes.func,onFocusSearch:l.PropTypes.func},componentWillMount:function(){this.selection=new p(this.props.contacts,function(e){return e.id})},componentWillReceiveProps:function(e){this.selection.init(e.contacts)},onFocusGain:function(e){e.target===c.findDOMNode(this)&&(this.selection.index<0?this.focusFirst():this.selection.reset())},focusFirst:function(){this.selection.setFirst()},onNextContact:function(e){e.preventDefault(),e.stopPropagation(),this.selection.setNext()},onPrevContact:function(e){e.preventDefault(),e.stopPropagation();var t=this.selection.prev();t>-1?this.selection.setPrev():(this.selection.unset(),this.props.onFocusSearch(e))},render:function(){for(var e,t=this.props.contacts,n=[],i=t.length>10,a="XXX",r=0;r<t.length;r++){var c=t[r];if(e=null,i){var p=c.header;r<t.length-1&&p!==t[r+1].header&&(e="last"),p!==a&&(n.push(l.createElement(d,{key:p,header:p})),a=p)}var h=c.id,f=void 0;c.isBlocked()&&(f=l10n.t("contact_list_blocked_contact")),n.push(l.createElement(u,{contact:c,active:this.selection,className:e,onClick:this.props.onClick,secondary:f,key:h}))}var m={down:this.onNextContact,up:this.onPrevContact};return l.createElement(o["default"],{handlers:m,onFocus:this.onFocusGain,"data-tab":3},l.createElement(s["default"],{className:"chatlist",data:n,height:72,extraItems:4}))}});e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(458),s=i(a),r=n(8),o=n(45),l=n(15),c=n(93),u=n(158),d=n(160),p=n(10),h=n(54),f=r.createClass({displayName:"AudioTag",mixins:[c,u,d],propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,className:r.PropTypes.string,controls:r.PropTypes.bool,preload:r.PropTypes.string,type:r.PropTypes.string,onClick:r.PropTypes.func,onPlay:r.PropTypes.func,onError:r.PropTypes.func,autoPlay:r.PropTypes.bool},componentDidMount:function(){var e=o.findDOMNode(this);this.regNativeListener(e,"error",this.onPlayerError,!0),this.regNativeListener(e,"playing",this.onPlaying),this.regCmd("mediaPlaying",this.onOtherPlaying),(h.isGecko||h.isSafari)&&(this.props.autoPlay?(this.checkIteration=0,this.checkForSuccessInterval=this.safeInterval(this.checkForSuccess,250)):this.props.autoPlay?this.startCheckForSuccess():this.regNativeListener(e,"play",this.startCheckForSuccess))},startCheckForSuccess:function(){this.checkIteration=0,this.checkForSuccessInterval=this.safeInterval(this.checkForSuccess,250)},clearCheckForSuccess:function(){this.checkForSuccessInterval&&(this.clearSafeInterval(this.checkForSuccessInterval),delete this.checkForSuccessInterval,delete this.checkIteration)},checkForSuccess:function(){if(l.state===l.STATE.CONNECTED){if(this.checkIteration++,this.checkIteration>40)return void this.onPlayerError({target:{src:this.state.src,error:{code:window.MediaError.MEDIA_ERR_NETWORK}}});var e=o.findDOMNode(this),t=e.buffered;t&&t.length&&t.end(0)>0&&this.onPlaying({target:e})}},onPlayerError:function(e){this.clearCheckForSuccess(),this.props.onError&&this.props.onError(e.target.src)},onOtherPlaying:function(e){e!==this&&o.findDOMNode(this).pause()},onPlaying:function(e){this.clearCheckForSuccess(),p.mediaPlaying(this),this.props.onPlay&&this.props.onPlay(e)},render:function(){return r.createElement("audio",{src:this.props.msg.mediaData.renderableUrl,className:this.props.className,onClick:this.props.onClick,controls:this.props.controls,preload:this.props.preload,type:this.props.type,autoPlay:this.props.autoPlay},this.props.children)}});e.exports=f},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1370),s=i(a),r=n(8),o=n(1372),l=n(1382),c=r.createClass({displayName:"DeleteMenuItem",mixins:[o],propTypes:{chat:r.PropTypes.instanceOf(s["default"]).isRequired,onDeleteOrExit:r.PropTypes.func.isRequired},getInitialState:function(){return{isReadOnly:this.async("chat.isReadOnly")}},render:function(){var e;switch(this.props.chat.kind){case s["default"].KIND.GROUP:e=this.props.chat.isReadOnly?l10n.t("web_delete_group"):l10n.t("web_exit_group");break;case s["default"].KIND.BROADCAST:e=l10n.t("web_delete_list");break;case s["default"].KIND.CHAT:e=l10n.t("delete_chat")}return r.createElement(l,{a8n:"mi-delete",action:this.props.onDeleteOrExit,shortcut:"x"},e)}});e.exports=c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1371),s=i(a),r=n(1414),o=i(r),l=n(1426),c=i(l),u=n(8),d=n(156),p=n(13),h=u.createClass({displayName:"GroupSubtitle",mixins:[d],propTypes:{presence:u.PropTypes.instanceOf(o["default"]),groupMetadata:u.PropTypes.instanceOf(c["default"]),placeholder:u.PropTypes.node,location:u.PropTypes.oneOf(["list","title"])},_init:function(){Store.GroupMetadata.find(this.props.groupMetadata.id)["catch"](p.WapDrop,_.noop)},componentWillMount:function(){this.uiIdle(this._init);var e=this.props.groupMetadata.participants;this.addObserver(e,"sort remove reset"),"list"!==this.props.location&&this.addObserver(this.props.presence,"change:chatstate.id change:chatstate.type change:forceDisplay change:withholdDisplay")},getSubtitle:function(){return this.props.groupMetadata.participants.map(function(e){return e.contact.formattedShortNameWithNonBreakingSpaces}).join(", ")},render:function(){var e,t=this.props.presence;return"list"===this.props.location?(e=this.getSubtitle(),e?u.createElement(s["default"],{ellipsify:!0,titlify:!0,text:e}):null):(e=t.withholdDisplay?this.props.placeholder:t.getFormattedString()||(t.forceDisplay?this.getSubtitle():this.getSubtitle()||this.props.placeholder),e?u.createElement("div",{className:"chat-status ellipsify"},u.createElement(s["default"],{ellipsify:!0,titlify:!0,text:e,direction:"inherit"})):null)}});e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_NUM_SECTIONS=t.DEFAULT_EXTRA_ITEMS=t.DEFAULT_SCROLL_TOP=t.DEFAULT_SECTION_HEIGHT=t.DEFAULT_ITEM_HEIGHT=t.SCROLL_OFFSET_ATTR=t.SCROLL_ATTR=void 0;var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(8),m=i(f),g=n(45),v=i(g),y=n(44),_=i(y),E=n(18),S=i(E),M=n(1377),C=i(M),b=n(1513),T=i(b),P=n(1546),k=i(P),N=n(1547),w=i(N),x=n(471),O=i(x),D=t.SCROLL_ATTR="data-list-scroll-container",R=t.SCROLL_OFFSET_ATTR="data-list-scroll-offset",I=t.DEFAULT_ITEM_HEIGHT=72,A=t.DEFAULT_SECTION_HEIGHT=72,L=(t.DEFAULT_SCROLL_TOP=0,t.DEFAULT_EXTRA_ITEMS=5),F=(t.DEFAULT_NUM_SECTIONS=0,new k["default"](0,0)),U=function(e){function t(){var e,n,i,a;(0,o["default"])(this,t);for(var r=arguments.length,l=Array(r),c=0;r>c;c++)l[c]=arguments[c];return n=i=(0,d["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(l))),i.state={firstPhysicalIndexPath:F,lastPhysicalIndexPath:F},i.scrollTop=0,i.offsetTop=0,i.bodyHeight=0,i.listHeight=0,i.pointerEvents=!0,i.metaItemMap={},i.prevMetaItemMap={},i.enablePointerEvents=S["default"].debounce(function(){return i.animationFrame?i.enablePointerEvents():(O["default"].clearBusy(i.busyId),delete i.busyId,i.props.onPointerEventsOn&&i.props.onPointerEventsOn(),v["default"].findDOMNode(i.refs.viewport).style.pointerEvents="auto",void(i.pointerEvents=!1))},150),i.onScroll=function(){i.animationFrame?i.hanging=!0:(i.hanging=!1,i.animationFrame=window.requestAnimationFrame(i._onScroll))},i._onScroll=function(){i.disablePointerEvents(),i.scrollTarget&&(i.scrollTop=i.scrollTarget.scrollTop);var e=i.getPhysicalIndexPaths(i.props),t=e.firstPhysicalIndexPath,n=e.lastPhysicalIndexPath;return t.equals(i.state.firstPhysicalIndexPath)&&n.equals(i.state.lastPhysicalIndexPath)?i._onFinishScroll():void i.setState({firstPhysicalIndexPath:t,lastPhysicalIndexPath:n},i._onFinishScroll)},i._onFinishScroll=function(){i.animationFrame=void 0,i.enablePointerEvents(),i.hanging&&i.onScroll()},a=n,(0,d["default"])(i,a)}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentWillReceiveProps",value:function(e){void 0!==e.scrollTop&&this.scrollTarget&&(this.scrollTarget.scrollTop=e.scrollTop),this.props.scrollTarget===e.scrollTarget&&this.initialize()}},{key:"componentDidUpdate",value:function(e,t){var n=this.state,i=n.firstPhysicalIndexPath,a=n.lastPhysicalIndexPath;i.equals(t.firstPhysicalIndexPath)&&a.equals(t.lastPhysicalIndexPath)&&this.props.scrollTarget!==e.scrollTarget&&(this.getTargets(this.props),this.initialize())}},{key:"componentDidMount",value:function(){var e=this;this.getTargets(this.props),this.initialize(this.props),this.props.listeners.add(window,"resize",function(){if(!e.scrollTarget)throw new Error("Invalid ScrollTarget!");e.bodyHeight=e.scrollTarget.clientHeight,e.initialize(e.props)})}},{key:"componentWillUnmount",value:function(){this.cancelScroll(),this.enablePointerEvents.cancel()}},{key:"getTargets",value:function(e){if(this.scrollTarget){var t=T["default"]?{passive:!0}:void 0;this.props.listeners.remove(this.scrollTarget,"scroll",this.onScroll,t)}for(var n=v["default"].findDOMNode(this),i=void 0,a=n,s=0;5>s;s++){if(a instanceof HTMLElement&&a.hasAttribute(D)){i=a;break}a=a&&a.parentNode}if(!i)throw new Error("Invalid ScrollTarget!");var r=T["default"]?{passive:!0}:void 0;this.props.listeners.add(i,"scroll",this.onScroll,r),this.scrollTarget=i,this.scrollTop=this.scrollTarget.scrollTop,this.bodyHeight=this.scrollTarget.clientHeight;var o=void 0;a=n;for(var l=0;s>l;l++){if(a instanceof HTMLElement&&a.hasAttribute(R)){o=a;break}a=a&&a.parentNode}this.offsetTarget=o,this.offsetTop=o?o.offsetTop:0}},{key:"initialize",value:function(e){var t=this,n=e?e:this.props;this.cancelScroll(),this.setMetaItemMap(n),this.setState(this.getPhysicalIndexPaths(n),function(){t.prevMetaItemMap={}})}},{key:"setMetaItemMap",value:function(e){var t=e.heightForItem,n=e.heightForSection,i=e.sectionForSection,a=e.numberOfSections,s=e.numberOfRowsInSection,r=e.keyForRowAtIndexPath;this.prevMetaItemMap=this.metaItemMap,this.metaItemMap={};for(var o=0,l=0,c=a(),u=0;c>u;u++){i(u)&&(this.metaItemMap["section_"+u]={indexPath:u,globalOffset:o,globalIndex:l},o+=n(u),l++);for(var d=0;d<s(u);d++){var p=new k["default"](d,u),h=r(p);this.metaItemMap[h]={indexPath:p,globalIndex:l,globalOffset:o},o+="number"==typeof t?t:t(p),l++,u===c-1&&d===s(u)-1&&(this.listHeight=o)}}}},{key:"numberOfItems",value:function(){var e=this.props,t=e.numberOfSections,n=e.numberOfRowsInSection,i=e.keyForRowAtIndexPath,a=t()-1,s=n(a)-1,r=new k["default"](s,a);return this.metaItemMap[i(r)].globalIndex+1}},{key:"getIndexPathAtIndexPathWithOffset",value:function(e,t,n,i){for(var a=i.keyForRowAtIndexPath,s=k["default"].indexPathIterator(i,e),r=this.metaItemMap[a(e)].globalOffset,o=void 0,l=void 0;o=s.next();){var c=a(o);if(this.metaItemMap[c].globalOffset-r>=t)return n?l||o:s.next()||o;l=o}if(!l)throw new Error("getIndexPathAtIndexPathWithOffset");return l}},{key:"getFirstVisibleIndexPath",value:function(e){var t=Math.max(this.scrollTop-this.offsetTop,0),n=new k["default"](0,0);return this.getIndexPathAtIndexPathWithOffset(n,t,!0,e)}},{key:"getLastVisibleIndexPath",value:function(e,t){var n=Math.min(this.bodyHeight,this.listHeight);return this.getIndexPathAtIndexPathWithOffset(e,n,!1,t)}},{key:"getPhysicalIndexPaths",value:function(e){for(var t=this.getFirstVisibleIndexPath(e),n=this.getLastVisibleIndexPath(t,e),i=k["default"].indexPathIterator(e,t),a=k["default"].indexPathIterator(e,n),s=void 0,r=void 0,o=e.extraItems;o--;){var l=i.prev();l&&(s=l),l=a.next(),l&&(r=l)}return{firstPhysicalIndexPath:s,lastPhysicalIndexPath:r}}},{key:"cancelScroll",value:function(){this.animationFrame&&(window.cancelAnimationFrame(this.animationFrame),this.animationFrame=void 0,this.hanging=!1)}},{key:"disablePointerEvents",value:function(){this.busyId=O["default"].setBusy(this.busyId),this.pointerEvents||(this.props.onPointerEventsOff&&this.props.onPointerEventsOff(),v["default"].findDOMNode(this.refs.viewport).style.pointerEvents="none",this.pointerEvents=!0)}},{key:"getHeight",value:function(e){var t=this.props,n=t.heightForItem,i=t.heightForSection,a=this.metaItemMap[e],s=a.indexPath instanceof k["default"]?n:i;return"number"==typeof s?s:s(a.indexPath)}},{key:"boundGlobalOffset",value:function(e,t,n){return e&&t&&n?Math.min(t.globalOffset,Math.max(e.globalOffset,n.globalOffset)):void 0}},{key:"getComponents",value:function(){var e=this,t=this.props,n=t.itemForRowAtIndexPath,i=t.keyForRowAtIndexPath,a=t.sectionForSection;if(S["default"].size(this.metaItemMap)){for(var s=this.state,r=s.firstPhysicalIndexPath,o=s.lastPhysicalIndexPath,l=void 0,c=k["default"].indexPathIterator(this.props,r,o),u={};l=c.next();){if(0===l.row){var d="section_"+l.section;this.metaItemMap[d]&&(u[d]=a(l.section))}var p=i(l);u[p]||(u[p]=n(l))}var h=S["default"].size(u),f=new Array(h),g=this.numberOfItems(),v=this.metaItemMap[i(r)],y=this.metaItemMap[i(o)];return S["default"].forEach(u,function(t,n){var i=e.metaItemMap[n],a=i.globalIndex%h,s=e.boundGlobalOffset(v,y,e.prevMetaItemMap[n]);f[a]=m["default"].createElement(w["default"],{key:a,dataKey:n,rowHeight:e.getHeight(n),className:0===i.globalIndex?"first":void 0,zIndex:g-i.globalIndex-1,rowOffset:i.globalOffset,prevRowOffset:s},t)}),f}}},{key:"render",value:function(){var e=this.props.className,t={viewport:{height:this.listHeight}},n={container:(0,_["default"])(e,"infinite-list"),viewport:"infinite-list-viewport"};return m["default"].createElement("div",{className:n.container},m["default"].createElement("div",{className:n.viewport,ref:"viewport",style:t.viewport},this.getComponents()))}}]),t}(m["default"].Component);U.defaultProps={extraItems:L,animate:!1,numberOfSections:function(){return 1},heightForItem:I,heightForSection:function(e){return A},stickyHeaders:!1},t["default"]=(0,C["default"])(U)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){var t=e.duration,n=S.durationStr(t);return n?_.createElement("span",{className:"media-canvas-duration"},n):null}var s=n(16),r=i(s),o=n(4),l=i(o),c=n(6),u=i(c),d=n(20),p=i(d),h=n(19),f=i(h),m=n(458),g=(i(m),n(1377)),v=i(g),y=n(1387),_=n(8),E=n(235),S=n(76),M=n(1394),C=function(e){function t(){(0,l["default"])(this,t);var e=(0,p["default"])(this,(t.__proto__||(0,r["default"])(t)).apply(this,arguments));return e.onSelectClick=function(t){e.props.onMessageSelect&&e.props.onMessageSelect(e.props.msg,!e.props.selected)},e.onMouseOver=function(t){e.state.hover||e.setState({hover:!0})},e.onMouseEnter=function(t){e.state.hover||e.setState({hover:!0})},e.onMouseLeave=function(t){e.state.hover&&e.setState({hover:!1})},e.state={hover:!1},e}return(0,f["default"])(t,e),(0,u["default"])(t,[{key:"componentDidMount",value:function(){this.props.listeners.add(this.props.msg.mediaData,"change:preview"),this.props.listeners.add(this.props.msg,"change:star"),this.props.imgRef&&this.props.imgRef(this.img)}},{key:"componentWillUnmount",value:function(){this.props.imgRef&&this.props.imgRef(null)}},{key:"render",value:function(){var e=this.props,t=e.msg.mediaData,n=e.selected,i=e.selectable,s=void 0,r=null,o=null,l=null,c=null,u=null;switch(this.props.msg.star&&(t.type!==E.TYPE.AUDIO&&(o=_.createElement("div",{className:"shade"})),u=_.createElement("span",{className:"icon-s icon-star-light"})),t.type){case E.TYPE.AUDIO:s="media-canvas attach-media-audio-thumb",l=_.createElement("span",{className:"icon-s icon-msg-audio-light"}),c=_.createElement(a,{duration:t.duration});break;case E.TYPE.VIDEO:o=_.createElement("div",{className:"shade"}),t.isGif?(s=t.preview?"media-canvas":"media-canvas media-video-thumb",l=_.createElement("span",{className:"icon-s icon-msg-gif-light"})):(s="media-canvas",l=_.createElement("span",{className:"icon-s icon-msg-video-light"}),c=_.createElement(a,{duration:t.duration})),t.preview&&(r={backgroundImage:'url("'+t.preview.url()+'")'});break;case E.TYPE.IMAGE:s="media-canvas",t.renderableUrl?r={backgroundImage:"url("+t.renderableUrl+")"}:t.preview&&(r={backgroundImage:'url("'+t.preview.url()+'")'})}var d=void 0;d=this.props.onDragStart?_.createElement("div",{className:s,style:r,onClick:this.props.onClick||null,ref:(0,y.GetRef)("img",this),onDragStart:this.props.onDragStart,draggable:!0}):_.createElement("div",{className:s,style:r,onClick:this.props.onClick||null,ref:(0,y.GetRef)("img",this)});var p=i||this.state.hover?_.createElement("div",{className:"media-select",onClick:this.onSelectClick},_.createElement("div",{className:"shade"}),_.createElement(M,{onChange:this.onSelectClick,checked:n})):null,h=null,f=null,m=null;return this.props.hoverEvent&&(h=this.onMouseOver,f=this.onMouseEnter,m=this.onMouseLeave),_.createElement("div",{className:this.props.classes,onMouseOver:h,onMouseEnter:f,onMouseLeave:m},p,d,o,l,c,u)}}]),t}(_.Component);e.exports=(0,v["default"])(C)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1370),s=i(a),r=n(8),o=n(1372),l=n(1382),c=r.createClass({displayName:"MuteMenuItem",mixins:[o],propTypes:{chat:r.PropTypes.instanceOf(s["default"]).isRequired,onMute:r.PropTypes.func.isRequired},getInitialState:function(){return{isMuted:this.async("chat.mute.isMuted")}},render:function(){var e=this.props.onMute.bind(null,!this.state.isMuted);return r.createElement(l,{action:e,shortcut:"m",a8n:"mi-mute"},this.state.isMuted?l10n.t("web_menuitem_mute_off"):l10n.t("web_menuitem_mute"))}});e.exports=c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1370),s=i(a),r=n(8),o=n(1372),l=n(10),c=n(1436),u=n(1394),d=n(233),p=r.createClass({displayName:"MuteRow",mixins:[o],propTypes:{chat:r.PropTypes.instanceOf(s["default"]).isRequired},getInitialState:function(){return this.asyncState({isMuted:"chat.mute.isMuted"})},onMute:function(e){l.muteChat(this.props.chat,e,this)},onUnmute:function(){var e=this.props.chat.isGroup?l10n.t("confirm_unmute_group"):l10n.t("confirm_unmute_chat");l.openModal(r.createElement(d,{onOK:this.unmute,okText:l10n.t("action_chat_unmute"),onCancel:function(){return l.closeModal()},cancelText:l10n.t("web_cancel")},e))},unmute:function(){this.onMute(!1),l.closeModal()},render:function(){var e=this,t=this.props.chat.mute.isMuted,n=t?this.onUnmute:function(){e.onMute(!0)},i=r.createElement(u,{checked:t,onChange:n}),a=t?l10n.t("web_chat_muted"):l10n.t("web_menuitem_mute");return r.createElement(c,{classes:"row-drawer-item",side:i,onClick:n,ellipsify:!0},r.createElement("span",{className:"title"},a))}});e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(35),s=i(a),r=n(22),o=i(r),l=function(e){for(var t={edges:{}},n=t,i=0;i<e.length;++i){for(var a=e[i],s=0;s<a.length;++s){var r=a[s];n.edges[r]||(n.edges[r]={edges:{}}),n=n.edges[r],s===a.length-1&&(n.idx=i)}n=t}return t},c=(0,o["default"])(n(484)),u=l(c),d=function(e,t){for(var n=[],i=e.length,a=t,s=0,r=void 0;(r=s)<i;){var o=a.edges[e[s++]];if(o){a=o;for(var l=a.idx;(a=a.edges[e[s]])&&++s;)void 0!==a.idx&&(l=a.idx);void 0===l?s=r+1:n.push([r,s-1]),a=t}}return n},p=function(e){for(var t=[],n=0,i=e.length;i>n;){var a=e.charCodeAt(n++);if(a>=55296&&56319>=a&&i>n){var s=e.charCodeAt(n++);if(56320===(64512&s)){t.push(""+e[n-2]+e[n-1]);continue}--n}t.push(e[n-1])}return t};e.exports=function(e){if(!e||!e.length)return[];for(var t=[],n=0,i=d(e,u),a=0;a<i.length;++a){var r=(0,s["default"])(i[a],2),o=r[0],l=r[1];o!==n&&(t=t.concat(p(e.substring(n,o)))),t.push(e.slice(o,l+1)),n=l+1}return n<e.length&&(t=t.concat(p(e.substr(n)))),t}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1452),s=i(a);e.exports=(0,s["default"])({CHANGE:void 0,MOUNT:void 0})},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1452),s=i(a);e.exports=(0,s["default"])({SEARCH:void 0,INACTIVE:void 0,ENTER:void 0,TAB:void 0,DOWN:void 0,UP:void 0})},function(e,t,n){"use strict";var i=n(8),a=n(44),s=i.createClass({displayName:"Tooltip",propTypes:{body:i.PropTypes.node.isRequired,className:i.PropTypes.string,direction:i.PropTypes.oneOf(["top","right","bottom","left"]).isRequired},getDefaultProps:function(){return{className:null}},render:function(){var e=a("tooltip",this.props.className,this.props.direction);return i.createElement("div",{className:e},this.props.body)}});e.exports=s},function(e,t,n){"use strict";var i=n(8),a=n(45),s=n(158),r=n(1280),o=i.createClass({displayName:"Video",mixins:[s,r],propTypes:{src:i.PropTypes.string.isRequired,onPlay:i.PropTypes.func},componentDidMount:function(){var e=a.findDOMNode(this),t=this;this.regNativeListener(e,"playing",function(n){e.videoHeight&&e.videoWidth||(e.pause(),e.play()),e.videoHeight&&e.videoWidth&&t.props.onPlay(n)})},render:function(){return i.createElement("video",this.props)}});e.exports=o},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(112),s=i(a),r=n(2),o=i(r),l=n(460),c=i(l),u=n(1370),d=i(u),p=n(1511),h=i(p),f=n(91),m=i(f),g=n(458),v=i(g),y=n(1384),E=i(y),S=n(1510),M=n(111),C=i(M),b=n(8),T=n(45),P=n(9),k=n(1442),N=n(1558),w=n(93),x=n(160),O=n(1372),D=n(156),R=n(10),I=n(233),A=n(13),L=n(62),F=n(47),U=n(1601),j=n(1440),G=n(1470),B=n(241),H=n(1),V=n(1376),q=n(61),W=n(44),z=n(234),Y=n(1536),K=n(95),Q=y.Configuration.ComposeBox(),X=n(1600),Z=function(){return q.supportsFeature(q.F.LINK_PREVIEW)||q.supportsFeature(q.F.SEND_LINK_PREVIEW)&&!1},J=b.createClass({displayName:"ComposeBox",mixins:[w,x,O,V,D],propTypes:{chat:b.PropTypes.instanceOf(d["default"]).isRequired,onPageUpDown:b.PropTypes.func.isRequired,onComposeHeightChange:b.PropTypes.func,className:b.PropTypes.string},getInitialState:function(){var e=this.props.chat;this.text=e.composeContents.text||"",this.selection=e.composeContents.selection,this.omittedURL=e.composeContents.omittedURL,this.pendingLinkPreviewPromises=[],this.preview=this.omittedURL,this.scanForLinks=this.safeDebounce(this._scanForLinks,200);var t;return t=0,{trusted:this.async("chat.trusted"),hasText:!!this.text,emojiExpanded:!1,recording:!1,linkPreview:null,quotedMsg:e.composeQuotedMsg,textsize:t}},componentWillMount:function(){var e=this.props.chat;e.setComposeContents({}),this.regCmd("focus_chat_text_input_"+this.props.chat.id,this.restoreFocus),this.regCmd("focus_chat_text_input",this.restoreFocus),this.regCmd("paste_chat_text_input_"+this.props.chat.id,this.pasteEmojiInput),this.regCmd("send_paste_to_compose_"+this.props.chat.id,this.handleRoutedPaste),this.regCmd("enter_chat_text_input_"+this.props.chat.id,this.onSendText),this.addObserver(e,"change:composeQuotedMsg",this.onQuotedMsgChange)},componentDidMount:function(){var e=this;this.height=T.findDOMNode(this.refs.composeBlock).clientHeight,Z()&&this.scanForLinks(),this.regCmd("textsize_change",function(t){e.setState({textsize:t})})},componentWillUnmount:function(){this.props.chat.setComposeContents({text:this.text,selection:this.selection,omittedURL:this.omittedURL})},pasteEmojiInput:function(e){return" "!==e||this.hasText()?void(this.refs.input&&(this.refs.input.focus(!0),this.refs.input.replaceSelection(e))):R.scrollMessages()},handleRoutedPaste:function(e){this.refs.input&&(this.refs.input.focus(!0),this.refs.input.onPaste(e))},onMaxPasteExceeded:function(){R.openModal(b.createElement(I,{title:l10n.t("message_too_large_title"),onOK:R.closeModal.bind(R),okText:l10n.t("web_ok")},l10n.t("message_too_large_text")))},restoreFocus:function(){this.refs.input&&this.refs.input.focus()},clearLinkPreview:function(){this.preview=null,this.omitLinkPreview()},cancelPendingLinkPreviews:function(){_.forEach(this.pendingLinkPreviewPromises,function(e){return e.cancel()}),this.pendingLinkPreviewPromises=[]},omitLinkPreview:function(e){e!==!0&&this.state.linkPreview&&(this.setState({linkPreview:null}),this.omittedURL=this.preview)},omitQuotedPreview:function(e){e!==!0&&(this.props.chat.composeQuotedMsg=null)},_findFirstWebLink:function(){return _.head(B.findLinks(this.text).filter(function(e){var t=e.url;return F.isHttp(t)}))},_scanForLinks:function(){var e=this;if(!this.state.hasText)return void this.clearLinkPreview();var t=this._findFirstWebLink();if(!t)return void this.clearLinkPreview();var n=t.url;if(!this.preview||this.preview!==n){this.preview=n,this.omittedURL=null;var i=(0,h["default"])(n).checkpoint(this.rejectOnUnmount()).cancellable();this.pendingLinkPreviewPromises.push(i),i.then(function(t){var n=t.url,i=t.data;e.preview&&e.preview!==n||(i.title||i.description)&&e.setState({linkPreview:i})})["catch"](A.Unmount,_.noop)["catch"](A.WapDrop,_.noop)["catch"](o["default"].CancellationError,_.noop)}},onQuotedMsgChange:function(){var e=this.props.chat,t=!1;(this.state.quotedMsg?!e.composeQuotedMsg:e.composeQuotedMsg)&&(t=!0),t&&!e.composeQuotedMsg?this.setState({quotedMsg:null}):this.setState({quotedMsg:e.composeQuotedMsg})},indicateFocus:function(e){var t=this.refs.container;if(t&&t.activate(),!(Date.now()-(C["default"].flashFocus||0)>200)){var n=T.findDOMNode(this.refs.input_hotkey);(0,c["default"])(n,"stop"),(0,c["default"])(n,{backgroundColor:["#ffffff","#D9F3FF"],borderColor:["#ffffff","#CBE4EF"]},{duration:1300,easing:[.24,.91,.01,.99]}),this.refs.input.focus(!1)}},onEmojiButtonFocus:function(){var e=T.findDOMNode(this.refs.emojiButton);m["default"].focus(e)},onPageUpDown:function(e){var t=this;this.props.onPageUpDown&&(e.stopPropagation(),this.props.onPageUpDown(e),this.safeDefer(function(){return t.refs.input&&t.refs.input.focus(!0)}))},handleEmoji:function(e){this.refs.input.replaceSelection(e)},handleGif:function(e,t){var n=K.get(e,K.RESP_TYPE.BLOB,{Accept:"video/mp4"}).then(function(e){var n=e.response;return n.isGifHackDoNotUse=!0,n.gifAttributionHackDoNotUse=t,n})["catch"](function(e){throw H.error("failed loading gif ("+e+")")(),new A.MediaFileFailedLoad});this.closeEmojiPanel(),R.attachMediaDrawer(this.props.chat,[n])},openEmojiPanel:function(){this.setState({emojiExpanded:!0})},closeEmojiPanel:function(){this.setState({emojiExpanded:!1})},onPTT:function(e){this.setState({recording:e===X.REC})},preventBlur:function(e){var t=e.target,n=T.findDOMNode(this.refs.input),i=T.findDOMNode(this.refs.container);do if(t===n)return;while(t!==i&&(t=t.parentNode));this.stopEvent(e),this.refs.input.focus(!1)},onChange:function(e){var t=T.findDOMNode(this.refs.composeBlock),n=t.clientHeight,i=n-this.height;i&&this.props.onComposeHeightChange({input:i}),this.height=n;var a=this.hasText();this.text=e;var s=this.hasText();if(s!==a&&this.setState({hasText:s}),s?(this.props.chat.presence.subscribe()["catch"](A.WapDrop,_.noop),
this.props.chat.markComposing()):this.props.chat.markPaused(),Z()){var r=this._findFirstWebLink();(!r&&this.preview||r&&r.url!==this.preview)&&this.clearLinkPreview(),this.scanForLinks()}},_getSendButton:function(){var e=navigator.getUserMedia&&window.AudioContext;if(this.state.hasText||!e)return b.createElement("button",{className:"icon icon-send compose-btn-send",onClick:this.onSendText,disabled:!this.hasText});var t=this.props.chat;return b.createElement(X,{key:"ptt",chat:t,onStateChange:this.onPTT})},_restoreEmojiPanelFocus:function(){this.refs.emojiPanel&&this.refs.emojiPanel.restoreFocus()},_getPopupPanel:function(){var e=void 0;this.state.linkPreview&&(e=b.createElement(z,{displayName:"ComposeBoxLinkPreview",escapable:!0,requestDismiss:this.omitLinkPreview},b.createElement("div",{className:"compose-popup-panel"},b.createElement(G,(0,s["default"])({onOmit:this.omitLinkPreview},this.state.linkPreview)))));var t=void 0;this.state.quotedMsg&&(t=b.createElement(z,{displayName:"ComposeBoxQuotedMsg",escapable:!0,requestFocus:this.restoreFocus,requestDismiss:this.omitQuotedPreview},b.createElement("div",{className:"compose-popup-panel"},b.createElement(j,{msg:this.state.quotedMsg,key:this.state.quotedMsg.id.toString(),onOmit:this.omitQuotedPreview,chat:this.state.quotedMsg.chat}))));var n=null;this.state.emojiExpanded&&(n=b.createElement(z,{displayName:"ComposeBoxEmojiPanel",escapable:!0,requestDismiss:this.closeEmojiPanel,requestFocus:this._restoreEmojiPanelFocus},b.createElement("div",null,b.createElement(k,{ref:"emojiPanel",key:"compose-emoji-panel",onEmoji:this.handleEmoji,onFocusRelease:this.restoreFocus,onGif:P.SHOW_GIF_SEARCH?this.handleGif:void 0}))));var i=this.props.chat,a=q.supportsFeature(q.F.SPAM),r=null;return!i.isPSA&&i.isVisible&&!i.trusted&&a&&(r=b.createElement(U,{chat:this.props.chat})),b.createElement("div",{className:"compose-box-items-positioning-container"},b.createElement("div",{className:"compose-box-items-overlay-container"},b.createElement(Y,{onHeightChange:this.onHeightChange},r,n,t,e)))},onHeightChange:function(e,t){this.props.onComposeHeightChange({overlay:e},t)},onFiles:function(e){var t=_.filter(e.getFiles(),function(e){var t=L.typeFromMimetype(e.type);return"image"===t||"video"===t});return t.length?(R.attachMediaDrawer(this.props.chat,t),!0):void 0},onTextPaste:function(e){var t=_.escapeRegExp("https://media.giphy.com/media"),n=new RegExp("^"+t+"/([a-zA-Z0-9]+)"),i=n.exec(e);if(i){var a="https://media.giphy.com/media/"+i[1]+"/200w.mp4";return this.handleGif(a,v["default"].GIF_ATTRIBUTION.GIPHY),!0}return!1},onSelectionChange:function(e){this.selection=e},hasText:function(){return J.hasText=this.text.trim().length>0},onEnter:function(e){e&&e.repeat||this.onSendText()},onSendText:function(){var e=this.text.trim();if(e.length){var t=/\u200B((\d+)@c\.us)\u200B/g,n=[],i=e.replace(t,function(e,t,i){return n.push(t),"@"+i}),a=(0,E["default"])(i,Q,S.TextSerializer);this.props.chat.sendMessage(a,this.state.linkPreview,this.props.chat.composeQuotedMsg,n),this.cancelPendingLinkPreviews(),this.setState({emojiExpanded:!1,hasText:!1,linkPreview:null,quotedMsg:this.props.chat.composeQuotedMsg=null}),this.props.chat.setComposeContents({}),this.refs.input.reset(),this.text="",this.hasText()}},stopEvent:function(e){e&&(e.preventDefault(),e.stopPropagation())},handleEmojiButtonClick:function(e){return this.stopEvent(e),this.state.emojiExpanded?this.closeEmojiPanel():this.openEmojiPanel()},handleTab:function(e){this.state.emojiExpanded&&(C["default"].flashFocus=Date.now(),this.refs.emojiPanel.focusSearchInput(),this.stopEvent(e))},render:function(){var e,t=this,n=this.state.emojiExpanded?b.createElement("button",{className:"icon icon-hide compose-btn-emoji",onClick:this.closeEmojiPanel}):b.createElement("button",{className:"icon icon-smiley compose-btn-emoji",onClick:this.openEmojiPanel}),i={enter:this.handleEmojiButtonClick},a=W("input-container",{disabled:this.state.recording}),s={pagedown:this.onPageUpDown,pageup:this.onPageUpDown},r=l10n.t("type_a_message"),o=_.find(P.TEXTSIZE_CLASS_MAP,function(e){return e.scale===t.state.textsize});o&&(e=o.classname);var l=W("block-compose",e,{"ptt-open":this.state.recording}),c={tab:this.handleTab,"shift+tab":this.handleTab},u=null;return b.createElement(z,{displayName:"ComposeBox",ref:"container",state:z.State.PASSIVE,requestFocus:this.restoreFocus},b.createElement(C["default"],{component:"footer",handlers:s,className:this.props.className,onMouseDown:this.preventBlur,onContextMenu:this.preventBlur},b.createElement("div",{className:l,ref:"composeBlock"},b.createElement(C["default"],{ref:"emojiButton",className:"emoji-button-container","data-tab":4,handlers:i,onFocus:this.onEmojiButtonFocus},n),b.createElement(C["default"],{ref:"input_hotkey",className:a,handlers:c,onFocus:this.indicateFocus},b.createElement(N,{placeholder:r,readOnly:this.state.recording,ref:"input",initialValue:this.text,initialSelection:this.selection,spellCheck:!0,multiline:!0,maxLength:P.MAX_TXT_MSG_SIZE,onMaxPasteExceeded:this.onMaxPasteExceeded,onEnter:this.onEnter,onFiles:this.onFiles,onTextPaste:this.onTextPaste,onChange:this.onChange,onSelect:this.onSelectionChange,className:"input"})),this._getSendButton()),this._getPopupPanel(),u,b.createElement(N.Suggestions,{chat:this.props.chat})))}});e.exports=J},function(e,t,n){"use strict";var i=n(8),a=i.createClass({displayName:"LinkPreview",propTypes:{title:i.PropTypes.string,description:i.PropTypes.string,canonicalUrl:i.PropTypes.string,thumbnail:i.PropTypes.string,onOmit:i.PropTypes.func},render:function(){var e=this.props,t=e.title,n=e.description,a=e.canonicalUrl,s=e.thumbnail,r=s?i.createElement("img",{className:"link-preview-media",src:"data:image/jpeg;base64,"+s}):null,o=this.props.onOmit?i.createElement("div",{className:"btn-background"},i.createElement("button",{className:"icon icon-x",onClick:this.props.onOmit})):null;return i.createElement("div",{className:"message-in link-preview-compose"},i.createElement("div",{className:"link-preview-container"},r,i.createElement("div",{className:"link-preview-body"},i.createElement("div",{className:"link-preview-title",title:t},t),i.createElement("div",{className:"link-preview-description",title:n},n),i.createElement("div",{className:"link-preview-source ellipsify"},a))),o)}});e.exports=a},function(e,t,n){"use strict";function i(e,t){var n=[];return n.push(r.createElement(l,{key:"info",a8n:"mi-group-info",action:function(){return o.chatInfoDrawer(e)},shortcut:"i"},l10n.t("web_group_info"))),n.push(r.createElement(l,{a8n:"mi-select-messages",key:"select",action:t,shortcut:"e"},l10n.t("web_select_messages"))),e.mute.canMute()&&n.push(r.createElement(c,{key:"mute",onMute:function(t){return o.muteChat(e,t)},chat:e})),e.canClear()&&n.push(r.createElement(l,{key:"clear",a8n:"mi-clear",shortcut:"e",action:function(){return o.clearChatMsgs(e)}},l10n.t("clear_chat"))),e.canDelete()&&n.push(r.createElement(u,{key:"delete",onDeleteOrExit:function(){return o.deleteOrExitChat(e)},chat:e})),n}function a(e,t){var n=[];return n.push(r.createElement(l,{key:"info",a8n:"mi-broadcast-info",action:function(){return o.chatInfoDrawer(e)},shortcut:"i"},l10n.t("web_list_info"))),n.push(r.createElement(l,{a8n:"mi-select-messages",key:"select",action:t,shortcut:"e"},l10n.t("web_select_messages"))),e.canClear()&&n.push(r.createElement(l,{key:"clear",a8n:"mi-clear",shortcut:"e",action:function(){return o.clearChatMsgs(e)}},l10n.t("clear_chat"))),e.canDelete()&&n.push(r.createElement(u,{key:"delete",onDeleteOrExit:function(){return o.deleteOrExitChat(e)},chat:e})),n}function s(e,t){var n=[];return e.isPSA||n.push(r.createElement(l,{key:"info",a8n:"mi-contact",action:function(){return o.chatInfoDrawer(e)},shortcut:"i"},l10n.t("web_contact_info"))),n.push(r.createElement(l,{a8n:"mi-select-messages",key:"select",action:t,shortcut:"e"},l10n.t("web_select_messages"))),e.mute.canMute()&&n.push(r.createElement(c,{key:"mute",onMute:function(t){return o.muteChat(e,t)},chat:e})),e.canClear()&&n.push(r.createElement(l,{key:"clear",a8n:"mi-clear",shortcut:"e",action:function(){return o.clearChatMsgs(e)}},l10n.t("clear_chat"))),e.canDelete()&&n.push(r.createElement(u,{key:"delete",onDeleteOrExit:function(){return o.deleteOrExitChat(e)},chat:e})),n}var r=n(8),o=n(10),l=n(1382),c=n(1462),u=n(1458);e.exports={group:i,contact:s,broadcast:a}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(458),s=i(a),r=n(8),o=n(76),l=r.createClass({displayName:"HiddenText",propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired},render:function(){var e=this.props.msg,t=e.senderObj.formattedUser,n="["+o.timeStr(e.t)+"]";return r.createElement("span",{className:"message-pre-text"},"⁠⁠",n," ",t,": ⁠⁠⁠")}});e.exports=l},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.PREVIEW_HEIGHT=void 0;var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(8),m=i(f),g=n(44),v=i(g),y=n(18),_=i(y),E=n(1392),S=i(E),M=n(458),C=(i(M),n(1381)),b=i(C),T=n(1380),P=i(T),k=n(47),N=i(k),w=n(1395),x=i(w),O=n(476),D=i(O),R=n(464),I=i(R),A=n(1377),L=i(A),F=50,U=["foursquare.com","facebook.com","maps.google.com"],j=t.PREVIEW_HEIGHT=150,G=270;t["default"]=(0,L["default"])(function(e){function t(e){(0,o["default"])(this,t);var n=(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).call(this,e));n.getClientThumb=function(){return"data:image/jpeg;base64,"+n.props.msg.body},n.getStaticMapUrl=function(){var e=n.props.msg,t=j+F,i=D["default"].currentRes===D["default"].RES.HIGH?2:1,a=N["default"].build("https://maps.googleapis.com/maps/api/staticmap",{markers:"color:red|"+e.lat+", "+e.lng,zoom:14,size:G+"x"+t,scale:i,language:l10n.getLocale(),client:N["default"].GSM_NAME});return N["default"].gsmURL(a,N["default"].GSM_NUMS)},n.getMapUrl=function(){var e=n.props.msg,t=n.loc();return t&&t.name?["https://maps.google.com/maps/search",encodeURIComponent(t.name),"@"+e.lat+","+e.lng+",17z"].join("/")+"?hl="+l10n.getLocale():N["default"].build("https://maps.google.com/maps",{q:e.lat+","+e.lng,z:17,hl:l10n.getLocale()})},n.loc=function(){var e=n.props.msg.get("loc");return e?(e=e.split("\n"),2===e.length?{name:e[0],addr:e[1]}:{name:e}):void 0},n.getLocationDetails=function(){var e=n.props.msg,t=n.loc(),i=n.props.msg.clientUrl||n.getMapUrl(),a=void 0,s=void 0,r=void 0,o=N["default"].hostname(i),l=_["default"].isEmpty(U.filter(function(e){return o.indexOf(e)>-1}));if(r=l?m["default"].createElement("div",{className:"location-page-host location-caption"},m["default"].createElement(S["default"],null,o)):null,t){a=t.name?m["default"].createElement("a",{href:i,title:t.name,target:"_blank",className:"text-title"},m["default"].createElement(S["default"],null,t.name)):null;var c=(0,v["default"])("text-contents",{"location-caption":!r});s=t.addr?m["default"].createElement("div",{title:t.addr,className:c},m["default"].createElement(S["default"],null,t.addr)):null}var u=a&&s?m["default"].createElement("div",{className:"image-caption message-text","data-id":e.id},a,s,r):null;return u},n.updateResolution=function(){n.setState({src:n.getStaticMapUrl()})},n.onImgLoaded=function(){n.state.hiResAvail||n.setState({hiResAvail:!0})},n.onClick=function(e){e.stopPropagation()};var i="",a=!1,r=n.getStaticMapUrl();return I["default"].isCached(r)&&(i=r,a=!0),n.state={src:i,hiResAvail:a},n}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentDidMount",value:function(){this.updateResolution(),this.props.listeners.add(window,"dpichange",this.updateResolution),this.props.listeners.add(this.props.msg,"change:body")}},{key:"render",value:function(){var e=this.props.msg,t=this.getLocationDetails(),n=t?null:m["default"].createElement("div",{className:"shade"}),i=this.props.displayAuthor&&P["default"].shouldRender(e)?m["default"].createElement(P["default"],{msg:e}):null,a=(0,v["default"])("bubble-location",{"bubble-location-caption":t,"bubble-broadcast":t&&e.broadcast,"bubble-star":t&&e.star}),s={background:"url("+this.getClientThumb()+")",backgroundSize:"cover",width:G,height:this.state.hiResAvail?void 0:j},r={height:j},o=(0,v["default"])("image-thumb-body",{"image-thumb-location-lores":!this.state.hiResAvail});return m["default"].createElement("div",{className:a},i,this.props.quotedMsg,m["default"].createElement("div",{className:"image-thumb",onClick:this.onClick,style:r},m["default"].createElement("a",{href:this.getMapUrl(),target:"_blank"},m["default"].createElement(x["default"],{src:this.state.src,className:o,style:s,hasPrivacyChecks:!1,onLoaded:this.onImgLoaded,noXHR:!0})),n),t,m["default"].createElement(b["default"],{msg:e}))}}]),t}(m["default"].Component))},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(458),m=i(f),g=n(1594),v=i(g),y=n(1473),_=i(y),E=n(1583),S=i(E),M=n(1591),C=i(M),b=n(8),T=n(462),P=n(1589),k=n(1576),N=n(1588),w=n(1598),x=n(1575),O=n(1597),D=n(1590),R=n(1578),I=n(1580);n(1376);var A=n(1596),L=n(1587),F=n(1),U=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){var e=this.props,t=e.msg,n=e.quotedMsg,i=e.displayAuthor,a=e.displayType,s=e.isMsgVisible;switch(t.type){case m["default"].TYPE.CIPHERTEXT:return b.createElement(k,{msg:t,ref:"msg",displayAuthor:i});case m["default"].TYPE.REVOKED:return b.createElement(C["default"],{msg:t,ref:"msg",displayAuthor:i});case m["default"].TYPE.CHAT:return b.createElement(v["default"],{msg:t,ref:"msg",quotedMsg:n,trusted:t.isTrusted(),senderName:t.senderObj?t.senderObj.name:void 0,displayAuthor:i});case m["default"].TYPE.IMAGE:return b.createElement(P,{msg:t,ref:"msg",quotedMsg:n,isMsgVisible:s,displayAuthor:i});case m["default"].TYPE.GROUP_NOTIFICATION:case m["default"].TYPE.GP2:case m["default"].TYPE.BROADCAST_NOTIFICATION:case m["default"].TYPE.NOTIFICATION:case m["default"].TYPE.E2E_NOTIFICATION:case m["default"].TYPE.CALL_LOG:var r=t.body,o=void 0,l=void 0,c=void 0;switch(t.type){case m["default"].TYPE.GP2:case m["default"].TYPE.GROUP_NOTIFICATION:r=T.formatGroupNotification(t);break;case m["default"].TYPE.BROADCAST_NOTIFICATION:r=T.formatBroadcastNotification(t.subtype,t.body);break;case m["default"].TYPE.E2E_NOTIFICATION:r=T.formatE2ENotification(t),o=t.subtype,c=t.body,l=t.id.remote;break;case m["default"].TYPE.CALL_LOG:r=T.formatCallLog(t,!0)}return b.createElement(N,{text:r,type:t.type,subtype:t.subtype,ref:"msg",e2eSubtype:o,participantJid:c,chatId:l});case m["default"].TYPE.AUDIO:return b.createElement(x,{msg:t,quotedMsg:n,isMsgVisible:s,displayAuthor:i,ref:"msg"});case m["default"].TYPE.VIDEO:return t.isGif?b.createElement(I,{msg:t,ref:"msg",quotedMsg:n,isMsgVisible:s,displayType:a,displayAuthor:i}):b.createElement(w,{msg:t,ref:"msg",quotedMsg:n,isMsgVisible:s,displayAuthor:i});case m["default"].TYPE.VCARD:return b.createElement(O,{msg:t,ref:"msg",quotedMsg:n,displayAuthor:i});case m["default"].TYPE.MULTI_VCARD:return b.createElement(L,{msg:t,quotedMsg:n,displayAuthor:i});case m["default"].TYPE.LOCATION:return t.isLive?b.createElement(S["default"],{msg:t,ref:"msg",displayAuthor:i}):b.createElement(_["default"],{msg:t,ref:"msg",quotedMsg:n,displayAuthor:i});case m["default"].TYPE.PTT:return b.createElement(D,{msg:t,quotedMsg:n,displayAuthor:i,ref:"msg"});case m["default"].TYPE.DOCUMENT:return b.createElement(R,{msg:t,ref:"msg",quotedMsg:n,trusted:t.isTrusted(),senderName:t.senderObj?t.senderObj.name:null,displayAuthor:i});case m["default"].TYPE.UNKNOWN:return b.createElement(A,{msg:t,displayAuthor:i});default:return F.log("messageList:render Unknown message type: "+t.type)(),b.createElement(A,{msg:t,displayAuthor:i})}}}]),t}(b.Component);e.exports=U},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(458),s=i(a),r=n(8),o=n(45),l=n(9),c=n(158),u=n(1457),d=r.createClass({displayName:"PTTPlayer",mixins:[c],propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,autoPlay:r.PropTypes.bool.isRequired,onPlayingUpdate:r.PropTypes.func.isRequired,onTimeUpdate:r.PropTypes.func.isRequired},playing:!1,dragging:!1,getInitialState:function(){return{progress:0}},onPlayClick:function(){var e=o.findDOMNode(this.refs.audio);this.playing?e.pause():e.play()},onPlaying:function(){this.playing=!0;var e=this.props.msg;!e.get("isSentByMe")&&e.get("ack")<l.ACK_PLAYED&&e.sendPlayed(),this.props.onPlayingUpdate&&this.props.onPlayingUpdate(this.playing)},onPause:function(){this.playing=!1,this.props.onPlayingUpdate&&this.props.onPlayingUpdate(this.playing)},onEnded:function(){var e=o.findDOMNode(this.refs.audio);e.currentTime=0,e.load()},onTimeUpdate:function(){var e=o.findDOMNode(this.refs.audio),t=0;_.isFinite(e.duration)&&(t=Math.round(100*Math.min(1,e.currentTime/e.duration)),this.props.onTimeUpdate&&this.props.onTimeUpdate(e.currentTime)),this.setState({progress:t})},componentDidMount:function(){var e=o.findDOMNode(this.refs.audio);this.regNativeListener(e,"playing",this.onPlaying),this.regNativeListener(e,"pause",this.onPause),this.regNativeListener(e,"ended",this.onEnded),this.regNativeListener(e,"timeupdate",this.onTimeUpdate),this.regNativeListener(e,"durationchange",this.onTimeUpdate),this.regNativeListener(e,"progress",this.onTimeUpdate)},onDrag:function(e){var t=o.findDOMNode(this.refs.audio),n=e.target.value;this.setState({progress:n}),t.duration&&(t.currentTime=t.duration/100*n)},onPlayerError:function(e){},render:function(){var e="btn-audio icon ";e+=this.playing?"icon-audio-pause":"icon-audio-play";var t={width:this.state.progress-this.state.progress/100*3+"%"};return r.createElement("div",{className:"audio"},r.createElement("div",{className:"audio-controls"},r.createElement("button",{ref:"play_pause",className:e,onClick:this.onPlayClick})),r.createElement("div",{className:"audio-body"},r.createElement("div",{className:"audio-track-container"},r.createElement("span",{className:"audio-progress",style:t}),r.createElement("input",{type:"range",className:"audio-track",value:this.state.progress,onChange:this.onDrag,min:"0",max:"100"}))),r.createElement(u,{ref:"audio",msg:this.props.msg,preload:"auto",onError:this.onPlayerError,autoPlay:this.props.autoPlay}))}});e.exports=d},function(e,t,n){"use strict";var i=n(8),a=n(93),s=n(158),r=n(160),o=n(161),l=n(1431),c=n(54),u=n(473),d=n(91),p=n(1429),h=i.createClass({displayName:"EmojiInput",mixins:[a,s,r],propTypes:{focusOnMount:i.PropTypes.bool,editable:i.PropTypes.bool,format:i.PropTypes.bool,value:i.PropTypes.string,selection:i.PropTypes.object,className:i.PropTypes.string,placeholder:i.PropTypes.string,onKeyPress:i.PropTypes.func,onEnter:i.PropTypes.func,onChange:i.PropTypes.func,onFocus:i.PropTypes.func,onBlur:i.PropTypes.func,onFiles:i.PropTypes.func,onMouseDown:i.PropTypes.func,onSelectionChange:i.PropTypes.func,maxLength:i.PropTypes.number,multiline:i.PropTypes.bool,spellCheck:i.PropTypes.bool,focusOnChange:i.PropTypes.bool},getDefaultProps:function(){return{editable:!0,format:!1,value:"",focusOnChange:!0}},getInitialState:function(){return this.value=this.props.value||"",this.selection=this.props.selection,null},componentWillMount:function(){this.debouncedSaveSelection=this.safeDebounce(this._saveSelection,0)},componentWillReceiveProps:function(e){if(e.value!==this.value&&(this.setNewValue(e.value||"",!1),this.updateDOM(),this.props.focusOnChange&&this.safeDefer(this.restoreFocus.bind(this,!0))),this.props.editable!==e.editable){var t=this.refs.input;t.contentEditable=e.editable,e.editable&&this._disableObjectResize()}},restoreFocus:function(e){if(this.props.editable){var t=this.refs.input;document.activeElement!==t&&(d.focus(t),this.selection&&!e?this.restoreSelection(this.selection):this._moveCursorToEnd(t),this.debouncedSaveSelection())}},_moveCursorToEnd:function(e){if(e){var t=window.getSelection();t&&(t.selectAllChildren(e),t=window.getSelection(),t&&t.rangeCount&&t.collapseToEnd())}},componentDidMount:function(){this.props.focusOnMount&&this.safeDefer(this.restoreFocus),this.props.editable&&this._disableObjectResize(),this.refs.input.restoreFocus=this.restoreFocus,this.refs.input.pasteText=this.pasteText},componentWillUnmount:function(){this.refs.input.restoreFocus=null},_disableObjectResize:function(){c.isGecko&&document.execCommand("enableObjectResizing",!1,!1)},limitLength:function(e){var t=this.props.maxLength;if(!t)return e;e=e||"";var n=this.selectionLength(),i=n+t-l.multibyteLength(this.value);return i>0?l.multibyteSubstr(e,0,i):""},onMouseDown:function(e){e.stopPropagation(),this.regNativeListener(window,"mouseup",this.onWindowMouseUp),this.props.onMouseDown&&this.props.onMouseDown(e)},onWindowMouseUp:function(){this.unregNativeListener(window,"mouseup",this.onWindowMouseUp),this.debouncedSaveSelection()},onContextMenu:function(e){e.stopPropagation()},onKeyUp:function(e){if(c.isTrident&&this.onInput(e),"Backspace"===e.key||"Delete"===e.key){var t=this.refs.input;switch(t.innerHTML){case"\n":case"\r\n":case"<br>":t.innerHTML="",this.setNewValue("",!0,!0)}}this.debouncedSaveSelection()},onKeyPress:function(e){if(c.isTrident&&this.onInput(e),!this.props.onKeyPress||(this.props.onKeyPress(e),!e.defaultPrevented)){var t=e.ctrlKey||e.shiftKey||e.altKey;if(!this.props.multiline&&"Enter"===e.key||this.props.multiline&&"Enter"===e.key&&!t)return e.preventDefault(),void(this.props.onEnter&&this.props.onEnter(e));var n=this.limitLength(u.ucs2.encode([e.charCode]));this.props.multiline&&"Enter"===e.key&&t&&(this.replaceSelection("\n",!0),e.preventDefault()),n.length||e.preventDefault()}},onInput:function(e){var t=this.refs.input;e=_.isBoolean(e)?e:void 0,this.setNewValue(o.NodeToEmoji(t),!0,e)},setNewValue:function(e,t,n){if(e!==this.value||n){if(e&&!this.value){var i=this.refs.placeholder;i&&(i.style.display="none")}else if(this.value&&!e){var a=this.refs.placeholder;a&&(a.style.display="")}this.value=e,t&&this.props.onChange&&this.props.onChange({target:{value:e}}),this.debouncedSaveSelection()}},updateDOM:function(){var e=o.emojiToHTML(_.escape(this.value)),t=this.refs.input;t.innerHTML!==e&&(t.innerHTML=e)},selectionLength:function(){if(!this.props.editable)return 0;var e=this.refs.input;d.focus(e);var t=window.getSelection();if(t.rangeCount){var n=t.getRangeAt(0);return l.multibyteLength(o.NodeToEmoji(n.cloneContents()))}return 0},_saveSelection:function(){var e=this.getSelection();_.isEqual(e,this.prevSelection)||(this.props.onSelectionChange&&this.props.onSelectionChange(e),this.prevSelection=this.selection,this.selection=e)},isCollapsed:function(){if(this.isMounted()){var e=this.refs.input;if(document.activeElement!==e)return null;var t=window.getSelection();return t.isCollapsed}},getCursor:function(){if(!this.isMounted())return-1;var e=this.refs.input;if(document.activeElement!==e)return null;var t=window.getSelection(),n=t.anchorNode,i=t.anchorOffset,a=e.childNodes,s=0;e===n&&(n=a[i]);for(var r=0;r<a.length;r++){var o=a[r];if(o===n)return s+i;o.nodeType===window.Node.ELEMENT_NODE&&o.alt?s+=o.alt.length:o.nodeType===window.Node.TEXT_NODE&&(s+=o.length)}return s},isAtBeginning:function(){return this.isCollapsed()&&0===this.getCursor()},isAtEnd:function(){return this.isCollapsed()&&this.getCursor()===this.value.length},getSelection:function(){if(!this.isMounted())return null;var e=this.refs.input;if(document.activeElement!==e)return null;for(var t=window.getSelection(),n=t.anchorNode,i=t.anchorOffset,a=t.focusNode,s=t.focusOffset,r=e.childNodes,o=-1,l=-1,c=!1,u=!1,d=0;d<r.length;d++){var p=r[d];if(p===n&&(o=d,c=!0),p===a&&(l=d,u=!0),c&&u)break}return{anchor:{index:o,offset:i},focus:{index:l,offset:s}}},restoreSelection:function(e){var t,n,i,a,s,r,o=this.refs.input,l=o.childNodes;-1===e.anchor.index?(t=o,i=e.anchor.offset,s=0):(t=l[e.anchor.index],i=e.anchor.index,s=e.anchor.offset),-1===e.focus.index?(n=o,a=e.focus.offset,r=0):(n=l[e.focus.index],a=e.focus.index,r=e.focus.offset);var u;u=i===a?r>=s?"forward":"reverse":i>a?"reverse":"forward";var d=window.getSelection();if(t&&n)try{var p=document.createRange();return void(c.isTrident?("forward"===u?(p.setStart(t,e.anchor.offset),p.setEnd(n,e.focus.offset)):(p.setStart(n,e.focus.offset),p.setEnd(t,e.anchor.offset)),d.removeAllRanges(),d.addRange(p)):(p.setStart(t,e.anchor.offset),d.removeAllRanges(),d.addRange(p),d.extend(n,e.focus.offset)))}catch(h){this._moveCursorToEnd(o)}else this._moveCursorToEnd(o)},onCut:function(e){c.isTrident&&this.onInput(e)},onPaste:function(e){if(!e.defaultPrevented){e.preventDefault();var t=new p(e.clipboardData);if(t.hasFiles())return e.stopPropagation(),this.props.onFiles&&this.props.onFiles(t);var n=c.isTrident?"text":"text/plain",i=e.clipboardData.getData(n);this.pasteText(i)}},pasteText:function(e){e&&(this.props.maxPaste&&e.length>this.props.maxPaste?this.props.onMaxPasteExceeded():this.replaceSelection(e))},replaceSelection:function(e,t){if(this.props.editable&&(d.focus(this.refs.input),e=this.limitLength(e),0!==e.length)){this.props.multiline||(e=e.replace(/\n+/g," ").replace(/(\r\n)+/g," "));var n=window.getSelection(),i=null;n.getRangeAt&&n.rangeCount&&(i=n.getRangeAt(0),i.deleteContents());var a=this.refs.input,s=a.scrollTop,r=a.scrollHeight,l=o.emojiToHTML(_.escape(e));c.isTrident?i&&this.replaceSelectionTrident(l,n,i):t?document.execCommand("insertText",!1,l):document.execCommand("insertHTML",!1,l),this.onInput(!0),this.debouncedSaveSelection(),this.scrollToCursor(s,r)}},scrollToCursor:function(e,t){var n=this.refs.input,i=n.scrollHeight,a=n.clientHeight;if(!(a>=i)){var s=i-t;this.refs.input.scrollTop=(e||0)+s}},replaceSelectionTrident:function(e,t,n){var i=document.createElement("div");i.innerHTML=e;for(var a,s,r=document.createDocumentFragment();a=i.firstChild;)s=r.appendChild(a);n.insertNode(r),s&&(n=n.cloneRange(),n.setStartAfter(s),n.collapse(!0),t.removeAllRanges(),t.addRange(n))},shouldComponentUpdate:function(){return!1},render:function(){var e=o.emojiToHTML(_.escape(this.value)),t=this.props.className?"input "+this.props.className:"input",n="input-emoji",a=this.props.placeholder&&!this.props.value?i.createElement("div",{className:"input-placeholder",ref:"placeholder"},this.props.placeholder):null;return i.createElement("div",{className:n},a,i.createElement("div",{dangerouslySetInnerHTML:{__html:e},dir:"auto",ref:"input",spellCheck:this.props.spellCheck,"data-tab":this.props.editable?1:null,contentEditable:this.props.editable,className:t,onInput:this.onInput,onPaste:this.onPaste,onCut:this.onCut,onKeyUp:this.onKeyUp,onKeyPress:this.onKeyPress,onMouseDown:this.onMouseDown,onContextMenu:this.onContextMenu,onFocus:this.props.onFocus,onBlur:this.props.onBlur}))}});e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=(n(1413),n(8)),m=n(54),g=function(e){function t(e){(0,o["default"])(this,t);var n=(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).call(this,e));return n.setVideoRef=function(e){n._videoRef=e,n.synchronizeVideo()},n.synchronizeVideo=function(){var e=n._videoRef;e&&(n.state.animate?e.paused&&e.play():e.paused||(e.pause(),e.currentTime=0))},n.setShouldAnimate=function(e){n.state.animate===e&&n.state.show||n.setState({animate:e,show:!0},n.synchronizeVideo)},n.handleClick=function(){n.props.onSend(n.props.gif)},n._videoRef=null,n.state={animate:!1,show:!1},n}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){var e=this.props.gif,t=null;this.state.show&&(t=m.troublesWithLotsOfVideos&&e.nonVideoUrl?f.createElement("img",{className:"gif-search-gif",onClick:this.handleClick,src:e.nonVideoUrl}):f.createElement("video",{className:"gif-search-gif",onClick:this.handleClick,controls:!1,autoPlay:this.state.animate,loop:!0,muted:!0,ref:this.setVideoRef,src:e.previewUrl}));var n=void 0;return this.props.isStarred&&(n=f.createElement("span",{className:"icon-s icon-star-light",onClick:this.props.onUnstarMsg})),f.createElement("div",{className:"gif-search-gif-wrapper",style:{flexBasis:e.widthStr}},f.createElement("div",{style:{width:e.widthStr}},f.createElement("div",{style:{paddingBottom:e.ratioStr}},t)),n)}}]),t}(f.Component);t["default"]=g},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t,n){this.key=e,this.css=t,this.title=n,this.className="emoji-"+e}Object.defineProperty(t,"__esModule",{value:!0}),t.PossibleTabs=t.ExtendedTabs=t.TabsOrdered=t.Tab=t.SKIN_TONE_VARIATIONS=t.EMOJI_HEIGHT=t.EMOJI_WIDTH=void 0;var s,r=n(236),o=i(r);t.TabInfo=a;var l=n(161),c=i(l),u=n(164),d=u.EMOJI.CATEGORIES,p=(t.EMOJI_WIDTH=44,t.EMOJI_HEIGHT=44,t.SKIN_TONE_VARIATIONS=[""].concat(c["default"].skinToneVariations),t.Tab=(s={},(0,o["default"])(s,d.RECENT,new a(d.RECENT,"icon-emoji-recent",function(){return l10n.t("emoji_tab_recent")})),(0,o["default"])(s,d.SMILEYS_PEOPLE,new a(d.SMILEYS_PEOPLE,"icon-emoji-people",function(){return l10n.t("emoji_tab_smileys_people")})),(0,o["default"])(s,d.ANIMALS_NATURE,new a(d.ANIMALS_NATURE,"icon-emoji-nature",function(){return l10n.t("emoji_tab_animals_nature")})),(0,o["default"])(s,d.FOOD_DRINK,new a(d.FOOD_DRINK,"icon-emoji-food",function(){return l10n.t("emoji_tab_food_drink")})),(0,o["default"])(s,d.ACTIVITY,new a(d.ACTIVITY,"icon-emoji-activity",function(){return l10n.t("emoji_tab_activity")})),(0,o["default"])(s,d.TRAVEL_PLACES,new a(d.TRAVEL_PLACES,"icon-emoji-travel",function(){return l10n.t("emoji_tab_travel_places")})),(0,o["default"])(s,d.OBJECTS,new a(d.OBJECTS,"icon-emoji-objects",function(){return l10n.t("emoji_tab_objects")})),(0,o["default"])(s,d.SYMBOLS,new a(d.SYMBOLS,"icon-emoji-symbols",function(){return l10n.t("emoji_tab_symbols")})),(0,o["default"])(s,d.FLAGS,new a(d.FLAGS,"icon-emoji-flags",function(){return l10n.t("emoji_tab_flags")})),(0,o["default"])(s,d.GIFS,new a(d.GIFS,"icon-emoji-gifs",function(){return l10n.t("emoji_tab_gifs")})),(0,o["default"])(s,d.SEARCH_RESULT,new a(d.SEARCH_RESULT,null,null)),s)),h=t.TabsOrdered=[p.RECENT,p.SMILEYS_PEOPLE,p.ANIMALS_NATURE,p.FOOD_DRINK,p.ACTIVITY,p.TRAVEL_PLACES,p.OBJECTS,p.SYMBOLS,p.FLAGS],f=t.ExtendedTabs=h.concat([p.GIFS]);t.PossibleTabs=f.concat([p.SEARCH_RESULT])},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1370),s=i(a),r=n(8),o=n(1383),l=n(1490),c=n(1644),u=n(1638),d=n(61),p=n(1637),h=n(1630),f=n(1627),m=r.createClass({displayName:"InfoFlow",mixins:[o],propTypes:{chat:r.PropTypes.instanceOf(s["default"]).isRequired},componentWillMount:function(){var e=d.supportsFeature(d.F.STARRED)&&d.supportsFeature(d.F.FULL_TEXT_SEARCH),t=e?this.onStarred:null,n=d.supportsFeature(d.F.MEDIA_GALLERY)?this.onMediaGallery:null,i=null;this.props.chat.isGroup?i=r.createElement(p,{chat:this.props.chat,onVerification:this.onVerification,onStarred:t,onMediaGallery:n,onGroupInviteLink:this.onGroupInviteLink,onClose:this._pop}):this.props.chat.isBroadcast?i=r.createElement(f,{chat:this.props.chat,onStarred:t,onMediaGallery:n,onClose:this._pop}):this.props.chat.isUser&&(i=r.createElement(h,{contact:this.props.chat.contact,onVerification:this.onVerification,onStarred:t,onMediaGallery:n,onClose:this._pop})),this.push(i)},onStarred:function(){var e=r.createElement(l,{chat:this.props.chat,starredMsgs:this.props.chat.getStarredMsgs(),onClose:this._pop});this.push(e)},onMediaGallery:function(){var e=r.createElement(c,{chat:this.props.chat,onBack:this._pop});this.push(e)},onGroupInviteLink:function(){var e=r.createElement(u,{chat:this.props.chat,onBack:this._pop});this.push(e)},_pop:function(){this.pop()}});e.exports=m},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(112),s=i(a),r=n(35),o=i(r),l=n(117),c=i(l),u=n(16),d=i(u),p=n(4),h=i(p),f=n(6),m=i(f),g=n(20),v=i(g),y=n(19),_=i(y),E=n(8),S=i(E),M=n(18),C=n(1387),b=n(1425),T=i(b);
e.exports=function(e){var t,n;return n=t=function(t){function n(){for(var e,t,i,a,s=arguments,r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return(0,h["default"])(this,n),t=i=(0,v["default"])(this,(e=n.__proto__||(0,d["default"])(n)).call.apply(e,[this].concat(l))),i.timers=new c["default"],i.timerId=0,i.setInterval=function(e,t){var n=i.cbWrapper(e),a=(0,o["default"])(n,2),s=a[0],r=a[1],l=window.setInterval(r,t);return i.timers.set(s,function(){window.clearInterval(l),i.timers["delete"](s)}),s},i.clearInterval=function(e){var t=i.timers.get(e);t&&t()},i.setTimeout=function(e,t){var n=i.cbWrapper(e),a=(0,o["default"])(n,2),s=a[0],r=a[1],l=window.setTimeout(r,t);return i.timers.set(s,function(){window.clearTimeout(l),i.timers["delete"](s)}),s},i.clearTimeout=function(e){var t=i.timers.get(e);t&&t()},i.throttle=function(e,t,n){var a=i.cbWrapper(e),r=(0,o["default"])(a,2),l=r[0],c=r[1],u=(0,M.throttle)(c,t,n),d=u.cancel.bind(u);u.cancel=function(){d(),i.timers["delete"](l)};var p=function(){return i.timers.set(l,u.cancel),u.apply(i,s)};return p.cancel=u.cancel,p},i.debounce=function(e,t,n){var a=i.cbWrapper(e),r=(0,o["default"])(a,2),l=r[0],c=r[1],u=(0,M.debounce)(c,t,n),d=u.cancel.bind(u);u.cancel=function(){d(),i.timers["delete"](l)};var p=function(){return i.timers.set(l,u.cancel),u.apply(i,s)};return p.cancel=u.cancel,p},i.cbWrapper=function(e){var t=++i.timerId;return[t,function(){return i.timers["delete"](t),e.apply(i,s)}]},a=t,(0,v["default"])(i,a)}return(0,_["default"])(n,t),(0,m["default"])(n,[{key:"_getComponent",value:function(){return C._getComponent.call(this)}},{key:"componentWillUnmount",value:function(){this.timers.forEach(function(e){return e()})}},{key:"render",value:function(){return S["default"].createElement(e,(0,s["default"])({ref:C.HOCRef,setInterval:this.setInterval,clearInterval:this.clearInterval,setTimeout:this.setTimeout,clearTimeout:this.clearTimeout,debounce:this.debounce},this.props))}}]),n}(S["default"].Component),t.displayName="Timer("+(0,T["default"])(e)+")",n}},function(e,t,n){"use strict";var i=n(55),a=50,s=75,r={getInitialState:function(){var e=this;this._setState=this.setState,this.setState=function(t,n,i){_.assign(e.getBatchRenderState(),t),_.isUndefined(n)&&_.isUndefined(i)?e._debounceSetState.forceRun():_.isUndefined(i)?e._debounceSetState.debounce(n):e._debounceSetState.debounceAndCap(n,i)}},componentWillMount:function(){var e=this;this._debounceSetState=new i(function(){e._setState(e._batchRenderMixinState),e._batchRenderMixinState={}})},componentWillUnmount:function(){this._debounceSetState.cancel()},getBatchRenderState:function(){return this._batchRenderMixinState||(this._batchRenderMixinState={}),this._batchRenderMixinState}};r.DD=s,r.CD=a,e.exports=r},function(e,t,n){"use strict";var i=n(8),a=n(45),s=n(462),r=n(1),o=n(1468),l=n(1390),c=n(1372),u=n(1376),d=n(158),p=n(160),h=n(1373),f=n(1375),m=n(1374),g=n(44),v=n(1405),y=n(464),E=n(9),S=n(110),M={ANIMATING:"animating",LOADING:"loading",RECORDING:"active",SENDING:"sending"},C=i.createClass({displayName:"CaptureDrawer",mixins:[p,c,u,d],propTypes:{noContainer:i.PropTypes.bool,stream:i.PropTypes.object.isRequired,caption:i.PropTypes.bool,layoutType:i.PropTypes.oneOf(_.values(l.TYPES)).isRequired,onBack:i.PropTypes.func.isRequired,onSend:i.PropTypes.func.isRequired,onCaptured:i.PropTypes.func},statics:{State:M},getInitialState:function(){return{state:M.ANIMATING,img:void 0,url:void 0}},componentDidMount:function(){this.safeDelay(function(){this.setState({state:M.LOADING,url:window.URL.createObjectURL(this.props.stream)})},300)},componentWillUnmount:function(){window.URL.revokeObjectURL(this.state.url)},onCapture:function(e){var t=this;if(this.refs.video){var n=document.createElement("canvas"),i=a.findDOMNode(this.refs.video);n.height=i.videoHeight,n.width=i.videoWidth;var s=n.getContext("2d");s.translate(n.width,0),s.scale(-1,1),s.drawImage(i,0,0,i.videoWidth,i.videoHeight),this.props.onCaptured?y.canvasToBlob(n).then(function(e){return t.props.onCaptured(e)}):this.setState({state:M.SENDING,img:n.toDataURL("image/jpeg")})}},onVideoLoaded:function(e){this.setState({state:M.RECORDING,videoSize:{width:e.target.videoWidth,height:e.target.videoHeight}})},onRetake:function(e){this.setState({state:M.RECORDING,caption:void 0})},onSend:function(e){this.props.onSend({file:window.dataURLtoBlob(this.state.img),caption:s.emojify(_.trim(this.state.caption))})},onCaptionChange:function(e){this.setState({caption:e.target.value})},render:function(){var e,t,n,a;switch(this.state.state){case M.ANIMATING:break;case M.LOADING:case M.RECORDING:var s=g("capture-video media-viewer-img webcam",{"capture-video-inactive":this.state.state===M.LOADING});n=i.createElement("div",{key:"webcam"},i.createElement(l,{type:this.props.layoutType,size:this.state.videoSize},i.createElement(o,{className:s,autoPlay:!0,ref:"video",onPlay:this.onVideoLoaded,src:this.state.url}))),e=i.createElement("div",{className:"drawer-controls fade",key:"btn-capture"},i.createElement("button",{className:"btn btn-round btn-l",onClick:this.onCapture},i.createElement("span",{className:"icon icon-camera-light"})));break;case M.SENDING:n=i.createElement(l,{type:this.props.layoutType,size:this.state.videoSize},i.createElement("img",{className:"capture-image snapshot",src:this.state.img}));var c=this.props.noContainer?"icon icon-checkmark-light-l":"icon icon-send-light";e=i.createElement("div",{className:"drawer-controls btn-send",key:"btn-send"},i.createElement("button",{className:"btn btn-round btn-l",onClick:this.onSend},i.createElement("span",{className:c}))),t=i.createElement("div",{className:"drawer-header-action",onClick:this.onRetake},i.createElement("span",{className:"icon icon-refresh-light"}),l10n.t("retake")),a=i.createElement(v,{ref:"emojiInput",editable:!0,value:this.state.caption,maxLength:E.MAX_CAPTION_LENGTH,showRemaining:!0,placeholder:l10n.t("add_a_caption"),onEnter:this.onSend,onChange:this.onCaptionChange,supportsEmoji:!0,focusOnMount:!0});break;default:r.log("captureDrawer:render Unhandled video capture state "+this.state.state)()}var u=void 0;u=this.props.caption?i.createElement("div",{className:"capture-footer"},i.createElement(S,{transitionName:"media-caption",className:"media-caption"},a),i.createElement(S,{transitionName:"pop_delay"},e)):i.createElement("div",{className:"capture-footer"},i.createElement(S,{transitionName:"pop_delay"},e));var d=this.props.noContainer?f.Type.POPUP:f.Type.OFFSET;return i.createElement(h,{key:"attach-capture-modal",position:"right",id:"capture",variant:"noheader",noContainer:this.props.noContainer},i.createElement(f,{title:l10n.t("take_photo"),type:d,onCancel:this.props.onBack},t),i.createElement(m,null,i.createElement("div",{className:"media-body"},i.createElement("div",{className:"media-body-container"},i.createElement(S,{transitionName:"capture"},n))),u))}});e.exports=C},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1409),s=i(a),r=n(460),o=i(r),l=n(1389),c=i(l),u=n(458),d=i(u),p=n(1370),h=i(p),f=n(1433),m=i(f),g=n(1417),v=i(g),y=n(1371),E=i(y),S=n(111),M=i(S),C=n(1384),b=n(8),T=n(45),P=n(76),k=n(1373),N=n(1374),w=n(1403),x=n(1372),O=n(156),D=n(93),R=n(1376),I=n(1481),A=n(158),L=n(1388),F=n(462),U=n(54),j=n(157),G=n(10),B=n(61),H=n(1431),V=n(13),q=n(1386),W=n(9),z=n(1501),Y=n(1396),K=n(1506),Q=n(91),X=n(92),Z=n(1387),J=Z.GetRef,$=n(1280),ee=n(44),te=2,ne=b.createClass({displayName:"ChatSearch",mixins:[O,D,$,R,I],propTypes:{chat:b.PropTypes.instanceOf(h["default"]).isRequired},getInitialState:function(){var e=this;return this.ftsMsgs=new z,this.fts=_.debounce(function(){e.pending=!1;var t=_.trim(e.state.searchText||"");H.multibyteLength(t)<te||(e._ftsPromise&&e._ftsPromise.cancel(),e._ftsPromise=e.ftsMsgs.search(t,e.props.chat).checkpoint(e.rejectOnUnmount()).then(function(n){t===_.trim(e.state.searchText)&&e.setState({searching:!1},I.DD)})["catch"](V.Unmount,_.noop)["catch"](function(){e.pending||e.setState({searching:!1},I.DD)}))},750),this.handleScroll=_.throttle(this._handleScroll,100),this.selection=new q([],function(e){return e.id.toString()}),{searchText:"",searching:!1}},componentDidMount:function(){this.onFocusSearch(),this.addObserver(this.ftsMsgs,"reset msgs_update")},componentDidUpdate:function(){this.shouldFTSSearch(this.refs.panel)&&(this.fts(),this.pending=!0,this.state.searching||this.setState({searching:!0}))},componentWillUnmount:function(){this.handleScroll.cancel(),this.fts.cancel(),this.ftsMsgs["delete"](!0),this._ftsPromise&&this._ftsPromise.cancel()},fullTextSearch:function(e){var t=_.trim(e);H.multibyteLength(t)>=te&&B.supportsFeature(B.F.FULL_TEXT_SEARCH)?(this.fts(),this.pending=!0,this.state.searching||this.setState({searching:!0},I.DD)):(this.fts.cancel(),this.ftsMsgs.resetSearch(),this.ftsMsgs["delete"](),this._ftsPromise&&this._ftsPromise.cancel(),this.pending=!1,this.state.searching&&this.setState({searching:!1},I.DD))},shouldFTSSearch:function(e){return!this.ftsMsgs.hasMoreMsgs||this.pending||this.state.searching||this.ftsMsgs.searchPromise||H.multibyteLength(this.state.searchText||"")<te?!1:e.scrollTop+W.SCROLL_FUDGE>e.scrollHeight-e.clientHeight},onSearch:function(e){if(this.isMounted()){if(!e)return void this.onStopSearch();var t=this.state.searchText;if(e!==t){var n={searchText:e};this.fullTextSearch(e),this.setState({searchText:e}),this.setState(n,I.DD)}}},onStopSearch:function(){this.fts.cancel(),this.ftsMsgs.resetSearch(),this.ftsMsgs["delete"](),this._ftsPromise&&this._ftsPromise.cancel(),this.pending=!1,this.setState({searchText:"",searching:!1})},onFocusList:function(e){e.repeat||this.refs.msglist&&this.search.isAtEnd()&&(e.preventDefault(),e.stopPropagation(),M["default"].flashFocus=Date.now(),this.refs.msglist.focusFirst())},onOpenFirst:function(e){e.preventDefault();var t=_.head(this.state.ftsResult);if(t){var n=t.chat,i=n.getSearchContext(t);G.focusChatTextInput(n),G.openChatAt(n,i)}},onFocusSearch:function(e){M["default"].flashFocus=Date.now(),Q.focus(this.search)},onClose:function(){this.context.uim.uie.requestDismiss()},indicateFocus:function(e){if(!(Date.now()-(M["default"].flashFocus||0)>200)){var t=T.findDOMNode(this.refs.input_hotkey);(0,o["default"])(t,"stop"),(0,o["default"])(t,{backgroundColor:["#fbfbfb","#D9F3FF"]},{duration:1600,easing:[.19,.69,.01,.99]})}},onScroll:function(e){this.handleScroll(e.target)},_handleScroll:function(e){this.shouldFTSSearch(e)&&(this.fts(),this.pending=!0)},getEmptyChatlistState:function(e){if(e.length)return null;var t=_.trim(this.state.searchText||"");return H.multibyteLength(t)>=te?this.state.searching?b.createElement(L.SearchingMessages,null):b.createElement(L.SearchMessages,null):L.BeforeSearchMessages(this.props.chat.title())},render:function(){var e=this.ftsMsgs.models,t=this.getEmptyChatlistState(e);if(!t){var n=this.state.searchText?_.trim(this.state.searchText):null;t=b.createElement(ie,{ref:"msglist",isSearching:!!this.state.searchText,searchText:n,ftsResult:e,selection:this.selection,onFocusSearch:this.onFocusSearch})}var i={down:this.onFocusList,enter:this.onOpenFirst},a=this.ftsMsgs.searchPromise&&e.length?b.createElement("div",{className:"more",style:{alignSelf:"center"}},b.createElement(j,{stroke:6,size:24})):null;return b.createElement(k,{key:"search-modal",id:"search",variant:"panel",onCancel:this.onClose},b.createElement("header",{className:"pane-header"},b.createElement("div",{className:"header-close"},b.createElement("button",{onClick:this.onClose},b.createElement("span",{className:"icon icon-x"}))),b.createElement("div",{className:"header-body"},b.createElement("div",{className:"header-main"},b.createElement("div",{className:"header-title"},l10n.t("search_msgs"))))),b.createElement(M["default"],{handlers:i,onFocus:this.indicateFocus,ref:"input_hotkey",className:"chatlist-panel-search"},b.createElement(s["default"],{ref:J("search",this),onSearch:this.onSearch,placeholder:l10n.t("search"),loading:this.state.searching})),b.createElement(N,null,b.createElement("div",{ref:"panel",className:"chatlist-panel-body pane-list-body",onScroll:this.onScroll,id:"pane-side","data-list-scroll-container":!0},t,a)))}});ne.contextTypes={uim:b.PropTypes.instanceOf(X)};var ie=b.createClass({displayName:"MsgList",mixins:[O,D,A],propTypes:{isSearching:b.PropTypes.bool,searchText:b.PropTypes.string,ftsResult:b.PropTypes.array,onClick:b.PropTypes.func,selection:b.PropTypes.instanceOf(q),onFocusSearch:b.PropTypes.func},getDefaultProps:function(){return{chats:[]}},getInitialState:function(){return this._listPointerEvents=!0,{}},componentWillMount:function(){this.props.selection.init(this.getSelection())},onListPointerEventsOff:function(){this._listPointerEvents=!1},onListPointerEventsOn:function(){this._listPointerEvents=!0},onClick:function(e,t,n){var i=this;e.preventDefault(),e.stopPropagation(),Store.Chat.find(t.id).then(function(e){i.props.isSearching&&i.props.onClick&&i.props.onClick(),2===K.column&&i.context.uim.uie.requestDismiss(),G.focusChatTextInput(e),G.openChatAt(e,n)})},getSelection:function(){return this.props.ftsResult||[]},getList:function(){var e=this;return this.props.ftsResult.map(function(t){return b.createElement(ae,{msg:t,searchText:e.props.searchText,onClick:e.onClick,active:e.props.selection,key:t.id.toString()})})},restoreFocus:function(){this.props.selection.reset()},onFocusGain:function(e){e.target===T.findDOMNode(this)&&this._listPointerEvents&&(this.props.selection.index<0?this.focusFirst():this.props.selection.reset())},focusFirst:function(){this.props.selection.setFirst()},onNextChat:function(e,t,n){e&&(e.preventDefault(),e.stopPropagation());var i=this.props.selection.next();this.props.selection.index!==i&&this.props.selection.setNext()},onPrevChat:function(e,t,n){e&&(e.stopPropagation(),e.preventDefault());var i=this.props.selection.prev();i>-1?(this.props.selection.setPrev(),this.focusComposer=n):t||this.props.onFocusSearch()},render:function(){var e=this,t={down:function(t){return e.onNextChat(t)},up:function(t){return e.onPrevChat(t)}};return b.createElement(M["default"],{handlers:t,onFocus:this.onFocusGain,"data-tab":3},b.createElement(c["default"],{className:"chatlist",data:this.getList(),height:72,animate:!0,extraItems:4,onPointerEventsOff:this.onListPointerEventsOff,onPointerEventsOn:this.onListPointerEventsOn}))}});ie.contextTypes={uim:b.PropTypes.instanceOf(X)};var ae=b.createClass({displayName:"Message",mixins:[x,O],propTypes:{msg:b.PropTypes.instanceOf(d["default"]).isRequired,searchText:b.PropTypes.string,mouseDownAsClick:b.PropTypes.bool,onClick:b.PropTypes.func,active:b.PropTypes.object},getInitialState:function(){var e=this.props,t=e.msg,n=e.active,i={formattedTitle:this.async("msg.chat.formattedTitle"),active:n?n.value===t:!1};return t.sender&&t.isGroupMsg&&!t.isNotification&&(t.isSentByMe?i.formattedShortName=t.senderObj.formattedShortName:i.formattedShortName=this.async("msg.senderObj.formattedShortName")),i},componentWillMount:function(){this.props.active&&this.addObserver(this.props.active,this.props.msg.id.toString(),this.onActiveChange)},onActiveChange:function(e,t){if("focus"===e){var n=T.findDOMNode(this);Q.focus(n),t&&w.scrollIntoViewIfNeeded(n)}this.setState({active:!!e})},onClick:function(e){if(_.isFunction(this.props.onClick)){var t=this.props.msg,n=t.chat,i=n.getSearchContext(t);i.msg=t,this.props.onClick(e,n,i)}},onMouseDown:function(e){0===e.button&&this.onClick(e)},onEnter:function(e){e.preventDefault(),e.stopPropagation(),M["default"].flashFocus=Date.now(),this.onClick(e)},indicateFocus:function(e){if(!(Date.now()-(M["default"].flashFocus||0)>200)){var t=T.findDOMNode(this.refs.cell);(0,o["default"])(t,"stop"),(0,o["default"])(t,{backgroundColor:["#e9eaeb","#cbdde7"]},{duration:1300,easing:[.19,.69,.01,.99],complete:this.onBlur})}},onBlur:function(e){var t=T.findDOMNode(this.refs.cell);t&&((0,o["default"])(t,"stop"),t.style.backgroundColor="")},contextEnabled:function(){return!1},render:function(){var e=this.props.msg,t=b.createElement("span",{className:"chat-time-title"},P.relativeStr(e.t)),n=[];e.isSentByMe&&n.push(b.createElement(m["default"],{msg:e,key:"symbol"})),e.isSentByMe||!e.isGroupMsg||e.isNotification||(n.push(b.createElement(E["default"],{text:this.state.formattedShortName,direction:"auto",className:{number:!e.senderObj.name,"chat-status-name":!0},key:"author"})),n.push(b.createElement("span",{className:"chat-status-divider",key:"divider"},":"))),e.hasSymbol()&&n.push(b.createElement(v["default"],{msg:e,key:"msg-symbol"})),n.push(b.createElement(E["default"],{direction:e.dir,ellipsify:!0,formatters:C.Configuration.Highlight(this.props.searchText?[this.props.searchText]:[]),text:F.msgText(e),key:"status"}));var i="chat-status";U.isGecko&&(i+=" ellipsify");var a=l10n.embedDir(F.msgText(e),e.rtl),s=b.createElement("div",{className:i,title:a},n),r={enter:this.onEnter},o=ee("message",{active:!!this.state.active}),l=this.props.mouseDownAsClick;return b.createElement(M["default"],{handlers:r,onFocus:this.indicateFocus,onBlur:this.onBlur,className:"chat-drag-cover"},b.createElement(Y,{id:e.id+"",ref:"cell",contextEnabled:this.contextEnabled,className:o,primaryDetail:t,secondary:s,onClick:l?null:this.onClick,onMouseDown:l?this.onMouseDown:null,onContext:this.onMenu}))}});e.exports=ne},function(e,t,n){"use strict";var i=n(8),a=n(44),s=i.createClass({displayName:"DrawerItem",propTypes:{title:i.PropTypes.node,icon:i.PropTypes.node,classes:i.PropTypes.string,onClick:i.PropTypes.func},render:function(){var e=this.props,t=e.onClick,n=e.title,s=e.icon,r=e.classes,o=e.children,l=a("drawer-button",r,{clickable:t}),c=a("contents",{"drawer-button-row":s}),u=a({"col-main":s}),d=a({"col-side":s});return i.createElement("div",{className:l,onClick:t},i.createElement("div",{className:c},i.createElement("div",{className:u},i.createElement("div",{className:"primary"},n),i.createElement("div",{className:"secondary"},o)),i.createElement("div",{className:d},s)))}});e.exports=s},function(e,t,n){"use strict";var i=n(8),a=n(158),s=n(1550),r=n(1373),o=n(1375),l=n(1374),c=n(1390),u=n(110),d=361,p=500,h={RETAKE:"retake",RESTART:"restart"},f=i.createClass({displayName:"EditImageDrawer",mixins:[a],propTypes:{img:i.PropTypes.oneOfType([i.PropTypes.instanceOf(File),i.PropTypes.instanceOf(Blob)]),imageSize:i.PropTypes.shape({width:i.PropTypes.width,height:i.PropTypes.height}),retryText:i.PropTypes.oneOf(_.values(h)),onCancel:i.PropTypes.func.isRequired,onFinished:i.PropTypes.func.isRequired,onRetake:i.PropTypes.func},statics:{RetryOptions:h},getInitialState:function(){return{img:this.props.img,doneEditing:!1,loaded:!1,editorSize:{width:p,height:d}}},onDoneEditing:function(){this.setState({doneEditing:!0})},onObjectLoad:function(e){if(e){var t={};!this.state.editorSize||this.state.editorSize.width===e.clientWidth&&this.state.editorSize.height===e.clientHeight||(t.editorSize={width:e.clientWidth,height:e.clientHeight}),this.state.loaded||(t.loaded=!0),_.isEmpty(t)||this.setState(t)}},render:function(){var e,t=this.state.loaded?i.createElement("div",{className:"drawer-controls-right btn-send",key:"btn-send"},i.createElement("button",{className:"btn btn-round btn-l",onClick:this.onDoneEditing},i.createElement("span",{className:"icon icon-checkmark-light-l"}))):null,n=this.props.noContainer?o.Type.POPUP:o.Type.OFFSET,a=i.createElement(s,{img:this.state.img,onImageSet:this.props.onFinished,doneEditing:this.state.doneEditing,size:this.state.editorSize});if(this.props.onRetake){var f;switch(this.props.retryText){case h.RETAKE:f=l10n.t("retake");break;case h.RESTART:default:f=l10n.t("retry")}e=i.createElement("div",{className:"drawer-header-action",onClick:this.props.onRetake},i.createElement("span",{className:"icon icon-refresh-light"}),f)}var m=i.createElement("div",{className:"capture-footer"},i.createElement(u,{transitionName:"btn"},t)),g=this.props.imageSize?this.props.imageSize:{width:p,height:d};return i.createElement(r,{key:"attach-edit-modal",position:"right",id:"edit",variant:"noheader"},i.createElement(o,{title:l10n.t("adjust_image"),type:n,onCancel:this.props.onCancel},e),i.createElement(l,null,i.createElement("div",{className:"media-body"},i.createElement("div",{className:"media-body-container-background"},i.createElement(u,{transitionName:"capture"},i.createElement(c,{type:c.TYPES.COVER,size:g,onObjectLoad:this.onObjectLoad},a)))),m))}});e.exports=f},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(111),s=i(a),r=n(1409),o=i(r),l=n(1389),c=i(l),u=n(8),d=n(1373),p=n(1375),h=n(1374),f=n(1400),m=n(1386),g=n(91),v=n(1387),y=v.GetRef,E=u.createClass({displayName:"ListModal",propTypes:{title:u.PropTypes.string.isRequired,selection:u.PropTypes.instanceOf(m),onSearch:u.PropTypes.func,searchPlaceholder:u.PropTypes.string,onCancel:u.PropTypes.func.isRequired,onSelect:u.PropTypes.func},onNext:function(e){e.preventDefault(),e.stopPropagation();var t=this.props.selection;t&&t.setNext()},onPrev:function(e){var t=this.props.selection;if(t){e.preventDefault(),e.stopPropagation();var n=t.prev();n>-1?t.setPrev():(t.unset(),s["default"].flashFocus=Date.now(),g.focus(this.search))}},onFocusList:function(e){this.list&&(e.preventDefault(),e.stopPropagation(),s["default"].flashFocus=Date.now(),this.props.selection.setFirst())},onSelectFirst:function(e){e.preventDefault(),e.stopPropagation();var t=_.head(this.props.children);t&&this.props.onSelect(e,t)},onSearch:function(e){this.props.onSearch(e)},render:function(){var e=this.props,t=e.title,n=e.onCancel,i=e.onSearch,a=e.searchPlaceholder,r=e.children,l={down:this.onFocusList,enter:this.onSelectFirst},m={down:this.onNext,up:this.onPrev},g=void 0;i&&(g=u.createElement(s["default"],{handlers:l},u.createElement(o["default"],{ref:y("search",this),onSearch:this.onSearch,placeholder:a||l10n.t("search")})));var v=void 0;return v=r&&r.length?u.createElement(s["default"],{handlers:m},u.createElement(c["default"],{className:"chatlist",ref:y("list",this),data:r,height:72,extraItems:4})):r,u.createElement(f,{type:f.TOWER},u.createElement(d,{key:"contact-modal",onCancel:n,position:"right"},u.createElement(p,{title:t,type:p.Type.POPUP,onCancel:n}),g,u.createElement(h,{"data-list-scroll-container":!0},v)))}});e.exports=E},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(460),s=i(a),r=n(1395),o=i(r),l=n(1371),c=i(l),u=n(237),d=i(u),p=n(8),h=n(1379),f=n(1390),m=n(10),g=n(1372),v=n(44),y=n(234),_=500,E=p.createClass({displayName:"PhotoViewerModal",mixins:[g],propTypes:{contact:p.PropTypes.instanceOf(d["default"]),imgFull:p.PropTypes.string,animateBorderRadius:p.PropTypes.bool,getZoomNode:p.PropTypes.func.isRequired},getInitialState:function(){return{formattedUser:this.async("contact.formattedUser"),imgFull:this.props.imgFull||this.async("contact.profilePicThumb.imgFull"),style:{visibility:"hidden"}}},shouldComponentUpdate:function(e,t){return t.imgFull?!0:(this.onClose(),!1)},onScroll:function(e){Math.abs(e.deltaY)>3&&this.onClose()},onClose:function(){if(!this.closing){this.closing=!0;var e=void 0;if(this.props.getZoomNode(function(t){e=t}),!e)return m.closeModalMedia();var t=this.refs.image,n=t.getBoundingClientRect(),i=e.getBoundingClientRect(),a=i.top-n.top,r=i.left-n.left,o=e.clientWidth/t.clientWidth;(0,s["default"])(t,{translateX:[r,0],translateY:[a,0],scale:[o,1]},{duration:200,easing:[.1,.82,.25,1]}).then(function(){m.closeModalMedia()})}},onImageLoad:function(e){var t=this,n=e.target;this.setState({size:{width:n.naturalWidth,height:n.naturalHeight}},function(){t.props.getZoomNode(function(e){var i=n.getBoundingClientRect(),a=e.getBoundingClientRect(),s=a.top-i.top,r=a.left-i.left,o=e.clientWidth/n.clientWidth,l={visibility:"hidden",transform:"translateX("+r+"px) translateY("+s+"px) scale("+o+")",transition:"transform 0s"};t.props.animateBorderRadius&&(l.borderRadius="50%"),t.setState({style:l},function(){var e={transform:"translateX(0px) translateY(0px) scale(1)",transition:"transform "+_+"ms cubic-bezier(.1,.82,.25,1)"};t.props.animateBorderRadius&&(e={transform:"translateX(0px) translateY(0px) scale(1)",borderRadius:"0%",transition:"transform "+_+"ms cubic-bezier(.1,.82,.25,1),\n                                         border-radius "+_+"ms cubic-bezier(.1,.82,.25,1)"}),t.setState({style:e})})})})},render:function(){var e=this.props.contact,t=v("media-viewer","media-viewer-animate"),n=v("media-panel-header",{});return p.createElement(y,{displayName:"PhotoViewer",escapable:!0,requestDismiss:this.onClose},p.createElement("div",{className:t,onWheel:this.onScroll,onClick:this.onClose},p.createElement("div",{className:n},p.createElement("div",{className:"chat media-chat"},p.createElement("div",{className:"chat-avatar"},p.createElement(h,{id:e.id})),p.createElement("div",{className:"chat-body"},p.createElement("div",{className:"chat-main"},p.createElement(c["default"],{text:this.state.formattedUser})))),p.createElement("div",{className:"menu menu-horizontal media-panel-tools"},p.createElement("div",{className:"menu-item"},p.createElement("button",{className:"icon icon-x-viewer",title:l10n.t("web_close"),onClick:this.onClose})))),p.createElement("div",{className:"media-content",dir:"ltr",ref:"container"},p.createElement("div",{className:"media"},p.createElement(f,{type:f.TYPES.SCALE_DOWN,size:this.state.size},p.createElement("div",{className:"profile-viewer",ref:"image",style:this.state.style},p.createElement(o["default"],{src:this.state.imgFull,hasPrivacyChecks:!0,onLoad:this.onImageLoad,className:"profile-viewer-img"})))))))}});e.exports=E},function(e,t,n){"use strict";var i=n(8),a=n(1373),s=n(1375),r=n(1398),o=n(1374),l=n(1434),c=n(233),u=n(10),d=n(1372),p=n(156),h=n(1376),f=n(1405),m=n(9),g=n(462),v=n(92),y=n(13),E=i.createClass({displayName:"ProfileDrawer",mixins:[d,p,h],propTypes:{id:i.PropTypes.string.isRequired,onClose:i.PropTypes.func},getInitialState:function(){return this.asyncState({status:"id.Status.status",imgFull:"id.ProfilePicThumb.imgFull"},{pushname:Store.Conn.pushname,status:l10n.t("contact_status_loading"),pendingPushname:!1,pendingStatus:!1,pendingPhoto:!1})},componentWillMount:function(){var e=this;this.addObserver(Store.Conn,"change:pushname",function(){e.setState({pushname:Store.Conn.pushname})})},validateStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return!!e.trim()},onSetStatusError:function(){u.openModal(i.createElement(c,{onOK:u.closeModal.bind(u),okText:l10n.t("web_ok")},l10n.t("action_status_empty")))},onSetStatus:function(e){var t=this;if(Store.Status.canSetMyStatus()){var n=Store.Status.get(this.props.id).status,i=g.emojify(this.state.status);if(i===n)return this.setState({status:i});this.setState({pendingStatus:!0}),Store.Status.setMyStatus(g.emojify(this.state.status)).checkpoint(this.rejectOnUnmount()).then(function(){t.setState({status:Store.Status.get(t.props.id).status,pendingStatus:!1})})["catch"](y.Unmount,_.noop)}},onBack:function(){this.props.onClose?this.props.onClose():this.context.uim.uie.requestDismiss()},onStatusChange:function(e){this.setState({status:e.target.value})},onCancelStatus:function(){this.setState({status:Store.Status.get(this.props.id).status})},validatePushname:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return!!e.trim()},onSetPushname:function(e){var t=this;if(Store.Conn.canSetMyPushname()){var n=Store.Conn.pushname,i=g.emojify(this.state.pushname);if(i===n)return this.setState({pushname:i});this.setState({pendingPushname:!0}),Store.Conn.updatePushname(g.emojify(this.state.pushname)).checkpoint(this.rejectOnUnmount()).then(function(){t.setState({pendingPushname:!1})})["catch"](y.Unmount,_.noop)}},onSetPushnameError:function(){u.openModal(i.createElement(c,{onOK:u.closeModal.bind(u),okText:l10n.t("web_ok")},l10n.t("action_pushname_empty")))},onPushnameChange:function(e){this.setState({pushname:e.target.value})},onCancelPushname:function(){this.setState({pushname:Store.Conn.pushname})},onImageSet:function(e,t){var n=this,i=Store.ProfilePicThumb.get(this.props.id);this.setState({pendingPhoto:!0});var a;a=e&&t?i.setPicture(e,t):i.deletePicture(),a.checkpoint(this.rejectOnUnmount()).then(function(){n.setState({pendingPhoto:!1})})["catch"](y.Unmount,_.noop)},render:function(){var e=Store.ProfilePicThumb.get(this.props.id),t=l.Type.PROFILE,n=!e.canSet()&&!e.canDelete(),c=i.createElement(l,{type:t,id:this.props.id,pending:this.state.pendingPhoto,startImage:this.state.imgFull,readOnly:n,onImageSet:this.onImageSet}),u=m.STATUS_V2?i.createElement(r,{a8n:"col-main-profile",title:l10n.t("web_status"),classes:"animate-enter1 well-input"},i.createElement(f,{value:this.state.status,editable:Store.Status.canSetMyStatus(),pending:this.state.pendingStatus,showRemaining:!0,validate:this.validateStatus,maxLength:m.MAX_STATUS_LENGTH,onChange:this.onStatusChange,onSave:this.onSetStatus,onError:this.onSetStatusError,onCancel:this.onCancelStatus,supportsEmoji:!0,lockable:!0,lowProfile:!0})):null,d=l10n.t("menuitem_profile_status"),p=l10n.t("menuitem_profile");return i.createElement(a,{onCancel:this.onBack,id:"profile"},i.createElement(s,{a8n:"drawer-title-profile",title:m.STATUS_V2?d:p,onBack:this.onBack,type:s.Type.LARGE}),i.createElement(o,null,i.createElement("div",{className:"drawer-section drawer-scale drawer-section-photo"},c),i.createElement(r,{a8n:"col-main-profile",title:l10n.t("pushname"),classes:"animate-enter1 well-input"},i.createElement(f,{value:this.state.pushname,editable:Store.Conn.canSetMyPushname(),pending:this.state.pendingPushname,showRemaining:!0,validate:this.validatePushname,maxLength:m.MAX_PUSHNAME_LENGTH,onChange:this.onPushnameChange,onSave:this.onSetPushname,onError:this.onSetPushnameError,onCancel:this.onCancelPushname,supportsEmoji:!0,lockable:!0,lowProfile:!0})),i.createElement("div",{className:"hint animate-enter1 well-transparent"},l10n.t("pushname_description")),u))}});E.contextTypes={uim:i.PropTypes.instanceOf(v)},e.exports=E},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1370),s=i(a),r=n(1371),o=i(r),l=n(8),c=n(463),u=n(233),d=n(1394),p=n(10),h=l.createClass({displayName:"RevokeMessagePopup",propTypes:{chat:l.PropTypes.instanceOf(s["default"]).isRequired,msgList:l.PropTypes.array.isRequired,toastPosition:l.PropTypes.string,onCancel:l.PropTypes.func},getInitialState:function(){return{clearMedia:!0}},onCancel:function(){p.closeModal()},onRevoke:function(){var e=this.props,t=e.chat,n=e.msgList,i=e.toastPosition,a=e.onCancel;p.sendRevokeMsgs(t,n,this.state.clearMedia,null,i),p.closeModal(),a&&a()},onToggleClearMedia:function(){this.setState({clearMedia:!this.state.clearMedia})},render:function(){var e=void 0,t=this.props.msgList,n=t.length;return _.some(t,function(e){return e.isMMS})&&(e=l.createElement("div",{className:"controls-section controls-section-popup",onClick:this.onToggleClearMedia},l.createElement("div",{"data-a8n":c.key("menu-icon-revoke-message"),className:"control"},l.createElement(d,{onChange:this.onToggleClearMedia,checked:this.state.clearMedia})),l.createElement("div",{className:"label"},l10n.t("clear_media")))),l.createElement(u,{title:l10n.t("are_you_sure"),onOK:this.onRevoke,okText:l10n.t("revoke_menu"),onCancel:this.onCancel},l.createElement("div",null,l.createElement(o["default"],{text:l10n.t("revoke_message_confirmation",{count:n,_plural:n})}),e))}});e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){return e.scrollTop+m.SCROLL_FUDGE>e.scrollHeight-e.clientHeight}var s=n(458),r=i(s),o=n(1370),l=i(o),c=n(1449),u=i(c),d=n(111),p=i(d),h=n(8),f=n(45),m=n(9),g=n(10),v=n(1373),y=n(1388),E=n(1375),S=n(1374),M=n(156),C=n(1376),b=n(110),T=n(1441),P=n(1386),k=n(1512),N=n(157),w=n(13),x=n(61),O=n(1),D=n(91),R=n(158),I=n(1411),A=I.MenuBarItem,L=n(1382),F=n(467),U=n(1661),j=n(92),G=h.createClass({displayName:"StarredDrawer",mixins:[M,C,R],propTypes:{chat:h.PropTypes.instanceOf(l["default"]),
starredMsgs:h.PropTypes.instanceOf(u["default"]),onClose:h.PropTypes.func},getInitialState:function(){return this.handleScroll=_.throttle(this._handleScroll,100),this.updateMsgListInfo=_.throttle(this._updateMsgListInfo,100),this.msgListInfo={visibleMsgs:{}},{cursor:new k(this.props.starredMsgs,void 0,m.RENDOR_CURSOR.STARRED_DRAWER).loadAfter(m.MSG_PRELOAD_THRESHOLD)}},componentWillMount:function(){this.currSelection=new P([],function(e){return e.id.toString()}),this.activeSelection=new P([],function(e){return e.id.toString()})},componentDidMount:function(){var e=this;this.focus(),this.regNativeListener(window,"resize",this.updateMsgListInfo),!this.props.starredMsgs.isSynced&&this.props.starredMsgs.length<m.PAGE_SIZE&&this.uiIdle(this.loadEarlierMsgs),this.initObservers(),this.addObserver(this.props.starredMsgs,"reset",function(){e.setState(e.getInitialState()),e.loadEarlierMsgs()})},componentWillUnmount:function(){this._firstSyncComplete&&this._firstSyncComplete.cancel(),this.handleScroll.cancel(),this.updateMsgListInfo.cancel()},componentDidUpdate:function(){this.updateMsgListInfo()},initObservers:function(){var e=this;this.addObserverAndRun(this.props.starredMsgs,"reset sync",function(){e.initSelectionObjects(),e.setState({})}),this.addObserver(this.props.starredMsgs,"add remove",this.handleStarChange),this.onFocusGain()},handleStarChange:function(e){this.initSelectionObjects(),this.setState({})},initSelectionObjects:function(){var e=this.props.starredMsgs.models;this.currSelection.init(e,!0),this.activeSelection.init(e)},loadEarlierMsgs:function(){var e=this,t=this.state.cursor,n=this.props.chat&&this.props.chat.id,i=this.props.starredMsgs.models;if(t.end<i.length)this.setState({cursor:t.loadAfter()});else{if(this.props.starredMsgs.isSynced)return;this.props.starredMsgs.sync(n).checkpoint(this.rejectOnUnmount()).then(function(){t.hasAfter()&&e.setState({cursor:t.loadAfter()})})["catch"](w.Unmount,_.noop)["catch"](function(e){O.log("StarredDrawer:loadEarlierMsgs failed")(),O.log(e)()})}},onClose:function(){this.props.onClose?this.props.onClose():this.context.uim.uie.requestDismiss()},focus:function(){D.focus(f.findDOMNode(this.refs.body))},onFocusGain:function(e){var t=e?e.target:document.activeElement;t===f.findDOMNode(this.refs.body)&&(this.currSelection.index<0?this.currSelection.setFirst():this.currSelection.reset(!1))},onNextMsg:function(e){e&&(e.preventDefault(),e.stopPropagation());var t=this.currSelection.next();this.currSelection.index!==t&&this.currSelection.setNext()},onPrevMsg:function(e){e&&(e.stopPropagation(),e.preventDefault());var t=this.currSelection.prev();t>-1&&this.currSelection.setPrev()},onScroll:function(e){this.handleScroll(e.target)},_handleScroll:function(e){this.updateMsgListInfo(),a(e)&&this.loadEarlierMsgs()},selectMsg:function(e){this.currSelection.setVal(e),this.activeSelection.setVal(e),g.openChatAt(e.chat,e.chat.getSearchContext(e)),g.focusShowMsg(e.id)},getMsgList:function(){var e=this.state.cursor,t=this.props.starredMsgs.models,n=this.props.starredMsgs.isSynced?e.end:Math.min(e.end,t.length);return t=t.slice(e.start,n),this.length=t.length,t},getMsgVisibility:function(e){if(!e)return m.VISIBILITY.BELOW;var t=f.findDOMNode(this.refs.scrollContainer),n=t.previousSibling.clientHeight,i=t.scrollTop+n,a=i+t.clientHeight,s=f.findDOMNode(e);return s?s.offsetTop+s.clientHeight<=i?m.VISIBILITY.ABOVE:s.offsetTop>=a?m.VISIBILITY.BELOW:m.VISIBILITY.VISIBLE:m.VISIBILITY.BELOW},isMsgVisible:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!1;return!!this.msgListInfo.visibleMsgs[e.toString()]&&(t?!0:this.getMsgComponent(e))},getMsgComponent:function(e){var t=this.refs[e.toString()];if(t){var n=t.refs.wrapper;if(n)return n.refs.component&&n.refs.component.refs.msg}},_updateMsgListInfo:function(){for(var e=this.getMsgList(),t={},n=0,i=this.length-1;i>n;){var a=Math.floor((n+i)/2),s=this.refs[e[a].id.toString()];this.getMsgVisibility(s)===m.VISIBILITY.ABOVE?n=a+1:i=a}for(var r=n;r<e.length;r++){var o=this.refs[e[r].id.toString()];if(this.getMsgVisibility(o)!==m.VISIBILITY.VISIBLE)break;t[e[r].id.toString()]=!0}this.pauseHiddenGifs(this.msgListInfo.visibleMsgs,t),this.msgListInfo.visibleMsgs=t},pauseHiddenGifs:function(e,t){for(var n in e)if(!t[n]){var i=this.props.starredMsgs.get(n);if(i&&i.isGif){var a=this.getMsgComponent(n);a&&a.playCount&&a.pause()}}},render:function(){var e=this,t=this.getMsgList(),n=this.state.cursor,i=this.props.chat||null,a=void 0,s=void 0;if(s=this.props.starredMsgs.isSynced&&n.end>=t.length?null:this.props.starredMsgs.syncPromise?h.createElement("div",{className:"more"},h.createElement("div",{className:"btn-more",title:l10n.t("loading_messages")},h.createElement(N,{stroke:6,size:24}))):h.createElement("div",{className:"more"},h.createElement("div",{className:"btn-more",title:l10n.t("load_earlier_messages"),onClick:this.loadEarlierMsgs},h.createElement("span",{className:"icon icon-refresh"}))),t.length>0){var o=t.map(function(t){var n=t.type===r["default"].TYPE.IMAGE||t.type===r["default"].TYPE.VIDEO||t.type===r["default"].TYPE.AUDIO;return h.createElement(T,{key:t.id,ref:t.id.toString(),msg:t,isMsgVisible:n?e.isMsgVisible:_.noop,currSelection:e.currSelection,activeSelection:e.activeSelection,onClickMsg:e.selectMsg})});a=h.createElement(b,{transitionName:"slide"},o)}else this.props.starredMsgs.isSynced?a=h.createElement(y.StarredMsgs,null):(a=h.createElement(y.Loading,null),s=null);var l={down:this.onNextMsg,up:this.onPrevMsg},c=t.length||this.props.starredMsgs.isSynced,u=x.supportsFeature(x.F.UNSTAR_ALL)?h.createElement(A,{a8n:"starred-menu",icon:"menu-white",title:l10n.t("menutitle_menu"),disabled:!c},h.createElement(B,{chat:i,msgs:t})):null;return h.createElement(v,{id:"starred",onCancel:this.onClose},h.createElement(p["default"],{className:"drawer",handlers:l,onFocus:this.onFocusGain,"data-tab":2,ref:"body"},h.createElement(E,{title:l10n.t("starred_flow_title"),onBack:this.onClose,type:E.Type.LARGE,menu:u}),h.createElement(S,{onScroll:this.onScroll,ref:"scrollContainer"},a,s)))}});G.contextTypes={uim:h.PropTypes.instanceOf(j)},e.exports=G;var B=h.createClass({displayName:"StarredHeaderDropdown",propTypes:{chat:h.PropTypes.instanceOf(l["default"]),msgs:h.PropTypes.array},sendUnstarAll:function(){g.openModal(h.createElement(U,{msgs:this.props.msgs,chat:this.props.chat}))},render:function(){return h.createElement(F,{type:F.Type.DROPDOWN_MENU,flipOnRTL:!0,key:"StarredDrawerHeader",direction:{x:F.Direction.X.LEFT}},h.createElement(L,{a8n:"mi-unstar-all menu-item",action:this.sendUnstarAll},l10n.t("unstar_all")))}})},function(e,t,n){"use strict";function i(e){var t=document.createElement("a");t.href=e,t.target="_blank",t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}function a(e){return e.join(" ")}var s=n(8),r=n(10),o=n(21),l=n(465),c=n(1423),u=n(1484),d=n(1396),p=s.createClass({displayName:"VCardModalDetails",propTypes:{className:s.PropTypes.string,parsedVCard:s.PropTypes.object.isRequired,thumbnail:s.PropTypes.string},defaultProps:{className:""},openChat:function(e){r.closeModal(),Store.Chat.find(o.numberToWid(e)).then(function(e){r.openChatFromUnread(e).then(function(t){t&&r.focusChatTextInput(e)})})},sendEmail:function(e){var t="mailto:"+e;i(t)},openLocation:function(e){var t=_.map(_.filter(e),encodeURIComponent).join(", "),n="https://maps.google.com/maps/search/"+t+"?hl="+l10n.getLocale();i(n)},getHeader:function(){var e=this.props.parsedVCard,t=l.vcardWAids(e),n=l.getNameFromParsedVCard(e),i=l.getOrganizationString(e),a=s.createElement("div",{className:"chat-avatar"},s.createElement(c,{thumb:this.props.thumbnail,waid:l.thumbnailWAid(t)}));return s.createElement("div",{className:"chatlist chatlist-plain"},s.createElement(d,{id:t[0],contextEnabled:function(){return!1},image:a,primary:n,secondary:i}))},render:function(){var e=this,t=this.props.parsedVCard,n=_.filter(t.TEL,function(e){return e.properties.waid}),i=_.filter(t.TEL,function(e){return!e.properties.waid}),r=_.map(n,function(t){var n=_.first(t.properties.waid),i=function(){return e.openChat(n)},a=s.createElement("span",{onClick:i,className:"icon icon-chat clickable"}),r=s.createElement("span",{className:"selectable-text"},o.formattedUser(n));return s.createElement(u,{title:r,icon:a,key:"vCard-"+t.index},l.getType(t))}),c=_.map(t.EMAIL,function(t){return s.createElement(u,{title:t.value,onClick:function(){return e.sendEmail(t.value)},key:"vCard-"+t.index},l.getType(t))}),d=_.map(t.ADR,function(t){var n=a(t.value);return s.createElement(u,{title:n,onClick:function(){return e.openLocation(t.value)},key:"vCard-"+t.index},l.getType(t))}),p=_.map(i,function(e){return s.createElement(u,{title:e.value,key:"vCard-"+e.index},l.getType(e))}),h=_.map(t.SERVICE,function(e){return s.createElement(u,{title:e.value,key:"vCard-"+e.index},l.getType(e))}),f=_.map(t.BDAY,function(e){return s.createElement(u,{title:l.getDate(e.value),key:"vCard-"+e.index},l10n.t("vcard_birthday"))}),m=_.map(t.NICKNAME,function(e){return s.createElement(u,{title:e.value,key:"vCard-"+e.index},l10n.t("vcard_nickname"))}),g=this.getHeader();return s.createElement("div",{className:this.props.className},s.createElement("div",null,g,s.createElement("div",{className:"drawer-item-container-compact"},r,c,d,p,f,m,h)))}});e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(77),o=i(r),l=n(62),c=n(468).prepRawMedia,u=n(1694),d=n(13),p={READY:"ready",PROCESSING:"processing",ERROR:"error"},h=(0,r.defineState)("AttachMedia",{props:{id:"number",file:"object",uiProcessed:"boolean"},session:{state:{type:"string",values:_.values(p)},media:"object",mediaPrep:"object",url:"string",name:"string",preview:"string",processPromise:"object",exception:"object",chat:"object",caption:"string",original:"object",generatedPreview:"object"},initialize:function(){o["default"].prototype.initialize.call(this),this.processFile(this.file)},processFile:function(e){var t=this;return this.state=p.PROCESSING,this.processPromise=s["default"].resolve(e).then(function(e){var n=void 0;n=e.isGifHackDoNotUse?{asGif:!0,gifAttribution:e.gifAttributionHackDoNotUse}:{};var i=c(e,n);return i.waitForPrep().then(function(e){return u.enrich(e)}).then(function(e){var n=e.media,a=e.documentPreview;t.set({media:n,mediaPrep:i,url:window.URL.createObjectURL(n.mediaBlob),name:n.filename,preview:n.preview,state:p.READY,generatedPreview:a})})})["catch"](d.MediaFileTooLarge,d.InvalidMediaFileType,d.MediaFileFailedLoad,d.MediaFileEmpty,function(e){return t.set({exception:e,state:p.ERROR}),t})["catch"](function(e){return t.set({exception:new d.InvalidMediaFileType,state:p.ERROR}),t})},getFileType:function(){return l.typeFromMimetype(this.file.type)},editImage:function(e){return this.getFileType()!==l.FILETYPE.IMAGE?null:(window.URL.revokeObjectURL(this.url),e.original=this.original||new f(this.toJSON()),this.set(e),void this.initialize())},revertImage:function(){if(this.getFileType()!==l.FILETYPE.IMAGE)return null;if(!this.original)return this;window.URL.revokeObjectURL(this.url);var e=this.original.toJSON();return e.original=null,this.set(e),this.initialize(),this}}),f=h.AttachMedia;f.STATE=p,e.exports=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BlocklistProxy=t["default"]=void 0;var i=n(77),a=(0,i.defineState)("Blocklist",{Collection:"Blocklist",session:{contact:"object"},props:{id:"string"},initialize:function(){this.addChild("contact",Store.Contact.gadd(this.id))}}),s=a.Blocklist,r=a.BlocklistProxy;t["default"]=s,t.BlocklistProxy=r},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.CallProxy=t["default"]=void 0;var a=n(77),s=i(a),r=n(1),o=n(10),l=(0,a.defineState)("Call",{Collection:"Call",props:{id:"string",type:"string",from:"string"},initialize:function(){s["default"].prototype.initialize.call(this),this.listenToAndRun(this,"change:type",this.updateNotification)},updateNotification:function(){r.log("call:"+this.type+" id:"+this.id+" from:"+this.from)(),"offer"===this.type||"offer_video"===this.type?o.alertCall(this.id,this.from,"offer_video"===this.type):o.cancelCall(this.id)}}),c=l.state,u=l.proxy;t["default"]=c,t.CallProxy=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(458),o=i(r),l=n(459),c=n(9),u=n(13),d=l.extend({model:o["default"],initialize:function(){l.prototype.initialize.call(this),this.hasDocBefore=!0},"delete":function(){l.prototype["delete"].call(this),this.stopListening(),this.reset()},queryDocs:function(e,t){var n=this;if(t)return this.queryDocBefore?this.queryDocBefore:(this.queryDocBefore=Store.Msg.queryMedia(t.id.remote,c.MEDIA_QUERY_LIMIT,"before",t.id,"document").then(function(e){return(!e||e.length<c.MEDIA_QUERY_LIMIT)&&(n.hasDocBefore=!1),n.add(e.filter(function(e){return e.isDoc}),{at:0}),{length:e.length}})["catch"](u.WapDrop,404,_.noop)["finally"](function(){n.queryDocBefore=null,n.trigger("query_doc_before")}),this.trigger("query_doc_before"),this.queryDocBefore);var i=e.msgs.models;if(0===this.length){if(!i||0===i.length)return new s["default"](function(e){e({eof:!0})});this.add(i.filter(function(e){return e.isDoc}),{at:0})}if(this.length<=2*c.MEDIA_QUERY_LIMIT){var a=0===this.length?_.head(i):this.head();return this.queryDocs(e,a)}return new s["default"](function(e){e({eof:!1})})}});e.exports=d},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(458),o=i(r),l=n(459),c=n(9),u=n(13),d=l.extend({model:o["default"],initialize:function(){l.prototype.initialize.call(this),this.hasLinkBefore=!0},comparator:function(e,t){return e.t-t.t},"delete":function(){l.prototype["delete"].call(this),this.stopListening(),this.reset()},queryLinks:function(e,t){var n=this;if(t)return this.queryLinkBefore?this.queryLinkBefore:(this.queryLinkBefore=Store.Msg.queryMedia(t.id.remote,c.MEDIA_QUERY_LIMIT,"before",t.id,"url").then(function(e){return(!e||e.length<c.MEDIA_QUERY_LIMIT)&&(n.hasLinkBefore=!1),n.add(e,{at:0}),n.createLinksAndAddMsgs(e),{length:e.length}})["catch"](u.WapDrop,404,_.noop)["finally"](function(){n.queryLinkBefore=null,n.trigger("query_link_before")}),this.trigger("query_link_before"),this.queryLinkBefore);var i=e.msgs.models;if(0===this.length){if(!i||0===i.length)return new s["default"](function(e){e({eof:!0})});this.add(i.filter(function(e){return e.hasLink}),{at:0}),this.createLinksAndAddMsgs(i)}if(this.length<=2*c.MEDIA_QUERY_LIMIT){var a=0===this.length?_.head(i):this.head();return this.queryLinks(e,a)}return new s["default"](function(e){e({eof:!1})})},createLinksAndAddMsgs:function(e){var t=this,n=[];s["default"].loop(function(t,i,a){e.length===a&&t();var s=e[a];s.createLinks(),s.links.length&&n.push(s)}).then(function(){t.add(n),t.trigger("query_link_before")})}});e.exports=d},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(458),o=i(r),l=n(459),c=n(9),u=n(13),d={before:"before",after:"after"},p=l.extend({model:o["default"],initialize:function(){l.prototype.initialize.call(this),this.hasMediaBefore=!0,this.hasMediaAfter=!0},"delete":function(){l.prototype["delete"].call(this),this.stopListening()},contains:function(e){return this.models.indexOf(e)>-1},getAfter:function(e){var t=this.models.indexOf(e);return 0>t||t===this.models.length-1?null:this.models[t+1]},getBefore:function(e){var t=this.models.indexOf(e);return 0>=t?null:this.models[t-1]},loadEarlierMedias:function(){var e=this.head();e&&this.queryMedia(null,e)},loadRecentMedias:function(){var e=this.last();e&&this.queryMedia(null,e,d.after)},loadMoreAroundIfNeeded:function(e){if(e){var t=this.models.indexOf(e);20>t&&this.hasMediaBefore&&this.loadEarlierMedias(),this.models.length-t<20&&this.hasMediaAfter&&this.loadRecentMedias()}},queryMedia:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d.before;if(!t){var a=e.msgs.models;if(!a||0===a.length)return new s["default"](function(e){e({eof:!0})});this.add(a.filter(function(e){return e.isMedia}),{at:0});var r=this.models;if(this.downloadMedias(r),r.length<=2*c.MEDIA_QUERY_LIMIT){var o=0===r.length?_.head(a):_.head(r);return this.queryMedia(e,o)}return new s["default"](function(e){e({eof:!1})})}return i===d.before?this.queryMediaBefore?this.queryMediaBefore:(this.queryMediaBefore=Store.Msg.queryMedia(t.id.remote,c.MEDIA_QUERY_LIMIT,i,t.isMedia?t.id:void 0).then(function(e){var t=e.messages;(!t||t.length<c.MEDIA_QUERY_LIMIT)&&(n.hasMediaBefore=!1);var i=[];return t&&t.length>0&&(i=t.filter(function(e){return e.isMedia}),n.downloadMedias(i)),n.add(i,{at:0}),{length:i.length}})["catch"](u.WapDrop,404,_.noop)["finally"](function(){n.queryMediaBefore=null,n.trigger("query_media_before")}),this.trigger("query_media_before"),this.queryMediaBefore):i===d.after?this.queryMediaAfter?this.queryMediaAfter:this.queryMediaAfter=Store.Msg.queryMedia(t.id.remote,c.MEDIA_QUERY_LIMIT,i,t.id).then(function(e){var t=e.messages;(!t||t.length<c.MEDIA_QUERY_LIMIT)&&(n.hasMediaAfter=!1);var i=[];return t&&t.length>0&&(i=t.filter(function(e){return e.isMedia}),n.downloadMedias(i)),n.add(i),{length:i.length}})["catch"](u.WapDrop,404,_.noop)["finally"](function(){n.queryMediaAfter=null,n.trigger("query_media_after")}):void 0},downloadMedias:function(e){_.forEach(e,function(e){e.downloadMedia()})}});e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(77),s=i(a),r=n(1402),o=n(1),l=(0,a.defineState)("ChatMsgs",{props:{pendingMsgs:"boolean"},session:{msgChunks:{type:"array","default":function(){return[]}},lastReceivedKey:"object",unreadMsgAnchor:"object",disableUnreadAnchor:"boolean",msgsLength:"number",msgsChanged:{type:"number","default":0}},collections:{msgs:r},initialize:function(){var e=this;s["default"].prototype.initialize.call(this),_.isFunction(this.onEmptyMRM)||o.error("states that extend ChatMsgs need to define onEmptyMRM()")(),this.listenTo(this.msgs,"change:last",function(){e.msgsChanged++}),this.listenTo(this.msgs,"add remove bulk_add",function(){e.msgsChanged++,e.msgsLength=e.msgs.length})},"delete":function(e){s["default"].prototype["delete"].call(this),this.getAllCMCs().forEach(function(e){e["delete"]()})},removeMsg:function(e){var t=e.msgChunk;if(t){var n=t.indexOf(e);0>n||(o.log("models:Chat:removeMsg "+e.get("id"))(),t.remove(e),0===t.length&&(t===this.msgs?this.onEmptyMRM():this.removeMsgsCollection(t)))}},getAllCMCs:function(){return this.msgChunks.concat([this.msgs])},getAllMsgs:function(){return _.flatten(this.getAllCMCs().map(function(e){return e.models}))},replaceMsgsCollection:function(e){o.info("model:Chat:replaceMsgsCollection:"+this.id)(),this.msgs.replace(e),this.notifyMsgCollectionMerge(e,this.msgs,this.msgs),this.msgChunks=_.without(this.msgChunks,e),e["delete"]()},removeMsgsCollection:function(e){this.msgChunks=_.without(this.msgChunks,e),e["delete"]()},notifyMsgCollectionMerge:function(e,t,n){this.trigger("change:cmc:merge",e,t,n)}}),c=l.ChatMsgs;e.exports=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatPreferenceProxy=t["default"]=void 0;var i=n(77),a=(0,i.defineState)("ChatPreference",{Collection:"ChatPreference",props:{id:"string",wallpaperColor:"string"}}),s=a.ChatPreference,r=a.ChatPreferenceProxy;t["default"]=s,t.ChatPreferenceProxy=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EmojiVariantProxy=t["default"]=void 0;var i=n(77),a=(0,i.defineState)("EmojiVariant",{props:{id:"string","char":"string",variant:"string"},initialize:function(e){this.id=e.id||e["char"]}}),s=a.EmojiVariant,r=a.EmojiVariantProxy;t["default"]=s,t.EmojiVariantProxy=r},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(458),o=i(r),l=n(459),c=n(13),u=n(61),d=100,p=l.extend({model:o["default"],initialize:function(){var e=this;l.prototype.initialize.call(this),this.hasMoreMsgs=!0,this.resultPage=0,this.listenTo(Store.Msg,"remove_msgs",function(t){var n=e.remove(t,{silent:!0});n&&e.trigger("bulk_remove")}),this.listenTo(Store.Chat,"remove",function(t){var n=[];e.forEach(function(e){e.chat===t&&n.push(e)});var i=e.remove(n,{silent:!0});i&&e.trigger("bulk_remove")})},"delete":function(e){e&&this.stopListening(),l.prototype["delete"].call(this)},resetSearch:function(e){this.hasMoreMsgs=!0,this.resultPage=0,this.searchTerm=e,this.searchPromise&&this.searchPromise.cancel()},search:function(e,t){var n=this;if(this.searchTerm!==e&&(this.searchTerm&&0===e.indexOf(this.searchTerm)||(this.searchTerm=e,this["delete"]()),this.resultPage=0,this.hasMoreMsgs=!0),this.searchPromise){if(this.searchTerm===e)return this.searchPromise;this.searchPromise.cancel()}var i=void 0;return i=t?t.fts(e,++this.resultPage,d):Store.Msg.search(e,++this.resultPage,d),this.searchPromise=i.cancellable().then(function(t){u.supportsFeature(u.F.FTS_PAGINATION)&&!t.eof||(n.hasMoreMsgs=!1),n.searchTerm!==e&&n["delete"](),n.searchTerm=e,n.add(t.messages)})["catch"](c.WapDrop,s["default"].CancellationError,_.noop)["finally"](function(){n.searchPromise=null})}});e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.MsgInfoProxy=t["default"]=void 0;var a=n(77),s=i(a),r=n(237),o=i(r),l=n(483),c=n(239),u=n(474),d=(0,a.defineState)("Participant",{props:{id:"string",t:"number"},session:{contact:"object"},initialize:function(){s["default"].prototype.initialize.call(this),this.addChild("contact",Store.Contact.gadd(this.id))},getCollection:function(){return this.collection}}),p=d.Participant,h=c.extend(u,{model:p,comparator:function(e,t){return o["default"].Comparator(e.contact,t.contact)},isStateStale:function(e){var t=this.get(e);return t&&t.stale}}),f=(0,a.defineState)("MsgInfo",{Collection:"MsgInfo",props:{id:"msgKey",isPTT:"boolean",playedRemaining:{type:"number","default":0},readRemaining:{type:"number","default":0},deliveryRemaining:{type:"number","default":0}},collections:{played:h,read:h,delivery:h},derived:{settled:{deps:["isPTT","playedRemaining","readRemaining"],fn:function(){return this.isPTT?!this.playedRemaining:!this.readRemaining}}}},l),m=f.MsgInfo,g=f.MsgInfoProxy;t["default"]=m,t.MsgInfoProxy=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RecentEmojiProxy=t["default"]=void 0;var i=n(77),a=(0,i.defineState)("RecentEmoji",{props:{id:"string","char":"string",weight:"number"},initialize:function(e){this.id=e.id||e["char"]}}),s=a.RecentEmoji,r=a.RecentEmojiProxy;t["default"]=s,t.RecentEmojiProxy=r},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(458),s=i(a),r=n(1370),o=i(r),l=n(113),c=n(18),u=i(c),d=n(1371),p=i(d),h=n(8),f=n(10),m=n(233),g=n(1489),v=n(466),y=n(1385),_=n(1443),E=n(61),S=n(156),M=h.createClass({displayName:"MultiselectBar",mixins:[S],propTypes:{chat:h.PropTypes.instanceOf(o["default"]).isRequired,selectedMessages:h.PropTypes.instanceOf(y).isRequired,onCancel:h.PropTypes.func.isRequired,noSortOnForward:h.PropTypes.bool,downloadButton:h.PropTypes.bool,toastPosition:h.PropTypes.oneOf(u["default"].values(l.ActionToast.POSITION))},getDefaultProps:function(){return{downloadButton:!0}},componentWillMount:function(){var e=this;u["default"].forEach(this.props.selectedMessages.getSelected(),function(t){e.addObserver(t,"change:star")}),this.addObserver(this.props.selectedMessages,"all"),this.addObserver(Store.Msg,"change:star",this.onStarChanged)},onStarChanged:function(e){this.props.selectedMessages.isSelected(e)&&this.setState({})},onStarSelected:function(){var e=this.props,t=e.chat,n=e.selectedMessages,i=e.toastPosition,a=n.getSelected();f.sendStarMsgs(t,a,null,i),this.props.onCancel()},onUnstarSelected:function(){var e=this.props,t=e.chat,n=e.selectedMessages,i=e.toastPosition,a=n.getSelected();f.sendUnstarMsgs(t,a,null,i),this.props.onCancel()},onDownloadSelected:function(){var e=u["default"].filter(this.props.selectedMessages.getSelected(),function(e){return e.mediaData&&e.mediaData.renderableUrl});e.length&&(v.initDownload(e),this.props.onCancel())},onDeleteSelected:function(){var e=this,t=this.props,n=t.chat,i=t.selectedMessages,a=t.toastPosition,s=i.getSelected(),r=function(){f.closeModal(),f.sendDeleteMsgs(n,s,null,a),e.props.onCancel()},o=u["default"].size(s),l=l10n.t("delete_message_confirmation",{count:o,_plural:o});f.openModal(h.createElement(m,{onOK:r,okText:l10n.t("web_delete"),onCancel:f.closeModal.bind(f),cancelText:l10n.t("web_cancel")},h.createElement(p["default"],{text:l})))},onRevokeSelected:function(){var e=this.props,t=e.chat,n=e.selectedMessages,i=e.toastPosition,a=n.getSelected();f.openModal(h.createElement(g,{chat:t,msgList:a,toastPosition:i,onCancel:this.props.onCancel}))},onForwardSelected:function(){var e=this,t=this.props.selectedMessages.getSelected();this.props.noSortOnForward||(t=this.props.chat.sortMsgs(t));var n=u["default"].size(t),i=function(){e.props.onCancel()},a=u["default"].filter(t,function(e){return e.canForward()});if(u["default"].size(a))if(n!==u["default"].size(a)){var s=function(){f.openModal(h.createElement(_,{msgs:a,onForward:i}),"modal-flow")};f.openModal(h.createElement(m,{title:l10n.t("confirm_forward_partial_messages_title"),onOK:s,okText:l10n.t("forward"),onCancel:f.closeModal.bind(f),cancelText:l10n.t("web_cancel")},l10n.t("confirm_forward_partial_messages_text")))}else f.openModal(h.createElement(_,{msgs:t,onForward:i}),"modal-flow");else f.openModal(h.createElement(m,{title:l10n.t("err_unsent_forward_title"),onOK:f.closeModal.bind(f),okText:l10n.t("web_ok")},l10n.t("err_unsent_forward_text",{count:n,_plural:n})))},render:function(){var e=this.props.selectedMessages.getSelected(),t=u["default"].size(e),n=E.supportsFeature(E.F.ENC_DOC)||u["default"].every(e,function(e){return e.type!==s["default"].TYPE.DOCUMENT}),i=u["default"].some(e,function(e){return e.canForward()}),a=u["default"].some(e,function(e){return e.mediaData&&e.mediaData.renderableUrl}),r=h.createElement("button",{className:"btn-icon btn-forward",disabled:t&&n&&i?null:"disabled",title:l10n.t("forward_message",{count:t,_plural:t}),onClick:this.onForwardSelected},h.createElement("span",{className:"icon icon-forward"})),o=void 0;E.supportsFeature(E.F.MESSAGE_DELETE)&&(o=h.createElement("button",{className:"btn-icon btn-delete",disabled:t?null:"disabled",title:l10n.t("delete_message",{count:t,_plural:t}),onClick:this.onDeleteSelected},h.createElement("span",{className:"icon icon-delete"})));var l=void 0;if(E.supportsFeature(E.F.STARRED)){var c=void 0,d=void 0,p=void 0;t&&u["default"].every(e,"star")?(c=this.onUnstarSelected,d=h.createElement("span",{className:"icon icon-unstar-btn"}),p=l10n.t("unstar_message",{count:t,_plural:t})):(c=this.onStarSelected,d=h.createElement("span",{className:"icon icon-star-btn"}),p=l10n.t("star_message",{count:t,_plural:t})),l=h.createElement("button",{className:"btn-icon btn-star",disabled:t?null:"disabled",title:p,onClick:c},d)}var f=void 0;if(E.supportsFeature(E.F.REVOKE)){var m=l10n.t("revoke_message",{count:t,_plural:t});f=t?u["default"].every(e,function(e){return e.canRevoke()})?h.createElement("button",{className:"btn-icon",title:m,onClick:this.onRevokeSelected},h.createElement("span",{className:"icon icon-x-danger"}),";"):null:h.createElement("button",{className:"btn-icon",disabled:"disabled",title:m},h.createElement("span",{className:"icon icon-x-danger"}),";")}var g=Modernizr.adownload&&this.props.downloadButton?h.createElement("button",{className:"btn-icon",disabled:t&&a?null:"disabled",title:l10n.t("web_button_download"),onClick:this.onDownloadSelected},h.createElement("span",{className:"icon icon-download"})):null;return h.createElement("div",{className:"multi-controls"},h.createElement("button",{className:"btn-icon btn-cancel",onClick:this.props.onCancel},h.createElement("span",{className:"icon icon-x"})),h.createElement("span",{className:"multi-count"},l10n.t("selected_count",{count:t,_plural:t})),l,o,f,r,g)}});e.exports=M},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(8),m=i(f),g=n(1378),v=i(g),y=n(1391),_=(i(y),n(1690)),E=i(_),S=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){var e=this.props.statusV3;return m["default"].createElement("div",{className:"status-image-container",onClick:this.props.onClick},m["default"].createElement(E["default"],{statusV3:e}),m["default"].createElement(M,{renderedThumbnail:e.renderedThumbnail}))}}]),t}(f.PureComponent);S.CONCERNS={statusV3:["unreadCount","totalCount","renderedThumbnail"]};var M=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentWillMount",value:function(){var e=this.props.renderedThumbnail;e&&e.retain()}},{key:"componentWillReceiveProps",value:function(e){var t=this.props.renderedThumbnail,n=e.renderedThumbnail;t!==n&&(t&&t.autorelease(),n&&n.retain())}},{key:"componentWillUnmount",value:function(){var e=this.props.renderedThumbnail;e&&e.autorelease()}},{key:"render",value:function(){var e=this.props.renderedThumbnail,t={backgroundImage:e&&"url("+e.url()+")"};return m["default"].createElement("div",{className:"status-image",style:t})}}]),t}(f.PureComponent);t["default"]=(0,v["default"])(S)},function(e,t){"use strict";var n=window.matchMedia("\nonly screen and (max-width: 1024px)\n"),i={column:n.matches?2:3},a=function(e){var t=e.matches?2:3;if(i.column!==t){i.column=t;var n=document.createEvent("Event");n.initEvent("columnChange",!0,!0),window.dispatchEvent(n)}};n.addListener(a),e.exports=i},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(464),o=n(13),l={getFiles:function(e,t){var n=e.target.files||e.dataTransfer.files;if(n=_.map(n,function(e,t){return e}),n.length)return s["default"].resolve(n);if(e.dataTransfer.getData("text/uri-list"))return r.urlToFile(e.dataTransfer.getData("text/uri-list")).then(function(e){return[e]});if(e.dataTransfer.getData("text/html")){var i=new DOMParser,a=i.parseFromString(e.dataTransfer.getData("text/html"),"text/html");if(a.createNodeIterator(a.childNodes[0],NodeFilter.SHOW_TEXT).nextNode()){if(e.dataTransfer.getData("text/plain")&&!t)return s["default"].reject(new o.MediaDragDropError("dropped html has text nodes",e.dataTransfer.getData("text/plain")))}else{var l=a.getElementsByTagName("img");if(l.length)return r.urlToFile(l[0].src).then(function(e){return[e]})}}return s["default"].resolve(n)}};e.exports=l},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){var t=E["default"].keys(e).map(E["default"].escapeRegExp).join("|");return new RegExp("("+t+")","g")}Object.defineProperty(t,"__esModule",{value:!0});var s=n(35),r=i(s),o=n(16),l=i(o),c=n(4),u=i(c),d=n(6),p=i(d),h=n(20),f=i(h),m=n(19),g=i(m),v=n(8),y=i(v),_=n(18),E=i(_),S=n(1430),M=i(S),C=n(1415),b=i(C),T=n(1707),P=i(T),k=function(e){function t(){return(0,u["default"])(this,t),(0,f["default"])(this,(t.__proto__||(0,l["default"])(t)).apply(this,arguments))}return(0,g["default"])(t,e),(0,p["default"])(t,null,[{key:"match",value:function(e,t){if(!t)return[];var n=a(t),i=(0,M["default"])(e,n);return i.map(function(e){var n=(0,r["default"])(e[4],1),i=n[0];return e[4]=t[i],e})}},{key:"jsx",value:function(e,t){var n=t.jid,i=t.display;return y["default"].createElement(P["default"],{jid:n,display:i})}}]),t}(b["default"]);t["default"]=k},function(e,t,n){
"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){return s(e,(0,c["default"])(t))}function s(e,t){var n=(0,d["default"])(e,t);return n.length?(0,h["default"])(e,(0,o["default"])(n,t),t):{children:[{type:"text",value:e}]}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=a,t._parse=s;var r=n(1718),o=i(r),l=n(1719),c=i(l),u=n(1720),d=i(u),p=n(1721),h=i(p)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(1723);Object.defineProperty(t,"JSXSerializer",{enumerable:!0,get:function(){return i(a)["default"]}});var s=n(1725);Object.defineProperty(t,"TextSerializer",{enumerable:!0,get:function(){return i(s)["default"]}});var r=n(1726);Object.defineProperty(t,"UnformatSerializer",{enumerable:!0,get:function(){return i(r)["default"]}})},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){return c.hasOwnProperty(e)?c[e]:c[e]=r["default"].props({url:e,data:l["default"].queryLinkPreview(e)})}Object.defineProperty(t,"__esModule",{value:!0});var s=n(2),r=i(s);t["default"]=a;var o=n(46),l=i(o),c={}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t,n){var i=e.models;if(n===S.BEFORE){var a=function(){var e=0;return{v:{hasNext:function(){return t>=e},next:function(){return i[t--]}}}}();if("object"==typeof a)return a.v}else{if(n!==S.AFTER)throw new Error("RendorCursor:invalid direction");var s=function(){var e=i.length-1;return{v:{hasNext:function(){return e>=t},next:function(){return i[t++]}}}}();if("object"==typeof s)return s.v}}function s(e,t,n){for(var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=P*i,r=a(e,t,n),o=0,c=0,u=void 0;r.hasNext();){var d=r.next(),p=l(d),h=2*d.isNotification+d.isSentByMe,f=h&&h===u?M:C;if(o+=p+f,c++,o>s)break;u=h}return c}function r(e,t,n){for(var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=P*i,r=a(e,t,n),o=0,c=0,u=void 0;r.hasNext();){var d=r.next(),p=l(d),h=d.author||(d.isSentByMe?Store.Conn.me:void 0),f=h&&!d.isSentByMe&&h!==u?b:0,m=h&&h===u?M:C;if(o+=p+f+m,c++,o>s)break;u=h}return c}function o(e,t,n){for(var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=P*i,r=a(e,t,n),o=0,c=0;r.hasNext();){var u=r.next(),d=l(u);if(o+=d+T,c++,o>s)break}return c}function l(e){var t=0;switch(e.quotedMsg&&(t+=54),e.caption&&(t+=31),e.type){case g["default"].TYPE.NOTIFICATION:case g["default"].TYPE.GROUP_NOTIFICATION:case g["default"].TYPE.GP2:case g["default"].TYPE.BROADCAST_NOTIFICATION:case g["default"].TYPE.E2E_NOTIFICATION:case g["default"].TYPE.CALL_LOG:case g["default"].TYPE.CIPHERTEXT:case g["default"].TYPE.REVOKED:case g["default"].TYPE.CHAT:e.linkPreview&&(t+=53);var n=E(e.body).length;return t+19*_.ceil(n/100)+13;case g["default"].TYPE.IMAGE:return t+e.fullWidth&&e.fullHeight?Math.floor(Math.min(330/e.fullWidth*e.fullHeight,330)):330;case g["default"].TYPE.VIDEO:case g["default"].TYPE.AUDIO:return e.isGif?t+137:t+166;case g["default"].TYPE.LOCATION:return t+v.PREVIEW_HEIGHT;case g["default"].TYPE.PTT:return t+67;case g["default"].TYPE.VCARD:return t+74;case g["default"].TYPE.DOCUMENT:return t+188;case g["default"].TYPE.UNKNOWN:default:return t}}function c(e){switch(e){case y.RENDOR_CURSOR.CONVERSATION:case y.RENDOR_CURSOR.GROUP_CONVERSATION:return y.RENDOR_CURSOR.RECENT_AT_BOTTOM;case y.RENDOR_CURSOR.STARRED_DRAWER:return y.RENDOR_CURSOR.RECENT_AT_TOP;default:return y.RENDOR_CURSOR.RECENT_AT_BOTTOM}}function u(e){switch(e){case y.RENDOR_CURSOR.CONVERSATION:return s;case y.RENDOR_CURSOR.GROUP_CONVERSATION:return r;case y.RENDOR_CURSOR.STARRED_DRAWER:return o;default:return s}}var d=n(4),p=i(d),h=n(6),f=i(h),m=n(458),g=i(m),v=n(1473),y=n(9),E=n(1464),S={BEFORE:"before",AFTER:"after"},M=2,C=12,b=19,T=65,P=window.innerHeight,k=_.debounce(function(e){P=window.innerHeight},500);window.addEventListener("resize",k);var N=function(){function e(t,n,i){var a=this;(0,p["default"])(this,e);var s=u(i);this.msgCollection=t,this.type=i,this.dir=c(i),this.cursorSize=function(e,t){if(e===S.BEFORE)return s(a.msgCollection,a.start-1,e,t);if(e===S.AFTER)return s(a.msgCollection,a.end,e,t);throw new Error("RendorCursor:invalid direction")},this.init(n)}return(0,f["default"])(e,[{key:"init",value:function(e){return this.before=0,this.after=0,this.prevKey=void 0,this.msgKey=e,this.loadBefore(void 0,1),this.loadAfter(void 0,1),this}},{key:"setKey",value:function(e){var t=this.index;this.msgKey=e;var n=this.index;return e?(this.after=this.after-(n-t),this.before=this.before+(n-t)):(this.before+=this.after,this.after=0),this.updatePrev(),this}},{key:"onRemove",value:function(e){e.id===this.prevKey?this.updatePrev():e.id===this.msgKey&&this.focusBefore()}},{key:"updatePrev",value:function(){this.prevKey=this.index>0?this.msgCollection.models[this.index-1].id:void 0}},{key:"focusBefore",value:function(){this.msgKey=this.prevKey,this.updatePrev()}},{key:"hasBefore",value:function(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return this.index-this.before>0}},{key:"loadBefore",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=e||this.cursorSize(S.BEFORE,t);return this.before+=n,this}},{key:"hasAfter",value:function(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return this.index+this.after<this.msgCollection.length-1}},{key:"loadAfter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=e||this.cursorSize(S.AFTER,t);return this.after+=n,this}},{key:"index",get:function(){if(this.msgKey){var e=this.msgCollection.get(this.msgKey),t=this.msgCollection.indexOf(e);if(-1!==t)return t}return this.dir===y.RENDOR_CURSOR.RECENT_AT_TOP?0:this.msgCollection.length-1}},{key:"start",get:function(){return Math.max(this.index-this.before,0)}},{key:"end",get:function(){return Math.min(this.index+this.after+1,this.msgCollection.length)}}]),e}();e.exports=N},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=!1;try{var i={get passive(){n=!0}};window.addEventListener("test",null,i)}catch(a){}t["default"]=n},function(e,t,n){function i(e){return n(a(e))}function a(e){var t=s[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}var s={"./de/translation.json":1741,"./en/translation.json":1742,"./es/translation.json":1743,"./it/translation.json":1744,"./pt/translation.json":1745,"./ru/translation.json":1746};i.keys=function(){return Object.keys(s)},i.resolve=a,e.exports=i,i.id=1514},,function(e,t,n){"use strict";var i=n(8),a=n(10),s=n(93),r=n(92),o=i.createClass({displayName:"ActionListener",mixins:[s],componentWillMount:function(){this.regCmd("mute_chat",this.onMute),this.regCmd("delete_or_exit_chat",this.onDeleteOrExit),this.regCmd("archive_chat",this.onArchive),this.regCmd("clear_chat_msgs",this.onClear),this.regCmd("mark_chat_unread",this.onMarkUnread),this.regCmd("pin_chat",this.onPin)},onMute:function l(e,t){if(t){var s=n(1648),l=function(t){e.pendingAction++,e.mute.mute(t,!0)["finally"](function(){e.pendingAction--})};a.openModal(i.createElement(s,{chat:e,onMute:l}),"modal",this.context.uim)}else e.pendingAction++,e.mute.unmute(!0)["finally"](function(){e.pendingAction--})},onDeleteOrExit:function(e){var t=n(1633),s=function(t){e.pendingAction++,t["finally"](function(){e.pendingAction--})};a.openModal(i.createElement(t,{chat:e,onDeleteOrExit:s}),"modal",this.context.uim)},onPin:function(e,t){e.pendingAction++,e.setPin(t)["catch"](_.noop)["finally"](function(){e.pendingAction--})},onClear:function(e){var t=n(1628);a.openModal(i.createElement(t,{chat:e}),"modal",this.context.uim)},onArchive:function(e,t){e.pendingAction++,e.setArchive(t)["catch"](_.noop)["finally"](function(){e.pendingAction--})},onMarkUnread:function(e,t){e.pendingAction++,e.markUnread(t)["finally"](function(){e.pendingAction--})},render:function(){return null}});o.contextTypes={uim:i.PropTypes.instanceOf(r)},e.exports=o},function(e,t,n){"use strict";var i=n(8),a=n(116).MIMETYPES,s=_.pickBy(a,function(e){return"audio"===e.msgType}),r=i.createClass({displayName:"AttachMediaTypeAudio",propTypes:{mimeType:i.PropTypes.oneOf(_.keys(s)).isRequired,url:i.PropTypes.string.isRequired},render:function(){var e=this.props,t=e.mimeType,n=e.url;return i.createElement("div",{className:"media-element-container"},i.createElement("div",{className:"media-element"},i.createElement("audio",{controls:!0,type:t,src:n})))}});e.exports=r},function(e,t,n){"use strict";var i=n(8),a=n(1390),s=n(1432),r=i.createClass({displayName:"AttachMediaTypeDoc",propTypes:{preview:i.PropTypes.object,mimeType:i.PropTypes.string,filename:i.PropTypes.string},render:function(){var e=this.props.preview;return e?i.createElement("div",{className:"media-element-pdf-container"},i.createElement("div",{className:"media-element-pdf-preview"},i.createElement(a,{type:a.TYPES.SCALE_DOWN,size:{width:e.width,height:e.height}},i.createElement("img",{src:e.url,className:"media-viewer-img"})))):i.createElement(s,{mimeType:this.props.mimeType,filename:this.props.filename})}});e.exports=r},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(112),s=i(a),r=n(8),o=n(1390),l=n(116).MIMETYPES,c=_.pickBy(l,function(e){return"image"===e.msgType||"video"===e.msgType}),u=r.createClass({displayName:"AttachMediaTypeMedia",propTypes:{mimeType:r.PropTypes.oneOf(_.keys(c)).isRequired,url:r.PropTypes.string.isRequired,isGif:r.PropTypes.bool,size:r.PropTypes.shape({width:r.PropTypes.number,height:r.PropTypes.number})},render:function(){var e=this.props,t=e.mimeType,n=e.url,i=e.size,a=void 0;if("image"===c[t].msgType)a=r.createElement("img",{src:n,className:"media-viewer-img"});else if("video"===c[t].msgType){var l=this.props.isGif?{loop:!0,autoPlay:!0,muted:!1,controls:!1}:{};a=r.createElement("video",(0,s["default"])({controls:!0,className:"media-viewer-img",type:t},l,{src:n}))}else"audio"===c[t].msgType&&(a=r.createElement("audio",{controls:!0,className:"media-viewer-audio",type:t,src:n}));return r.createElement("div",{className:"media-element-container"},r.createElement("div",{className:"media-element"},r.createElement(o,{type:o.TYPES.SCALE_DOWN,size:i},a)))}});e.exports=u},function(e,t,n){"use strict";var i=n(8),a=n(1390),s=n(1432),r=i.createClass({displayName:"AttachMediaTypePdf",propTypes:{preview:i.PropTypes.object,mimeType:i.PropTypes.string,filename:i.PropTypes.string},componentWillUnmount:function(){},render:function(){var e=this.props.preview;if(e){var t=l10n.t("attach_document_pdf_total_pages",{count:e.pdfPages,_plural:e.pdfPages});return i.createElement("div",{className:"media-element-pdf-container"},i.createElement("div",{className:"media-element-pdf-preview"},i.createElement(a,{type:a.TYPES.SCALE_DOWN,size:{width:e.width,height:e.height}},i.createElement("img",{src:e.url,className:"media-viewer-img"}))),i.createElement("div",{className:"media-element-pdf-caption"},t))}return i.createElement(s,{mimeType:this.props.mimeType,filename:this.props.filename})}});e.exports=r},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(115),s=i(a),r=n(470),o=i(r),l=n(8),c=n(1),u=n(54),d=n(243),p=n(15),h=n(165),f=n(41),m=n(55),g=n(0),v=n(40),y=n(156),E=n(93),S=n(160),M=n(9),C=n(10),b=n(44),T=n(110),P=n(1407),k=l.createClass({displayName:"ButterBar",mixins:[y,E],getInitialState:function(){var e=this;this._showNotifyTimer=new m(this.showPrompt),this._showBatteryTimer=new m(function(){return e.batteryUpdate()});var t=o["default"].battery<M.BATTERY_LOW_THRESHOLD_1?o["default"].battery<M.BATTERY_LOW_THRESHOLD_2?2:1:0;return{lowBatteryWarning:o["default"].plugged?0:t,notifyPermission:window.Notification&&window.Notification.permission,showNotify:!1}},componentWillMount:function(){this.addObserver(s["default"],"change:displayInfo"),this.addObserver(s["default"],"change:needsUpdate"),this.addObserver(s["default"],"change:needsManualDownload"),this.addObserver(o["default"],"change:plugged",this.batteryUpdate),this.addObserver(o["default"],"change:battery",this.batteryUpdate)},componentWillUnmount:function(){this._showNotifyTimer.cancel(),this._showBatteryTimer.cancel()},onReload:function(){d.restart()},onClickManualDownload:function(){},batteryUpdate:function(e){var t=this.state.lowBatteryWarning;o["default"].plugged||o["default"].battery>M.BATTERY_LOW_THRESHOLD_1?0!==t&&this.setState({lowBatteryWarning:0}):o["default"].battery<=M.BATTERY_LOW_THRESHOLD_2?-2!==t&&(e?this._showBatteryTimer.onOrBefore(M.BATTERY_DELAY):2!==t&&this.setState({lowBatteryWarning:2})):t>-1&&o["default"].battery<=M.BATTERY_LOW_THRESHOLD_1&&(e?this._showBatteryTimer.onOrBefore(M.BATTERY_DELAY):1!==t&&this.setState({lowBatteryWarning:1}))},dismissLowBatteryWarning:function(){var e=this.state.lowBatteryWarning;e>0&&this.setState({lowBatteryWarning:-e})},showPrompt:function(e){this.setState({showNotify:e})},guideConfirm:function(){C.closeModal()},guideLearnMore:function(){switch(u.browser){case M.BROWSER_TYPE.CHROME:return window.open("https://www.whatsapp.com/faq/web/28080004","_blank");case M.BROWSER_TYPE.FIREFOX:return window.open("https://www.whatsapp.com/faq/web/28080006","_blank");case M.BROWSER_TYPE.SAFARI:return window.open("https://www.whatsapp.com/faq/web/28080008","_blank");case M.BROWSER_TYPE.OPERA:return window.open("https://www.whatsapp.com/faq/web/28080007","_blank");default:return window.open("https://www.whatsapp.com/faq/web/28080004","_blank")}},requestPermissions:function(){C.openModal(l.createElement(P,{title:"guide_desktop_notifications_title",desc:"guide_desktop_notifications_description",onConfirm:this.guideConfirm,onCancel:this.guideLearnMore,type:P.TYPE.GUIDE_ALLOW}));var e=this;window.Notification.requestPermission(function(t){C.closeModal(),e.setState({notifyPermission:t})})},render:function(){var e=null;switch(s["default"].displayInfo){case s["default"].INFO.OFFLINE:e=l.createElement(x,{key:"bbar"});break;case s["default"].INFO.OPENING:case s["default"].INFO.CONNECTING:e=l.createElement(O,{key:"bbar"});break;case s["default"].INFO.NORMAL:break;case s["default"].INFO.RESUMING:case s["default"].INFO.TIMEOUT:var t=function(){window.open("http://www.whatsapp.com/faq/web/28080002")},n=l.createElement("span",null,l10n.t("make_sure_phone_active_internet_connection")," ",l.createElement("span",{className:"action",onClick:t},l10n.t("learn_more")));e=l.createElement(N,{type:"phone",key:"bbar",title:l10n.t("phone_not_connected"),text:n})}if(!e&&this.state.lowBatteryWarning>0&&(e=l.createElement(N,{type:"battery",key:"bbar",title:l10n.t("phone_battery_low"),text:l10n.t("charge_phone_description"),dismissable:!0,onDismiss:this.dismissLowBatteryWarning})),!e&&s["default"].needsUpdate&&(e=l.createElement(N,{type:"update",key:"bbar",title:l10n.t("update_available"),text:l10n.t("click_to_update_whatsapp_web"),action:this.onReload})),s["default"].needsManualDownload&&(e=l.createElement(N,{type:"update",key:"bbar",title:l10n.t("desktop_client_update_available"),text:l10n.t("click_to_download_desktop_client"),action:this.onClickManualDownload})),e)this.state.showNotify&&this._showNotifyTimer.onOrBefore(0,!1);else if(this.state.showNotify){if(window.Notification&&this.state.notifyPermission===M.PERMISSION_DEFAULT){var i=l.createElement("span",{className:"action",onClick:this.requestPermissions},l10n.t("enable_desktop_notifications"));e=l.createElement(N,{type:"notification",key:"bbar",title:l10n.t("get_notified_of_new_messages"),text:i})}}else this._showNotifyTimer.onOrBefore(M.NOTIFICATION_PROMPT_DELAY,!0);return l.createElement("div",{className:"butterbar-container"},l.createElement(T,{transitionName:"butterbar"},e))}}),N=l.createClass({displayName:"BB",propTypes:{type:l.PropTypes.oneOf(["computer","phone","notification","battery","update"]),title:l.PropTypes.node.isRequired,text:l.PropTypes.node,dismissable:l.PropTypes.bool,onDismiss:l.PropTypes.func,action:l.PropTypes.func},onClick:function(){this.props.action&&this.props.action()},render:function(){var e,t;switch(this.props.type){case"computer":case"phone":case"notification":case"battery":case"update":e="butterbar-"+this.props.type,t="icon-alert-"+this.props.type;break;default:c.log("butterbar:render invalid type")()}var n=b("butterbar",e,{action:this.props.action}),i=b("icon","icon-alert",t),a=this.props.dismissable?l.createElement("div",{className:"butterbar-controls"},l.createElement("button",{className:"icon icon-x-light",onClick:this.props.onDismiss})):null,s=this.props.text?l.createElement("div",{className:"butterbar-text"},this.props.text):null;return l.createElement("div",{className:"butterbar-wrapper"},l.createElement("div",{className:n,onClick:this.onClick},l.createElement("div",{className:"butterbar-icon"},l.createElement("span",{className:i})),l.createElement("div",{className:"butterbar-body"},l.createElement("div",{className:"butterbar-title"},this.props.title),s),a))}}),w=3e3,x=l.createClass({displayName:"Offline",mixins:[S],getInitialState:function(){return{allowReconnect:!0}},reconnect:function(){var e=h.numSocketsAttempted+1;p.poke(),v.waitForBBEvent(s["default"],"change:displayInfo",function(){return s["default"].displayInfo===s["default"].INFO.NORMAL}).then(function(){new f.WebcManualWebsocketAttempt({webcManualWebsocketAttemptSuccessful:h.numSocketsAttempted===e}).commit()}),this.setState({allowReconnect:!1}),this.reconnectTimeout=this.safeDelay(this.resetReconnectTimeout,w)},resetReconnectTimeout:function(){this.clearSafeTimeout(this.reconnectTimeout),delete this.reconnectTimeout,this.setState({allowReconnect:!0})},render:function(){var e,t;return this.state.allowReconnect?(e=l.createElement("span",null,l10n.t("make_sure_computer_active_internet_connection")+" ",l.createElement("span",{className:"action",onClick:this.reconnect},l10n.t("reconnect"))),t=l10n.t("computer_not_connected")):(e=null,t=l10n.t("connecting_to_whatsapp_or_phone")),l.createElement(N,{type:"computer",title:t,text:e})}}),O=l.createClass({displayName:"Resume",mixins:[y],getInitialState:function(){return{takingTooLong:!1,didShowSubtitle:!1}},componentWillMount:function(){this._timeoutTimer=new m(this.timedOut),this._intervalTimer=new m(this.onInterval),this.addObserver(p,"change:state",this.onProgress),this.addObserver(p,"change:retryTimestamp",this.onProgress)},componentDidMount:function(){this._timeoutTimer.onOrBefore(3e3)},componentWillUnmount:function(){this._timeoutTimer.cancel(),this._intervalTimer.cancel()},timedOut:function(){this._intervalTimer.onOrAfter(1e3),this.setState({takingTooLong:!0,didShowSubtitle:!0})},onProgress:function(){this._intervalTimer.cancel(),this._timeoutTimer.onOrBefore(3e3),this.setState({takingTooLong:!1})},onInterval:function(){this._intervalTimer.onOrAfter(1e3),this.setState({now:Date.now()})},retry:function(e){p.poke(),this.onProgress()},render:function(){var e,t;if(s["default"].displayInfo===s["default"].INFO.OPENING)e=l10n.t("connecting_to_whatsapp");else{if(s["default"].displayInfo!==s["default"].INFO.CONNECTING)return null;e=l10n.t("connecting_to_whatsapp_or_phone")}if(this.state.takingTooLong){var n=p.retryTimestamp-Date.now();if(1>n)n=l10n.t("retrying"),_.defer(function(){return p.poke()});else if(6e4>n){var i=Math.ceil(n/1e3);n=l10n.t("retrying_in_some_seconds",{number:i,_plural:i})}else n=l10n.t("retrying_in",{duration:g.duration(n).humanize()});t=l.createElement("span",null,n," ",l.createElement("span",{className:"action",onClick:this.retry},l10n.t("retry_now")))}else t=this.state.didShowSubtitle?l.createElement("span",null,l10n.t("retrying")):null;return l.createElement(N,{type:"computer",title:e,text:t})}});e.exports=k},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(8),m=i(f),g=n(1370),v=(i(g),n(1414)),y=(i(v),n(1378)),_=i(y),E=n(1527),S=i(E),M=n(1371),C=i(M),b=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){var e=this.props,t=e.chat,n=e.presence;if(n.isActive()){var i=n.getFormattedString();if(i)return m["default"].createElement("div",{className:"chat-status typing ellipsify",dir:"auto"},m["default"].createElement(C["default"],{ellipsify:!0,titlify:!0,text:i}))}var a=t.previewMessage;return a?m["default"].createElement(S["default"],{msg:a}):m["default"].createElement("div",{className:"chat-status"})}}]),t}(m["default"].PureComponent);b.displayName="ChatStateInfo",b.CONCERNS={chat:["previewMessage"],chatstate:["id","type"]},b.WEAK_CONCERNS={presence:["hasData","withholdDisplay"]};var T=(0,_["default"])(b);t["default"]=function(e){var t=e.chat;return m["default"].createElement(T,{chat:t,presence:t.presence,chatstate:t.presence.chatstate})}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1370),s=i(a),r=n(237),o=i(r),l=n(1408),c=i(l),u=n(8),d=n(156),p=n(1385),h=n(1386),f=n(1393),m=n(1394),g=n(159),v=u.createClass({displayName:"CheckboxChatWrapper",mixins:[d],propTypes:{chat:u.PropTypes.oneOfType([u.PropTypes.instanceOf(s["default"]),u.PropTypes.instanceOf(o["default"])]).isRequired,active:u.PropTypes.instanceOf(h).isRequired,selections:u.PropTypes.instanceOf(p).isRequired,onSelect:u.PropTypes.func.isRequired},getInitialState:function(){return{selected:this.props.selections.isSelected(this.props.chat)}},componentWillMount:function(){this.addObserver(this.props.selections,this.props.chat.id.toString(),this.onSelectChange)},onSelectChange:function(e){this.state.selected!==e&&this.setState({selected:e})},onSelect:function(){this.props.onSelect(this.props.chat,!this.state.selected)},render:function(){var e=this.props,t=e.chat,n=e.active,i=void 0;return i=t instanceof s["default"]?u.createElement(c["default"],{className:"chat-container",active:n,chat:t,mode:l.Mode.INFO,noContext:!0,onClick:this.onSelect}):u.createElement(f,{className:"chat-container",active:n,contact:t,onClick:this.onSelect,secondary:t.isBlocked()?g.t("confirm_unblock_contact_and_forward_text"):null}),u.createElement("div",{className:"checkbox-chat-wrapper"},u.createElement("div",{className:"checkbox-container-wrapper"},u.createElement(m,{onChange:this.onSelect,checked:this.state.selected})),i)}});e.exports=v},function(e,t,n){"use strict";var i=n(8),a=n(76),s=i.createClass({displayName:"ContactMsgInfoCell",propTypes:{title:i.PropTypes.string.isRequired,icon:i.PropTypes.node.isRequired,t:i.PropTypes.number},render:function(){var e=this.props,t=e.title,n=e.t,s=e.icon,r=n?a.relativeDateAndTimeStr(n):"-",o={cursor:"auto"};return i.createElement("div",{className:"contact chat contact-msg-info-cell",style:o},i.createElement("div",{className:"chat-body"},i.createElement("div",{className:"chat-main"},i.createElement("div",{className:"chat-title"},i.createElement("span",{className:"ellipsify",dir:"auto"},s,t))),i.createElement("div",{className:"chat-secondary"},i.createElement("div",{className:"chat-status ellipsify"},i.createElement("span",{className:"ellipsify",dir:"auto"},r)))))}});e.exports=s},function(e,t,n){"use strict";var i=n(8),a=n(1396),s=n(1379),r=n(76),o=n(1372),l=i.createClass({displayName:"GroupMsgInfoCell",mixins:[o],propTypes:{participant:i.PropTypes.instanceOf(Object).isRequired},getInitialState:function(){return{formattedName:this.async("participant.contact.formattedName")}},render:function(){var e=this.props.participant,t=i.createElement("div",{className:"chat-avatar"},i.createElement(s,{id:e.id})),n={cursor:"auto"};return i.createElement(a,{id:e.id,contextEnabled:function(){return!1},image:t,primary:this.state.formattedName,secondary:r.relativeDateAndTimeStr(e.t),style:n})}});e.exports=l},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(8),m=i(f),g=n(1370),v=(i(g),n(1447)),y=(i(v),n(1378)),_=i(y),E=n(159),S=i(E),M=n(110),C=function(e){function t(){var e,n,i,a;(0,o["default"])(this,t);for(var r=arguments.length,l=Array(r),c=0;r>c;c++)l[c]=arguments[c];return n=i=(0,d["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(l))),i.shouldAnimate=!1,a=n,(0,d["default"])(i,a)}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentWillUpdate",value:function(e){this.shouldAnimate=this.props.chat.id===e.chat.id}},{key:"render",value:function(){var e=this.props,t=e.chat,n=e.mute,i=n.isMuted?m["default"].createElement("span",{className:"icon icon-meta icon-muted",key:"icon-muted"}):null,a=t.pin?m["default"].createElement("span",{className:"icon icon-meta icon-pinned",key:"icon-pinned"}):null,s=0!==t.unreadCount?m["default"].createElement("span",{className:"icon-meta unread-count",key:"icon-unread"},t.unreadCount>0?S["default"].n(t.unreadCount):m["default"].createElement("span",null," ")):null,r=t.archive?m["default"].createElement("span",{className:"icon-meta chat-marker chat-marker-archived",key:"icon-archived"},S["default"].t("chat_archived")):null;return m["default"].createElement(M,{transitionName:"pop",transitionEnter:this.shouldAnimate,transitionLeave:this.shouldAnimate},i,r,a,s)}}]),t}(m["default"].PureComponent);C.CONCERNS={chat:["id","unreadCount","archive","pin"],mute:["isMuted"]},t["default"]=(0,_["default"])(C)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a,s,r=n(16),o=i(r),l=n(4),c=i(l),u=n(6),d=i(u),p=n(20),h=i(p),f=n(19),m=i(f),g=n(8),v=i(g),y=n(458),_=(i(y),n(1454)),E=i(_),S=n(54),M=i(S),C=n(159),b=i(C),T=n(1433),P=i(T),k=n(1417),N=i(k),w=n(1371),x=i(w),O=n(1384),D=n(1378),R=i(D);t["default"]=(0,R["default"])((s=a=function(e){function t(){return(0,c["default"])(this,t),(0,h["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"render",value:function(){var e=this.props.msg,t=[];e.isSentByMe&&t.push(v["default"].createElement(P["default"],{msg:e,key:"symbol"})),e.isSentByMe||!e.isGroupMsg||e.isNotification||t.push(v["default"].createElement(E["default"],{contact:e.senderObj,key:"author"}),v["default"].createElement("span",{className:"chat-status-divider",key:"divider"},":")),e.hasSymbol()&&t.push(v["default"].createElement(N["default"],{msg:e,key:"msg-symbol"})),t.push(v["default"].createElement(x["default"],{direction:e.dir,ellipsify:!0,text:e.msgText(!1),dirMismatch:e.dir&&e.rtl!==b["default"].isRTL(),formatters:O.Configuration.LastMessage(e.mentionMap()),key:"status"}));var n="chat-status";M["default"].isGecko&&(n+=" ellipsify");var i=b["default"].embedDir(e.msgText(e.rtl));return v["default"].createElement("div",{className:n,title:i},t)}}]),t}(v["default"].PureComponent),a.CONCERNS={msg:["isSentByMe","isGroupMsg","isNotification","senderObj","dir","rtl","type"]},s))},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(112),s=i(a),r=n(114),o=i(r),l=n(16),c=i(l),u=n(4),d=i(u),p=n(6),h=i(p),f=n(20),m=i(f),g=n(19),v=i(g),y=n(460),_=i(y),E=n(8),S=i(E),M=n(45),C=i(M),b=n(1396),T=i(b),P=n(1371),k=i(P),N=n(44),w=i(N),x=n(1403),O=i(x),D=n(54),R=i(D),I=n(91),A=i(I),L=n(1455),F=i(L),U=n(1417),j=i(U),G=n(458),B=i(G),H=n(1433),V=i(H),q=n(1454),W=i(q),z=n(111),Y=i(z),K=n(159),Q=i(K),X=n(1378),Z=i(X),J=n(1377),$=i(J),ee=n(1386),te=(i(ee),n(1384)),ne=n(18),ie=i(ne),ae=function(e){function t(){var e,n,i,a;(0,d["default"])(this,t);for(var s=arguments.length,r=Array(s),o=0;s>o;o++)r[o]=arguments[o];return n=i=(0,m["default"])(this,(e=t.__proto__||(0,c["default"])(t)).call.apply(e,[this].concat(r))),i.onActiveChange=function(e){if("focus"===e){var t=C["default"].findDOMNode(i);A["default"].focus(t),O["default"].scrollIntoViewIfNeeded(t)}i.setState({active:!!e})},i.onClick=function(e){if(ie["default"].isFunction(i.props.onClick)){var t=i.props,n=t.msg,a=t.chat,s=Store.Msg.get(n.id),r=a.getSearchContext(s);r.msg=s,i.props.onClick(e,Store.Chat.get(a.id),r)}},i.onMouseDown=function(e){0===e.button&&i.onClick(e)},i.onEnter=function(e){e.preventDefault(),e.stopPropagation(),Y["default"].flashFocus=Date.now(),i.onClick(e)},i.indicateFocus=function(e){if(!(Date.now()-(Y["default"].flashFocus||0)>200)){var t=C["default"].findDOMNode(i.refs.cell);(0,_["default"])(t,"stop"),(0,_["default"])(t,{backgroundColor:["#e9eaeb","#cbdde7"]},{duration:1300,easing:[.19,.69,.01,.99],complete:i.onBlur})}},i.onBlur=function(e){var t=C["default"].findDOMNode(i.refs.cell);t&&((0,_["default"])(t,"stop"),t.style.backgroundColor="")},a=n,(0,m["default"])(i,a)}return(0,v["default"])(t,e),(0,h["default"])(t,[{key:"componentWillMount",value:function(){this.initActiveListeners(this.props)}},{key:"componentWillReceiveProps",value:function(e){this.initActiveListeners(e,this.props)}},{key:"initActiveListeners",value:function(e,t){if(t){var n=t.listeners,i=t.active,a=t.msg;n.remove(i,a.id.toString(),this.onActiveChange)}var s=e.listeners,r=e.active,o=e.msg;e.active&&s.add(r,o.id.toString(),this.onActiveChange);var l=r&&r.value instanceof B["default"]&&r.value.id.equals(o.id);this.setState({active:l})}},{key:"render",value:function(){var e=this.props,t=e.msg,n=e.chat,i=[];t.isSentByMe&&i.push(S["default"].createElement(V["default"],{msg:t,key:"symbol"})),t.isSentByMe||!t.isGroupMsg||t.isNotification||i.push(S["default"].createElement(W["default"],{contact:t.senderObj,key:"author"}),S["default"].createElement("span",{className:"chat-status-divider",key:"divider"},":")),t.hasSymbol()&&i.push(S["default"].createElement(j["default"],{msg:t,key:"msg-symbol"}));var a=[];this.props.searchText&&(a=ie["default"].uniq(ie["default"].compact(ie["default"].split(ie["default"].toLower(this.props.searchText)," ")))),i.push(S["default"].createElement(k["default"],{direction:t.dir,ellipsify:!0,text:t.msgText(!1),dirMismatch:t.dir&&t.rtl!==Q["default"].isRTL(),formatters:te.Configuration.FTSMessage(t.mentionMap(),a),key:"status"}));var s=(0,w["default"])("chat-status",{ellipsify:R["default"].isGecko}),r=S["default"].createElement(F["default"],{msg:t}),o=Q["default"].embedDir(t.msgText(t.rtl)),l=S["default"].createElement("div",{className:s,title:o},i),c={enter:this.onEnter},u=(0,w["default"])("message",{active:!!this.state.active}),d=this.props.mouseDownAsClick;return S["default"].createElement(Y["default"],{handlers:c,onFocus:this.indicateFocus,onBlur:this.onBlur,className:"chat-drag-cover"},S["default"].createElement(T["default"],{id:t.id.toString(),ref:"cell",contextEnabled:function(){return!1},className:u,primary:n.title(),primaryDetail:r,secondary:l,onClick:d?null:this.onClick,onMouseDown:d?this.onMouseDown:null}))}}]),t}(S["default"].PureComponent);ae.CONCERNS={msg:["id","isSentByMe","isGroupMsg","isNotification","senderObj","dir","rtl","type"],chat:["id","formattedTitle"]};var se=(0,$["default"])((0,Z["default"])(ae));t["default"]=function(e){var t=e.msg,n=(0,o["default"])(e,["msg"]);return S["default"].createElement(se,(0,s["default"])({msg:t,chat:t.chat},n))}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1427),s=i(a),r=n(1371),o=i(r),l=n(8),c=n(1372),u=l.createClass({displayName:"Status",mixins:[c],propTypes:{status:l.PropTypes.instanceOf(s["default"])},getInitialState:function(){return{status:this.async("status.status")}},render:function(){var e=void 0,t=void 0;return _.isUndefined(this.state.status)?e=l.createElement("span",{className:"muted"},l10n.t("contact_status_loading")):(e=l.createElement(o["default"],{direction:"auto",ellipsify:!0,text:this.state.status}),t=this.state.status),l.createElement("div",{className:"chat-status",title:t},e)}});e.exports=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1370),o=i(r),l=n(159),c=i(l),u=n(1),d=i(u),p=n(13),h=i(p),f=n(113),m=n(8),g=n(10),v=n(93),y=n(92),E=m.createClass({
displayName:"ChatActionListener",mixins:[v],componentWillMount:function(){this.regCmd("chat_info_drawer",this.onChatInfoDrawer),this.regCmd("msg_info_drawer",this.onMsgInfoDrawer),this.regCmd("chat_search",this.onChatSearch),this.regCmd("attach_media_drawer",this.onAttachMediaDrawer),this.regCmd("verification_drawer",this.onVerificationDrawer),this.regCmd("media_viewer_modal",this.onMediaViewer),this.regCmd("send_star_msgs",this.onSendStarMsgs),this.regCmd("send_unstar_msgs",this.onSendUnstarMsgs),this.regCmd("send_delete_msgs",this.onSendDeleteMsgs),this.regCmd("send_revoke_msgs",this.onSendRevokeMsgs)},onChatInfoDrawer:function(e){var t=n(1479);g.openDrawerRight(m.createElement(t,{chat:e,key:"info-"+e.id}),"slide-left",this.context.uim)},onVerificationDrawer:function(e){var t=n(1663);g.openDrawerRight(m.createElement(t,{contact:Store.Contact.get(e),isFirstLevel:!0}),"slide-left",this.context.uim)},onMsgInfoDrawer:function(e){if(e.chat.kind===o["default"].KIND.CHAT){var t=n(1631);g.openDrawerRight(m.createElement(t,{msg:e}),"slide-left",this.context.uim)}else{var i=n(1641);g.openDrawerRight(m.createElement(i,{msg:e}),"slide-left",this.context.uim)}},onAttachMediaDrawer:function(e,t,i){var a=this;g.existsDrawerMid(function(s){if(!s){var r=n(1610),o=i||{};o.noFocus=!0,g.openDrawerMid(m.createElement(r,{chat:e,files:t}),"slide-up",a.context.uim,o)}})},onChatSearch:function(e){var t=n(1483);g.openDrawerRight(m.createElement(t,{chat:e}),"slide-left",this.context.uim)},onMediaViewer:function(e,t,i){if(Store.Msg.get(e.id)){var a=n(1615);g.openModalMedia(m.createElement(a,{msg:e,startTime:i,getZoomNode:t}),"media-viewer",this.context.uim)}else{var s=n(1399);g.openModal(m.createElement(s,{msg:e}))}},onSendStarMsgs:function(e,t,n){var i=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"left";if(!t)return s["default"].reject(new h["default"].ActionError);if(_.some(t,function(e){return!e.id}))return s["default"].reject(new h["default"].ActionError);n=n||f.ActionToast.genId();var r=_.size(t),o={count:r,_plural:r},l=new f.ActionType(c["default"].t("action_message_starring",o)),u=e.sendStarMsgs(t,!0).then(function(s){return 200===s.status?new f.ActionType(c["default"].t("action_message_starred",o),c["default"].t("action_undo"),i.onSendUnstarMsgs.bind(i,e,t,n,a)):s.status>=400?new f.ActionType(c["default"].t("action_message_star_failed",o)):void 0})["catch"](function(s){return d["default"].error("chatAction:sendStarMsgs dropped")(s),new f.ActionType(c["default"].t("action_message_star_failed",o),c["default"].t("action_try_again"),i.onSendStarMsgs.bind(i,e,t,n,a))});return g.openToast(m.createElement(f.ActionToast,{id:n,toastPosition:a,initialAction:l,pendingAction:u})),u},onSendUnstarMsgs:function(e,t,n){var i=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"left";if(!t)return s["default"].reject(new h["default"].ActionError);if(_.some(t,function(e){return!e.id}))return s["default"].reject(new h["default"].ActionError);n=n||f.ActionToast.genId();var r=_.size(t),o={count:r,_plural:r},l=new f.ActionType(c["default"].t("action_message_unstarring",o)),u=e.sendStarMsgs(t,!1).then(function(s){return 200===s.status?new f.ActionType(c["default"].t("action_message_unstarred",o),c["default"].t("action_undo"),i.onSendStarMsgs.bind(i,e,t,n,a)):s.status>=400?new f.ActionType(c["default"].t("action_message_unstar_failed",o)):void 0})["catch"](function(s){return d["default"].error("chatAction:sendUnstarMsgs dropped")(s),new f.ActionType(c["default"].t("action_message_unstar_failed",o),c["default"].t("action_try_again"),i.onSendUnstarMsgs.bind(i,e,t,n,a))});return g.openToast(m.createElement(f.ActionToast,{id:n,toastPosition:a,initialAction:l,pendingAction:u})),u},onSendDeleteMsgs:function(e,t,n,i){var a=this;if(!t)return s["default"].reject(new h["default"].ActionError);if(_.some(t,function(e){return!e.id}))return s["default"].reject(new h["default"].ActionError);var r=_.size(t);n=n||f.ActionToast.genId();var o={count:r,_plural:r},l=new f.ActionType(c["default"].t("action_message_deleting",o)),u=e.sendDeleteMsgs(t).then(function(e){return 200===e.status?new f.ActionType(c["default"].t("action_message_deleted",o)):e.status>=400?new f.ActionType(c["default"].t("action_message_delete_failed",o)):void 0})["catch"](function(s){return d["default"].error("chatAction:sendDeleteMsgs dropped")(s),new f.ActionType(c["default"].t("action_message_delete_failed",o),c["default"].t("action_try_again"),a.onSendDeleteMsgs.bind(a,e,t,n,i))});return g.openToast(m.createElement(f.ActionToast,{id:n,toastPosition:i,initialAction:l,pendingAction:u})),u},onSendRevokeMsgs:function(e,t,n,i,a){if(!t)return s["default"].reject(new h["default"].ActionError);if(_.some(t,function(e){return!e.canRevoke()}))return s["default"].reject(new h["default"].ActionError);var r=_.size(t);i=i||f.ActionToast.genId();var o={count:r,_plural:r},l=new f.ActionType(c["default"].t("action_message_revoking",o)),u=e.sendRevokeMsgs(t,n).then(function(e){return new f.ActionType(c["default"].t("action_message_revoked",o))})["catch"](function(e){return d["default"].error("chatAction:sendRevokeMsgs fail")(e),new f.ActionType(c["default"].t("action_message_revoke_failed",o))});return g.openToast(m.createElement(f.ActionToast,{id:i,toastPosition:a,initialAction:l,pendingAction:u})),u},render:function(){return null}});E.contextTypes={uim:m.PropTypes.instanceOf(y)},e.exports=E},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1371),s=i(a),r=n(18),o=i(r),l=n(8),c=n(159),u=n(1385),d=n(156),p=n(110),h=l.createClass({displayName:"ChatSelectorFooter",mixins:[d],propTypes:{selections:l.PropTypes.instanceOf(u).isRequired,onForward:l.PropTypes.func.isRequired},componentWillMount:function(){this.addObserver(this.props.selections,"all")},render:function(){var e=void 0;return o["default"].size(this.props.selections.getSelected())>0&&(e=l.createElement("div",{className:"drawer-controls-summary"},l.createElement(f,{chats:this.props.selections.getSelected()}),l.createElement("button",{className:"btn btn-round btn-l btn-action",onClick:this.props.onForward},l.createElement("span",{className:"icon icon-send-light"})))),l.createElement(p,{transitionName:"slide-up-down-footer",className:"drawer-controls-container"},e)}}),f=l.createClass({displayName:"SelectedChatsList",propTypes:{chats:l.PropTypes.array.isRequired},getInitialState:function(){return{chats:this.props.chats}},componentWillReceiveProps:function(e){var t=this.state.chats,n=e.chats;t=o["default"].size(n)>o["default"].size(t)?t.concat(o["default"].difference(n,t)):o["default"].intersection(t,n),this.setState({chats:t})},render:function(){var e=o["default"].map(this.state.chats,function(e){var t=e.isGroup?e.formattedTitle:e.formattedShortNameWithNonBreakingSpaces;return l.createElement(s["default"],{text:t,className:"list-comma-item",key:e.id})});return c.isRTL()||e.reverse(),l.createElement(p,{transitionName:"pop",className:"drawer-controls-summary-text"},e)}});e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(94),s=i(a),r=n(1460),o=i(r),l=n(1408),c=i(l),u=n(1370),d=i(u),p=n(1528),h=i(p),f=n(111),m=i(f),g=n(8),v=n(45),y=n(10),E=n(1421),S=n(156),M=n(93),C=n(158),b=n(1386),T=n(234),P=n(9),k=n(1393),N=n(61),w=0,x=1,O=2,D=3,R=g.createClass({displayName:"Chatlist",mixins:[S,M,C],propTypes:{isSearching:g.PropTypes.bool,searchText:g.PropTypes.string,chats:g.PropTypes.array,contacts:g.PropTypes.array,ftsResult:g.PropTypes.array,onClick:g.PropTypes.func,selection:g.PropTypes.instanceOf(b),onFocusSearch:g.PropTypes.func},getDefaultProps:function(){return{chats:[]}},getInitialState:function(){var e=this;this._listPointerEvents=!0,this.ftsStarred=this.getFTSStarred(),this.ftsMessages=this.getFTSMessages(),this.debouncedOpenSelected=_.debounce(function(){e.openSelected(e.focusComposer),e.focusComposer=!1},200);var t;return t=0,{textsize:t}},componentWillMount:function(){this.props.selection.init(this.getSelection())},componentWillReceiveProps:function(e){this.ftsStarred=this.getFTSStarred(e),this.ftsMessages=this.getFTSMessages(e)},componentWillUnmount:function(){var e=this.getSelection(),t=this.props.selection.getVal();t&&t.isState&&!this.props.isSearching&&!e.length&&y.clearChat(t)},componentDidMount:function(){var e=this;this.regCmd("focus_chat_list",this.restoreFocus),this.regCmd("focus_next_chat",this.onNextChat.bind(this,null,!0)),this.regCmd("focus_prev_chat",this.onPrevChat.bind(this,null,!0)),this.regCmd("update_chatlist_selection",this.updateSelected),this.regCmd("textsize_change",function(t){e.setState({textsize:t})})},componentDidUpdate:function(e,t){var n=this.props.selection.getVal();this.props.selection.init(this.getSelection(),!e.isSearching&&!this.props.isSearching),n!==this.props.selection.getVal()&&(this.focusComposer=!0,this.debouncedOpenSelected())},onListPointerEventsOff:function(){this._listPointerEvents=!1},onListPointerEventsOn:function(){this._listPointerEvents=!0},updateSelected:function(e){this.debouncedOpenSelected.cancel(),this.props.selection.setVal(e,!1)},openSelected:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!1,t=this.props.selection.getVal();t&&(t instanceof d["default"]&&t!==this.getActiveChat()?y.openChatFromUnread(t).then(function(n){n&&e&&y.focusChatTextInput(t)}):e&&y.focusChatTextInput(t))},onClick:function(e,t,n){var i=this;e.preventDefault(),e.stopPropagation(),Store.Chat.find(t.id).then(function(e){i.props.isSearching&&i.props.onClick&&i.props.onClick(),n?y.openChatAt(e,n).then(function(t){t&&y.focusChatTextInput(e)}):e!==i.getActiveChat()?y.openChatFromUnread(e).then(function(t){t&&y.focusChatTextInput(e)}):y.focusChatTextInput(e)})},getSelection:function(){return[].concat((0,s["default"])(this.props.chats),(0,s["default"])(this.props.contacts),(0,s["default"])(this.ftsStarred),(0,s["default"])(this.ftsMessages))},getFTSStarred:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props;return _.filter(e.ftsResult,{star:!0})},getFTSMessages:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props;return _.filter(e.ftsResult,{star:!1})},getSection:function(e){var t=this.props,n=t.chats,i=t.contacts,a=t.isSearching,s=[];return n.length>0&&s.push(w),a&&i.length>0&&s.push(x),this.ftsStarred.length>0&&s.push(O),this.ftsMessages.length>0&&s.push(D),s[e]},numberOfSections:function(){var e=this.props,t=e.contacts,n=e.chats,i=e.isSearching,a=n.length>0?1:0;return i?(t.length>0&&a++,N.supportsFeature(N.F.FULL_TEXT_SEARCH)?(this.ftsStarred.length>0&&a++,this.ftsMessages.length>0&&a++,a):a):a},numberOfRowsInSection:function(e){var t=this.props,n=t.contacts,i=t.chats;switch(this.getSection(e)){case w:return i.length;case x:return n.length;case O:return this.ftsStarred.length;case D:return this.ftsMessages.length;default:return 0}},sectionForSection:function(e){var t=this.props.isSearching;if(t)switch(this.getSection(e)){case w:return g.createElement(E,{key:"chat-header",header:l10n.t("web_chats")});case x:return g.createElement(E,{key:"contact-header",header:l10n.t("web_contacts")});case O:return g.createElement(E,{key:"fts-header-starred",header:l10n.t("web_starred_messages")});case D:return g.createElement(E,{key:"fts-header-messages",header:l10n.t("web_messages")})}},keyForRowAtIndexPath:function(e){var t=this.props,n=t.chats,i=t.contacts,a=e.row,s=e.section;switch(this.getSection(s)){case w:return n[a].id;case x:return i[a].id;case O:return this.ftsStarred[a].id.toString();case D:return this.ftsMessages[a].id.toString()}},itemForRowAtIndexPath:function(e){var t=this.props,n=t.chats,i=t.contacts,a=e.row,s=e.section;switch(this.getSection(s)){case w:var r=n[a];return g.createElement(c["default"],{chat:r,mode:l.Mode.LAST,searchText:this.props.searchText,onClick:this.onClick,mouseDownAsClick:!0,active:this.props.selection});case x:var o=i[a];return g.createElement(k,{contact:o,active:this.props.selection,searchText:this.props.searchText,onClick:this.onClick,mouseDownAsClick:!0});case O:var u=this.ftsStarred[a];return g.createElement(h["default"],{msg:u,searchText:this.props.searchText,onClick:this.onClick,active:this.props.selection});case D:var d=this.ftsMessages[a];return g.createElement(h["default"],{msg:d,searchText:this.props.searchText,onClick:this.onClick,active:this.props.selection})}},restoreFocus:function(){this.props.selection.reset()},onFocusGain:function(e){var t=this.refs.uie;t&&t.activate(),e.target===v.findDOMNode(this)&&this._listPointerEvents&&(this.props.selection.index<0?this.focusFirst():this.props.selection.reset())},focusFirst:function(){this.props.selection.setFirst(),this.debouncedOpenSelected()},onNextChat:function(e,t,n){e&&(e.preventDefault(),e.stopPropagation());var i=this.props.selection.next();this.props.selection.index!==i&&(this.props.selection.setNext(),this.focusComposer=n,this.debouncedOpenSelected())},onPrevChat:function(e,t,n){e&&(e.stopPropagation(),e.preventDefault());var i=this.props.selection.prev();i>-1?(this.props.selection.setPrev(),this.focusComposer=n,this.debouncedOpenSelected()):t||(this.debouncedOpenSelected.cancel(),this.openSelected(),this.props.onFocusSearch())},render:function(){var e=this,t={down:function(t){return e.onNextChat(t)},j:function(t){return e.onNextChat(t)},up:function(t){return e.onPrevChat(t)},k:function(t){return e.onPrevChat(t)}},n=72,i=_.find(P.LIST_HEIGHT_TEXTSIZE_MAP,function(t){return t.scale===e.state.textsize});return i&&(n=i.height),g.createElement(T,{displayName:"Chatlist",ref:"uie",state:T.State.PASSIVE,requestFocus:function(){return e.props.selection.reset(!1)}},g.createElement(m["default"],{handlers:t,onFocus:this.onFocusGain,"data-tab":3},g.createElement(o["default"],{className:"chatlist",itemForRowAtIndexPath:this.itemForRowAtIndexPath,keyForRowAtIndexPath:this.keyForRowAtIndexPath,sectionForSection:this.sectionForSection,numberOfRowsInSection:this.numberOfRowsInSection,numberOfSections:this.numberOfSections,heightForItem:n,extraItems:10,onPointerEventsOff:this.onListPointerEventsOff,onPointerEventsOn:this.onListPointerEventsOn})))},getActiveChat:function(){return _.find(Store.Chat.toArray(),{active:!0})}});e.exports=R},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1691),s=i(a),r=n(8),o=n(15),l=n(1488),c=n(233),u=n(1616),d=n(1617),p=n(1620),h=n(1624),f=n(1490),m=n(29),g=n(467),v=n(1382),y=n(1379),_=n(10),E=n(1372),S=n(160),M=n(9),C=n(1411),b=C.MenuBarItem,T=C.MenuBar,P=n(61),k=n(461),N=n(44),w=n(110),x="global_mute",O=r.createClass({displayName:"ChatlistHeader",mixins:[E,S],getDefaultProps:function(){return{muteId:x}},getInitialState:function(){return Store.Mute.globalMute(),{isMuted:this.async("muteId.Mute.isMuted")}},componentWillMount:function(){},onWindowFocus:function(){var e=this;this.setState({newlyFocused:!0}),this.safeDelay(function(){return e.setState({newlyFocused:!1})},100)},onMouseDown:function(){},onDrag:function(e){this.didDrag=!0},onClickCapture:function(e){},onNewChat:function(e){e.preventDefault(),_.openDrawerLeft(r.createElement(u,null))},onProfile:function(){_.openDrawerLeft(r.createElement(l,{id:Store.Conn.me}))},onUnmute:function(){Store.Mute.globalMute().unmute(),_.openToast(r.createElement(k,{msg:l10n.t("global_unmuted"),id:k.genId()}))},render:function(){var e=null;this.state.isMuted&&(e=r.createElement(b,{a8n:"menu-bar-unmute",icon:"dnd",title:l10n.t("global_unmute"),onClick:this.onUnmute,key:"btn-dnd"}));var t=null;P.supportsFeature(P.F.STATUS_V3_UI)&&(t=r.createElement(s["default"],null));var n=N("pane-list-user",{});return r.createElement("header",{className:"pane-header pane-list-header",onMouseDown:this.onMouseDown,onClickCapture:this.onClickCapture},r.createElement("div",{className:n},r.createElement(y,{id:Store.Conn.me,size:40,onClick:this.onProfile})),r.createElement("div",{className:"pane-list-controls"},r.createElement(T,{key:"chatlist-header"},r.createElement(w,{transitionName:"btn"},e,t,r.createElement(b,{a8n:"menu-bar-chat",icon:"chat",title:l10n.t("web_menuitem_new"),onClick:this.onNewChat}),r.createElement(b,{a8n:"menu-bar-menu",icon:"menu",title:l10n.t("menutitle_menu")},r.createElement(D,null))))))}});e.exports=O;var D=r.createClass({displayName:"ChatlistHeaderDropdown",getInitialState:function(){return{rememberMe:m.getRememberMe()}},onCreateGroup:function(){_.openDrawerLeft(r.createElement(d,null))},onProfile:function(){_.openDrawerLeft(r.createElement(l,{id:Store.Conn.me}))},onDisconnect:function(){var e=Store.Msg.some(function(e){return 0===e.ack&&e.local&&e.isSentByMe});return e?void _.openModal(r.createElement(c,{title:l10n.t("confirm_logout"),onOK:function(){return o.logout()},okText:l10n.t("menuitem_logout"),onCancel:function(){return _.closeModal()},cancelText:l10n.t("web_cancel")},l10n.t("some_of_your_messages_are_still_sending"))):o.logout()},onArchived:function(){_.openDrawerLeft(r.createElement(h,null))},onSettings:function(){_.openDrawerLeft(r.createElement(p,null))},onStarred:function(){_.openDrawerLeft(r.createElement(f,{starredMsgs:Store.AllStarredMsgs}))},render:function(){var e=P.supportsFeature(P.F.GROUP_CREATE)?r.createElement(v,{a8n:"mi-new-group menu-item",action:this.onCreateGroup,shortcut:"g"},l10n.t("web_menuitem_groupchat")):null,t=P.supportsFeature(P.F.STARRED)&&P.supportsFeature(P.F.FULL_TEXT_SEARCH)?r.createElement(v,{a8n:"mi-starred menu-item",action:this.onStarred},l10n.t("menuitem_starred")):null,n=l10n.t("menuitem_profile_status"),i=l10n.t("menuitem_profile");return r.createElement(g,{type:g.Type.DROPDOWN_MENU,flipOnRTL:!0,key:"ChatlistHeader",direction:{x:g.Direction.X.LEFT}},e,r.createElement(v,{a8n:"mi-profile-status menu-item",action:this.onProfile},M.STATUS_V2?n:i),r.createElement(v,{a8n:"mi-archived menu-item",action:this.onArchived},l10n.t("menuitem_archived")),t,r.createElement(v,{a8n:"mi-setting menu-item",action:this.onSettings},l10n.t("menuitem_settings")),r.createElement(v,{a8n:"mi-logout menu-item",action:this.onDisconnect,shortcut:"q"},l10n.t("menuitem_logout")))}})},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(111),s=i(a),r=n(8),o=n(1393),l=n(1386),c=r.createClass({displayName:"ParticipantList",propTypes:{contacts:r.PropTypes.array.isRequired,onDelete:r.PropTypes.func.isRequired,onFocusSearch:r.PropTypes.func.isRequired},getInitialState:function(){return this.selection=new l(this.props.contacts,function(e){return e.id}),null},componentWillReceiveProps:function(e){this.selection.init(e.contacts,!0)},focusLast:function(){_.size(this.props.contacts)&&this.selection.setLast()},focusPrev:function(e){e.preventDefault(),e.stopPropagation();var t=this.selection.prev();t>-1&&this.selection.setPrev()},focusNext:function(e){e.preventDefault(),e.stopPropagation();var t=this.selection.next();this.selection.index===t?(this.selection.unset(),this.props.onFocusSearch(e)):this.selection.setNext()},deleteContact:function(e){e.preventDefault(),e.stopPropagation();var t=_.find(this.props.contacts,this.selection.getVal());this.props.onDelete(e,t)},onParticipantClick:function(e,t){this.selection.setVal(t)},render:function(){var e=this,t=this.props.contacts;if(!t)return null;var n=_.size(this.props.contacts)?_.map(this.props.contacts,function(t){return r.createElement(o,{contact:t,active:e.selection,onDelete:e.props.onDelete,onClick:e.onParticipantClick,type:o.Type.SMALL,key:t.id})}):null,i={up:this.focusPrev,down:this.focusNext,backspace:this.deleteContact};i[l10n.LR("left","right")]=this.focusPrev,i[l10n.LR("right","left")]=this.focusNext;var a=r.createElement("ul",{ref:"list"},n);return r.createElement(s["default"],{handlers:i},a)}});e.exports=c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1409),o=i(r),l=n(460),c=i(l),u=n(111),d=i(u),p=n(8),h=n(45),f=n(156),m=n(93),g=n(1376),v=n(160),y=n(1481),E=n(1533),S=n(1532),M=n(1388),C=n(157),b=n(1521),T=n(10),P=n(61),k=n(1431),N=n(13),w=n(1386),x=n(9),O=n(91),D=n(1501),R=n(44),I=n(1387),A=I.GetRef,L=x.MIN_CHARS_FOR_FTS,F={THROTTLE:450},U=p.createClass({displayName:"ChatlistPanel",mixins:[f,m,g,v,y],propTypes:{className:p.PropTypes.string},getInitialState:function(){var e=this;this.ftsMsgs=new D,this.selection=new w([],function(e){return e.id.toString()}),this._fts=this.safeDebounce(function(){var t=_.trim(e.searchText||"");e._ftsPromise&&e._ftsPromise.cancel(),e._ftsPromise=s["default"].resolve().then(function(){e.isFTSSearching()||e.setState({searching:!0},y.DD)}).then(function(){return e.ftsMsgs.search(t)}).checkpoint(e.rejectOnUnmount()).then(function(t){e.setState({searching:!1},y.DD)})["catch"](N.Unmount,_.noop)["catch"](s["default"].CancellationError,_.noop)["finally"](function(){e._ftsPromise=void 0})["catch"](function(){e.isFTSSearching()&&e.setState({searching:!1},y.DD)})},750),this.throttledFilteredChats=this.safeThrottle(function(t){var n=e.getFilteredChats(t);e.setState({chats:n},y.DD,y.CD)},F.THROTTLE,{leading:!1,trailing:!0}),this.throttledFilteredContacts=this.safeThrottle(function(t){var n=e.getFilteredContacts(t);e.setState({contacts:n},y.DD,y.CD)},F.THROTTLE,{leading:!1,trailing:!0}),this.throttledOnScroll=this.safeThrottle(function(t){e.shouldFTSSearch(t)&&e.fullTextSearch()},100),this.searchText="";var t;return t=0,{searching:!1,chats:this.getFilteredChats(),contacts:this.getFilteredContacts(),textsize:t}},componentWillMount:function(){var e=this;this.addObserver(Store.Chat,"remove",function(t){if(e.searchText){var n=_.without(e.state.chats,t);n.length!==e.state.chats.length&&e.setState({chats:n})}else e.throttledFilteredChats.cancel(),e.setState({chats:e.getFilteredChats()})}),this.addObserver(Store.Contact,"remove",function(t){if(e.searchText){var n=_.without(e.state.contacts,t);n.length!==e.state.contacts.length&&e.setState({contacts:n})}else e.throttledFilteredContacts.cancel(),e.setState({contacts:e.getFilteredContacts()})}),this.addObserver(Store.Chat,"sort change:archive",function(){e.searchText||(e.throttledFilteredChats.cancel(),e.setState({chats:e.getFilteredChats()}))}),this.addObserver(Store.Contact,"sort",function(){e.searchText||(e.throttledFilteredContacts.cancel(),e.setState({contacts:e.getFilteredContacts()}))}),this.addObserver(this.ftsMsgs,"bulk_remove"),this.regCmd("focus_chat_search",this.onFocusSearch),this.regCmd("textsize_change",function(t){e.setState({textsize:t})})},componentWillUnmount:function(){this.cancelSearch(),this.cancelThrottled()},getFilteredContacts:function(e,t){if(!e)return[];e=l10n.accentFold(_.trim(e));var n=Store.Contact.getFilteredContacts();return n.filter(function(n){var i=n.searchMatch(e);if(!i)return!1;var a=Store.Chat.get(n.id);return t||!a||!a.isVisible})},getFilteredChats:function(e){return e=_.trim(e),e?(e=l10n.accentFold(e),Store.Chat.filter(function(t){return t.contact.searchMatch(e)&&t.isVisible})):Store.Chat.filter(function(e){return!e.archive&&e.isVisible})},fullTextSearch:function(e){if(P.supportsFeature(P.F.FULL_TEXT_SEARCH)){var t=_.trim(e||this.searchText);k.multibyteLength(t)>=L?this._fts():this.isFTSSearching()&&this.cancelSearch()}},shouldFTSSearch:function(e){return!this.ftsMsgs.hasMoreMsgs||this.isFTSSearching()||!P.supportsFeature(P.F.FULL_TEXT_SEARCH)||k.multibyteLength(this.searchText||"")<L?!1:e.scrollTop+x.SCROLL_FUDGE>e.scrollHeight-e.clientHeight},onSearch:function(e){if(!e)return void this.onStopSearch();var t=this.searchText;e!==t&&(this.fullTextSearch(e),this.throttledFilteredChats(e),this.throttledFilteredContacts(e),this.searchText=e)},hasSearchText:function(){return!!this.searchText},isFTSSearching:function(){var e=this.getBatchRenderState();return"searching"in e?e.searching:this.state.searching},cancelSearch:function(){this._fts.cancel(),this.ftsMsgs.resetSearch(),this.ftsMsgs.reset(),this._ftsPromise&&this._ftsPromise.cancel(),this.isFTSSearching()&&this.setState({searching:!1},y.DD)},cancelThrottled:function(){this.throttledFilteredChats.cancel(),this.throttledFilteredContacts.cancel(),this.throttledOnScroll.cancel()},onStopSearch:function(){this.cancelSearch(),this.searchText="",this.cancelThrottled(),this.search&&this.search.setState({searchText:this.searchText}),this.setState({chats:this.getFilteredChats(),contacts:this.getFilteredContacts(),searching:!1})},onFocusList:function(e){e.repeat||this.refs.chatlist&&this.search.isAtEnd()&&(e.preventDefault(),e.stopPropagation(),d["default"].flashFocus=Date.now(),this.refs.chatlist.focusFirst())},onOpenFirst:function(e){var t=this;e.preventDefault();var n=_.head(this.getFilteredChats(this.searchText))||_.head(this.getFilteredContacts(this.searchText));n&&Store.Chat.find(n.id).then(function(e){t.onStopSearch(),d["default"].flashFocus=Date.now(),T.openChatFromUnread(e).then(function(t){t&&T.focusChatTextInput(e)})})},onFocusSearch:function(e){var t=this;T.existsDrawerLeft(function(e){e||(d["default"].flashFocus=Date.now(),O.focus(t.search))})},indicateFocus:function(e){if(!(Date.now()-(d["default"].flashFocus||0)>200)){var t=h.findDOMNode(this.refs.input_hotkey);(0,c["default"])(t,"stop"),(0,c["default"])(t,{backgroundColor:["#fbfbfb","#D9F3FF"]},{duration:1600,easing:[.19,.69,.01,.99]})}},onScroll:function(e){this.throttledOnScroll(e.target)},getEmptyChatlistState:function(e,t,n){return e.length||t.length||n.length?null:this.searchText?this.state.searching?p.createElement(M.Searching,null):p.createElement(M.Search,null):Store.Chat.some(function(e){return e.isVisible})?p.createElement(M.AllArchived,null):p.createElement(M.ListChats,null)},render:function(){var e=this,t=this.state,n=t.chats,i=t.contacts,a=this.ftsMsgs.models,s=this.getEmptyChatlistState(n,i,a);s||(s=p.createElement(S,{ref:"chatlist",chats:n,contacts:i,isSearching:!!this.hasSearchText(),searchText:_.trim(this.searchText),ftsResult:a,selection:this.selection,onFocusSearch:this.onFocusSearch,onClick:this.onStopSearch}));var r,l={down:this.onFocusList,enter:this.onOpenFirst},c=(this.state.searching||this.ftsMsgs.hasMoreMsgs)&&this.ftsMsgs.length?p.createElement("div",{key:"spinner",className:"more",style:{alignSelf:"center"}},p.createElement(C,{stroke:6,size:24})):null,u=_.find(x.TEXTSIZE_CLASS_MAP,function(t){return t.scale===e.state.textsize});u&&(r=u.classname);var h=R("chatlist-panel",r,this.props.className),f=this.ftsMsgs.hasMoreMsgs&&a.length?this.onScroll:void 0;return p.createElement("div",{id:"side",className:h},p.createElement(E,{key:"ChatHeader"}),p.createElement(b,{key:"ButterBar"}),p.createElement(d["default"],{handlers:l,onFocus:this.indicateFocus,ref:"input_hotkey",className:"chatlist-panel-search"},p.createElement(o["default"],{ref:A("search",this),onSearch:this.onSearch,loading:this.state.searching})),p.createElement("div",{ref:"panel",className:"chatlist-panel-body",onScroll:f,id:"pane-side","data-list-scroll-container":!0},s,c))}});e.exports=U},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t,n){for(var i=[],a=0,s=0;a<e.length||s<t.length;)n(e[a],t[s])?i.push(e[a++]):i.push(t[s++]);return a<e.length?i.concat(e.slice(a)):s<t.length?i.concat(t.slice(s)):i}var s=n(94),r=i(s),o=n(2),l=i(o),c=n(16),u=i(c),d=n(4),p=i(d),h=n(6),f=i(h),m=n(20),g=i(m),v=n(19),y=i(v),_=n(35),E=i(_),S=n(10),M=i(S),C=n(8),b=i(C),T=n(45),P=i(T),k=n(460),N=i(k),w=n(471),x=i(w),O={duration:300,easing:[.1,.82,.25,1]},D=function(e,t){return e.map(function(e,n){return[t[n]===e,n]}).filter(function(e){var t=(0,E["default"])(e,1),n=t[0];return!n}).map(function(e){var t=(0,E["default"])(e,2),n=t[1];return n})},R=function(e,t){return D(e,t).filter(function(n){return e[n]&&!t[n]})},I=function(e,t,n){var i=D(e,t).filter(function(n){return!e[n]&&t[n]}),s=n.filter(function(e){return!!t[e]});return s.length?a(i,s,function(e,t){return t>e}):i},A=function(e){function t(){var e,n,i,a;(0,p["default"])(this,t);for(var s=arguments.length,r=Array(s),o=0;s>o;o++)r[o]=arguments[o];return n=i=(0,g["default"])(this,(e=t.__proto__||(0,u["default"])(t)).call.apply(e,[this].concat(r))),i.containerHeight=0,i.childAnimations=[],i.didCancel=!1,i.state={children:i.props.children},i.pendingRemoval=[],a=n,(0,g["default"])(i,a)}return(0,y["default"])(t,e),(0,f["default"])(t,[{key:"getHeightChange",value:function(e,t){var n=this;return e.reduce(function(e,i){if(t>i)return e;var a=n.refs["animation-child-"+i];if(!a)return e;var s=P["default"].findDOMNode(a);return s?e+s.clientHeight:e},0)}},{key:"animateElement",value:function(e,t,n,i){var a=this;this.childAnimations[e]||(this.childAnimations[e]=l["default"].resolve()),this.childAnimations[e]&&(this.didCancel=!0,this.childAnimations[e].cancel());var s=n>0?[0,n]:[-n,0];return this.childAnimations[e]=(this.childAnimations[e]||l["default"].resolve()).then(function(){return(0,N["default"])(t,{translateY:s},O)}).cancellable().then(function(){return 0>n&&(-1===i.indexOf(e)?t.style.transform="":t.style.opacity="0"),e})["catch"](l["default"].CancellationError,function(){return(0,N["default"])(t,"stop",!0),t.style.transform="",!1})["finally"](function(){a.didCancel?a.didCancel=!1:(delete a.childAnimations[e],M["default"].setUiBusy(!1,"animation_group"))}),this.childAnimations[e]}},{key:"transitionAffected",value:function(e,t){if(!e)return l["default"].resolve();for(var n=[],i=e.slice(-1),a=(0,E["default"])(i,1),s=a[0],r=0;s>=r;++r){var o=this.refs["animation-child-"+r];o&&n.push(this.animateElement(r,P["default"].findDOMNode(o),(t?1:-1)*this.getHeightChange(e,r),e))}return l["default"].all(n).then(function(e){return e.filter(function(e){return e!==!1})})}},{key:"notifyHeightChange",value:function(e,t){e.length&&this.props.onHeightChange&&this.props.onHeightChange((t?1:-1)*this.getHeightChange(e,0))}},{key:"componentWillReceiveProps",value:function(e){var t,n=this,i=e.children,a=R(this.state.children,i);this.added=I(this.state.children,i,this.pendingRemoval);for(var s=0;s<this.added.length;++s)this.busyId=x["default"].setBusy(this.busyId),M["default"].setUiBusy(!0,"animation_group");if(!a.length)return this.setState({children:i});var o=a.filter(function(e){return-1===n.pendingRemoval.indexOf(e)});if(o.length){for(var l=0;l<o.length;++l)this.busyId=x["default"].setBusy(this.busyId),M["default"].setUiBusy(!0,"animation_group");(t=this.pendingRemoval).push.apply(t,(0,r["default"])(o)),this.notifyHeightChange(a,!1),this.transitionAffected(a,!1).then(function(e){n.pendingRemoval=n.pendingRemoval.filter(function(e){return-1===o.indexOf(e)}),e.length>0&&n.setState({children:i},function(){x["default"].decBusy(n.busyId)})})}}},{key:"componentDidUpdate",value:function(e,t){var n=this;t.children;this.added.length&&(this.notifyHeightChange(this.added,!0),this.transitionAffected(this.added,!0).then(function(){x["default"].decBusy(n.busyId)}))}},{key:"componentDidMount",value:function(){var e=this,t=this.state.children.reduce(function(t,n,i){var a=e.refs["animation-child-"+i];if(!a)return t;var s=P["default"].findDOMNode(a);return s?(s.style.transform="translateY(0)",t+s.clientHeight):t},0);this.props.onHeightChange(t,!0)}},{key:"render",value:function(){var e=this.state.children,t=b["default"].Children.map(e,function(e,t){return e?b["default"].cloneElement(e,{ref:"animation-child-"+t}):e});return b["default"].createElement("div",null,t)}}]),t}(b["default"].Component);e.exports=A},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1370),s=i(a),r=n(8),o=n(1372),l=n(1382),c=r.createClass({displayName:"ArchiveMenuItem",mixins:[o],propTypes:{chat:r.PropTypes.instanceOf(s["default"]).isRequired,onArchive:r.PropTypes.func.isRequired},getInitialState:function(){return{archive:this.async("chat.archive")}},render:function(){var e=this.props.onArchive.bind(null,!this.state.archive);return r.createElement(l,{a8n:"mi-archive",action:e,shortcut:"a",key:"ArchiveMenuItem"},this.state.archive?l10n.t("unarchive_chat"):l10n.t("archive_chat"))}});e.exports=c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{
"default":e}}var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(1377),m=i(f),g=n(1370),v=(i(g),n(458)),y=(i(v),n(1495)),_=(i(y),n(8)),E=n(9),S=n(18),M=n(10),C=n(1441),b=n(157),T=n(1388),P=(n(1385),function(e){function t(){var e,n,i,a;(0,o["default"])(this,t);for(var r=arguments.length,l=Array(r),c=0;r>c;c++)l[c]=arguments[c];return n=i=(0,d["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(l))),i.onScroll=function(e){i.handleScroll(e.target)},i.handleScroll=S.throttle(function(e){var t=i.props.docMsgs;t.hasDocBefore&&e.scrollTop+E.SCROLL_FUDGE>e.scrollHeight-e.clientHeight&&i.queryDocs(t.head())},100),i.onClickMsg=function(e,t){i.props.selectable&&void 0!==t?i.props.onMessageSelect(e,t):M.openChatAt(e.chat,e.chat.getSearchContext(e))},a=n,(0,d["default"])(i,a)}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentWillMount",value:function(){this.props.docMsgs.hasDocBefore&&this.queryDocs()}},{key:"componentDidMount",value:function(){this.props.listeners.add(this.props.docMsgs,"add remove reset"),this.props.listeners.add(this.props.docMsgs,"query_doc_before")}},{key:"componentWillUnmount",value:function(){this.handleScroll.cancel()}},{key:"queryDocs",value:function(e){var t=this,n=this.props.docMsgs;n.hasDocBefore&&this.props.listeners.uiIdle(function(){n.queryDocs(t.props.chat,e)})}},{key:"render",value:function(){var e=this,t=this.props.docMsgs,n=this.props.selectedMessages,i=t.map(function(t){return _.createElement(C,{key:t.id,ref:t.id.toString(),msg:t,multiMedia:!0,selectable:e.props.selectable,selectedMessages:n,onMessageSelect:e.props.onMessageSelect,onClickMsg:e.onClickMsg})});if(i.reverse(),t.queryDocBefore){if(0===i.length)return _.createElement(T.Loading,null);i.push(_.createElement("div",{className:"more",key:"spinner"},_.createElement(b,{stroke:6,size:24})))}return 0!==t.length||t.queryDocBefore||t.hasDocBefore?_.createElement("div",{onScroll:this.onScroll,className:"doc-gallery"},i):_.createElement(T.DocMsgs,null)}}]),t}(_.Component));e.exports=(0,m["default"])(P)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(112),s=i(a),r=n(114),o=i(r),l=n(8),c=n(157),u=n(44),d=function(e){var t=e.className,n=e.children,i=(0,o["default"])(e,["className","children"]),a=u("doc-state",t);return l.createElement("div",(0,s["default"])({className:a},i),n)},p=function(e){var t=e.onClick;return l.createElement(d,{onClick:t||_.noop},l.createElement("span",{className:"icon doc-state-icon icon-audio-download"}))},h=function(){return l.createElement(d,null,l.createElement(c,{stroke:3,size:32}))},f=function(){return l.createElement(d,null,l.createElement("span",{className:"icon doc-state-icon icon-audio-cancel-noborder"},l.createElement(c,{stroke:3,size:32})))},m=function(){return l.createElement(d,null,l.createElement("span",{className:"icon doc-state-icon icon-audio-upload"}))};e.exports={Download:p,Pending:h,PendingCancel:f,Upload:m}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(236),s=i(a),r=n(8),o=n(45),l=n(158),c=n(238),u=n(44),d=r.createClass({displayName:"Draggable",mixins:[l],propTypes:{children:r.PropTypes.node.isRequired,padding:r.PropTypes.number.isRequired,start:r.PropTypes.shape({x:r.PropTypes.number,y:r.PropTypes.number}),scale:r.PropTypes.number,childSize:r.PropTypes.shape({width:r.PropTypes.number,height:r.PropTypes.number}),container:r.PropTypes.shape({width:r.PropTypes.number.isRequired,height:r.PropTypes.number.isRequired,x:r.PropTypes.number,y:r.PropTypes.number}),onStart:r.PropTypes.func,onDrag:r.PropTypes.func,onStop:r.PropTypes.func},getInitialState:function(){var e=this.props.start?this.props.start.x:0,t=this.props.start?this.props.start.y:0;return{dragging:!1,x:e,y:t,scaledPadding:this.props.scale*this.props.padding,offsetX:0,offsetY:0}},componentDidMount:function(){this.updateContainer()},componentWillReceiveProps:function(e){e.scale!==this.props.scale||e.container.width!==this.props.container.width||e.container.height!==this.props.container.height?this.updateContainer(e,!0):this.updateContainer(e)},updateContainer:function(e,t){e=e||this.props;var n=e.container;if(n&&this.refs.draggable){var i,a=o.findDOMNode(this.refs.draggable),s=a&&0===a.width&&e.childSize?e.childSize.width:a.width,r=a&&0===a.height&&e.childSize?e.childSize.height:a.height,l=n.x?n.x:0,c=n.y?n.y:0,u=this.state.x,d=this.state.y,p=s*e.scale,h=r*e.scale,f=e.padding*e.scale;this.props.scale!==e.scale&&this.state.center?(i=this.state.center,u=n.width/2+l-i.x*p,d=n.height/2+c-i.y*h):i={x:(n.width/2+l-u)/p,y:(n.height/2+c-d)/h},u+f>l?u=l-f:u+p+f<l+n.width&&(u=l+n.width-p-f),d+f>c?d=c-f:d+h+f<c+n.height&&(d=c+n.height-h-f),this.setState({width:p,height:h,x:u,y:d,scaledPadding:f,center:i}),this.props.onStop&&t&&e.onStop(u,d)}},handleMouseDown:function(e){e.preventDefault(),this.setState({dragging:!0,offsetX:e.clientX-this.state.x,offsetY:e.clientY-this.state.y}),this.regNativeListener(window,"mousemove",this.handleMouseMove),this.regNativeListener(window,"mouseup",this.handleMouseUp),this.props.onStart&&this.props.onStart()},handleMouseUp:function(e){this.unregisterListeners(),this.setState({dragging:!1}),this.props.onStop&&this.props.onStop(this.state.x,this.state.y)},handleMouseMove:function(e){if(this.state.dragging){var t=e.clientX-this.state.offsetX,n=e.clientY-this.state.offsetY,i=this.props.container,a=i.x?i.x:0,s=i.y?i.y:0,r=this.state.scaledPadding;i&&((t+r>a||t+this.state.width+r<a+i.width)&&(t=this.state.x),(n+r>s||n+this.state.height+r<s+i.height)&&(n=this.state.y)),this.setState({x:t,y:n}),this.props.onDrag&&this.props.onDrag(t,n)}},render:function(){var e,t=this.props.scale?" scale("+this.props.scale+")":"",n=(e={},(0,s["default"])(e,c.prefix("transform"),"translate("+this.state.x+"px, "+this.state.y+"px)"+t),(0,s["default"])(e,"padding",this.props.padding+"px"),e);this.state.dragging||(n[c.prefix("transition")]="transform 200ms");var i=u("draggable",{dragging:this.state.dragging});return r.cloneElement(r.Children.only(this.props.children),{style:n,draggable:!0,ref:"draggable",className:i,onMouseDown:this.handleMouseDown})}});e.exports=d},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(161),s=i(a),r=n(8),o=n(9),l=o.ONE_BY_ONE_TRANS_GIF,c=n(44);e.exports=function(e){var t=e.emoji,n=e.size,i=void 0===n?"small":n,o=e.className,u=a.emojiMap[t];return u?r.createElement("img",{alt:t,draggable:!1,src:l,className:c(o,s["default"].getClasses(u,i))}):null}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(8),m=(i(f),n(471)),g=i(m),v=function(e){function t(){var e,n,i,a;(0,o["default"])(this,t);for(var r=arguments.length,l=Array(r),c=0;r>c;c++)l[c]=arguments[c];return n=i=(0,d["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(l))),i.state={isBusy:g["default"].isBusy()},i.onIdle=function(){i.setState({isBusy:!1})},a=n,(0,d["default"])(i,a)}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentWillMount",value:function(){this.idleTaskId=g["default"].enqueue(this.onIdle)}},{key:"componentWillReceiveProps",value:function(e){if(this.props.id!==e.id){this.state.isBusy&&g["default"].dequeue(this.idleTaskId);var t=g["default"].isBusy();t&&(this.idleTaskId=g["default"].enqueue(this.onIdle)),this.setState({isBusy:t})}}},{key:"componentWillUnmount",value:function(){g["default"].dequeue(this.idleTaskId)}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.onComplex,i=this.state.isBusy;return i?t:n()}}]),t}(f.Component);t["default"]=v},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(114),s=i(a),r=n(8),o=r.createClass({displayName:"IsolatedBlock",propTypes:{Component:r.PropTypes.string.isRequired},getDefaultProps:function(){return{Component:"span"}},render:function(){var e=this.props,t=e.Component,n=e.children,i=(0,s["default"])(e,["Component","children"]);return r.createElement(t,i,"​⁠​",n,"​⁠​")}});e.exports=o},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(1377),m=i(f),g=n(1370),v=(i(g),n(458)),y=(i(v),n(1496)),_=(i(y),n(8)),E=n(9),S=n(18),M=n(10),C=n(1441),b=n(1545),T=n(157),P=n(1388),k=(n(1385),function(e){function t(){var e,n,i,a;(0,o["default"])(this,t);for(var r=arguments.length,l=Array(r),c=0;r>c;c++)l[c]=arguments[c];return n=i=(0,d["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(l))),i.onScroll=function(e){i.handleScroll(e.target)},i.handleScroll=S.throttle(function(e){var t=i.props.linkMsgs;t.hasLinkBefore&&e.scrollTop+E.SCROLL_FUDGE>e.scrollHeight-e.clientHeight&&i.queryLinks(t.head())},100),i.onClickMsg=function(e,t){i.props.selectable&&void 0!==t?i.props.onMessageSelect(e,t):M.openChatAt(e.chat,e.chat.getSearchContext(e))},a=n,(0,d["default"])(i,a)}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentWillMount",value:function(){this.props.linkMsgs.hasLinkBefore&&this.queryLinks()}},{key:"componentDidMount",value:function(){this.props.listeners.add(this.props.linkMsgs,"add remove reset"),this.props.listeners.add(this.props.linkMsgs,"query_link_before")}},{key:"componentWillUnmount",value:function(){this.handleScroll.cancel()}},{key:"queryLinks",value:function(e){var t=this,n=this.props.linkMsgs;n.hasLinkBefore&&this.props.listeners.uiIdle(function(){n.queryLinks(t.props.chat,e)})}},{key:"render",value:function(){var e=this,t=this.props.linkMsgs,n=this.props.selectedMessages,i=t.reduce(function(t,i){return i.links.forEach(function(a,s){t.push(_.createElement(b,{key:i.id+"-"+s,msg:i,link:a,selectable:e.props.selectable,selectedMessages:n,onMessageSelect:e.props.onMessageSelect,onClickMsg:e.onClickMsg}))}),i.isLink&&t.push(_.createElement(C,{key:i.id,ref:i.id.toString(),msg:i,multiMedia:!0,selectable:e.props.selectable,selectedMessages:n,onMessageSelect:e.props.onMessageSelect,onClickMsg:e.onClickMsg})),t},[]);if(i.reverse(),t.queryLinkBefore){if(0===i.length)return _.createElement(P.Loading,null);i.push(_.createElement("div",{className:"more",key:"spinner"},_.createElement(T,{stroke:6,size:24})))}return 0!==t.length||t.queryLinkBefore||t.hasLinkBefore?_.createElement("div",{onScroll:this.onScroll,className:"link-gallery"},i):_.createElement(P.LinkMsgs,null)}}]),t}(_.Component));e.exports=(0,m["default"])(k)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(8),m=i(f),g=n(1377),v=i(g),y=n(1470),_=i(y),E=n(1394),S=i(E),M=n(1371),C=i(M),b=n(44),T=i(b),P=n(1385),k=(i(P),n(110)),N=i(k),w=n(159),x=i(w),O=n(1384),D=function(e){function t(e){(0,o["default"])(this,t);var n=(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).call(this,e));n.mouseOver=function(){n.state.hover||n.setState({hover:!0})},n.mouseEnter=function(){n.state.hover||n.setState({hover:!0})},n.mouseLeave=function(){n.state.hover&&n.setState({hover:!1})},n.onSelectChange=function(e){n.state.selected!==e&&n.setState({selected:e})},n.onSelectClick=function(e){e&&e.stopPropagation(),n.props.onMessageSelect(n.props.msg,!n.state.selected)},n.onClick=function(){n.props.onClickMsg(n.props.msg,!n.state.selected)};var i=e.msg,a=e.selectedMessages;return n.state={hover:!1,selected:a?a.isSelected(i):!1},n}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentDidMount",value:function(){this.props.selectedMessages&&this.props.listeners.add(this.props.selectedMessages,this.props.msg.id.toString(),this.onSelectChange)}},{key:"render",value:function(){var e=this.props,t=e.msg,n=e.link,i=this.props.selectable||this.state.hover?m["default"].createElement("div",{className:"msg-select",onClick:this.onSelectClick},m["default"].createElement(S["default"],{onChange:this.onSelectClick,checked:this.state.selected})):null,a={wrapper:(0,T["default"])("starred-msg-wrapper",{hover:this.state.hover}),linkContainer:(0,T["default"])("message tail-override-left",{"message-out":t.isSentByMe,"message-in":!t.isSentByMe})},s=t.isTrusted?O.Configuration.TrustedConversation:O.Configuration.UntrustedConversation;return m["default"].createElement("div",{className:a.wrapper,onClick:this.onClick,onMouseEnter:this.state.hover?null:this.mouseEnter,onMouseOver:this.state.hover?null:this.mouseOver,onMouseLeave:this.state.hover?this.mouseLeave:null},m["default"].createElement("div",{className:"msg"},m["default"].createElement(N["default"],{transitionName:"delay-leave"},i),m["default"].createElement("div",{className:a.linkContainer},m["default"].createElement("span",{className:"tail-container"}),m["default"].createElement("div",{className:"bubble message-text"},m["default"].createElement(_["default"],{title:n.url,canonicalUrl:n.domain}),m["default"].createElement(C["default"],{text:t.body,selectable:!0,dirMismatch:t.rtl!==x["default"].isRTL(),direction:t.dir,formatters:s(t.mentionMap())})))))}}]),t}(m["default"].Component);e.exports=(0,v["default"])(D)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(4),s=i(a),r=n(6),o=i(r),l=function(){function e(t,n){(0,s["default"])(this,e),this.row=t,this.section=n}return(0,o["default"])(e,null,[{key:"indexPathIterator",value:function(t,n,i){function a(){if(f){var t=f;return f=void 0,t}var n=r(p)-1;return n>h&&p<d.section||h<d.row&&p===d.section?new e(++h,p):p<d.section?(h=0,new e(h,++p)):void 0}function s(){if(f){var t=f;return f=void 0,t}return h>0&&p>u.section||h>0&&p===u.section?new e(--h,p):p>u.section?(h=r(--p)-1,new e(h,p)):void 0}var r=t.numberOfRowsInSection,o=t.numberOfSections,l=o()-1,c=r(l)-1,u=n?n:new e(0,0),d=i?i:new e(c,l);if(u.row<0||u.section<0)throw new Error("Invalid iterator range.");if(d.section>l||d.row>r(d.section))throw new Error("Invalid iterator range.");if(u.gt(d))throw new Error("Invalid iterator range.");var p=u.section,h=u.row,f=u;return{next:a,prev:s}}}]),(0,o["default"])(e,[{key:"lt",value:function(e){return this.section<e.section||this.section===e.section&&this.row<e.row}},{key:"gt",value:function(e){return this.section>e.section||this.section===e.section&&this.row>e.row}},{key:"equals",value:function(e){return this.row===e.row&&this.section===e.section}}]),e}();t["default"]=l},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(236),s=i(a),r=n(16),o=i(r),l=n(4),c=i(l),u=n(6),d=i(u),p=n(20),h=i(p),f=n(19),m=i(f),g=n(8),v=i(g),y=n(45),_=i(y),E=n(238),S=i(E),M=n(44),C=i(M),b=n(460),T=i(b),P=200,k=function(e){function t(){return(0,c["default"])(this,t),(0,h["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"shouldComponentUpdate",value:function(e){return this.props.dataKey!==e.dataKey||this.props.rowHeight!==e.rowHeight||this.props.rowOffset!==e.rowOffset}},{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.rowOffset,i=t.prevRowOffset;"number"==typeof i&&(0,T["default"])(_["default"].findDOMNode(this),{translateY:[n,i]},{easing:"easeInOut",duration:P})}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.rowHeight,i=e.rowOffset,a=e.zIndex,r=e.className,o=(0,s["default"])({zIndex:a,height:n},S["default"].prefix("transform"),"translateY("+i+"px)"),l=(0,C["default"])(r,"infinite-list-item","infinite-list-item-transition");return v["default"].createElement("div",{className:l,style:o},t)}}]),t}(v["default"].Component);t["default"]=k},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(236),s=i(a),r=n(16),o=i(r),l=n(4),c=i(l),u=n(6),d=i(u),p=n(20),h=i(p),f=n(19),m=i(f),g=n(8),v=n(238),y=n(44),_=function(e){function t(e){(0,c["default"])(this,t);var n=(0,h["default"])(this,(t.__proto__||(0,o["default"])(t)).call(this,e));return n.state={rendered:!1},n}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentDidMount",value:function(){this.setState({rendered:!0})}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.rowNumber,i=e.rowHeight,a=e.zIndex,r=e.className,o=(0,s["default"])({zIndex:a,height:i},v.prefix("transform"),"translate3d(0, "+i*n+"px, 0)");return r=y(r,{"infinite-list-item":!0,"infinite-list-item-keyframe":!this.state.rendered,"infinite-list-item-transition":!0}),g.createElement("div",{className:r,style:o},t)}}]),t}(g.Component);e.exports=_},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1370),s=i(a),r=n(8),o=n(1372),l=n(1382),c=r.createClass({displayName:"MarkUnreadMenuItem",mixins:[o],propTypes:{chat:r.PropTypes.instanceOf(s["default"]).isRequired,onMarkUnread:r.PropTypes.func.isRequired},getInitialState:function(){return{unreadCount:this.async("chat.unreadCount")}},render:function(){var e=this.props.onMarkUnread.bind(null,!this.state.unreadCount);return r.createElement(l,{a8n:"mi-mark-as",action:e,shortcut:"r",key:"MarkUnreadMenuItem"},this.state.unreadCount?l10n.t("mark_read_chat"):l10n.t("mark_unread_chat"))}});e.exports=c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(8),o=i(r),l=n(464),c=i(l),u=n(1540),d=i(u),p=n(163),h=i(p),f=n(9),m=i(f),g=n(44),v=i(g),y=n(110),_=i(y),E=n(1),S=i(E),M=336,C=1.1,b=2,T=82,P=12.5,k=350,N=o["default"].createClass({displayName:"PhotoEditor",propTypes:{img:o["default"].PropTypes.oneOfType([o["default"].PropTypes.instanceOf(File),o["default"].PropTypes.instanceOf(Blob)]),size:o["default"].PropTypes.shape({width:o["default"].PropTypes.number.isRequired,height:o["default"].PropTypes.number.isRequired}),className:o["default"].PropTypes.oneOfType([o["default"].PropTypes.string,o["default"].PropTypes.arrayOf(o["default"].PropTypes.string),o["default"].PropTypes.objectOf(o["default"].PropTypes.bool)]),onImageSet:o["default"].PropTypes.func.isRequired},getInitialState:function(){return{img:this.props.img,scale:1,left:T,top:P}},componentWillMount:function(){this.setImage(this.props.img)},componentWillReceiveProps:function(e){return!this.props.doneEditing&&e.doneEditing?void this.onCrop():void(this.props.img!==e.img&&this.setImage(e.img))},setImage:function(e){var t=this;c["default"].rotateAndResize(e,3*m["default"].IMG_MAX_EDGE,c["default"].DATA_URL|c["default"].CANVAS).then(function(e){var n=e.width,i=e.height,a=e.images;h["default"].loadImage(a.dataUrl).then(function(e){var a=M/Math.min(n,i),s=t.getInitialPadding(a,n,i),r=0>b-(a+s)?b:a+s,o=t.getStart(r,e.width,e.height),l=o.x+r*k,c=o.y+r*k;t.setState({scale:r,minScale:a,start:o,left:l,top:c,img:e.src,imageSize:{width:e.width,height:e.height}})})["catch"](function(e){S["default"].error("PhotoEditor:loadImage failed to load image: "+e)()})})["catch"](function(e){S["default"].error("PhotoEditor:setImage failed to load image: "+e)()})},getInitialPadding:function(e,t,n){var i=(M+2*T)/t,a=(M+2*P)/n;return Math.max(i,a)-e},cropImage:function(){var e=this;if(!this.state.img)return s["default"].reject("Image missing from state");var t=this.state.img,n=this.getOffset(),i=this.state.scale,a=Math.abs((this.state.left-n.x)/i),r=Math.abs((this.state.top-n.y)/i),o=M/i,l=o;o>m["default"].MAX_PIC_SIDE?l=m["default"].MAX_PIC_SIDE:o<m["default"].MIN_PIC_SIDE&&(l=m["default"].MIN_PIC_SIDE);var u;return this.promise=new s["default"](function(n,i){c["default"].crop(t,a,r,o,o,l,l,c["default"].DATA_URL|c["default"].CANVAS).then(function(e){var t=e.images;return u=t.dataUrl,c["default"].crop(t.canvas,0,0,m["default"].PROF_PIC_THUMB_SIDE,m["default"].PROF_PIC_THUMB_SIDE,c["default"].DATA_URL)}).then(function(e){var t=e.images;n({thumb:t.dataUrl,full:u})})["catch"](i)["finally"](function(){e.promise=null})}),this.promise},onCrop:function(){var e=this;this.promise||this.cropImage().then(function(t){e.props.onImageSet(t.thumb,t.full)})["catch"](function(){e.setState({img:e.props.img,isEditing:!1})})},onZoomIn:function(){var e=this.state.scale*C;e>=b||this.setState({scale:e})},onZoomOut:function(){var e=this.state.scale/C;this.state.minScale>=e&&(e=this.state.minScale),this.setState({scale:e})},onMouseWheel:function(e){e.deltaY<-4?this.onZoomOut():e.deltaY>4&&this.onZoomIn()},onUpdate:function(e,t){e+=this.state.scale*k,t+=this.state.scale*k,this.setState({left:e,top:t})},getStart:function(e,t,n){var i=this.getOffset(),a=(t*e-M)/2,s=(n*e-M)/2,r=i.x-k*e-a,o=i.y-k*e-s;return{x:r,y:o}},getOffset:function(){var e=T,t=P;return this.props.size&&(e=this.props.size.width/2-M/2,t=this.props.size.height/2-M/2),{x:e,y:t}},render:function(){var e,t=this.getOffset(),n={width:M,height:M,x:t.x,y:t.y};this.state.img&&this.state.imageSize&&this.state.start&&(e=o["default"].createElement(d["default"],{ref:"img",container:n,onStop:this.onUpdate,start:this.state.start,scale:this.state.scale,padding:k,childSize:this.state.imageSize},o["default"].createElement("img",{className:"avatar-original",src:this.state.img})));var i=o["default"].createElement("div",{className:"avatar-picker-controls",key:"zoom-controls"},o["default"].createElement("button",{className:"icon icon-plus",onClick:this.onZoomIn}),o["default"].createElement("button",{className:"icon icon-minus",onClick:this.onZoomOut})),a=(0,v["default"])("avatar-picker-editor",this.props.className);return o["default"].createElement("div",{className:a,onWheel:this.onMouseWheel},o["default"].createElement("div",{className:"avatar-editor",ref:"imageContainer",dir:"ltr"},o["default"].createElement("div",{className:"avatar-editor-body"},e)),o["default"].createElement("svg",{className:"svg-overlay",style:{position:"absolute"}},o["default"].createElement("defs",null,o["default"].createElement("mask",{id:"mask",x:0,y:0,width:this.props.size.width,height:this.props.size.height,style:{position:"absolute"}},o["default"].createElement("rect",{x:0,y:0,width:this.props.size.width,height:this.props.size.height,fill:"rgba(255, 255, 255, 0.7)"}),o["default"].createElement("circle",{cx:this.props.size.width/2,cy:this.props.size.height/2,r:M/2,style:{position:"absolute"}}))),o["default"].createElement("rect",{x:0,y:0,width:this.props.size.width,height:this.props.size.height,mask:"url(#mask)",fillOpacity:.7,style:{position:"absolute"}})),o["default"].createElement(_["default"],{transitionName:"fade",style:{left:this.state.left,top:this.state.top}},i))}});e.exports=N},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(8),m=i(f),g=n(1370),v=(i(g),n(1378)),y=i(v),_=n(1382),E=i(_),S=function(e){function t(){var e,n,i,a;(0,o["default"])(this,t);for(var r=arguments.length,l=Array(r),c=0;r>c;c++)l[c]=arguments[c];return n=i=(0,d["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(l))),i.pin=function(){var e=i.props,t=e.chat,n=e.onPinOrUnpin;n(!t.pin)},a=n,(0,d["default"])(i,a)}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){var e=this.props.chat;return m["default"].createElement(E["default"],{a8n:"mi-pin",action:this.pin,shortcut:"p",key:"PinChat"},e.pin?l10n.t("unpin_chat"):l10n.t("pin_chat"))}}]),t}(m["default"].PureComponent);S.CONCERNS={chat:["pin"]},t["default"]=(0,y["default"])(S)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){return function(n){e.some(function(e){var i=(0,r["default"])(e,2),a=i[0],s=i[1],o=s.call(a,n,t);return n.defaultPrevented?!0:o===!0?(n.preventDefault&&n.preventDefault(),n.stopPropagation&&n.stopPropagation(),!0):!1})}}var s=n(35),r=i(s),o=n(22),l=i(o);e.exports=function(e,t){var n=e.reduce(function(e,t){var n=t.handlers;return n?((0,l["default"])(n).forEach(function(i){e[i]||(e[i]=[]),e[i].push([t,n[i]])}),e):e},{});return(0,l["default"])(n).reduce(function(e,i){return e[i]=a(n[i],t),e},{})}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){return function(){for(var n=arguments.length,i=Array(n),a=0;n>a;a++)i[a]=arguments[a];e.forEach(function(e){var n=(0,r["default"])(e,2),a=n[0],s=n[1];return s.call.apply(s,[a].concat(i,[t]))})}}var s=n(35),r=i(s),o=n(22),l=i(o);e.exports=function(e,t){var n=e.reduce(function(e,t){var n=t.hooks;return n?((0,l["default"])(n).forEach(function(i){e[i]||(e[i]=[]),e[i].push([t,n[i]])}),e):e},{});return(0,l["default"])(n).reduce(function(e,i){return e[i]=a(n[i],t),e},{})}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){return function(n){e.some(function(e){var i=(0,r["default"])(e,2),a=i[0],s=i[1],o=s.call(a,n,t);return n.defaultPrevented?!0:o===!0?(n.preventDefault&&n.preventDefault(),n.stopPropagation&&n.stopPropagation(),!0):!1})}}var s=n(35),r=i(s),o=n(22),l=i(o);e.exports=function(e,t){var n=e.reduce(function(e,t){var n=t.hotkeys;return n?((0,l["default"])(n).forEach(function(i){e[i]||(e[i]=[]),e[i].push([t,n[i]])}),e):e},{});return(0,l["default"])(n).reduce(function(e,i){return e[i]=a(n[i],t),e},{})}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){return e.msMatchesSelector?e.msMatchesSelector(t):e.webkitMatchesSelector?e.webkitMatchesSelector(t):e.matches(t)}function s(e,t){for(var n=0;n<t.length;++n){var i=t[n].serializers;if(i)for(var s=0;s<i.length;++s){var r=(0,l["default"])(i[s],2),o=r[0],c=r[1];if(a(e,o))return c}}return null}function r(e,t){for(var n=[],i=e.cloneNode(!0),a=i.firstChild;a;){switch(a.nodeType){case 1:var r=s(a,t);if(r){n.push(r(a));break}switch(a.tagName){case"P":case"BR":case"PRE":case"DIV":n.push("\n")}case 3:n.push(a.nodeValue)}if(a.hasChildNodes())a=a.firstChild;else{for(;a&&!a.nextSibling;)if(a=a.parentNode,a===e){a=null;break}a&&(a=a.nextSibling)}}return n.join("")}var o=n(35),l=i(o);e.exports=r},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){return t.reduce(function(e,t){var n=t.parsers;return n?n.reduce(function(e,t){return t(e)},e):e},r["default"].escape(e))}var s=n(18),r=i(s);e.exports=a},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(112),s=i(a),r=n(16),o=i(r),l=n(4),c=i(l),u=n(6),d=i(u),p=n(20),h=i(p),f=n(19),m=i(f),g=n(8),v=function(e,t){var n,i;return i=n=function(n){function i(){return(0,c["default"])(this,i),(0,h["default"])(this,(i.__proto__||(0,o["default"])(i)).apply(this,arguments))}return(0,m["default"])(i,n),(0,d["default"])(i,[{key:"render",value:function(){return g.createElement(e,(0,s["default"])({},this.props,t))}}]),i}(g.Component),n.displayName="Wrapper("+(e.displayName||e.name)+")",i};e.exports=v},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(16),s=i(a),r=n(4),o=i(r),l=n(20),c=i(l),u=n(19),d=i(u),p=n(1560),h=i(p),f=n(1565),m=i(f),g=n(1559),v=i(g),y=n(1568),_=i(y),E=n(1567),S=i(E),M=n(1557),C=i(M),b=function(e){function t(){return(0,o["default"])(this,t),(0,c["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,d["default"])(t,e),t}((0,v["default"])([h["default"],m["default"],_["default"]]));b.Suggestions=(0,C["default"])(S["default"],{plugin:m["default"]}),e.exports=b},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){return{handlers:s(e,j)}}function s(e,t){return t.reduce(function(t,n){return Array.isArray(n)?t[n[0]]=e[n[1]]:t[n]=e[n],t},{})}function r(e){return e.which===L&&(e.getModifierState("Shift")||e.getModifierState("Alt")||e.getModifierState("Control"))}function o(e,t,n){var i={};return n.forEach(function(n){return i[n]=e[n]!==t[n]}),i}var l=n(94),c=i(l),u=n(112),d=i(u),p=n(16),h=i(p),f=n(4),m=i(f),g=n(6),v=i(g),y=n(20),_=i(y),E=n(19),S=i(E),M=n(111),C=i(M),b=n(1435),T=n(1429),P=n(91),k=n(1465),N=n(8),w=n(1552),x=n(1553),O=n(1554),D=n(44),R=n(1555),I=n(1464),A=n(1556),L=13,F=function(e){function t(){var e,n,i,a;(0,m["default"])(this,t);for(var s=arguments.length,r=Array(s),o=0;s>o;o++)r[o]=arguments[o];return n=i=(0,_["default"])(this,(e=t.__proto__||(0,h["default"])(t)).call.apply(e,[this].concat(r))),U.call(i),a=n,(0,_["default"])(i,a)}return(0,S["default"])(t,e),(0,v["default"])(t,[{key:"replaceSelection",value:function(e){if(!this.props.readOnly){var t=this.refs.input;this._hasFocus(t)||(P.focus(t),this.selection&&this.restoreSelection(this.selection));var n=this.trimToFit(e);if(n.length){this.props.multiline||(n=n.replace(/\r?\n/g,"")),window.getSelection().getRangeAt(0).deleteContents();var i=t.scrollTop,a=t.scrollHeight;document.execCommand("insertHTML",!1,A(n,this.plugins)),this.onSelect();var s=t.scrollHeight,r=t.clientHeight;r>=s||(t.scrollTop=(i||0)+(s-a))}}}},{key:"restoreSelection",value:function(e){var t=this.refs.input;if(t){var n=e.anchorIndex,i=e.focusIndex,a=e.anchorOffset,s=e.focusOffset,r=t.childNodes,o=-1===n?t:r[n],l=-1===i?t:r[i];if(o&&l)try{if(o===l&&a>s){var c=[s,a];a=c[0],s=c[1]}var u=document.createRange();u.setStart(o,a),u.setEnd(l,s);var d=window.getSelection();d.removeAllRanges(),d.addRange(u)}catch(p){this.focus(!0)}}}},{key:"getSelection",value:function(){var e=this.refs.input;if(!e||document.activeElement!==e)return null;for(var t=window.getSelection(),n=t.anchorNode,i=t.anchorOffset,a=t.focusNode,s=t.focusOffset,r=e.childNodes,o=-1,l=-1,c=0,u=void 0;(0>o||0>l)&&(u=r[c++]);)n===u&&(o=c-1),a===u&&(l=c-1);return{anchorIndex:o,anchorOffset:i,focusIndex:l,focusOffset:s}}},{key:"trimToFit",value:function(e){var t=this.props.maxLength;if(!t)return e;var n=this.selectionLength,i=this.length,a=t+n-i;if(0>=a)return"";var s=I(String(e));return s.slice(0,a).join("")}},{key:"render",value:function(){var e=this.props.placeholder,t=this.state.value,n=t.length?"hidden":"visible",i=A(t,this.plugins);return N.createElement(C["default"],{className:"input-emoji",handlers:this.hotKeyMap},N.createElement("div",{className:"input-placeholder",ref:"placeholder",style:{visibility:n}},e),N.createElement("div",(0,d["default"])({},this.handlerMap,{className:D(this.props.className),contentEditable:!this.props.readOnly,dangerouslySetInnerHTML:{__html:i},"data-tab":this.props.readOnly?null:1,dir:"auto",ref:"input",spellCheck:this.props.spellCheck})))}},{key:"value",get:function(){return this.state.value}},{key:"selectionLength",get:function(){if(this.props.readOnly)return 0;var e=this.refs.input;this._hasFocus(e)||P.focus(e);var t=window.getSelection();return t.rangeCount?I(R(t.getRangeAt(0).cloneContents(),this.plugins)).length:0}},{key:"length",get:function(){return I(this.state.value).length}},{key:"isComposing",get:function(){return this.__isComposing}}]),t}(N.Component),U=function(){var e=this;this.__changeDueToReset=!1,this.__isMounted=!0,this.__isComposing=!1,this.selection=this.props.initialSelection,this.state={value:this.props.initialValue||""},this.trigger=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=e.hookMap[t];i&&i.apply(void 0,(0,c["default"])(n))},this.serializeNode=function(t){return R(t,e.plugins)},this._hasFocus=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.refs.input;if(!t)return!1;var n=document,i=n.activeElement;return i?i===t||t.contains(i):!1},this.forceFocus=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!1;if(!e.props.readOnly&&e.__isMounted){var n=e.refs.input;if(n){var i=e._hasFocus(n);if(!i||t)if(i||P.focus(n),!t&&e.selection)e.restoreSelection(e.selection);else{var a=window.getSelection();a&&a.rangeCount&&(a.selectAllChildren(n),a.collapseToEnd())}}}},this.focus=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!1;return setTimeout(function(){e.forceFocus(t)},0)},this.reset=function(){e.__changeDueToReset=!0,e.selection=null,
e.setState({value:""})},this.onSelect=function(){e.selection=e.getSelection(),e.props.onSelect&&e.props.onSelect(e.selection)},this.shouldComponentUpdate=function(t,n){var i=n.value,a=!i.length&&!!e.state.value.length,s=!!i.length&&!e.state.value.length;if(!s&&!a)return!1;var r=s?"hidden":"visible";return e.refs.placeholder&&e.refs.placeholder.setAttribute("style","visibility: "+r),a&&(e.refs.input.innerHTML=""),e.__changeDueToReset&&(e.__changeDueToReset=!1,e.refs.input&&(e.refs.input.innerHTML=A(i,e.plugins))),!1},this.componentWillReceiveProps=function(t){var n=o(e.props,t,["readOnly"]);n.readOnly&&e.refs.input.setAttribute("contentEditable",String(!t.readOnly))},this.componentWillUnmount=function(){e.__isMounted=!1,e.refs.input.restoreFocus=null},this.onInput=function(t){var n=R(e.refs.input,e.plugins),i="\n"===n?"":n,a=e.props.maxLength;if(a>0&&I(i).length>a){var s=e.selection;return e.refs.input.innerHTML=A(e.state.value,e.plugins),void(s&&e.restoreSelection(s))}e.setState({value:i},function(){e.trigger(k.CHANGE,[i]),e.props.onChange&&e.props.onChange(i)})},this.onPaste=function(t){t.preventDefault();var n=new T(t.clipboardData),i=e.props,a=i.onFiles,s=i.onTextPaste;n.hasFiles()&&a&&a(n)||n.hasText()&&n.getText().then(function(t){if(t&&(!s||!s(t))){if(I(t).length>e.props.maxLength){var n=e.props.onMaxPasteExceeded;return n&&n()}e.replaceSelection(t)}})},this.onBeforeInput=function(t){if(e.props.readOnly)return!0;var n=e.props.maxLength;if(!n)return!1;var i=t.data.charCodeAt(0);if(8===i||127===i)return!1;var a=e.selectionLength,s=e.length,r=n+a-s;return I(t.data).length>r},this.onKeyDown=function(t){return e.props.onKeyDown&&e.props.onKeyDown(t)?!0:t.which!==L?!1:e.props.multiline&&r(t)?!1:(e.props.onEnter&&e.props.onEnter(t),!0)},this.componentDidMount=function(){e.refs.input.restoreFocus=e.focus,e.trigger(k.MOUNT)},this.onBlur=function(t){return e.props.onBlur&&e.props.onBlur(t)},this.onFocus=function(t){e.props.onFocus&&e.props.onFocus(t)},this.onCompositionStart=function(t){return!(e.__isComposing=!0)},this.onCompositionEnd=function(){return e.__isComposing=!1}};e.exports=function(e){var t=function(t){function n(){var t,i,s,r;(0,m["default"])(this,n);for(var o=arguments.length,l=Array(o),u=0;o>u;u++)l[u]=arguments[u];return i=s=(0,_["default"])(this,(t=n.__proto__||(0,h["default"])(n)).call.apply(t,[this].concat(l))),s.plugins=[].concat((0,c["default"])(e.map(function(e){return e instanceof b&&e.initialize(s),e})),[a(s)]),s.handlerMap=w(s.plugins,s),s.hookMap=x(s.plugins,s),s.hotKeyMap=O(s.plugins,s),r=i,(0,_["default"])(s,r)}return(0,S["default"])(n,t),n}(F);return t};var j=["onBeforeInput","onBlur","onCompositionEnd","onCompositionStart","onFocus","onInput","onKeyDown","onPaste","onSelect"]},function(e,t,n){"use strict";var i=n(161),a=i.emojiRegex,s=i.emojiMap,r=n(9),o=r.ONE_BY_ONE_TRANS_GIF,l=a(),c={serializers:[["img.emoji",function(e){return e.getAttribute("alt")||""}]],parsers:[function(e){return e.replace("️","")},function(e){return e.replace(l,function(e,t){var n=s[t];if(!n)return"";var a=document.createElement("img");return a.setAttribute("alt",t),a.setAttribute("draggable","false"),a.setAttribute("class",i.getClasses(n)),a.setAttribute("src",o),a.outerHTML})}],handlers:{onBeforeInput:function(e,t){var n=e.data,i=l.exec(n);return i?(t.replaceSelection(i[0]),!0):!1}}};e.exports=c},function(e,t,n){"use strict";var i=n(1419),a=n(1420),s=n(1412),r=a.Direction;e.exports=function(e,t){if(!s(e))return!1;var n=a(t,r.BACKWARD);if(!n||!n.getAttribute("data-mention-jid"))return!1;var o=i(t,n),l=window.getSelection();l.removeAllRanges();var c=document.createRange();return c.setStart(t,o),c.setEnd(t,o),l.addRange(c),!0}},function(e,t,n){"use strict";var i=n(1419),a=n(1420),s=n(1412),r=a.Direction;e.exports=function(e,t){if(!s(e))return!1;var n=a(t,r.FORWARD);if(!n||!n.getAttribute("data-mention-jid"))return!1;var o=i(t,n),l=window.getSelection();l.removeAllRanges();var c=document.createRange();return c.setStart(t,o+1),c.setEnd(t,o+1),l.addRange(c),!0}},function(e,t,n){"use strict";var i=n(1419),a=n(1420),s=n(1412),r=a.Direction,o=n(54),l=o.isGecko;e.exports=function(e,t){if(!l||!s(e))return!1;var n=a(t,r.BACKWARD);if(!n||!n.getAttribute("data-mention-jid"))return!1;var o=i(t,n),c=window.getSelection();c.removeAllRanges();var u=document.createRange();return u.setStart(t,o),u.setEnd(t,o+1),c.addRange(u),!0}},function(e,t,n){"use strict";var i=n(1419),a=n(1420),s=n(1412),r=a.Direction;e.exports=function(e,t){if(!s(e))return!1;var n=a(t,r.FORWARD);if(!n||!n.getAttribute("data-mention-jid"))return!1;var o=i(t,n),l=window.getSelection();l.removeAllRanges();var c=document.createRange();return c.setStart(t,o),c.setEnd(t,o+1),l.addRange(c),!0}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){if(e.hasChildNodes())for(;e.childNodes.length;)e.removeChild(e.childNodes[0])}function s(e,t){if(!e.rangeCount)return null;var n=e.getRangeAt(0);if(!n.collapsed)return null;for(var i=0;5>i;++i)e.modify("extend","backward","word");var a=e.getRangeAt(0).cloneContents(),s=t.serializeNode(a),l=O(F,s).pop();if(!l)return r(e,n);r(e,n);for(var c=l[0].length;c--;)e.modify("extend","backward","character");var u=b.findDOMNode(t.refs.input),d=u.querySelectorAll("span[data-mention-jid]");return o(e,d)?r(e,n):{original:n,range:e.getRangeAt(0),match:l}}function r(e,t){e.removeAllRanges(),e.addRange(t)}function o(e,t){var n=t.length;if(!n)return 0;for(var i=0,a=0;n>a;++a)e.containsNode(t[a],!0)&&++i;return i}var l=n(236),c=i(l),u=n(16),d=i(u),p=n(4),h=i(p),f=n(6),m=i(f),g=n(20),v=i(g),y=n(19),_=i(y),E=n(1435),S=n(1466),M=n(61),C=n(1465),b=n(45),T=n(240),P=T.dir,k=n(54),N=k.isGecko,w=k.isTrident,x=n(249),O=x.matchAll,D=n(1563),R=n(1564),I=n(1562),A=n(1561),L=/\u200B((\d+)@c\.us)\u200B/g,F=/(?:\B|^)@((?:[^\s@]+ ?){1,3}(?:[^\s@]+)?)?$/g,U={Enter:S.ENTER,Tab:S.TAB,ArrowUp:S.UP,ArrowDown:S.DOWN},j=function(e){function t(){var e,n,i,o,l;(0,h["default"])(this,t);for(var u=arguments.length,p=Array(u),f=0;u>f;f++)p[f]=arguments[f];return i=o=(0,v["default"])(this,(e=t.__proto__||(0,d["default"])(t)).call.apply(e,[this].concat(p))),o.serializers=[["span[data-mention-jid]",function(e){return a(e),"​"+(e.getAttribute("data-mention-jid")||"")+"​"}]],o.parsers=[function(e){return e.replace(L,function(e,t,n){var i=window.Store.Contact.get(t);if(!i)return t;var a=!i.isMyContact&&i.notifyName?i.notifyName:i.formattedName,s=document.createElement("span");s.setAttribute("data-mention-jid",i.id);var r=document.createElement("span");r.setAttribute("class","at-symbol"),r.appendChild(document.createTextNode("@"));var o=document.createElement("span");return o.setAttribute("dir",P(a)||"auto"),o.appendChild(document.createTextNode(a)),s.appendChild(r),s.appendChild(o),s.outerHTML})}],o.hooks=(n={},(0,c["default"])(n,C.CHANGE,function(e,t){var n=t.refs.input;if(N)for(var i=n.querySelectorAll("[data-mention-jid]"),a=0;a<i.length;++a){var s=i[a].nextSibling;s&&s instanceof Element&&"BR"===s.tagName&&"_moz"===s.getAttribute("type")&&s.remove()}}),(0,c["default"])(n,C.MOUNT,function(e){for(var t=e.refs.input,n=t.querySelectorAll("[data-mention-jid]"),i=0;i<n.length;++i)n[i].setAttribute("contenteditable","false")}),n),o.handlers={onKeyDown:function(e,t){if(!this.ctx.isComposing){var n=t.refs.input,i=e.key;if("Backspace"===i&&D(e,n)||"Delete"===i&&R(e,n))return!1;if("ArrowRight"===i&&I(e,n)||"ArrowLeft"===i&&A(e,n))return!0}var a=U[e.key];return a?this.handle(a,[e,t]):!1},onBlur:function(){return this.handle(S.INACTIVE),!1},onSelect:function(e,t){var n=M.supportsFeature(M.F.MENTIONS_OUT);if(w||this.ctx.isComposing||!n)return!1;if(t.value.indexOf("@")<0)return this.handle(S.INACTIVE);var i=window.getSelection(),a=s(i,t);if(!a)return this.handle(S.INACTIVE);var o=a.original,l=a.match;return this.handle(S.SEARCH,[l[1]||""]),r(i,o),!1}},l=i,(0,v["default"])(o,l)}return(0,_["default"])(t,e),(0,m["default"])(t,[{key:"handleSelect",value:function(e,t){if(s(window.getSelection(),this.ctx)){this.ctx.replaceSelection("​"+e.id+"​ "),this.handle(S.INACTIVE);for(var n=this.ctx.refs.input,i=n.querySelectorAll("[data-mention-jid]"),a=0;a<i.length;++a)i[a].setAttribute("contenteditable","false")}}}]),t}(E);e.exports=new j},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(1379),m=i(f),g=n(1371),v=i(g),y=n(8),_=i(y),E=n(1384),S=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"shouldComponentUpdate",value:function(e){return this.props.className!==e.className||this.props.contact!==e.contact||this.props.term!==e.term}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.contact,i=n.id,a=n.formattedName,s=n.isMyContact,r=n.notifyName,o=e.onMouseDown,l=e.onMouseOver,c=e.onMouseUp,u=e.term,d=E.Configuration.Highlight(u?[u]:[],!0);return _["default"].createElement("div",{className:t,onMouseDown:o,onMouseUp:c,onMouseOver:l},_["default"].createElement(m["default"],{id:i,size:32,className:"mentions-result-image"}),_["default"].createElement("div",{className:"mentions-result-text-contact",dir:"auto"},_["default"].createElement(v["default"],{text:a,formatters:d})),_["default"].createElement("div",{className:"mentions-result-text-pushname",dir:"auto"},!s&&r?_["default"].createElement(v["default"],{text:r,formatters:d,className:"emoji-text"}):null))}}]),t}(_["default"].Component);e.exports=S},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){return function(n,i){return t.state.active&&t.state.results.length?(e.call(t,n,i),!0):!1}}function s(e,t){if(t.isMe)return!1;var n=[t.searchName||t.formattedName];return!t.isMyContact&&t.notifyName&&n.push(t.notifyName.toLowerCase()),n.some(function(t){return r(e,t)})}function r(e,t){var n=-1;do if(t.indexOf(e,n+1)===n+1)return!0;while(-1!==(n=t.indexOf(" ",n+1)));return!1}var o=n(16),l=i(o),c=n(4),u=i(c),d=n(6),p=i(d),h=n(20),f=i(h),m=n(19),g=i(m),v=n(1389),y=i(v),_=n(18),E=i(_),S=n(1466),M=n(8),C=n(45),b=n(1566),T=n(234),P=n(110),k=n(44),N={active:!1,offset:0,omitted:"",query:"",results:[],scrollTop:0},w=52,x=function(e){function t(){var e,n,i,s;(0,u["default"])(this,t);for(var r=arguments.length,o=Array(r),c=0;r>c;c++)o[c]=arguments[c];return n=i=(0,f["default"])(this,(e=t.__proto__||(0,l["default"])(t)).call.apply(e,[this].concat(o))),i.state=N,i.onEnter=a(function(){return i.handleSelect(i.state.offset)},i),i.onInactive=a(function(){return i.setState(N)},i),i.onSearch=function(e){var t=i,n=t.state.omitted;n&&E["default"].startsWith(e,n)||i.props.chat&&i.props.chat.isGroup&&i.setState({active:!0,offset:0,omitted:null,query:e,results:i.getResults(e)})},i.onEscape=function(){i.setState({active:!1,offset:0,omitted:i.state.query,query:"",results:[]})},i.onUp=a(function(){var e=Math.max(i.state.offset-1,0);i.setOffset(e)},i),i.onDown=a(function(){var e=i.state.results.length-1,t=Math.min(i.state.offset+1,e);i.setOffset(t)},i),s=n,(0,f["default"])(i,s)}return(0,g["default"])(t,e),(0,p["default"])(t,[{key:"componentWillMount",value:function(){var e=this.props.plugin;e.registerHandler(S.ENTER,this.onEnter),e.registerHandler(S.TAB,this.onEnter),e.registerHandler(S.SEARCH,this.onSearch),e.registerHandler(S.INACTIVE,this.onInactive),e.registerHandler(S.UP,this.onUp),e.registerHandler(S.DOWN,this.onDown)}},{key:"componentWillUnmount",value:function(){var e=this.props.plugin;e.unregisterHandler(S.ENTER),e.unregisterHandler(S.TAB),e.unregisterHandler(S.SEARCH),e.unregisterHandler(S.INACTIVE),e.unregisterHandler(S.UP),e.unregisterHandler(S.DOWN)}},{key:"handleSelect",value:function(e){var t=this.state.results[e];if(t&&t.id){var n=this.props.chat.assignedColor(t.id);this.props.plugin.handleSelect(t,n)}}},{key:"getResults",value:function(e){var t=this.props.chat.groupMetadata.participants,n=t.models.map(function(e){var t=e.contact;return t}),i=(e||"").toLowerCase(),a=n.filter(function(e){return s(i,e)});return a}},{key:"setOffset",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!1,n=e*w,i=n+w,a=C.findDOMNode(this.refs.overflow),s=a.scrollTop,r=s+a.clientHeight,o={offset:e,scrollTop:s};t||(s>n?o.scrollTop=n:i>r&&(o.scrollTop+=i-r)),this.setState(o)}},{key:"renderList",value:function(e,t,n){var i=this;if(!e||!t.length)return null;var a=t.map(function(e,t){return M.createElement(b,{key:e.id,contact:e,term:n,ref:"mention-result-"+t,className:k("mentions-result",{selected:t===i.state.offset}),onMouseDown:function(e){return e.preventDefault()},onMouseUp:function(){return i.handleSelect(t)},onMouseOver:function(){return i.setOffset(t,!0)}})});return M.createElement(T,{displayName:"MentionSuggestions",escapable:!0,requestDismiss:this.onEscape},M.createElement("div",{className:"mentions-overlay-container"},M.createElement("div",{className:"mentions-results-container","data-list-scroll-container":"true",ref:"overflow"},M.createElement(y["default"],{data:a,height:w,scrollTop:this.state.scrollTop,animate:!1}))))}},{key:"render",value:function(){var e=this.state,t=e.query,n=e.results,i=e.active;return M.createElement(P,{component:"div",className:"mentions-positioning-container",transitionName:"slide-up"},this.renderList(i,n,t))}}]),t}(M.Component);e.exports=x},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(16),s=i(a),r=n(4),o=i(r),l=n(20),c=i(l),u=n(19),d=i(u),p=n(1435),h=i(p),f=n(10),m=i(f),g=n(1412),v=i(g),y=function(e){function t(){var e,n,i,a;(0,o["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return n=i=(0,c["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(l))),i.handlers={onKeyDown:function(e){return this.ctx.isComposing?!1:" "===e.key&&(0,v["default"])(e)?this.ctx.value.length?!1:(m["default"].scrollMessages(),!0):!1}},a=n,(0,c["default"])(i,a)}return(0,d["default"])(t,e),t}(h["default"]);t["default"]=new y},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(8),o=n(13),l=n(10),c=n(1382),u=n(1400),d=n(1612),p=n(1407),h=r.createClass({displayName:"TakePhotoMenuItem",propTypes:{onImageTake:r.PropTypes.func.isRequired},onCapture:function(){var e=this,t=new s["default"](function(n,i){navigator.getUserMedia({video:!0},function(i){l.closeModal(),n(i),t.isPending()||l.openModal(r.createElement(u,{type:u.BOX},r.createElement(d,{stream:i,onFinished:e.props.onImageTake,handleStreamClose:!1})))},function(e){var n=_.isString(e)?e:e.name,a=o.GUM[n]||o.GUM.GUMError;i(new a),t&&!t.isPending()&&l.closeModal()})}).timeout(1500,"waitForGUMTakePhotoTimeout").then(function(t){l.openModal(r.createElement(u,{type:u.BOX},r.createElement(d,{stream:t,onFinished:e.props.onImageTake,handleStreamClose:!1})))})["catch"](s["default"].TimeoutError,function(e){l.openModal(r.createElement(p,{title:"guide_desktop_camera_title",desc:"guide_desktop_camera_description",type:p.TYPE.GUIDE_ALLOW}))})["catch"](o.GUM.PermissionDeniedError,function(){l.openModal(r.createElement(p,{title:"guide_desktop_camera_title",desc:"guide_desktop_camera_fail_description",type:p.TYPE.GUIDE_UNBLOCK}))})["catch"](o.GUM.GUMError,function(){l.openModal(r.createElement(p,{title:"guide_desktop_camera_missing_title",desc:"guide_desktop_camera_missing_description",type:p.TYPE.GUIDE_NONE}))})},render:function(){return r.createElement(c,{action:this.onCapture,a8n:"mi-take-photo"},l10n.t("take_photo"))}});e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(112),s=i(a),r=n(114),o=i(r),l=n(8),c=n(10),u=n(92),d=l.createClass({displayName:"UIETooltip",propTypes:{tooltip:l.PropTypes.object.isRequired},componentDidMount:function(){var e=this,t=this.props.tooltip,n=t.menu,i=(0,o["default"])(t,["menu"]);c.openTooltip(n,(0,s["default"])({},i),this.context.uim,function(t){return e.element=t})},componentWillUnmount:function(){c.closeTooltip(this.context.uim)},getElement:function(){return this.element},render:function(){return null}});d.contextTypes={uim:l.PropTypes.instanceOf(u)},e.exports=d},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(115),s=i(a),r=n(8),o=n(45),l=n(93),c=n(158),u=n(156),d=n(160),p=n(1602),h=n(1623),f=n(13),m=n(9),g=n(10),v=void 0,y=r.createClass({displayName:"Conversation",mixins:[l,c,u,d],getInitialState:function(){return{chat:void 0,msgCollection:void 0,focusCtx:void 0}},componentWillMount:function(){this.regCmd("open_chat",this.handleOpenChat),this.regCmd("clear_chat",this.handleClearChat),this.regNativeListener(window,"focus",this.windowGainedFocus),this.regNativeListener(window,"blur",this.windowLostFocus)},componentDidMount:function(){var e=this.safeDebounce(this.windowResized,100);this.regNativeListener(window,"resize",e),e()},windowResized:function(){v=o.findDOMNode(this).clientHeight},shouldComponentUpdate:function(e,t){return t!==this.state||e.animate!==this.props.animate},componentDidUpdate:function(e,t){var n=this.state.chat,i=t.chat;n&&i!==n&&(this.addObserver(n,"change:cmc:merge",this.msgCollectionChanged),i&&this.removeObserver(i,"change:cmc:merge"))},msgCollectionChanged:function(e,t,n){var i=this.state.msgCollection;i!==e&&i!==t||this.setState({msgCollection:n})},windowGainedFocus:function(){s["default"].markAvailable();var e=this.state.chat;e&&e.isUser&&e.presence.subscribe()["catch"](f.WapDrop,_.noop)},windowLostFocus:function(){s["default"].markUnavailable(m.SEND_UNAVAILABLE_WAIT)},handleClearChat:function(e){this.state.chat===e&&this.setState({chat:void 0,msgCollection:void 0,focusCtx:void 0})},handleOpenChat:function(e,t,n){var i=this;g.updateChatlistSelection(e);var a=this.openedChatInfo,s={},r=function(e){_.assign(s,e)};this.state.chat!==e?this.setState({chat:e,msgCollection:t?t.collection:e.msgs,focusCtx:t,notifyChatRendered:function(){return n(i.newChatScrollInfo(a,t))},updateOpenedChatInfo:r}):this.setState({msgCollection:t?t.collection:e.msgs,focusCtx:t,notifyChatRendered:function(){return n(i.newChatScrollInfo(a,t))},updateOpenedChatInfo:r}),this.openedChatInfo=s},newChatScrollInfo:function(e,t){var n=t?t.msg||Store.Msg.get(t.key):void 0;if(t&&n&&e&&e.chat&&e.renderedMsgsInfo&&e.visibleMsgOrder&&!_.isEmpty(e.renderedMsgsInfo)&&!_.isEmpty(e.visibleMsgOrder)){var i=e.renderedMsgsInfo[_.head(e.visibleMsgOrder)],a=_.find(e.renderedMsgsInfo,function(e,t){return t===n.id.toString()});return a?{wasVisible:!0,offset:a.offset}:e.chat===n.chat?n.t<i.t?{wasVisible:!1,alignAt:"top"}:{wasVisible:!1,alignAt:"bottom"}:{wasVisible:!1,alignAt:"center"}}return{wasVisible:!1,alignAt:"center"}},render:function(){var e=this.state,t=e.chat,n=e.msgCollection,i=e.focusCtx;return t?r.createElement(p,{key:t.id,chat:t,msgCollection:n,height:v,focusCtx:i,notifyChatRendered:this.state.notifyChatRendered,updateOpenedChatInfo:this.state.updateOpenedChatInfo}):r.createElement("div",{className:"pane pane-two"},r.createElement(h,{animate:this.props.animate,className:"pane-body"}))}});e.exports=y},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1370),o=i(r),l=n(1437),c=i(l),u=n(1371),d=i(u),p=n(8),h=n(9),f=n(116),m=n(1372),g=n(1376),v=n(160),y=n(1471),E=n(1459),S=n(1379),M=n(1611),C=n(1479),b=n(1483),T=n(10),P=n(1407),k=n(233),N=n(13),w=n(61),x=n(1411),O=x.MenuBar,D=x.MenuBarItem,R=n(467),I=n(1382),A=n(1467),L=n(1416),F=n(1446),U=n(92),j=p.createClass({displayName:"ConversationHeader",mixins:[m,g,v],propTypes:{chat:p.PropTypes.instanceOf(o["default"]).isRequired,onSelectMessages:p.PropTypes.func.isRequired,canAttach:p.PropTypes.bool.isRequired},statics:{ATTACH_MEDIA_ACTIVE:"attach_media_active",GROUP_CHAT_ACTIVE:"group_chat_active"},getInitialState:function(){return this.asyncState({img:"chat.ProfilePicThumb.img",formattedTitle:"chat.formattedTitle"},{activeDropdown:void 0})},componentWillMount:function(){},onWindowFocus:function(){var e=this;this.setState({newlyFocused:!0}),this.safeDelay(function(){return e.setState({newlyFocused:!1})},100)},onMouseDown:function(e){},onDrag:function(e){this.didDrag=!0},onClickCapture:function(e){},onInfoPanel:function(){var e=this.props.chat;!e.isPSA&&(e.isUser||e.isBroadcast||e.isGroup)&&T.openDrawerRight(p.createElement(C,{chat:e,key:"info-"+e.id}),"slide-left",this.context.uim)},checkForDrawerMid:function(e){T.existsDrawerMid(function(t){t&&e.preventDefault()})},onChatSearch:function(e){e.preventDefault();var t=this.props.chat;T.openDrawerRight(p.createElement(b,{chat:t,key:"chat-search-"+t.id}),"slide-left",this.context.uim)},onCaptureClick:function(){var e=this,t=this.props.chat,n=L.start("camera");s["default"].race([n,this.rejectOnUnmount()]).bind(this).checkpoint(this.rejectOnUnmount()).then(function(n){T.openDrawerMid(p.createElement(M,{chat:t,stream:n}),"slide-up",e.context.uim,{noFocus:!0})})["catch"](N.Unmount,function(){n.then(function(e){return L.stop(e)})["catch"](_.noop)})["catch"](N.GUM.PermissionDeniedError,function(){T.openModal(p.createElement(P,{title:"guide_desktop_camera_title",desc:"guide_desktop_camera_fail_description",type:P.TYPE.GUIDE_UNBLOCK}))})["catch"](N.GUM.GUMError,function(){T.openModal(p.createElement(P,{title:"guide_desktop_camera_missing_title",desc:"guide_desktop_camera_missing_description",type:P.TYPE.GUIDE_NONE}))})},render:function(){var e,t,i=this.props.chat;i.isUser?(e=p.createElement(V,{chat:i,onSelectMessages:this.props.onSelectMessages}),t=p.createElement(c["default"],{presence:i.presence,chatstate:i.presence.chatstate,placeholder:l10n.t("click_here_for_user_info"),location:"title"})):i.isBroadcast?(e=p.createElement(H,{chat:i,onSelectMessages:this.props.onSelectMessages}),t=null):i.isGroup&&(e=p.createElement(B,{chat:i,onSelectMessages:this.props.onSelectMessages}),t=p.createElement(E,{presence:i.presence,groupMetadata:i.groupMetadata,placeholder:l10n.t("click_here_for_group_info"),location:"title"}));var a=n(61),s=a.supportsFeature(a.F.FTS_IN_CONV)?p.createElement(D,{a8n:"search-button",icon:"search-alt",title:l10n.t("search"),onClick:this.onChatSearch}):null,r=this.props.canAttach?p.createElement(D,{a8n:"conversation-clip",icon:"clip",title:l10n.t("menutitle_attach"),transitionName:"menu",onClick:this.checkForDrawerMid},p.createElement(G,{chat:i,onCaptureClick:this.onCaptureClick})):null,o="chat-avatar",l="chat-body",u="chat-title",h=null,f=i.contact&&i.contact.isVerified;return(i.isPSA||f)&&(i.isPSA&&(o+=" chat-psa",l+=" chat-psa",t=null),u+=" chat-title-verified",h=p.createElement("span",{className:"icon-psa-verified"})),p.createElement("header",{className:"pane-header pane-chat-header",onClickCapture:this.onClickCapture,onMouseDown:this.onMouseDown},p.createElement("div",{className:o,onClick:this.onInfoPanel},p.createElement(S,{id:i.id,size:40})),p.createElement("div",{className:l,onClick:this.onInfoPanel},p.createElement("div",{className:"chat-main"},p.createElement("h2",{className:u,dir:"auto"},p.createElement(d["default"],{text:i.title(),titlify:!0,ellipsify:!0}),h)),t),p.createElement("div",{className:"pane-chat-controls"},p.createElement(O,{key:"conversation-header"},s,r,p.createElement(D,{a8n:"conversation-menu",icon:"menu",title:l10n.t("menutitle_menu"),onClick:this.checkForDrawerMid},e))))}});j.contextTypes={uim:p.PropTypes.instanceOf(U)};var G=p.createClass({displayName:"AttachMenuDropdown",mixins:[g],propTypes:{chat:p.PropTypes.instanceOf(o["default"]).isRequired},canSendDocument:function(){return w.supportsFeature(w.F.ENC_DOC)},onDocumentPick:function(e){if(e){e.stopPropagation();var t=_.toArray(e.target.files);t.length&&(e.target.value="",this.canSendDocument()?T.attachMediaDrawer(this.props.chat,t):this.showCantSendDocument())}},onMediaPick:function(e){if(e){e.stopPropagation();var t=_.toArray(e.target.files);t.length&&(e.target.value="",T.attachMediaDrawer(this.props.chat,t))}},onMediaClick:function(e){e.preventDefault(),this.refs.mediaPicker.triggerInput()},onDocumentClick:function(e){e.preventDefault(),this.canSendDocument()?this.refs.docPicker.triggerInput():this.showCantSendDocument()},confirmContactSend:function(e){var t=this,n=void 0;n=this.props.chat.isUser?l10n.t("confirm_contact_send_chat",{name:e.formattedName,chat:this.props.chat.title()}):this.props.chat.isGroup?l10n.t("confirm_contact_send_group",{name:e.formattedName,chat:this.props.chat.title()}):l10n.t("confirm_contact_send_broadcast",{name:e.formattedName}),T.openModal(p.createElement(k,{key:"contact_confirm",onOK:function(){return t.sendContact(e)},onCancel:function(){return T.closeModal()}},n))},sendContact:function(e){this.props.chat.sendContact(e),T.closeModal()},onContactClick:function(e){e.preventDefault(),T.openModal(p.createElement(F,{key:"contacts",title:l10n.t("send_contact"),filter:Store.Contact.isFilteredContact,onCancel:function(){return T.closeModal()},onSelect:this.confirmContactSend}))},showCantSendDocument:function(e){var t;if(e instanceof N.InvalidMediaFileType)t=l10n.t("cannot_send_document_type_unsupported");else if(e instanceof N.MediaFileTooLarge)t=l10n.t("document_too_big",{maxSize:h.MAX_MEDIA_UPLOAD_SIZE/1024/1024+"MB"});else{var n=this.props.chat;t=n.isUser?l10n.t("cannot_send_document_to_contact_unsupported",{contact:n.title()}):l10n.t("cannot_send_document_to_group_unsupported",{group:n.title()})}T.openModal(p.createElement(k,{key:"doc_cant_send",onOK:T.closeModal.bind(T)},p.createElement(d["default"],{text:t})))},onCaptureClick:function(){this.props.onCaptureClick()},render:function(){var e=p.createElement(A,{direction:"left",className:"tooltip-menu",body:l10n.t("attach_capture")}),t=navigator.getUserMedia?p.createElement(I,{tooltip:e,a8n:"mi-attach-camera",action:this.onCaptureClick},p.createElement("button",{className:"menu-icons-item"},p.createElement("div",{className:"icon-xl icon-camera"}))):null,n=void 0;if(w.supportsFeature(w.F.ENC_DOC)){var i=p.createElement(A,{direction:"left",className:"tooltip-menu",body:l10n.t("attach_document")});n=p.createElement(I,{tooltip:i,ref:"docPicker",a8n:"mi-attach-document",action:this.onDocumentClick,filePickerMimes:f.DOC_MIMES,onFilePick:this.onDocumentPick},p.createElement("button",{className:"menu-icons-item"},p.createElement("div",{className:"icon-xl icon-document"})))}var a=p.createElement(A,{direction:"left",className:"tooltip-menu",body:l10n.t("attach_media")}),s=p.createElement(I,{tooltip:a,ref:"mediaPicker",a8n:"mi-attach-media",filePickerMimes:[h.IMAGE_MIMES,h.VIDEO_MIMES].join(","),action:this.onMediaClick,onFilePick:this.onMediaPick},p.createElement("button",{className:"menu-icons-item"},p.createElement("div",{className:"icon-xl icon-image"}))),r=p.createElement(A,{direction:"left",className:"tooltip-menu",body:l10n.t("attach_vcard")}),o=p.createElement(I,{tooltip:r,a8n:"mi-attach-contact",action:this.onContactClick},p.createElement("button",{className:"menu-icons-item"},p.createElement("div",{className:"icon-xl icon-contact"})));return p.createElement("div",null,p.createElement(R,{type:R.Type.MENU,key:"AttachMenuDropdown"},s,t,n,o))}}),B=p.createClass({displayName:"GroupMenuDropdown",mixins:[m],propTypes:{chat:p.PropTypes.instanceOf(o["default"]).isRequired,onSelectMessages:p.PropTypes.func.isRequired},getInitialState:function(){return{isReadOnly:this.async("chat.isReadOnly")}},render:function(){var e=y.group(this.props.chat,this.props.onSelectMessages);return p.createElement(R,{type:R.Type.DROPDOWN_MENU,key:"GroupMenuDropdown",flipOnRTL:!0,direction:{x:R.Direction.X.LEFT}},e)}}),H=p.createClass({displayName:"BroadcastMenuDropdown",propTypes:{chat:p.PropTypes.instanceOf(o["default"]).isRequired,onSelectMessages:p.PropTypes.func.isRequired},render:function(){var e=y.broadcast(this.props.chat,this.props.onSelectMessages);return p.createElement(R,{type:R.Type.DROPDOWN_MENU,key:"BroadcastMenuDropdown",flipOnRTL:!0,direction:{x:R.Direction.X.LEFT}},e)}}),V=p.createClass({displayName:"ContactMenuDropdown",propTypes:{chat:p.PropTypes.instanceOf(o["default"]).isRequired,onSelectMessages:p.PropTypes.func.isRequired},render:function(){var e=y.contact(this.props.chat,this.props.onSelectMessages);return p.createElement(R,{type:R.Type.DROPDOWN_MENU,key:"ContactMenuDropdown",flipOnRTL:!0,direction:{x:R.Direction.X.LEFT}},e)}});e.exports=j},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(460),s=i(a),r=n(1370),o=i(r),l=n(8),c=n(45),u=n(1429),d=n(9),p=n(1372),h=n(156),f=n(93),m=n(160),g=n(1376),v=n(1599),y=n(1574),E=n(10),S=n(1402),M=n(158),C=n(62),b=n(44),T=n(1471),P=n(55),k=n(1512),N=n(1385),w=n(1593),x=n(110),O=n(1),D=n(76),R=n(1397),I=n(234),A=n(159),L=n(91),F=n(461),U=n(13),j=3e3,G=8.5,B=300,H=v.UpdateTypes,V=v.UpdateTypePriority,q=l.createClass({displayName:"ConversationMsgs",mixins:[p,f,h,M,m,g],propTypes:{chat:l.PropTypes.instanceOf(o["default"]).isRequired,msgCollection:l.PropTypes.instanceOf(S).isRequired,selectable:l.PropTypes.bool,onMessageSelect:l.PropTypes.func.isRequired,onSelectMessages:l.PropTypes.func.isRequired,focusCtx:l.PropTypes.object,selectedMessages:l.PropTypes.instanceOf(N),notifyChatRendered:l.PropTypes.func,updateOpenedChatInfo:l.PropTypes.func.isRequired},getInitialState:function(){return this.rerender=this.safeDebounce(this._rerender,100),this.handleScroll=_.throttle(this._handleScroll,100),this.initialState(this.props)},componentWillMount:function(){var e=this;this._hideStickyDateMarkerTimer=new P(function(){return e.hideFloatingMarker()})},componentDidMount:function(){var e=this,t=this.props,n=t.chat,i=t.msgCollection;if(this.regCmd("compose_height_change",this.composeHeightChange),this.regCmd("scroll_chat_to_bottom",this.scrollToBottom),this.regCmd("scroll_to_focused_msg",function(){e.chatOpenScrollTimestamp=Date.now()}),this.attachMsgCollectionObservers(this.props,void 0),this.regNativeListener(window,"focus",this.windowGainedFocus),this.regNativeListener(window,"blur",this.windowLostFocus),this.handleResize=_.throttle(function(){e.updateMsgListInfo(),e.updateFloatingDateMarker()},100),this.updateNearBottomOnResize=this.safeDebounce(this.updateNearBottom,100),this.regNativeListener(window,"resize",this.handleResize),this.regNativeListener(window,"resize",this.updateNearBottomOnResize),this.addObserver(n,"change:trusted"),this.regCmd("textsize_change",function(t){e.setState({textsize:t})}),n.isGroup?this.addObserver(n.groupMetadata.participants,"change:contact.name change:contact.isMyContact change:contact.notifyName",this.rerender):n.isUser&&this.addObserver(n.contact,"change:isMyContact",this.rerender),this.addObserver(i,"change:star",this.rerender),this.addObserver(n,"change:quotedMsg",this.onQuotedMsgChange),!this.props.focusCtx){var a=c.findDOMNode(this.refs.scrollContainer),s=c.findDOMNode(this.refs.messageList);s&&s.clientHeight<a.clientHeight&&this.loadEarlierMsgs()}this.updateMsgListInfo(),this.updateFloatingDateMarker(),this.props.updateOpenedChatInfo({chat:n}),n.sendSeen();var r=void 0,o=void 0,l=void 0;this.regCmd("panes_will_change",function(t){if(e.msgListInfo&&e.msgListInfo.visibleMsgOrder&&e.msgListInfo.visibleMsgOrder.length&&e.refs.messageList){var n=_.last(e.msgListInfo.visibleMsgOrder).toString();l=c.findDOMNode(e.refs.messageList.refs[n]),o=c.findDOMNode(e.refs.scrollContainer),r=e.getMsgBottom(o,l)}}),this.regCmd("panes_did_change",function(t){o&&l&&!_.isUndefined(r)&&(e.setMsgBottom(o,l,r),l=void 0,o=void 0,r=void 0)})},getMsgBottom:function(e,t){var n=e.scrollTop,i=e.scrollHeight,a=e.clientHeight,s=i-(n+a);return i-(t.offsetTop+t.clientHeight+s)},setMsgBottom:function(e,t,n){var i=t.offsetTop,a=t.clientHeight,s=i+a+n-e.clientHeight;this.setScrollTop(e,s)},_rerender:function(){var e=this,t=c.findDOMNode(this.refs.scrollContainer),n=t.scrollTop;this.setState({msgListKey:this.state.msgListKey+1},function(){e.setScrollTop(t,n)})},componentDidUpdate:function(e,t){
if(this.updateType=H.DEFAULT,this.updateMsgListInfo(),t.msgListKey===this.state.msgListKey){var n=e.chat===this.props.chat;this.updateFloatingDateMarker(n),this.props.updateOpenedChatInfo({chat:this.props.chat})}},initialState:function(e){var t=e.focusCtx,n=e.chat,i=e.msgCollection;this.updateType=H.DEFAULT,this.msgListInfo={visibleMsgs:{},dateMarker:void 0};var a,s=t||this.getUnreadFocusCtx(e),r=s&&s.msg,o=r&&r.id;return a=0,{msgListKey:0,cursor:new k(i,o,n.isGroup?d.RENDOR_CURSOR.GROUP_CONVERSATION:d.RENDOR_CURSOR.CONVERSATION),unreadCount:n.pendingSeenCount?0:n.unreadCount,isNearBottom:!0,newUnread:0,focusCtx:s,contextMenu:!1,textsize:a}},attachMsgCollectionObservers:function(e,t){var n=this,i=e.chat,a=e.msgCollection,s=e.focusCtx;this.props.msgCollection&&(this.removeObserver(this.props.chat,"change:unreadCount"),this.removeObserver(this.props.msgCollection,"change:last"),this.removeObserver(this.props.msgCollection,"remove_msgs",this.onMsgsDelete),this.removeObserver(this.props.chat.msgs,"change:last")),a===i.msgs&&this.addObserver(i,"change:unreadCount",this.onUnreadCount),this.addObserver(i.msgs,"change:last",this.onLastMsgChanged),this.addObserver(a,"remove_msgs",this.onMsgsDelete),this.state.cursor.msgCollection=a;var r=s,o=function(){return r.key&&(r.msg=Store.Msg.get(r.key)),r.msg?(n.setUpdateType(H.KEEP_SCROLL_BOTTOM),void n.setState({cursor:n.state.cursor.init(r.msg.id)})):E.openChatBottom(n.props.chat)};r&&a.loadAroundPromise?a.loadAroundPromise.checkpoint(this.rejectOnUnmount()).then(o)["catch"](U.Unmount,_.noop)["catch"](U.E404,function(){E.openToast(l.createElement(F,{msg:A.t("message_query_404"),id:F.genId()})),o()})["catch"](o):r&&o()},isMostRecentCMC:function(){return this.props.chat.msgs===this.props.msgCollection},componentWillReceiveProps:function(e){var t=this;this.attachMsgCollectionObservers(e,this.props.focusCtx);var n=_.clone(e);n.selectable=!e.selectable,_.isEqual(n,this.props)||this.setState(this.initialState(e),function(){t.props.chat.sendSeen()})},componentWillUnmount:function(){this._hideStickyDateMarkerTimer.cancel(),this.handleScroll.cancel(),this.handleResize.cancel(),this.maybeSendSeen()&&(this.props.chat.markedUnread=!1)},loadEarlierMsgs:function(){var e=this,t=this.props,n=t.chat,i=t.msgCollection,a=this.state.cursor;if(a.start>0)a.hasBefore()&&(this.setUpdateType(H.KEEP_SCROLL_BOTTOM),this.setState({cursor:a.loadBefore()}));else{if(i.msgLoadState.noEarlierMsgs||i.msgLoadState.isLoadingEarlierMsgs||i.msgLoadState.isLoadingAroundMsgs)return;n.loadEarlierMsgs(i).checkpoint(this.rejectOnUnmount()).then(function(){a.hasBefore()?(e.setUpdateType(H.KEEP_SCROLL_BOTTOM),e.setState({cursor:a.loadBefore()})):i.msgLoadState.noEarlierMsgs&&e.setState({})})["catch"](U.Unmount,_.noop)["catch"](function(e){O.log("ConversationMsgs:loadEarlierMsgs failed")(),O.log(e)()})}},loadRecentMsgs:function(){var e=this,t=this.props,n=t.chat,i=t.msgCollection,a=this.state.cursor;if(a.end<i.length)this.setUpdateType(H.KEEP_SCROLL_TOP),this.setState({cursor:a.loadAfter()});else{if(i.msgLoadState.isLoadingRecentMsgs||i.msgLoadState.isLoadingAroundMsgs)return;n.loadRecentMsgs(i).checkpoint(this.rejectOnUnmount()).then(function(){a.hasAfter()?(e.setUpdateType(H.KEEP_SCROLL_TOP),e.setState({cursor:a.loadAfter()})):e.state.cursor.end>=i.length&&e.isMostRecentCMC()&&e.setState({})})["catch"](U.Unmount,_.noop)["catch"](function(e){O.log("ConversationMsgs:loadRecentMsgs failed")(),O.log(e)()})}},composeHeightChange:function(e){var t=this,n=c.findDOMNode(this.refs.scrollContainer);if(e){if(0>e&&n.scrollTop===n.scrollHeight-n.clientHeight)return;this.setScrollTop(n,n.scrollTop+e)}else!function(){var e=n.scrollHeight-(n.scrollTop+n.clientHeight);(0,s["default"])(n,{tween:18},{progress:function(){t.setScrollTop(n,n.scrollHeight-e-n.clientHeight)},duration:300},[.1,.82,.25,1])}()},getScrollBottom:function(){var e=c.findDOMNode(this.refs.scrollContainer);return e.scrollHeight-(e.scrollTop+e.clientHeight)},setScrollBottom:function(e){var t=c.findDOMNode(this.refs.scrollContainer);this.setScrollTop(t,t.scrollHeight-e-t.clientHeight)},onStickyDateMarkerUpdated:function(e){var t=this.refs.stickyDateMarker;t&&t.updateDateMarkerText(e)},hideFloatingMarker:function(){var e=this.refs.stickyDateMarker;e&&e.hideStickyDateMarker(!0)},setScrollTop:function(e,t){this.programmaticScroll=Date.now(),e.scrollTop=t},updateFloatingDateMarker:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!1,t=this.msgListInfo.dateMarker;if(this.isMounted()&&void 0!==t){var n=e||Date.now()-(this.programmaticScroll||0)<200;if(!n){var i=this.refs.stickyDateMarker;i&&i.hideStickyDateMarker(!1)}if(this.refs.messageList){var a=this.refs.messageList.refs;if(-1===t)this.onStickyDateMarkerUpdated();else if(a){var s=a["dateMarker_"+t];if(s){var r=s.props.timestamp,o=D.relativeDateStr(r).toUpperCase();this.onStickyDateMarkerUpdated(o)}}if(a&&t!==this.dateMarkerIdx){var l=a["dateMarker_"+this.dateMarkerIdx],c=a["dateMarker_"+t];l&&l.hide(!1),c&&c.hide(!0),this.dateMarkerIdx=t}n||this._hideStickyDateMarkerTimer.debounce(j)}}},setUpdateType:function(e){V[e]>=V[this.updateType]&&(this.updateType=e)},nearBottom:function(e){return e=e||c.findDOMNode(this.refs.scrollContainer),e.scrollTop+d.SCROLL_FUDGE>e.scrollHeight-e.clientHeight},updateNearBottom:function(){var e=this.nearBottom();this.nearBottom!==e&&(this.setUpdateType(H.NONE),this.setState({isNearBottom:e}))},getUnreadFocusCtx:function(e){var t=e||this.props,n=t.chat,i=t.msgCollection,a=t.focusCtx;if((!a||this.isMostRecentCMC())&&n.unreadCount){var s=_(i.toArray()).filter(function(e){return e.isUnreadType}).reverse().take(n.unreadCount).value();if(s.length===n.unreadCount)return s=_.last(s),{msg:s,isUnreadDivider:!0,highlightMsg:!1}}},getMsgs:function(){var e=this.props.msgCollection,t=this.state.cursor;return e.toArray().slice(t.start,t.end)},updateMsgListInfo:function(){var e=this.refs.messageList;if(e){for(var t=e.props.msgs,n=e.refs,i={},a=[],s=0,r=t.length-1;r>s;){var o=Math.floor((s+r)/2),l=n[t[o].id.toString()],u=c.findDOMNode(l);u||(O.error("invalid ref lookup for ref: "+t[o].id.toString()+" msg index: "+o)(),_.forEach(_.keys(n),function(e){O.info(""+e)()}),O.error("msg ids: ")(),_.forEach(t,function(e){O.info(""+e.id)()})),e.getMsgVisibility(l).visibility===d.VISIBILITY.ABOVE?s=o+1:r=o}for(var p=s;p<t.length;p++){var h=n[t[p].id.toString()],f=e.getMsgVisibility(h);if(f.visibility!==d.VISIBILITY.VISIBLE)break;i[t[p].id.toString()]={offset:f.offset,t:t[p].t},a.push(t[p].id)}var m=_.pickBy(n,function(e,t){return _.startsWith(t,"dateMarker_")}),g=c.findDOMNode(this.refs.scrollContainer),v=g.scrollTop,y=n.dateMarker_0?c.findDOMNode(n.dateMarker_0).offsetTop:void 0;if(s=0,r=_.size(m)-1,_.size(m)&&v+G>=y)for(;r>s;){var E=Math.ceil((s+r)/2),S=c.findDOMNode(n["dateMarker_"+E]);if(!S)return;S.offsetTop>v+G?r=E-1:s=E}else s=-1;this.msgListInfo.dateMarker=s,this.pauseHiddenGifs(this.msgListInfo.visibleMsgs,i),this.msgListInfo.visibleMsgs=i,this.msgListInfo.visibleMsgOrder=a,this.props.updateOpenedChatInfo({renderedMsgsInfo:i,visibleMsgOrder:a,clientHeight:g.clientHeight})}},isMsgVisible:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!1;return!!this.msgListInfo.visibleMsgs[e.toString()]&&(t?!0:this.getMsgComponent(e))},getMsgComponent:function(e){var t=this.refs.messageList;if(t){var n=t.refs[e.toString()];if(n)return n.refs.component&&n.refs.component.refs.msg}},pauseHiddenGifs:function(e,t){for(var n in e)if(!t[n]){var i=this.props.msgCollection.get(n);if(i&&i.isGif){var a=this.getMsgComponent(n);a&&a.playCount&&a.pause()}}},onScroll:function(e){this.handleScroll(e.target,this.props.chat,this.nearBottom,this)},_handleScroll:function(e,t,n){this.updateMsgListInfo(),e.scrollTop<B&&Date.now()-(this.chatOpenScrollTimestamp||0)>d.MSG_FOCUS_SCROLL_ANIMATION_DURATION+50&&this.loadEarlierMsgs();var i=this.state,a=i.isNearBottom,s=i.cursor,r=n(e);r?(this.maybeSendSeen(!0),this.isMostRecentCMC()&&a!==r&&(this.setUpdateType(H.NONE),this.setState({isNearBottom:r,newUnread:0})),(s.end<this.props.msgCollection.length||!this.isMostRecentCMC())&&this.loadRecentMsgs()):a!==r&&(this.setUpdateType(H.NONE),this.setState({isNearBottom:r})),this.updateFloatingDateMarker()},windowGainedFocus:function(){var e=this.props.chat;!this.clearUnreadTimer&&e.isDirty()&&(this.clearUnreadTimer=this.safeDelay(function(){delete this.clearUnreadTimer,this.maybeSendSeen()},d.CLEAR_CHAT_DIRTY_WAIT))},windowLostFocus:function(){if(this.state.unreadCount&&this.isMostRecentCMC()){var e=this.props.chat;0===e.unreadCount&&(this.setUpdateType(H.KEEP_SCROLL_BOTTOM),this.setState({unreadCount:0})),e.markedUnread=!1}},maybeSendSeen:function(e,t){var n=this.props,i=n.chat,a=n.msgCollection,s=this.state.cursor;return i.isDirty()&&this.isMostRecentCMC()&&s.end>=a.length&&(_.isUndefined(t)&&(t=document.hasFocus()),t&&(_.isUndefined(e)&&(e=this.nearBottom()),e))?(i.sendSeen(),!0):void 0},jumpToBottom:function(){var e=this;this.isMostRecentCMC()&&this.state.cursor.end>=this.props.msgCollection.length?this.scrollToBottom():E.openChatBottom(this.props.chat).then(function(t){t&&E.focusChatTextInput(e.props.chat)})},scrollToBottom:function(e){var t=c.findDOMNode(this.refs.scrollContainer);t&&this.setScrollTop(t,t.scrollHeight),e&&e()},onLastMsgChanged:function(){var e=this.props.msgCollection,t=this.state,n=t.cursor,i=t.focusCtx,a=e.last();if(!this.isMostRecentCMC())return void(a&&a.isSentByMe&&this.jumpToBottom());var s={},r=document.hasFocus(),o=this.nearBottom();this.setUpdateType(o?H.SCROLL_BOTTOM:H.KEEP_SCROLL_TOP),r&&o?(this.setUpdateType(H.SCROLL_BOTTOM),s.unreadCount=0,s.focusCtx=void 0,s.cursor=n.setKey()):a&&a.isSentByMe&&(this.setUpdateType(H.SCROLL_BOTTOM),this.state.unreadCount&&(s.unreadCount=0,s.focusCtx=void 0,s.cursor=n.setKey()),this.jumpToBottom()),this.isMostRecentCMC()&&(i&&!s.hasOwnProperty("focusCtx")?s.cursor=n.loadAfter(1):s.cursor=n.loadBefore(1)),_.isEmpty(s)||this.setState(s)},onUnreadCount:function(){var e=this.props.chat,t=this.nearBottom(),n=document.hasFocus();this.maybeSendSeen(t,n);var i={};if(e.unreadCount&&!e.pendingSeenCount){i.unreadCount=e.unreadCount;var a=this.getUnreadFocusCtx();a&&(i.focusCtx=a,i.cursor=this.state.cursor.setKey(a.msg.key))}t&&i.unreadCount-this.state.unreadCount===1&&this.setUpdateType(H.SCROLL_BOTTOM),(!t&&this.isMostRecentCMC()||!e.pendingSeenCount&&this.state.newUnread!==e.unreadCount)&&(i.newUnread=e.unreadCount),_.isEmpty(i)||this.setState(i)},onMsgsDelete:function(e,t,n){var i=this;e.forEach(function(e){i.state.cursor.onRemove(e)}),this.setState({})},onPageUpDown:function(e){L.focus(c.findDOMNode(this.refs.scrollContainer))},onKeyPress:function(e){e.metaKey||e.ctrlKey||(e.preventDefault(),"Enter"!==e.key||e.shiftKey?E.pasteChatTextInput(this.props.chat,String.fromCharCode(e.charCode)):E.enterChatTextInput(this.props.chat))},onContextMenu:function(e){var t,n=this.props.chat,i=this.props.onSelectMessages;if(n.isUser)t=T.contact(n,i);else if(n.isGroup)t=T.group(n,i);else{if(!n.isBroadcast)return;t=T.broadcast(n,i)}e.preventDefault(),e.stopPropagation(),e.persist(),this.setState({contextMenu:{menu:t,event:e}})},contextClose:function(){this.setState({contextMenu:!1})},onPaste:function(e){e.preventDefault();var t=new u(e.clipboardData);if(!t.hasFiles()&&t.hasType("text/plain"))return e.persist(),void E.sendPasteToCompose(this.props.chat,e);var n=_.filter(t.getFiles(),function(e){var t=C.typeFromMimetype(e.type);return"image"===t||"video"===t});n.length&&E.attachMediaDrawer(this.props.chat,n)},render:function(){var e,t=this,n=this.props,i=n.chat,a=n.msgCollection,s=n.selectable,r=n.onMessageSelect,o=this.state.focusCtx,c=b("pane-chat-msgs pane-chat-body lastTabIndex",{selectable:s}),u=this.isMostRecentCMC(),p=!!o,h=_.find(d.TEXTSIZE_CLASS_MAP,function(e){return e.scale===t.state.textsize});h&&(e=h.classname);var f=l.createElement(v,{key:"ml-"+i.id+"-"+this.state.msgListKey,ref:"messageList",updateType:this.updateType,unreadCount:this.state.unreadCount,selectable:s,onMessageSelect:r,msgs:this.getMsgs(),focusedMsgCtx:o,selectedMessages:this.props.selectedMessages,isMsgVisible:this.isMsgVisible,notifyChatRendered:this.props.notifyChatRendered}),m=l.createElement(y,{direction:"around",isMostRecentCMC:u,loadMoreMsgs:_.noop,msgCollection:a}),g=void 0;(this.state.cursor.start>0||!a.msgLoadState.noEarlierMsgs)&&(g=l.createElement(y,{direction:"earlier",isMostRecentCMC:u,loadMoreMsgs:this.loadEarlierMsgs,msgCollection:a}));var E=void 0;(this.state.cursor.end<a.length||!u)&&(E=l.createElement(y,{direction:"recent",isMostRecentCMC:u,loadMoreMsgs:this.loadRecentMsgs,msgCollection:a})),p&&a.msgLoadState.isLoadingAroundMsgs?(E=void 0,g=void 0,f=void 0):m=void 0;var S=void 0,M=void 0,C=this.state,T=C.isNearBottom,P=C.newUnread;T&&(a.msgLoadState.isLoadingAroundMsgs||u)||(P&&i.unreadCount&&(M=l.createElement("span",{className:"icon-meta unread-count",key:"icon-unread"},A.n(this.state.newUnread))),S=l.createElement("div",{className:"incoming-msgs",onClick:this.jumpToBottom},l.createElement(x,{transitionName:"pop"},M),l.createElement("span",{className:"icon icon-down"})));var k=void 0;return this.state.contextMenu&&(k=l.createElement(I,{displayName:"ConversationContextMenu",escapable:!0,popable:!0,requestDismiss:this.contextClose},l.createElement(R,{contextMenu:this.state.contextMenu}))),l.createElement("div",{className:e},l.createElement(w,{ref:"stickyDateMarker"}),l.createElement(x,{transitionName:"pop"},S),l.createElement("div",{className:c,ref:"scrollContainer",onScroll:this.onScroll,onKeyPress:this.onKeyPress,onContextMenu:s?null:this.onContextMenu,onPaste:this.onPaste,tabIndex:"0"},l.createElement("div",{className:"pane-chat-empty"}),m,g,f,E),k)}});e.exports=q},function(e,t,n){"use strict";var i=n(8),a=n(157),s=n(156),r=n(1402),o=i.createClass({displayName:"LoadMoreMessages",mixins:[s],propTypes:{direction:i.PropTypes.oneOf(["recent","earlier","around"]).isRequired,isMostRecentCMC:i.PropTypes.bool.isRequired,loadMoreMsgs:i.PropTypes.func.isRequired,msgCollection:i.PropTypes.instanceOf(r).isRequired},getInitialState:function(){return this.props.msgCollection.msgLoadState.toJSON()},componentWillMount:function(){this.attachObservers()},componentWillReceiveProps:function(e){this.attachObservers(e)},attachObservers:function(e){var t=this,n=this.props.msgCollection.msgLoadState;e&&(this.removeObserver(n,"change"),n=e.msgCollection.msgLoadState),this.addObserver(n,"change",function(){t.setState(n.toJSON())})},loadMoreMsgs:function(e){"earlier"===this.props.direction&&this.state.isLoadingEarlierMsgs||"recent"===this.props.direction&&this.state.isLoadingRecentMsgs||"around"===this.props.direction&&this.state.isLoadingAroundMsgs||this.props.loadMoreMsgs()},render:function(){var e=this.props.direction;if("earlier"===e&&this.state.isLoadingEarlierMsgs||"recent"===e&&this.state.isLoadingRecentMsgs||"around"===e&&this.state.isLoadingAroundMsgs)return i.createElement("div",{className:"more"},i.createElement("div",{className:"btn-more",title:l10n.t("loading_messages")},i.createElement(a,{stroke:6,size:24})));var t;return t="earlier"===e?l10n.t("load_earlier_messages"):"recent"===e?l10n.t("load_recent_messages"):l10n.t("loading_messages"),i.createElement("div",{className:"more"},i.createElement("div",{className:"btn-more",title:t,onClick:this.loadMoreMsgs},i.createElement("span",{className:"icon icon-refresh"})))}});e.exports=o},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(458),s=i(a),r=n(8),o=n(9),l=n(1372),c=n(235),u=n(1381),d=n(1380),p=n(1439),h=n(1475),f=n(10),m=n(1399),g=n(1401),v=n(61),y=n(466),_=n(233),E=n(157),S=r.createClass({displayName:"Audio",mixins:[l],propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,quotedMsg:r.PropTypes.element,displayAuthor:r.PropTypes.bool},getInitialState:function(){return this.asyncState({mediaStage:"msg.mediaData.mediaStage",ack:"msg.ack"},{currentTime:0,playing:!1,autoPlay:!1})},componentDidMount:function(){this.props.msg.downloadMedia()},showMediaMissing:function(){f.openModal(r.createElement(m,{msg:this.props.msg}))},downloadMedia:function(){this.props.msg.forceDownloadMedia()},cancelDownload:function(){this.props.msg.cancelDownload()},cancelUpload:function(){this.props.msg.cancelUpload()},resumeUpload:function(){this.props.msg.resumeUpload()},resumeRemoteUpload:function(){v.supportsFeature(v.F.MEDIA_RETRY)?this.props.msg.resumeRemoteUpload():f.openModal(r.createElement(g,{msg:this.props.msg}))},downloadUnsupportedToDesktop:function(e){var t=this;e&&e.stopPropagation(),f.openModal(r.createElement(_,{onCancel:f.closeModal.bind(f),onOK:function(){f.closeModal(),y.initDownload(t.props.msg)},okText:l10n.t("web_button_download"),cancelText:l10n.t("web_cancel"),title:l10n.t("download_unsupported_media_title")},l10n.t("download_unsupported_media_prompt")))},handleTimeUpdate:function(e){this.setState({currentTime:e})},handlePlayingUpdate:function(e){this.setState({autoPlay:!1,playing:e})},loader:function(e,t,n){return n=n?r.createElement(E,{stroke:3,size:38}):null,r.createElement("div",{className:"audio"},r.createElement("div",{className:"audio-controls"},r.createElement("button",{className:"btn-audio "+(t?"icon "+t:""),onClick:e},n)),r.createElement("div",{className:"audio-body"},r.createElement("input",{type:"range",className:"audio-track",min:0,max:100,value:0,disabled:"disabled"})))},getStatusClass:function(e){return e+=" audio-state-default",this.state.ack===o.ACK_PLAYED&&(e+=" audio-state-played"),e},render:function(){var e,t=this.props.msg,n=t.mediaData,i=this.getStatusClass("bubble bubble-attach bubble-audio"),a=this.state.playing?this.state.currentTime:n.duration,s=r.createElement(p,{key:"image",className:this.props.quotedMsg?"quoted-msg-bubble-ptt":null,type:n.type,shade:!1,duration:a}),o=t.isSentByMe?s:null,l=t.isSentByMe?null:s,f=t.isSentByMe?"text no-author":"text";switch(n.mediaStage){case c.STAGE.RESOLVED:e=r.createElement(h,{msg:t,autoPlay:!1,onPlayingUpdate:this.handlePlayingUpdate,onTimeUpdate:this.handleTimeUpdate});break;case c.STAGE.NEED_POKE:e=this.loader(this.downloadMedia,"icon-audio-download");break;case c.STAGE.NEED_UPLOAD:e=this.loader(this.resumeUpload,"icon-audio-upload");break;case c.STAGE.REMOTE_NEED_UPLOAD:e=this.loader(this.resumeRemoteUpload,"icon-audio-upload");break;case c.STAGE.ERROR_MISSING:e=this.loader(this.showMediaMissing,"icon-audio-play");break;default:e=this.loader(null,null,!0)}var m=this.props.displayAuthor&&d.shouldRender(t)?r.createElement(d,{msg:t,className:this.props.quotedMsg?"quoted-msg-bubble-ptt-author":null}):null;return r.createElement("div",{className:i},this.props.quotedMsg?m:null,this.props.quotedMsg,r.createElement("div",{className:"wrapper"},o,r.createElement("div",{className:"contents"},this.props.quotedMsg?null:m,r.createElement("div",{className:f},e)),l,r.createElement(u,{msg:t})))}});e.exports=S},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(458),s=i(a),r=n(8),o=n(1381),l=n(1380),c=n(47),u=n(44),d=r.createClass({displayName:"Ciphertext",propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,displayAuthor:r.PropTypes.bool},onLearnMore:function(){var e="https://www.whatsapp.com/faq/general/26000015/";e=c.build(e,{lg:l10n.getLocale()}),window.open(e,"_blank")},render:function(){var e=this.props.msg,t=this.props.displayAuthor&&l.shouldRender(e),n=t?r.createElement(l,{msg:e}):null,i=u("bubble bubble-placeholder",{"has-author":t}),a="message-text";return r.createElement("div",{className:i},n,r.createElement("div",{className:"icon icon-ciphertext placeholder-icon"}),r.createElement("div",{className:a},r.createElement("span",null,r.createElement("span",{className:"placeholder-msg"},l10n.t("placeholder_msg")),r.createElement("span",{className:"placeholder-msg-action",onClick:this.onLearnMore},l10n.t("learn_more")))),r.createElement(o,{msg:e}))}});e.exports=d},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1371),s=i(a),r=n(8),o=n(1392),l=n(93),c=n(44),u=n(76),d=n(0),p=r.createClass({displayName:"DateMarker",mixins:[l],propTypes:{timestamp:r.PropTypes.number.isRequired},getInitialState:function(){return{hide:!1}},componentDidMount:function(){this.maybeRegMidnight()},componentDidUpdate:function(){this.maybeRegMidnight()},hide:function(e){this.state.hide!==e&&this.setState({hide:e})},rerender:function(){this.forceUpdate()},maybeRegMidnight:function(){this.unregCmd("midnight",this.rerender);var e=d().startOf("day").subtract(7,"day");this.props.timestamp>=e.unix()&&this.regCmd("midnight",this.rerender)},render:function(){var e=u.relativeDateStr(this.props.timestamp).toUpperCase(),t=c("message-system-body",{"date-marker-floating":this.state.hide});return r.createElement("div",{className:"msg"},r.createElement("div",{className:"message message-system"},r.createElement("span",{className:t},r.createElement(o,null,r.createElement(s["default"],{direction:"auto",text:e})))))}});e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(112),s=i(a),r=n(2),o=i(r),l=n(458),c=i(l),u=n(1371),d=i(u),p=n(8),h=n(1372),f=n(1380),m=n(235),g=n(1381),v=n(44),y=n(1399),E=n(1401),S=n(1539),M=n(61),C=n(10),b=n(116).MIMETYPES,T=n(466),P=n(233),k=n(9),N=n(461),w=_.pickBy(b,function(e){return"document"===e.msgType}),x=p.createClass({displayName:"Doc",mixins:[h],propTypes:{msg:p.PropTypes.instanceOf(c["default"]).isRequired,quotedMsg:p.PropTypes.element,displayAuthor:p.PropTypes.bool},getInitialState:function(){return{mediaStage:this.async("msg.mediaData.mediaStage")}},showMediaMissing:function(){C.openModal(p.createElement(y,{msg:this.props.msg}))},downloadMedia:function(e){var t=this;if(e&&e.stopPropagation(),!Modernizr.adownload){var n=l10n.t("whatsapp_safari_limited").replace("__chrome_homepage__",k.BROWSER_LINK.CHROME).replace("__firefox_homepage__",k.BROWSER_LINK.FIREFOX).replace("__opera_homepage__",k.BROWSER_LINK.OPERA);return void C.openModal(p.createElement(P,{onOK:C.closeModal.bind(C),okText:l10n.t("web_ok")},p.createElement("div",{dangerouslySetInnerHTML:{__html:n}})))}this.downloadToBlob().then(function(){T.initDownload(t.props.msg)})},downloadToBlob:function(){return this.props.msg.mediaData.mediaStage===m.STAGE.RESOLVED?o["default"].resolve():this.props.msg.forceDownloadMedia().then(this.displayToast)["catch"](_.noop)},displayToast:function(){if(this.props.msg.mediaData.mediaStage!==m.STAGE.RESOLVED)return o["default"].reject(this.props.msg.mediaData.mediaStage);var e=this.props.msg,t=e.mediaData,n=e.caption||t.filename||l10n.t("untitled_document");return C.openToast(p.createElement(N,{msg:l10n.t("document_downloaded",{name:n}),id:N.genId()})),o["default"].resolve()},cancelDownload:function(){this.props.msg.cancelDownload()},cancelUpload:function(){this.props.msg.cancelUpload()},resumeUpload:function(){this.props.msg.resumeUpload()},resumeRemoteUpload:function(){M.supportsFeature(M.F.MEDIA_RETRY)?this.props.msg.resumeRemoteUpload():C.openModal(p.createElement(E,{msg:this.props.msg}))},preventDefault:function(e){return function(t){t.preventDefault(),t.stopPropagation(),e(t)}},openDownloadedFile:function(){var e=this.props.msg.mediaData.renderableUrl;e&&window.open(e,"_blank")},render:function(){var e,t=this.props,n=t.msg,i=t.displayAuthor,a=n.mediaData,r=v("bubble","bubble-doc",{"bubble-broadcast":n.broadcast,"bubble-star":n.star}),o=i&&f.shouldRender(n)?p.createElement(f,{msg:n}):null;a.pageCount>0&&(e=p.createElement("span",{className:"document-meta-value"},l10n.t("web_conversations_most_recent_document",{count:a.pageCount,_plural:a.pageCount})));var l,c=a.size>0?p.createElement("span",{className:"document-meta-value"},l10n.filesize(a.size)):null,u="icon-doc";_.has(w,a.mimetype)&&(l=p.createElement("span",{className:"document-meta-value"},w[a.mimetype].ext),u=v(u,w[a.mimetype].icon));var h=a.preview?p.createElement("div",{className:"document-thumb",style:{backgroundImage:'url("'+a.preview.url()+'")'}}):null,y=n.caption||a.filename||l10n.t("untitled_document"),E=null,M={href:"#",onClick:null};switch(a.mediaStage){case m.STAGE.RESOLVED:case m.STAGE.ERROR_UNSUPPORTED:M.onClick=this.preventDefault(this.downloadMedia),E=p.createElement(S.Download,{onClick:M.onClick});break;case m.STAGE.FETCHING:E=p.createElement(S.PendingCancel,null),M.onClick=this.preventDefault(this.cancelDownload);break;case m.STAGE.NEED_POKE:case m.STAGE.INIT:M.onClick=this.preventDefault(this.downloadMedia),E=p.createElement(S.Download,{onClick:M.onClick});break;case m.STAGE.UPLOADING:E=p.createElement(S.PendingCancel,null),M.onClick=this.preventDefault(this.cancelUpload);break;case m.STAGE.NEED_UPLOAD:E=p.createElement(S.Upload,null),M.onClick=this.preventDefault(this.resumeUpload);break;case m.STAGE.REMOTE_NEED_UPLOAD:E=p.createElement(S.Upload,null),M.onClick=this.preventDefault(this.resumeRemoteUpload);break;case m.STAGE.ERROR_MISSING:M.onClick=this.preventDefault(this.showMediaMissing);break;default:E=p.createElement(S.Pending,null)}return p.createElement("div",{className:r},o,this.props.quotedMsg,p.createElement("a",(0,s["default"])({className:"document-container",title:l10n.t("web_download_document",{name:y})},M),h,p.createElement("div",{className:"document-body"},p.createElement("div",{className:"document-icon"},p.createElement("div",{className:u})),p.createElement("div",{className:"document-text"},p.createElement(d["default"],{text:y,ellipsify:!0,selectable:!1,dirMismatch:n.rtl!==l10n.isRTL(),direction:"auto"})),E)),p.createElement("div",{className:"document-meta"},e,l,c),p.createElement(g,{msg:n}))}});e.exports=x},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(111),s=i(a),r=n(8),o=n(1467),l=r.createClass({displayName:"FailedMsgIcon",propTypes:{onResend:r.PropTypes.func.isRequired,errMsg:r.PropTypes.string.isRequired},getInitialState:function(){return{hover:!1}},onMouseEnter:function(){this.setState({hover:!0})},onMouseLeave:function(){this.setState({hover:!1})},render:function(){var e=r.createElement("span",null,this.props.errMsg),t=this.state.hover?r.createElement(o,{direction:"left",className:"tooltip-error",body:e}):null;return r.createElement(s["default"],{onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,className:"icon-error-container"},t,r.createElement("button",{className:"error",onClick:this.props.onResend},r.createElement("span",{className:"icon icon-error"})))}});e.exports=l},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(458),o=i(r),l=n(8),c=n(45),u=n(1372),d=n(160),p=n(1380),h=n(1438),f=n(44),m=n(10),g=n(233),v=n(1401),y=n(235),E=n(1410),S=n(1381),M=n(1422),C=n(61),b=n(9),T=n(1376),P=n(40),k=2.4,N=330,w=N/k,x=3,O=6,D=l.createClass({displayName:"Gif",mixins:[u,d,T],propTypes:{msg:l.PropTypes.instanceOf(o["default"]).isRequired,quotedMsg:l.PropTypes.element,isMsgVisible:l.PropTypes.func,displayType:l.PropTypes.oneOf(_.values(b.DISP_TYPE)),displayAuthor:l.PropTypes.bool},getInitialState:function(){return this.playCount=0,{mediaStage:this.async("msg.mediaData.mediaStage"),playing:!1}},componentDidMount:function(){this.props.msg.downloadMedia()},componentWillUnmount:function(){this._preppingPlay&&this._preppingPlay.cancel()},pause:function(){this.playCount=0,this._pause()},play:function(e){var t=this;this.props.msg.mediaData.mediaStage===y.STAGE.RESOLVED&&this.refs.player&&(e&&e.stopPropagation(),this._preppingPlay&&this._preppingPlay.cancel(),this._preppingPlay=s["default"].resolve().cancellable().then(function(){if(!_.isUndefined(t.duration))return t.duration;var e=c.findDOMNode(t.refs.player);return e.readyState>0?e.duration:P.waitForEvent(e,"canplay").then(function(){return e.duration})}).then(function(e){t.duration=e,t.setState({playing:!0});var n=Math.ceil(O/e);t.playCount=Math.max(n,x),t._play()}),this._preppingPlay["catch"](s["default"].CancellationError,_.noop)["finally"](function(){t._preppingPlay=void 0}))},_pause:function(){if(this.setState({playing:!1}),this.refs.player){var e=c.findDOMNode(this.refs.player);e&&(e.currentTime=0,e.paused||e.pause())}},_play:function(){if(this.refs.player){if(!this.playCount)return this.pause();this.playCount-=1;var e=c.findDOMNode(this.refs.player);e&&e.paused&&e.play()}},getStyle:function(){var e=this.props.msg.mediaData,t=e.aspectRatio,n=void 0,i=void 0;t?1/k>t?(i=N,n=w):1>t?(i=N,n=N*t):k>t?(n=N,i=N/t):(n=N,i=w):(i="100%",n=N);var a=e.renderableUrl?e.fullWidth||n:n,s=e.renderableUrl?e.fullHeight||i:i;return t?a/s>n/i?(a=a*i/s,s=i):(s=s*n/a,a=n):(a=N,s="100%"),{bubbleWidth:n,bubbleHeight:i,contentWidth:a,contentHeight:s}},showMediaMissing:function(){m.openModal(l.createElement(g,{title:l10n.t("missing_photo_title"),onOK:m.closeModal.bind(m),okText:l10n.t("web_ok")},l10n.t("missing_photo_text")))},getZoomNode:function(e){var t=this.props.isMsgVisible(e);return t&&t.getImgNode?t.getImgNode():void 0},launchMediaViewer:function(e){e&&e.stopPropagation();var t=this.props,n=t.msg,i=t.isMsgVisible;m.mediaViewerModal(n,i?this.getZoomNode:_.noop)},downloadMedia:function(){this.props.msg.forceDownloadMedia()},cancelDownload:function(){this.props.msg.cancelDownload()},cancelUpload:function(){this.props.msg.cancelUpload()},resumeUpload:function(){this.props.msg.resumeUpload()},resumeRemoteUpload:function(){C.supportsFeature(C.F.MEDIA_RETRY)?this.props.msg.resumeRemoteUpload():m.openModal(l.createElement(v,{msg:this.props.msg}))},onDragStart:function(e){e.nativeEvent.dataTransfer.setData(b.DRAG_TYPE_LOCAL_IMAGE,!0)},stopEvent:function(e){e.stopPropagation()},getImgNode:function(){return this.refs.player?c.findDOMNode(this.refs.player):void 0},render:function(){var e=this.props.msg,t=e.mediaData,n=e.caption?l.createElement(h,{msg:e}):null,i=n?null:l.createElement("div",{className:"shade"}),a=t.preview?t.preview.url():void 0,s=null,r=null,c=null,u=this.getStyle(),d=u.bubbleWidth,m=u.bubbleHeight,g=u.contentWidth,v=u.contentHeight,_={width:d,height:m};switch(t.mediaStage){case y.STAGE.RESOLVED:this.state.playing||(s=l.createElement("span",{className:"image-gif-control",onClick:this.play},l.createElement("button",{className:"icon icon-media-gif"}))),c=l.createElement(M,{msg:e,poster:a,ref:"player",className:"image-thumb-body",width:g,height:v,onEnded:this._play,muted:!0},l10n.t("video_playback_not_supported")),r=this.launchMediaViewer;break;case y.STAGE.INIT:r=this.launchMediaViewer;break;case y.STAGE.FETCHING:s=l.createElement(E.PendingCancel,null),r=this.cancelDownload;break;case y.STAGE.NEED_POKE:s=l.createElement(E.Download,{filesize:t.size}),r=this.downloadMedia;break;case y.STAGE.UPLOADING:s=l.createElement(E.PendingCancel,null),r=this.cancelUpload;break;case y.STAGE.NEED_UPLOAD:s=l.createElement(E.Upload,{filesize:t.size}),r=this.resumeUpload;break;case y.STAGE.REMOTE_NEED_UPLOAD:s=l.createElement(E.Upload,{filesize:t.size}),r=this.resumeRemoteUpload;break;case y.STAGE.ERROR_MISSING:r=this.showMediaMissing;break;default:s=l.createElement(E.Pending,null)}c||(c=l.createElement("div",{className:"image-thumb-body image-thumb-gif",style:{backgroundImage:"url("+a+")"}}));var C=f("bubble-image",{"bubble-image-caption":e.caption,"bubble-broadcast":e.caption&&e.broadcast,"bubble-star":e.caption&&e.star}),b=this.props.displayAuthor&&p.shouldRender(e)?l.createElement(p,{msg:e}):null,T=void 0;switch(e.gifAttribution){case o["default"].GIF_ATTRIBUTION.GIPHY:T=l.createElement("span",{className:"icon-gif-vendor icon icon-giphy"});break;case o["default"].GIF_ATTRIBUTION.TENOR:T=l.createElement("span",{className:"icon-gif-vendor icon icon-tenor"});break;default:T=null}return l.createElement("div",{className:C,onClick:this.stopEvent,style:{width:_.width}},b,this.props.quotedMsg,l.createElement("div",{className:"image-thumb",onClick:r,style:_},s,c,i,T),n,l.createElement(S,{msg:this.props.msg}))}});e.exports=D},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e
}}Object.defineProperty(t,"__esModule",{value:!0}),t.EMOJI_SIZE=void 0;var a,s,r=n(16),o=i(r),l=n(4),c=i(l),u=n(6),d=i(u),p=n(20),h=i(p),f=n(19),m=i(f),g=n(1395),v=i(g),y=n(1377),_=i(y),E=n(8),S=n(476),M=n(1428),C=n(161),b=C.emojiMap,T=C.getEmojiPath,P=C.getClasses,k=n(9),N=k.ONE_BY_ONE_TRANS_GIF,w=n(44),x=t.EMOJI_SIZE={LARGE:"large",XLARGE:"xlarge"};t["default"]=(0,_["default"])((s=a=function(e){function t(){var e,n,i,a;(0,c["default"])(this,t);for(var s=arguments.length,r=Array(s),l=0;s>l;l++)r[l]=arguments[l];return n=i=(0,h["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(r))),i.state={assetLoaded:!1},i.onAssetLoaded=function(){i.setState({assetLoaded:!0})},i.onCopy=function(e){if(e.clipboardData){var t=window.getSelection();e.clipboardData.setData("text/plain",M.asPlainText(t))}e.stopPropagation(),e.preventDefault()},a=n,(0,h["default"])(i,a)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentWillMount",value:function(){var e=this;this.props.listeners.add(window,"dpichange",function(){e.setState({assetLoaded:!1})})}},{key:"render",value:function(){var e=b[this.props.emoji];if(!e)return null;var t=T(e,this.props.emojiSize)[S.currentRes],n=void 0;return n=this.state.assetLoaded?w("large-emoji","selectable-text",{"heart-animation":this.props.animation}):w(P(e),"selectable-text"),this.props.animation&&this.state.assetLoaded?E.createElement("div",{className:"large-emoji-container",onCopy:this.onCopy},E.createElement("img",{className:"large-emoji selectable-text image",src:N,alt:this.props.emoji}),E.createElement(v["default"],{className:"large-emoji heart-animation container",draggable:!1,src:t})):E.createElement("div",{className:"large-emoji-container",onCopy:this.onCopy},E.createElement(v["default"],{draggable:!1,onLoad:this.onAssetLoaded,alt:this.props.emoji,src:t,className:n}))}}]),t}(E.Component),a.defaultProps={emojiSize:x.LARGE,animation:!1},s))},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(458),s=i(a),r=n(8),o=n(47),l=n(1280),c=n(473),u=n(44),d={LINK:"link",GROUP_INVITE:"group_invite"},p=r.createClass({displayName:"LinkPreview",mixins:[l],propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,type:r.PropTypes.oneOf(_.values(d)).isRequired},getDefaultProps:function(){return{type:d.LINK}},render:function(){var e=this.props,t=e.msg,n=e.type,i=void 0;if(t.thumbnail){var a=u({"link-preview-media":n===d.LINK,"group-invite-preview":n===d.GROUP_INVITE});i=r.createElement("img",{className:a,src:"data:image/jpeg;base64,"+t.thumbnail})}var s=t.title?r.createElement("div",{className:"link-preview-title",title:t.title},t.title):null,l=t.description?r.createElement("div",{className:"link-preview-description",title:t.description},t.description):null,p=u("link-preview-body",{nothumb:!i}),h=n===d.LINK?r.createElement("div",{className:"link-preview-source ellipsify"},c.toUnicode(o.hostname(t.canonicalUrl||t.matchedText))):null,f=function(e){var n=document.createElement("a");n.href=t.matchedText,n.target="_blank",document.body.appendChild(n),n.click(),document.body.removeChild(n)};return r.createElement("div",{className:"link-preview-container",onClick:f},i,r.createElement("div",{className:p},s,l,h))}});p.Type=d,e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(8),m=i(f),g=n(44),v=i(g),y=n(1381),_=i(y),E=n(1380),S=i(E),M=n(1585),C=i(M),b=n(458),T=(i(b),n(159)),P=i(T),k=n(1371),N=i(k),w=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){var e=this.props.msg,t=this.props.displayAuthor&&S["default"].shouldRender(e)?m["default"].createElement(S["default"],{msg:e}):null,n=(0,v["default"])("message-text",{"empty-text":!e.comment});return m["default"].createElement("div",{className:"bubble bubble-placeholder"},t,m["default"].createElement("div",{className:n},m["default"].createElement(C["default"],{msg:e,type:M.TYPE.LIVE_LOCATION}),m["default"].createElement(N["default"],{text:e.comment,selectable:!0,dirMismatch:e.rtl!==P["default"].isRTL(),direction:e.dir})),m["default"].createElement(_["default"],{msg:this.props.msg}))}}]),t}(m["default"].Component);t["default"]=w},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(458),s=i(a),r=n(8),o=n(44),l={FRONT:"front",MID:"mid",END:"end",SINGLE:"single"},c=r.createClass({displayName:"Menu",propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,position:r.PropTypes.oneOf(_.values(l)).isRequired,onClick:r.PropTypes.func,isFocusedMsg:r.PropTypes.bool},click:function(){this.refs.context.click()},render:function(){var e=this.props,t=e.msg,n=e.position,i=e.onClick,a=t.isMedia,c=t.isSentByMe,u=t.isGroupMsg,d=t.type,p=!!t.quotedMsg,h=c?"context-out":"context-in",f=t.type===s["default"].TYPE.DOCUMENT&&!t.body,m=t.type===s["default"].TYPE.DOCUMENT&&t.body,g=d===s["default"].TYPE.LOCATION;a=a||m||g||p;var v;u&&(v=!c&&(n===l.FRONT||n===l.SINGLE),a=a&&!v);var y=d===s["default"].TYPE.CHAT&&t.matchedText&&t.matchedText.length&&t.body.indexOf(t.matchedText)>-1&&!v&&t.isTrusted(),_=o("js-context-icon",a&&d!==s["default"].TYPE.AUDIO?"context-icon-media":"context-icon"),E=o(h,{context:!(a||y),"context-media":a&&d!==s["default"].TYPE.AUDIO,"context-media-document":m,"context-ptt":d===s["default"].TYPE.PTT&&!p,"context-ptt-author":d===s["default"].TYPE.PTT&&v&&!p,"context-special":(y||f)&&!v&&!p,"context-doc":f&&!v&&!p,"context-inverse":d===s["default"].TYPE.CHAT&&!p&&!!t.dir&&t.rtl!==l10n.isRTL()});return r.createElement("div",{className:E},r.createElement("div",{className:_,ref:"context",onClick:i}))}});e.exports=c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.TYPE=void 0;var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(8),m=i(f),g=n(458),v=(i(g),n(159)),y=i(v),_=t.TYPE={LIVE_LOCATION:"LIVE_LOCATION"},E=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){var e=void 0,t=void 0;switch(this.props.type){case _.LIVE_LOCATION:e=y["default"].t("check_phone_for_live_location"),t=m["default"].createElement("span",{className:"icon icon-live-location placeholder-icon"});break;default:throw new Error("Unrecognized type")}return m["default"].createElement("div",{className:"msg-desc-container"},t,e)}}]),t}(m["default"].Component);t["default"]=E},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(1581),m=i(f),g=n(18),v=i(g),y=n(8),_=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){var e=this,t=this.props.emojis,n=v["default"].size(t);if(0===n)return null;var i=1===n?f.EMOJI_SIZE.XLARGE:f.EMOJI_SIZE.LARGE,a=t.map(function(t,n){return y.createElement(m["default"],{animation:e.props.animation,emoji:t,key:t+n,emojiSize:i})});return y.createElement("span",{className:"large-emoji-wrapper"},a)}}]),t}(y.Component);t["default"]=_},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1371),s=i(a),r=n(458),o=i(r),l=n(8),c=n(44),u=n(1380),d=n(486),p=n(465),h=n(1423),f=n(1381),m=n(10),g=n(1647),v=l.createClass({displayName:"VCardList",propTypes:{msg:l.PropTypes.instanceOf(o["default"]).isRequired,quotedMsg:l.PropTypes.node,displayAuthor:l.PropTypes.bool},getDefaultProps:function(){return{quotedMsg:null,displayAuthor:!1}},_showContactsModal:function(){m.openModal(l.createElement(g,{msg:this.props.msg}))},_renderProfilePics:function(){for(var e=_(this.props.msg.vcardList).map(function(e,t){var n=p.thumbnailWAid(p.vcardWAids(p.parse(e.vcard))),i=p.thumbnail(e.vcard);return n||i?l.createElement(h,{key:t,waid:n,thumb:i,className:"preview-vcard-multi preview-vcard",size:h.Size.NONE}):void 0}).filter().take(3).value(),t=Math.min(3-e.length,this.props.msg.vcardList.length-e.length),n=0;t>n;n++)e.push(l.createElement(h,{key:"default-"+n,className:"preview-vcard-multi preview-vcard",size:h.Size.NONE}));return e},render:function(){var e=this.props.msg,t=this.props.quotedMsg,n=c(["bubble","bubble-vcard"],{"bubble-attach-caption":!!e.caption,"bubble-vcard-quoted":!!e.quotedMsg}),i="vcard-avatar";t&&(i=c(i,"quoted-msg-bubble-vcard"));var a=this.props.displayAuthor&&u.shouldRender(e)?l.createElement(u,{msg:e}):null,r=null,o=d.getNameString(e.vcardList),p=t?l.createElement(h,{className:"preview-vcard",size:h.Size.NONE}):this._renderProfilePics();return l.createElement("div",{className:n},a,t,l.createElement("div",{className:"wrapper wrapper-vcard wrapper-vcard-multi",title:o,onClick:this._showContactsModal},l.createElement("div",{className:"vcard"},l.createElement("div",{className:i},p),l.createElement("div",{className:"vcard-body"},l.createElement(s["default"],{text:o,element:"div",className:"vcard-name vcard-name-multi",dirMismatch:e.rtl!==l10n.isRTL(),direction:e.dir,wbr:15}))),l.createElement(f,{msg:e,contextMenu:this.contextMenu})),r)}});e.exports=v},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1371),s=i(a),r=n(458),o=i(r),l=n(8),c=n(1392),u=n(1280),d=n(10),p=n(1636),h=l.createClass({displayName:"Notification",mixins:[u],propTypes:{text:l.PropTypes.string.isRequired,e2eSubtype:l.PropTypes.string,participantJid:l.PropTypes.string,chatId:l.PropTypes.string,type:l.PropTypes.string,subtype:l.PropTypes.string},onSecurityClick:function(){d.openModal(l.createElement(p,{e2eSubtype:this.props.e2eSubtype,jid:this.props.participantJid,chatId:this.props.chatId}))},render:function(){var e=null;this.props.type===o["default"].TYPE.CALL_LOG&&(e="miss_video"===this.props.subtype?l.createElement("span",{className:"icon icon-miss_video"}):l.createElement("span",{className:"icon icon-miss"}));var t=l.createElement(c,null,e,l.createElement(s["default"],{direction:"auto",text:this.props.text})),n=!!this.props.e2eSubtype,i=n?l.createElement("button",{className:"message-system-e2e",onClick:this.onSecurityClick},t):l.createElement("span",{className:"message-system-body"},t);return i}});e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){if(!e)return C;var t=void 0;return t=1>=e?C:2.4>=e?M/e:M/2.4,Math.round(t)}function s(e,t,n,i){return e&&t&&n&&i?t/e>i/n?{height:"100%"}:{width:"100%"}:{height:"100%",width:"100%"}}var r=n(458),o=i(r),l=n(8),c=n(1372),u=n(1380),d=n(1438),p=n(44),h=n(10),f=n(1399),m=n(1401),g=n(235),v=n(1410),y=n(1381),E=n(61),S=n(9),M=330,C=330,b=l.createClass({displayName:"Picture",mixins:[c],propTypes:{msg:l.PropTypes.instanceOf(o["default"]).isRequired,quotedMsg:l.PropTypes.element,isMsgVisible:l.PropTypes.func,displayAuthor:l.PropTypes.bool},getInitialState:function(){return{mediaStage:this.async("msg.mediaData.mediaStage")}},componentDidMount:function(){this.props.msg.downloadMedia()},showMediaMissing:function(){h.openModal(l.createElement(f,{msg:this.props.msg}))},getZoomNode:function(e){var t=this.props.isMsgVisible(e);return t&&t.getImgNode?t.getImgNode():void 0},launchMediaViewer:function(e){e&&e.stopPropagation();var t=this.props,n=t.msg,i=t.isMsgVisible;h.mediaViewerModal(n,i?this.getZoomNode:_.noop)},downloadMedia:function(){this.props.msg.forceDownloadMedia()},cancelDownload:function(){this.props.msg.cancelDownload()},cancelUpload:function(){this.props.msg.cancelUpload()},resumeUpload:function(){this.props.msg.resumeUpload()},resumeRemoteUpload:function(){E.supportsFeature(E.F.MEDIA_RETRY)?this.props.msg.resumeRemoteUpload():h.openModal(l.createElement(m,{msg:this.props.msg}))},onDragStart:function(e){e.nativeEvent.dataTransfer.setData(S.DRAG_TYPE_LOCAL_IMAGE,!0)},stopEvent:function(e){e.stopPropagation()},getImgNode:function(){return this.refs.img},render:function(){var e=this.props.msg,t=e.mediaData,n=e.caption?null:l.createElement("div",{className:"shade"}),i=e.caption?l.createElement(d,{msg:e}):null,r=t.renderableUrl||t.preview&&t.preview.url(),o=null,c=null;switch(t.mediaStage){case g.STAGE.RESOLVED:c=this.launchMediaViewer;break;case g.STAGE.FETCHING:o=l.createElement(v.PendingCancel,null),c=this.cancelDownload;break;case g.STAGE.NEED_POKE:o=l.createElement(v.Download,{filesize:t.size}),c=this.downloadMedia;break;case g.STAGE.UPLOADING:o=l.createElement(v.PendingCancel,null),c=this.cancelUpload;break;case g.STAGE.NEED_UPLOAD:o=l.createElement(v.Upload,{filesize:t.size}),c=this.resumeUpload;break;case g.STAGE.REMOTE_NEED_UPLOAD:o=l.createElement(v.Upload,{filesize:t.size}),c=this.resumeRemoteUpload;break;case g.STAGE.ERROR_MISSING:c=this.showMediaMissing;break;case g.STAGE.ERROR_UNSUPPORTED:o=l.createElement(v.Download,{filesize:t.size}),c=this.launchMediaViewer;break;default:o=l.createElement(v.Pending,null)}var h=p("bubble-image",{"bubble-image-caption":e.caption,"bubble-broadcast":e.caption&&e.broadcast,"bubble-star":e.caption&&e.star}),f=p("image-thumb-body",{"image-thumb-lores":!t.renderableUrl}),m=this.props.displayAuthor&&u.shouldRender(e)?l.createElement(u,{msg:e}):null,_=M,E=a(t.aspectRatio),S={width:_,height:E},C=t.fullHeight||E,b=t.fullWidth||_,T=s(C,b,E,_);return l.createElement("div",{className:h,onClick:this.stopEvent},m,this.props.quotedMsg,l.createElement("div",{className:"image-thumb",onClick:c,style:S},o,l.createElement("img",{src:r,onDragStart:this.onDragStart,className:f,style:T,ref:"img"}),n),i,l.createElement(y,{msg:e}))}});e.exports=b},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(458),s=i(a),r=n(8),o=n(9),l=n(1372),c=n(1381),u=n(1380),d=n(1439),p=n(1475),h=n(1401),f=n(10),m=n(61),g=n(235),v=n(1399),y=n(157),_=r.createClass({displayName:"PTT",mixins:[l],propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,quotedMsg:r.PropTypes.element,displayAuthor:r.PropTypes.bool},getInitialState:function(){return this.asyncState({mediaStage:"msg.mediaData.mediaStage",img:"msg.sender.ProfilePicThumb.img",ack:"msg.ack"},{currentTime:0,playing:!1,autoPlay:!1})},componentDidMount:function(){this.props.msg.downloadMedia()},showMediaMissing:function(){f.openModal(r.createElement(v,{msg:this.props.msg}))},downloadMedia:function(){this.props.msg.forceDownloadMedia()},cancelDownload:function(){this.props.msg.cancelDownload()},cancelUpload:function(){this.props.msg.cancelUpload()},resumeUpload:function(){this.props.msg.resumeUpload()},resumeRemoteUpload:function(){m.supportsFeature(m.F.MEDIA_RETRY)?this.props.msg.resumeRemoteUpload():f.openModal(r.createElement(h,{msg:this.props.msg}))},handleTimeUpdate:function(e){this.setState({currentTime:e})},handlePlayingUpdate:function(e){this.setState({autoPlay:!1,playing:e})},loader:function(e,t,n){return n=n?r.createElement(y,{stroke:3,size:38}):null,r.createElement("div",{className:"audio"},r.createElement("div",{className:"audio-controls"},r.createElement("button",{className:"btn-audio "+(t?"icon "+t:""),onClick:e},n)),r.createElement("div",{className:"audio-body"},r.createElement("input",{type:"range",className:"audio-track",min:0,max:100,value:0,disabled:"disabled"})))},getStatusClass:function(e){return e+=" audio-state-default",this.state.ack===o.ACK_PLAYED&&(e+=" audio-state-played"),e},render:function(){var e=this.props.msg,t=e.mediaData,n=this.getStatusClass("bubble bubble-attach bubble-audio"),i="audio-status icon ";i+=this.state.ack===o.ACK_PLAYED?e.isSentByMe?"icon-ptt-out-blue":"icon-ptt-in-blue":e.isSentByMe?"icon-ptt-out-gray":"icon-ptt-in-green";var a,s=r.createElement("span",{className:i,key:"status"}),l=this.state.playing?this.state.currentTime:t.duration,h=r.createElement(d,{key:"image",className:this.props.quotedMsg?"quoted-msg-bubble-ptt":null,thumb:this.state.img,type:t.type,shade:!1,duration:l}),f=e.isSentByMe?[h,s]:null,m=e.isSentByMe?null:[h,s],v=e.isSentByMe?"text no-author":"text";switch(t.mediaStage){case g.STAGE.RESOLVED:a=r.createElement(p,{msg:e,autoPlay:this.state.autoPlay,onPlayingUpdate:this.handlePlayingUpdate,onTimeUpdate:this.handleTimeUpdate});break;case g.STAGE.NEED_POKE:a=this.loader(this.downloadMedia,"icon-audio-download");break;case g.STAGE.NEED_UPLOAD:a=this.loader(this.resumeUpload,"icon-audio-upload");break;case g.STAGE.REMOTE_NEED_UPLOAD:a=this.loader(this.resumeRemoteUpload,"icon-audio-upload");break;case g.STAGE.ERROR_MISSING:a=this.loader(this.showMediaMissing,"icon-audio-play");break;default:a=this.loader(null,null,!0)}var y=this.props.displayAuthor&&u.shouldRender(e)?r.createElement(u,{msg:e,className:this.props.quotedMsg?"quoted-msg-bubble-ptt-author":null}):null;return r.createElement("div",{className:n},this.props.quotedMsg?y:null,this.props.quotedMsg,r.createElement("div",{className:"wrapper"},f,r.createElement("div",{className:"contents"},this.props.quotedMsg?null:y,r.createElement("div",{className:v},a)),m,r.createElement(c,{msg:e})))}});e.exports=_},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(458),m=(i(f),n(8)),g=i(m),v=n(1381),y=i(v),_=n(1380),E=i(_),S=n(44),M=i(S),C=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){var e=this.props.msg,t=this.props.displayAuthor&&E["default"].shouldRender(e),n=t?g["default"].createElement(E["default"],{msg:e}):null,i=(0,M["default"])("bubble bubble-placeholder bubble-revoked",{"has-author":t}),a=e.isSentByMe?l10n.t("revoke_outgoing"):l10n.t("revoke_incoming");return g["default"].createElement("div",{className:i},n,g["default"].createElement("div",{className:"message-text"},g["default"].createElement("span",{className:"placeholder-msg"},a)),g["default"].createElement(y["default"],{msg:e}))}}]),t}(g["default"].Component);t["default"]=C},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(458),s=i(a),r=n(8),o=n(1372),l=n(44),c=r.createClass({displayName:"Status",mixins:[o],propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired},getInitialState:function(){var e=this.props.msg;return{ack:e.ack<3?this.async("msg.ack"):e.ack}},render:function(){var e=this.props.msg,t=e.ack,n=e.isMedia&&!e.caption&&e.type!==s["default"].TYPE.AUDIO||e.type===s["default"].TYPE.LOCATION&&!e.get("loc")&&!e.isLive,i="icon",a=void 0;return a=1>t?n?"icon-msg-time-light":"icon-msg-time":1===t?n?"icon-msg-check-light":"icon-msg-check":2===t?n?"icon-msg-dblcheck-light":"icon-msg-dblcheck":n?"icon-msg-dblcheck-ack-light":"icon-msg-dblcheck-ack",i=l("icon",a),r.createElement("span",{className:i})}});e.exports=c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1371),s=i(a),r=n(8),o=n(1392),l=n(110),c=r.createClass({displayName:"StickyDateMarker",proptypes:{},getInitialState:function(){return{date:null,hide:!1}},updateDateMarkerText:function(e){this.setState({date:e})},hideStickyDateMarker:function(e){this.state.hide!==e&&this.setState({hide:e})},render:function(){var e=void 0;return this.state.date&&!this.state.hide&&(e=r.createElement("div",{className:"msg sticky-date-marker-floating-container"},r.createElement("div",{className:"sticky-date-marker-floating-wrapper"},r.createElement("span",{className:"message-system-body"},r.createElement(o,null,r.createElement(s["default"],{direction:"auto",text:this.state.date})))))),r.createElement(l,{transitionName:"slide-down-date"},e)}});e.exports=c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(35),s=i(a),r=n(16),o=i(r),l=n(4),c=i(l),u=n(6),d=i(u),p=n(20),h=i(p),f=n(19),m=i(f),g=n(8),v=i(g),y=n(1380),_=i(y),E=n(1381),S=i(E),M=n(1582),C=i(M),b=n(1472),T=i(b),P=n(458),k=(i(P),n(1371)),N=i(k),w=n(44),x=i(w),O=n(242),D=n(1586),R=i(D),I=n(161),A=i(I),L=n(1384),F=function(e){function t(){return(0,c["default"])(this,t),(0,h["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"render",value:function(){var e=this.props,t=e.msg,n=e.displayAuthor,i=e.trusted,a=n&&_["default"].shouldRender(t),r=(0,x["default"])("bubble","bubble-text",{"bubble-broadcast":t.broadcast,"bubble-star":t.star,"has-author":a}),o=a?v["default"].createElement(_["default"],{msg:t,className:this.props.quotedMsg?"text-author-quoted-msg":null}):null,l=void 0,c=void 0;if(i&&t.linkPreview){var u=(0,O.parseCmd)(t.matchedText),d=(0,s["default"])(u,1),p=d[0];if(p===O.Cmd.GROUP_INVITE){l=v["default"].createElement(C["default"],{msg:t,type:C["default"].Type.GROUP_INVITE});var h=function(e){var n=document.createElement("a");n.href=t.matchedText,n.target="_blank",document.body.appendChild(n),n.click(),document.body.removeChild(n)},f=t.isSentByMe?l10n.t("group_invite_view"):l10n.t("group_invite_join");c=v["default"].createElement("div",{className:"bubble-actions"},v["default"].createElement("div",{className:"bubble-btn",onClick:h,title:f},f))}else l=v["default"].createElement(C["default"],{msg:t})}var m=void 0,g=void 0,y=A["default"].getMatchedEmojis(t.body);if(y){m=(0,x["default"])("message-text","large-emoji-text",{"one-emoji-text":1===y.length,"two-emoji-text":2===y.length,"three-emoji-text":3===y.length});var E=1===y.length&&"❤"===y[0];g=v["default"].createElement(R["default"],{animation:E,emojis:y})}else{m=(0,x["default"])("message-text");var M=t.mentionMap(),b=i?L.Configuration.TrustedConversation:L.Configuration.UntrustedConversation;g=v["default"].createElement(N["default"],{text:t.body,selectable:!0,dirMismatch:t.rtl!==l10n.isRTL(),direction:t.dir,formatters:b(M)})}return v["default"].createElement("div",{className:r},o,this.props.quotedMsg,v["default"].createElement("div",{className:m,"data-id":t.id},l,v["default"].createElement(T["default"],{msg:t}),g),v["default"].createElement(S["default"],{msg:t}),c)}}]),t}(v["default"].PureComponent);t["default"]=F},function(e,t,n){"use strict";var i=n(8),a=n(1392),s=i.createClass({displayName:"Unread",propTypes:{count:i.PropTypes.number.isRequired},render:function(){var e=l10n.t("unread_message_count",{count:l10n.n(this.props.count),_plural:this.props.count});return i.createElement("span",{className:"msg-unread-body"},i.createElement(a,null,e))}});e.exports=s},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(458),s=i(a),r=n(8),o=n(1381),l=n(1380),c=n(462),u=n(243),d=n(44),p=r.createClass({displayName:"UnsupportedMsg",propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,displayAuthor:r.PropTypes.bool},render:function(){var e=this.props.msg,t=this.props.displayAuthor&&l.shouldRender(e),n=t?r.createElement(l,{msg:e}):null,i=d("bubble bubble-placeholder",{"has-author":t}),a="message-text",s=e.isSentByMe||!e.subtype?r.createElement("a",{className:"text-clickable placeholder-msg-action",onClick:u.restart.bind(u)},l10n.t("unsupported_msg_web_click_to_update")):null;return r.createElement("div",{className:i},n,r.createElement("div",{className:"icon icon-unknown placeholder-icon"}),r.createElement("div",{className:a},r.createElement("span",null,r.createElement("span",{className:"placeholder-msg"},c.msgText(e)),s)),r.createElement(o,{msg:e}))}});e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(458),s=i(a),r=n(1371),o=i(r),l=n(18),c=i(l),u=n(1384),d=n(8),p=n(44),h=n(1380),f=n(1381),m=n(10),g=n(465),v=n(1423),y=n(156),_=n(1662),E=n(1608),S=n(1632),M=n(466),C=n(233),b=d.createClass({displayName:"Vcard",mixins:[y],propTypes:{msg:d.PropTypes.instanceOf(s["default"]).isRequired,quotedMsg:d.PropTypes.element,displayAuthor:d.PropTypes.bool},onMessageClick:function(){var e=this.props.msg.getWAids();e.length>1?m.openModal(d.createElement(_,{vCard:this.props.msg.vcard,onCancel:m.closeModal.bind(m),onSelect:this.openContactChat})):this.openContactChat(c["default"].first(e))},openContactChat:function(e){Store.Chat.find(e).then(function(e){m.closeModal(),m.openChatFromUnread(e).then(function(t){t&&m.focusChatTextInput(e)})})},viewContact:function(){var e=this;this.props.msg.vcard?m.openModal(d.createElement(S,{msg:this.props.msg})):m.openModal(d.createElement(C,{onCancel:m.closeModal.bind(m),onOK:function(){m.closeModal(),M.initDownload(e.props.msg)},okText:l10n.t("web_button_download"),cancelText:l10n.t("web_cancel"),title:l10n.t("download_contact_title")},l10n.t("download_contact_prompt")))},onAddToGroupClick:function(){var e=this.props.msg.getWAids();e.length>1?m.openModal(d.createElement(_,{vCard:this.props.msg.vcard,onCancel:m.closeModal.bind(m),onSelect:this.addContactToGroup,iconClass:"icon icon-add-user"})):this.addContactToGroup(c["default"].first(e))},addContactToGroup:function(e){Store.Contact.find(e).then(function(e){m.openModal(d.createElement(E,{contact:e}),"modal-flow")})},render:function(){var e=this.props.msg,t=e.getWAids(),n="vcard-avatar vcard-avatar-single",i=p(["bubble","bubble-vcard"],{"bubble-attach-caption":!!e.caption,"bubble-vcard-quoted":e.isQuoted}),a=c["default"].truncate(e.subtype||l10n.t("attach_vcard"),{length:120,omission:l10n.t("punctuation_ellipsis")}),s=void 0;t.length>0&&(s=d.createElement("div",{className:"bubble-actions"},d.createElement("div",{className:"bubble-btn",onClick:this.onMessageClick,title:l10n.t("message_author",{author:a})},l10n.t("message")),d.createElement("div",{className:"bubble-btn",onClick:this.onAddToGroupClick,title:l10n.t("add_contact_to_group")},l10n.t("add_contact_to_group"))));var r=this.props.displayAuthor&&h.shouldRender(e)?d.createElement(h,{msg:e}):null,l=this.props.msg.vcard||this.props.msg.chat.isTrusted(),m=p({vcard:!0,"vcard-pointer":l}),y=l?this.viewContact:c["default"].noop;return d.createElement("div",{className:i},r,this.props.quotedMsg,d.createElement("div",{className:"wrapper wrapper-vcard",onClick:y},d.createElement("div",{className:m},d.createElement(v,{className:n,thumb:g.thumbnail(e.body),waid:e.getVCardThumbnailWAid()}),d.createElement("div",{className:"vcard-body"},d.createElement(o["default"],{text:a,element:"div",className:"vcard-name vcard-name-single",selectable:!0,dirMismatch:e.rtl!==l10n.isRTL(),direction:e.dir,formatters:u.Configuration.Compatibility()}))),d.createElement(f,{msg:e,contextMenu:this.contextMenu})),s)}});e.exports=b},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(458),s=i(a),r=n(8),o=n(1372),l=n(158),c=n(235),u=n(1410),d=n(1438),p=n(1381),h=n(1380),f=n(10),m=n(1399),g=n(1401),v=n(61),y=n(76),E=n(466),S=n(233),M=n(1),C=r.createClass({displayName:"Video",mixins:[o,l],propTypes:{msg:r.PropTypes.instanceOf(s["default"]).isRequired,quotedMsg:r.PropTypes.element,isMsgVisible:r.PropTypes.func,displayAuthor:r.PropTypes.bool},getInitialState:function(){return{mediaStage:this.async("msg.mediaData.mediaStage")}},showMediaMissing:function(){f.openModal(r.createElement(m,{msg:this.props.msg}))},downloadMedia:function(){this.props.msg.forceDownloadMedia()},cancelDownload:function(){this.props.msg.cancelDownload()},cancelUpload:function(){this.props.msg.cancelUpload()},resumeUpload:function(){this.props.msg.resumeUpload()},resumeRemoteUpload:function(){v.supportsFeature(v.F.MEDIA_RETRY)?this.props.msg.resumeRemoteUpload():f.openModal(r.createElement(g,{msg:this.props.msg}))},getZoomNode:function(e){var t=this.props.isMsgVisible(e);return t&&t.getImgNode?t.getImgNode():void 0},downloadUnsupportedToDesktop:function(e){var t=this;e&&e.stopPropagation(),f.openModal(r.createElement(S,{onCancel:f.closeModal.bind(f),onOK:function(){f.closeModal(),E.initDownload(t.props.msg)},okText:l10n.t("web_button_download"),cancelText:l10n.t("web_cancel"),title:l10n.t("download_unsupported_media_title")},l10n.t("download_unsupported_media_prompt")))},launchMediaViewer:function(e){var t=this.props,n=t.msg,i=t.isMsgVisible;n.downloadMedia(!0),e&&e.stopPropagation(),f.mediaViewerModal(n,i?this.getZoomNode:_.noop)},launchVideoFloater:function(e){e&&e.stopPropagation();var t=this.props,n=t.msg,i=t.isMsgVisible;f.videoPlayerFloater(n,i?this.getZoomNode:_.noop)},stopEvent:function(e){e.stopPropagation()},render:function(){var e=this.props.msg,t=e.mediaData,n=null,i=null;switch(t.mediaStage){case c.STAGE.RESOLVED:case c.STAGE.INIT:n=r.createElement(u.Play,null),i=this.launchMediaViewer;break;case c.STAGE.NEED_POKE:n=r.createElement(u.Download,{filesize:t.size}),i=this.downloadMedia;break;case c.STAGE.UPLOADING:n=r.createElement(u.PendingCancel,null),i=this.cancelUpload;break;case c.STAGE.NEED_UPLOAD:n=r.createElement(u.Upload,{filesize:t.size}),i=this.resumeUpload;break;case c.STAGE.REMOTE_NEED_UPLOAD:n=r.createElement(u.Upload,{filesize:t.size}),i=this.resumeRemoteUpload;break;case c.STAGE.ERROR_MISSING:i=this.showMediaMissing;break;case c.STAGE.ERROR_UNSUPPORTED:e.isUnsentMedia||(n=r.createElement(u.Download,{filesize:t.size}),i=this.downloadUnsupportedToDesktop);break;default:n=r.createElement(u.Pending,null)}var a=null,s=y.durationStr(t.duration);s&&(a=r.createElement("span",{className:"message-duration"},r.createElement("span",{className:"icon-s icon-msg-video-light"}),s));var o=t.preview?{backgroundImage:'url("'+t.preview.url()+'")'}:void 0,l=r.createElement("div",{className:"image-thumb-body",style:o});t.preview||void 0===t.preview||M.assert(!1,"media-preview-invalid","Invalid preview: "+t.preview)();var f=this.props.displayAuthor&&h.shouldRender(e)?r.createElement(h,{msg:e}):null,m=r.createElement("div",{className:"shade"}),g=e.caption?r.createElement(d,{msg:e}):null,v=g?"bubble-image bubble-video bubble-image-caption":"bubble-image bubble-video",_=null;return r.createElement("div",{onClick:this.stopEvent},r.createElement("div",{className:v},f,this.props.quotedMsg,_,r.createElement("div",{className:"image-thumb",onClick:i},n,l,m,a),g,r.createElement(p,{msg:this.props.msg})))}});e.exports=C},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(458),m=i(f),g=n(18),v=i(g),y=n(8),_=n(45),E=n(1577),S=n(1595),M=n(1424),C=n(44),b=n(76),T=n(1428),P=(n(1385),n(9)),k=n(1),N={KEEP_SCROLL_BOTTOM:"KEEP_SCROLL_BOTTOM",KEEP_SCROLL_TOP:"KEEP_SCROLL_TOP",SCROLL_BOTTOM:"SCROLL_BOTTOM",NONE:"NONE",DEFAULT:"DEFAULT"},w={};w[N.KEEP_SCROLL_BOTTOM]=2,w[N.KEEP_SCROLL_TOP]=2,w[N.SCROLL_BOTTOM]=2,w[N.NONE]=1,w[N.DEFAULT]=0;var x=function(e){function t(e){return(0,o["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).call(this,e))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"shouldComponentUpdate",value:function(e){return e.updateType!==N.NONE}},{key:"componentWillUpdate",value:function(e){var t=_.findDOMNode(this).parentNode,n=e.updateType;n===N.KEEP_SCROLL_BOTTOM?this.shouldRestoreScroll=t.scrollHeight-t.scrollTop-t.clientHeight:n===N.KEEP_SCROLL_TOP&&(this.shouldRestoreScroll=t.scrollTop)}},{key:"componentDidMount",value:function(){this.maybeNotifyChatRendered()}},{key:"componentDidUpdate",value:function(e){var t=_.findDOMNode(this).parentNode;this.props.updateType===N.SCROLL_BOTTOM?t.scrollTop=t.scrollHeight:void 0!==this.shouldRestoreScroll&&(this.props.updateType===N.KEEP_SCROLL_BOTTOM?t.scrollTop=t.scrollHeight-this.shouldRestoreScroll-t.clientHeight:t.scrollTop=this.shouldRestoreScroll,this.shouldRestoreScroll=void 0),
this.maybeNotifyChatRendered()}},{key:"maybeNotifyChatRendered",value:function(){this.props.notifyChatRendered&&(this.props.focusedMsgCtx&&this.props.focusedMsgCtx.msg&&!v["default"].includes(this.props.msgs,this.props.focusedMsgCtx.msg)||this.props.notifyChatRendered())}},{key:"onCopy",value:function(e){var t=window.getSelection();e.clipboardData.setData("text/plain",T.asPlainText(t)),e.stopPropagation(),e.preventDefault()}},{key:"getMsgVisibility",value:function(e){var t=_.findDOMNode(this).parentNode,n=t.scrollTop,i=n+t.clientHeight,a=_.findDOMNode(e);return a?a.offsetTop+a.clientHeight<=n?{visibility:P.VISIBILITY.ABOVE,offset:a.offsetTop-n}:a.offsetTop>=i?{visibility:P.VISIBILITY.BELOW,offset:a.offsetTop-n}:{visibility:P.VISIBILITY.VISIBLE,offset:a.offsetTop-n}:(k.error("getMsgVisibility on invalid ref: "+e)(),{visibility:P.VISIBILITY.VISIBLE,offset:0})}},{key:"render",value:function(){var e,t,n=[],i=this.props.msgs,a=this.props,s=a.focusedMsgCtx,r=a.unreadCount,o=a.selectedMessages,l=!1,c=void 0,u=0;for(t=0;t<i.length;t++)if(e=i[t]){var d=b.dayOfMsg(e);0!==t&&c===d||(n.push(y.createElement(E,{ref:"dateMarker_"+u,key:"msg-"+e.id+"-date",timestamp:e.t})),l=!1,u+=1),c=d,r>0&&s&&s.isUnreadDivider&&s.msg===e&&(n.push(y.createElement("div",{className:"msg-unread",key:"msg-unread"},y.createElement(S,{count:r}))),l=!1);var p=v["default"].matches({from:e.from,startOfDay:e.startOfDay}),h=v["default"].matches({author:e.author,startOfDay:e.startOfDay}),f=e.isGroupMsg?h:p,g=M.Position.SINGLE,_=i[t+1];(_&&r&&s&&s.isUnreadDivider&&s.msg===_||_&&_.isNotification||_&&d!==b.dayOfMsg(_))&&(_=!1),e.isNotification?g=M.Position.SINGLE:f(_)&&!f(l)?g=M.Position.FRONT:f(l)&&f(_)?g=M.Position.MID:f(l)&&!f(_)&&(g=M.Position.END);var T=s&&s.msg===e,k=e.type===m["default"].TYPE.IMAGE||e.type===m["default"].TYPE.VIDEO||e.type===m["default"].TYPE.AUDIO;n.push(y.createElement(M,{key:"msg-"+e.id,ref:e.id.toString(),msg:e,displayType:P.DISP_TYPE.CONVERSATION,isMsgVisible:k?this.props.isMsgVisible:v["default"].noop,selectable:this.props.selectable,selectedMessages:o,onMessageSelect:this.props.onMessageSelect,position:g,isFocusedMsg:T})),l=e.isNotification?!1:e}var N=C("message-list",{selectable:this.props.selectable});return y.createElement("div",{className:N,onCopy:this.onCopy.bind(this)},n)}}]),t}(y.Component);x.UpdateTypes=N,x.UpdateTypePriority=w,e.exports=x},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1370),o=i(r),l=n(468),c=n(8),u=n(1),d=n(10),p=n(1376),h=n(158),f=n(160),m=n(13),g=n(1407),v=n(1416),y=n(1729),E=n(0),S=n(40),M=n(234),C=n(110),b=c.createClass({displayName:"PTT",mixins:[f,h,p],propTypes:{chat:c.PropTypes.instanceOf(o["default"]),onStateChange:c.PropTypes.func.isRequired},statics:{READY:"ready",DELAY:"delay",REC:"recording",PROCESSSING:"processsing",GUM_TIMEOUT:"ptt_gum_timeout",PERMISSION_DENIED:"permission_denied",NOT_SUPPORTED_ERROR:"not_supported_error",MANDATORY_UNSATISFIED_ERROR:"mandatory_unsatisfied_error",CANCEL:"cancel",SEND:"send"},getInitialState:function(){return{state:b.READY,active:void 0,elapsedTime:0,startTime:0}},componentDidMount:function(){this.regNativeListener(window,"blur",this.cancelRecording)},isRecording:function(){var e=this.state.state;return e===b.REC||e===b.DELAY||e===b.PROCESSSING},cancelRecording:function(){this.isRecording()&&(this.state.state!==b.READY&&this.props.onStateChange(b.READY),this.safeIsMounted()&&this.setState({state:b.READY,active:void 0,elapsedTime:0,startTime:0}),this.clearSafeInterval(this.elapsedTimeInterval),delete this.elapsedTimeInterval,this.recorder&&this.recorder.stop(),this.props.chat.markPaused())},startInterval:function(){var e=this;this.elapsedTimeInterval=this.safeInterval(function(){e.setState({elapsedTime:e.state.elapsedTime+1})},1e3),this.setState({elapsedTime:0,startTime:Date.now()})},cancelPTTTimer:function(){this.pttTimer&&(this.clearSafeTimeout(this.pttTimer),delete this.pttTimer)},onPTTReady:function(){delete this.pttTimer,this.state.state===b.DELAY&&this.setState({state:b.REC})},onMouseOverSend:function(){this.setState({active:b.SEND})},onMouseOutSend:function(){this.setState({active:void 0})},onMouseOverCancel:function(){this.setState({active:b.CANCEL})},onMouseOutCancel:function(){this.setState({active:void 0})},onMouseUpCancel:function(){this.state.elapsedTime<1||(this.cancelPTTTimer(),this.cancelRecording())},onMouseUpSend:function(){var e=this;if(!(this.state.elapsedTime<1)){this.cancelPTTTimer();var t=this.props.chat;if(this.state.state===b.REC){this.setState({state:b.PROCESSSING}),this.props.onStateChange(b.READY);var n=t.regCancellablePromise(S.waitForEvent(this.recorder,"dataAvailable").then(function(e){return e.detail}));(0,l.prepRawMedia)(n,{isPtt:!0,precomputedDuration:~~this.recorder.duration}).sendToChat(t,{quotedMsg:t.composeQuotedMsg||void 0,addEvenWhilePreparing:!0}),t.composeQuotedMsg=null,n["catch"](s["default"].CancellationError,_.noop)["finally"](function(){e.cancelRecording()}),this.recorder.stop()}else this.cancelRecording(),u.log("ptt:onMouseUpSend duration too short")()}},onMouseDown:function(){var e=this;if(this.state.state===b.READY){var t=v.start("microphone");s["default"].race([t,this.rejectOnUnmount()]).checkpoint(this.rejectOnUnmount()).then(function(t){e.recorder=new y({bitRate:16e3,encoderSampleRate:16e3,encoderApplication:2048}),e.recorder.initStream(t),e.recorder.start(),e.props.chat.presence.update()["catch"](m.WapDrop,_.noop),e.props.chat.markRecording(),e.setState({state:b.DELAY}),e.props.onStateChange(b.REC),e.pttTimer=e.safeDelay(e.onPTTReady,1500),e.startInterval()})["catch"](m.Unmount,function(){t.then(function(e){return v.stop(e)})["catch"](_.noop)})["catch"](m.GUM.PermissionDeniedError,function(){d.openModal(c.createElement(g,{title:"guide_desktop_mic_title",desc:"guide_desktop_mic_fail_description",type:g.TYPE.GUIDE_UNBLOCK}))})["catch"](m.GUM.GUMError,function(){d.openModal(c.createElement(g,{title:"guide_desktop_mic_missing_title",desc:"guide_desktop_mic_missing_description",type:g.TYPE.GUIDE_NONE}))})["catch"](function(t){e.recorder&&e.recorder.stop(),u.error("PTT Recording Error")(t)})}},render:function(){var e="btn-close btn-border ptt-close";this.state.active===b.CANCEL&&(e+=" is-hover");var t="btn-border ptt-send";this.state.active===b.SEND&&(t+=" is-hover");var n=void 0;this.state.state!==b.DELAY&&this.state.state!==b.REC||(n=c.createElement(M,{displayName:"PTT",popable:!0,escapable:!0,requestDismiss:this.cancelRecording},c.createElement("div",{className:"ptt-recording",key:"recording"},c.createElement("button",{className:e,onMouseOver:this.onMouseOverCancel,onMouseOut:this.onMouseOutCancel,onMouseUp:this.onMouseUpCancel},c.createElement("span",{className:"icon icon-round-x btn-state-default"}),c.createElement("span",{className:"icon icon-round-x-inv btn-state-hover"})),c.createElement("div",{className:"ptt-counter"},E.unix(this.state.elapsedTime).format("m:ss")),c.createElement("button",{className:t,onMouseOver:this.onMouseOverSend,onMouseOut:this.onMouseOutSend,onMouseUp:this.onMouseUpSend},c.createElement("span",{className:"icon icon-round-send btn-state-default"}),c.createElement("span",{className:"icon icon-round-send-inv btn-state-hover"})))));var i=this.state.state===b.READY||this.state.state===b.PROCESSSING?c.createElement("button",{className:"icon btn-icon icon-ptt",onMouseDown:this.onMouseDown,disabled:this.state.state===b.PROCESSSING,key:"button"}):null,a="ptt-container";return n&&(a+=" active"),c.createElement("div",{className:a},c.createElement(C,{transitionName:"ptt"},n||i))}});e.exports=b},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1370),o=i(r),l=n(8),c=n(233),u=n(10),d=n(156),p=n(40),h=l.createClass({displayName:"Spam",mixins:[d],propTypes:{chat:l.PropTypes.instanceOf(o["default"]).isRequired},componentWillMount:function(){this.addObserver(Store.Blocklist,"add remove reset"),this.addObserver(this.props.chat,"change:trusted")},confirmReportGroupSpam:function(){u.openModal(l.createElement(c,{onOK:this.reportGroupSpam,okText:l10n.t("report_group_spam"),onCancel:u.closeModal.bind(u),cancelText:l10n.t("web_cancel")},l10n.t("report_group_spam_ack")))},reportGroupSpam:function(){var e=this.props.chat,t=e.sendSpamReport(!0);if(!e.isReadOnly){var n=e.sendExit(),i=p.waitForBBEvent(e.msgs,"change:last",function(e){return e.isGroupLeave()});t=s["default"].all([t,n,i])}t.then(function(){return e.sendDelete()})["catch"](_.noop),u.closeModal()},confirmReportSpam:function(){u.openModal(l.createElement(c,{onOK:this.reportSpam,okText:l10n.t("report_spam"),onCancel:u.closeModal.bind(u),cancelText:l10n.t("web_cancel")},l10n.t("report_spam_ack")))},reportSpam:function(){var e=this.props.chat;e.sendSpamReport().then(function(){return e.contact.setBlock(!0)}).then(function(){return e.sendDelete()})["catch"](_.noop),u.closeModal()},notSpam:function(){this.props.chat.sendNotSpam(!0)["catch"](_.noop)},confirmBlock:function(){u.openModal(l.createElement(c,{onOK:this.block,okText:l10n.t("block"),onCancel:u.closeModal.bind(u),cancelText:l10n.t("web_cancel")},l10n.t("block_ack")))},block:function(){this.props.chat.contact.setBlock(!0)["catch"](_.noop),u.closeModal()},confirmUnblock:function(){u.openModal(l.createElement(c,{okText:l10n.t("unblock_button"),onOK:this.unblock,cancelText:l10n.t("web_cancel"),onCancel:u.closeModal.bind(u)},l10n.t("unblock_confirmation",{contact:this.props.chat.contact.formattedName})))},unblock:function(){this.props.chat.contact.setBlock(!1)["catch"](_.noop),u.closeModal()},render:function(){var e=this.props.chat;if(e.isPSA||!e.isVisible||e.trusted)return null;var t,n=[];if(e.isGroup)t=l10n.t("group_admin_not_a_contact"),n.push(l.createElement("button",{className:"spam-button btn-plain",key:"report_spam",onClick:this.confirmReportGroupSpam},l10n.t("report_spam")));else{t=l10n.t("sender_not_a_contact"),n.push(l.createElement("button",{className:"spam-button btn-plain",key:"report_spam",onClick:this.confirmReportSpam},l10n.t("report_spam")));var i=Store.Blocklist.get(e.id);i?n.push(l.createElement("button",{onClick:this.confirmUnblock,key:"unblock",className:"spam-button btn-plain"},l10n.t("unblock_button"))):n.push(l.createElement("button",{onClick:this.confirmBlock,key:"block",className:"spam-button btn-plain"},l10n.t("block")))}return n.push(l.createElement("button",{onClick:this.notSpam,key:"not_spam",className:"spam-button btn-plain"},l10n.t("not_spam"))),l.createElement("div",{className:"spam"},l.createElement("div",{className:"spam-text"},t),l.createElement("div",{className:"spam-controls"},n))}});e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(460),o=i(r),l=n(1370),c=i(l),u=n(8),d=n(45),p=n(156),h=n(93),f=n(1402),m=n(1572),g=n(1573),v=n(1469),y=n(1504),E=n(10),S=n(41),M=n(110),C=n(1385),b=n(1372),T=n(9),P=n(1530),k=n(234),N=u.createClass({displayName:"ConversationPanel",mixins:[p,b,h],propTypes:{chat:u.PropTypes.instanceOf(c["default"]).isRequired,msgCollection:u.PropTypes.instanceOf(f).isRequired,focusCtx:u.PropTypes.object,notifyChatRendered:u.PropTypes.func,updateOpenedChatInfo:u.PropTypes.func.isRequired},getInitialState:function(){var e=this.props.chat;return this.fillerHeight=e.fillerHeight||0,this.selectedMessages=new C([],function(e){return e.id.toString()}),{canCompose:e.canSend,selectable:!1,wallpaperColor:this.async("chat.ChatPreference.wallpaperColor")}},componentWillMount:function(){var e=this.props.chat;e.fillerHeight=null,this.addObserver(e,"change:canSend",this.onComposeState),this.openEvent=new S.WebcChatOpen({webcUnreadCount:e.unreadCount}),this.uiActionEvent=new S.UiAction({uiActionType:S.UI_ACTION_TYPE.CHAT_OPEN,uiActionPreloaded:!0})},componentDidMount:function(){var e=this.props.chat;e.set({active:!0,viewed:!0}),this.openEvent&&(this.openEvent.markWebcChatOpenT(),this.openEvent.commit(),delete this.openEvent),this.uiActionEvent&&(this.uiActionEvent.markUiActionT(),this.uiActionEvent.commit(),delete this.uiActionEvent),this.addObserver(Store.ChatPreference,"wallpaper_color_preview",this.onWallpaperColorPreview),this.regCmd("scroll_messages",this.scrollMessages)},componentWillUnmount:function(){this.props.chat.set("active",!1)},onComposeState:function(){var e=this.props.chat.canSend;this.state.canCompose!==e&&this.setState({canCompose:e})},onComposeHeightChange:function(e,t){var n=this,i=e.input,a=e.overlay,r=d.findDOMNode(this.refs.msgPanel);if(r&&this.refs.msgs){var l=this.refs.msgs.getScrollBottom();return _.isNumber(i)?void this.refs.msgs.composeHeightChange(i):t?(this.fillerHeight=a,void(this.refs.filler&&(this.refs.filler.style.height=this.fillerHeight+"px",this.refs.msgs.setScrollBottom(l)))):(this.fillerHeight+=a,0>a&&(this.refs.filler&&(this.refs.filler.style.height=this.fillerHeight+"px"),this.refs.msgs&&this.refs.msgs.setScrollBottom(l)),this.msgPanelAnimation&&(this.didCancel=!0,this.msgPanelAnimation.cancel()),this.msgPanelAnimation=(this.msgPanelAnimation||s["default"].resolve()).then(function(){return(0,o["default"])(r,{translateY:a>0?[-a,0]:[0,a]},{duration:300,easing:[.1,.82,.25,1]})}).cancellable().then(function(){n.isMounted()&&(a>0&&n.refs.filler&&(n.refs.filler.style.height=n.fillerHeight+"px"),r.style.transform="",n.refs.msgs&&a>0&&n.refs.msgs.setScrollBottom(l))})["catch"](s["default"].CancellationError,function(){(0,o["default"])(r,"finish",!0)}).then(function(){n.didCancel?n.didCancel=!1:n.msgPanelAnimation=void 0}))}},onWallpaperColorPreview:function(e){e?this.state.wallpaperColor!==e&&this.setState({wallpaperColor:e}):this.setState({wallpaperColor:Store.ChatPreference.get("defaultPreference").wallpaperColor})},onSelectMessages:function(){this.state.selectable||this.setState({selectable:!0})},onCancelSelection:function(){this.state.selectable&&(this.selectedMessages.unsetAll(),this.setState({selectable:!1}))},onMessageSelect:function(e,t){this.onSelectMessages(),this.selectedMessages.setVal(e,t)},onPageUpDown:function(e){this.refs.msgs.onPageUpDown(e)},scrollMessages:function(){var e=this.refs.msgs,t=e&&e.refs.scrollContainer;if(t){var n=_.last(e.msgListInfo.visibleMsgOrder);if(n){var i=d.findDOMNode(e.refs.messageList.refs[n.toString()]);if(i){var a=0;1===e.msgListInfo.visibleMsgOrder.length&&(a=i.clientHeight),(0,o["default"])(i,"stop"),(0,o["default"])(t,"stop"),(0,o["default"])(i,"scroll",{duration:300,container:t,offset:a})}}}},onDragStart:function(e){this.state.canCompose&&(this.blockDrop=!0)},onDragEnd:function(e){this.state.canCompose&&(this.blockDrop=!1)},onDragEnter:function(e){this.state.canCompose&&!this.blockDrop&&(_.includes(e.dataTransfer.types,"Files")||_.includes(e.dataTransfer.types,"text/uri-list")||_.includes(e.dataTransfer.types,"text/html"))&&(E.attachMediaDrawer(this.props.chat,void 0),e.stopPropagation(),e.preventDefault())},render:function(){var e,t,n,i=this.props,a=i.chat,s=i.msgCollection,r=i.focusCtx;if(this.state.selectable)t=u.createElement(k,{displayName:"MultiSelect",escapable:!0,requestDismiss:this.onCancelSelection},u.createElement(y,{chat:a,selectedMessages:this.selectedMessages,onCancel:this.onCancelSelection})),e=u.createElement("footer",{className:"pane-footer pane-chat-footer"}),n=u.createElement("div",{ref:"filler",className:"compose-filler"});else if(this.state.canCompose)e=u.createElement(v,{chat:a,ref:"composeBox",className:"pane-footer pane-chat-footer",onComposeHeightChange:this.onComposeHeightChange,onPageUpDown:this.onPageUpDown}),n=u.createElement("div",{ref:"filler",style:{height:this.fillerHeight+"px"},className:"compose-filler"});else{var o;o=a.isGroup?l10n.t("web_cannot_send_not_a_group_participant"):a.isPSA?l10n.t("web_psa_title"):l10n.t("web_cannot_send_to_blocked_contact_1",{contact:a.contact.formattedName}),e=u.createElement("footer",{className:"pane-footer pane-chat-footer"},u.createElement("div",{className:"block-message"},o))}var l={},c={};return this.state.wallpaperColor!==T.DEFAULT_CHAT_WALLPAPER&&(l.background=this.state.wallpaperColor,l.transition="background 0.3s ease",c.display="none"),u.createElement(k,{displayName:"ConversationPanel",state:k.State.INACTIVE,requestFocus:this.requestFocus},u.createElement("div",{id:"main",className:"pane pane-chat pane-two"},u.createElement("div",{className:"pane-chat-tile",style:c}),u.createElement(m,{chat:a,canAttach:this.state.canCompose,onSelectMessages:this.onSelectMessages}),u.createElement("div",{className:"pane-body pane-chat-tile-container",ref:"msgPanel",onDragStart:this.onDragStart,onDragEnd:this.onDragEnd,onDragOver:this.onDragOver,onDragEnter:this.onDragEnter,style:l},u.createElement(g,{ref:"msgs",chat:a,selectable:this.state.selectable,onMessageSelect:this.onMessageSelect,msgCollection:s,onSelectMessages:this.onSelectMessages,focusCtx:r,selectedMessages:this.selectedMessages,notifyChatRendered:this.props.notifyChatRendered,updateOpenedChatInfo:this.props.updateOpenedChatInfo})),n,e,u.createElement(M,{transitionName:"slide-up"},t),u.createElement(P,null)))}});e.exports=N},function(e,t,n){"use strict";var i=n(8),a=n(45),s=n(110),r=n(93),o=n(234),l=n(481),c=n(44),u=n(1281),d=n(18),p=n(91),h=n(92),f={LEFT:"drawer-left",MID:"slide-up",RIGHT:"slide-left",NONE:"none"},m={LEFT:"left",MID:"mid",RIGHT:"right"},g=function(e){return f[e.toUpperCase()]},v=i.createClass({displayName:"DrawerManager",mixins:[r],propTypes:{direction:i.PropTypes.oneOf(d.values(m)),onDrawerIn:i.PropTypes.func,onDrawerOut:i.PropTypes.func,onDrawerAnimationComplete:i.PropTypes.func},getChildContext:function(){var e=this.state.uim||this.context.uim;return{uim:e}},getInitialState:function(){return{drawer:void 0,drawerId:0,transition:g(this.props.direction),uim:void 0}},componentWillMount:function(){this.regCmd("open_drawer_"+this.props.direction,this.openFlow),this.regCmd("exists_drawer_"+this.props.direction,this.existsFlow),this.regCmd("close_drawer_"+this.props.direction,this.closeFlow)},shouldComponentUpdate:function(e,t){return u(this,e,t)},openFlow:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g(this.props.direction),n=this,i=arguments[2],a=arguments[3],s=d.uniqueId("DrawerManager"+this.props.direction);if(this.state.drawer){if(e.key&&d.isEqual(this.state.drawer.key,e.key))return;this.blockTransition=f.NONE,this.setState({drawer:e,drawerId:s,transition:t,uim:i,option:a},function(){n.blockTransition=t})}else this.props.onDrawerIn&&this.props.onDrawerIn(),this.setState({drawer:e,drawerId:s,transition:t,uim:i,option:a})},existsFlow:function(e){e(!!this.state.drawer)},closeFlow:function(e){e&&this.state.drawerId!==e||this.state.drawer&&(this.props.onDrawerOut&&this.props.onDrawerOut(),this.setState({drawer:void 0}))},requestFocus:function(e){var t=a.findDOMNode(this.refs.UIE);t&&!t.contains(document.activeElement)&&p.focus(t)},render:function(){var e=this.props,t=e.onDrawerAnimationComplete,n=e.direction,a=this.state,r=a.drawer,u=a.drawerId,p=a.transition,h=a.option,f=this.blockTransition||p,g=h&&h.noFocus?null:this.requestFocus;r&&(r=i.createElement(o,{displayName:"Drawer"+d.upperFirst(n),escapable:!0,key:u,ref:"UIE",requestFocus:g,requestDismiss:this.closeFlow.bind(null,u)},i.createElement(l,{style:{height:"100%"}},r)));var v=c("pane",{"pane-one":n===m.LEFT,"pane-two":n===m.MID,"pane-three":n===m.RIGHT});return i.createElement(s,{transitionName:f,className:v,onAnimationComplete:t},r)}});v.contextTypes={uim:i.PropTypes.instanceOf(h)},v.childContextTypes={uim:i.PropTypes.instanceOf(h)},v.Dir=m,v.Transition=f,e.exports=v},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(8),s=i(a),r=n(45),o=i(r),l=n(156),c=i(l),u=n(158),d=i(u),p=n(160),h=i(p),f=n(93),m=i(f),g=n(161),v=i(g),y=n(1371),E=i(y),S=n(91),M=n(111),C=i(M),b=n(1570),T=i(b),P=n(1382),k=i(P),N=n(467),w=i(N),x=n(1384),O=n(92),D=i(O),R=n(234),I=i(R),A=n(1478),L=s["default"].createClass({displayName:"EmojiTab",mixins:[c["default"],h["default"],d["default"],m["default"]],propTypes:{tab:s["default"].PropTypes.oneOf(A.PossibleTabs).isRequired,onEmoji:s["default"].PropTypes.func.isRequired,emojiList:s["default"].PropTypes.array,focusPrevSection:s["default"].PropTypes.func,focusNextSection:s["default"].PropTypes.func,onFocusRelease:s["default"].PropTypes.func,scrollEmojiIntoViewIfNeeded:s["default"].PropTypes.func,isSuggestion:s["default"].PropTypes.bool,onArrowDown:s["default"].PropTypes.func},emojiList:null,lastFocusedElement:null,rowLength:0,getInitialState:function(){var e={skinTonePicker:!1};return e},shouldComponentUpdate:function(e,t){return this.state.skinTonePicker!==t.skinTonePicker},componentWillReceiveProps:function(e){this.state.skinTonePicker&&this.closeSkinTonePicker()},componentDidMount:function(){var e=this;if(this.addObserver(Store.EmojiVariant,"add remove change:variant",function(){return e.forceUpdate()}),this.props.isSuggestion){var t=this.safeDebounce(this.windowResized,100);this.regNativeListener(window,"resize",t),this.windowResized()}},windowResized:function(){var e=this.getEmojiRowLength();this.rowLength!==e&&(this.rowLength=e,this.forceUpdate())},onEmojiClick:function(e){this.stopEvent(e);var t=e.target.dataset.unicode;if(t)if(v["default"].skinToneEmojis[t]){var n=this.getEmojiVariant(t);this.props.tab===A.Tab.RECENT?this.onEmoji(n||t):n?this.onEmoji(n):this.onContextMenu(e)}else this.onEmoji(t)},onEmojiMouseDown:function(e){this.stopEvent(e);var t=e.target.dataset.unicode;t&&v["default"].skinToneEmojis[t]&&this.startPickerTimer(e)},onEmoji:function(e){this.props.onEmoji(e),this.releaseFocus()},releaseFocus:function(){this.props.onFocusRelease&&this.props.onFocusRelease()},getEmojiVariant:function(e){return v["default"].skinToneEmojis[e]?Store.EmojiVariant.getVariant(e):null},setEmojiVariant:function(e,t,n){return this.stopEvent(e),this.onEmoji(n),Store.EmojiVariant.setVariant(t,n),!1},stopEvent:function(e){e&&(e.preventDefault(),e.stopPropagation())},onContextMenu:function(e){this.stopEvent(e);var t=e.target.dataset.unicode;t&&v["default"].skinToneEmojis[t]&&this._onContextMenu(t,e.target)},_onContextMenu:function(e,t,n){var i=this;n||(this.lastFocusedElement=null),this.clearPickerTimer();var a=v["default"].skinToneEmojis[e],r=A.SKIN_TONE_VARIATIONS.map(function(t){var n=v["default"].variantToUnicode(a,t);return s["default"].createElement(k["default"],{key:n,a8n:"mi-emoji-variant",action:function(t){return i.setEmojiVariant(t,e,n)}},s["default"].createElement("div",{className:"emoji-picker"},s["default"].createElement(E["default"],{text:n,formatters:x.Configuration.LargeEmojiOnly(),tabIndex:"-1"})))});this.setState({skinTonePicker:{menu:r,anchor:t,type:w["default"].Type.PICKER,menuDirection:{x:w["default"].Direction.X.RIGHT,y:w["default"].Direction.Y.TOP},layoutDirection:w["default"].LayoutDirection.HORIZONTAL,focusFirstOnMount:n}})},closeSkinTonePicker:function(){this.setState({skinTonePicker:!1})},clearPickerTimer:function(){this.pickerTimer&&(this.unregNativeListener(window,"mouseup",this.clearPickerTimer,!0),this.clearSafeTimeout(this.pickerTimer),this.pickerTimer=null)},eatClick:function(e){this.stopEvent(e),this.unregCmd("window_click",this.eatClick)},startPickerTimer:function(e){var t=this;this.stopEvent(e),this.clearPickerTimer();var n=e.target,i=n.dataset.unicode;this.pickerTimer=this.safeDelay(function(){t.regCmd("window_click",t.eatClick),t._onContextMenu(i,n)},250),this.regNativeListener(window,"mouseup",this.clearPickerTimer,!0)},getEmojiRowLength:function(){var e=this.refs.emojiPanel&&this.refs.emojiPanel.offsetWidth;return e?Math.floor(e/A.EMOJI_WIDTH):8},focusPrevSection:function(e){this.props.focusPrevSection&&(this.props.focusPrevSection(this.props.tab,e),this.lastFocusedElement=null)},focusNextSection:function(e){this.props.focusNextSection&&(this.props.focusNextSection(this.props.tab,e),this.lastFocusedElement=null)},onEmojiArrowUp:function(e){this.onEmojiArrow(e,"up")},onEmojiArrowDown:function(e){this.onEmojiArrow(e,"down")},onEmojiArrowLeft:function(e){this.onEmojiArrow(e,"left")},onEmojiArrowRight:function(e){this.onEmojiArrow(e,"right")},onEmojiArrow:function(e,t){this.stopEvent(e);var n=e.target.dataset.emojiIndex;if(n){n=Number(n);var i=this.props.emojiList,a=this.getEmojiRowLength(),s=n;switch(t){case"up":if(this.props.isSuggestion)s=0;else{if(a>n)return void this.focusPrevSection(n%a);s=n-a}break;case"down":if(this.props.isSuggestion)this.props.onArrowDown&&this.props.onArrowDown();else{if(Math.floor(n/a)>=Math.floor((i.length-1)/a))return void this.focusNextSection(n%a);s=Math.min(n+a,i.length-1)}break;case"left":if(!(n>0))return void this.focusPrevSection(a-1);s=n-1;break;case"right":if(n+1>=i.length)return void this.focusNextSection(0);s=n+1}this.focusEmoji(s)}},getEmoji:function(e){var t=this;if(this.props.isSuggestion){var n=this.getEmojiRowLength();e&&e.length>n&&(e=e.slice(0,n))}var i=_.map(e,function(e,n){var i=v["default"].codeToEmoji[e],a=t.getEmojiVariant(i);return a&&(e=v["default"].emojiMap[a]),s["default"].createElement("span",{key:i,"data-unicode":i,"data-variant":a,tabIndex:"-1","data-emoji-index":n,className:v["default"].getClasses(e,"large")})}),a={up:this.onEmojiArrowUp,down:this.onEmojiArrowDown,left:this.onEmojiArrowLeft,right:this.onEmojiArrowRight,enter:this.onEmojiEnter};return s["default"].createElement(C["default"],{ref:"emojis",onMouseDown:this.onEmojiMouseDown,onClick:this.onEmojiClick,onContextMenu:this.onContextMenu,handlers:a},i)},onEmojiEnter:function(e){this.stopEvent(e);var t=e.target.dataset.emojiIndex;if(t){var n=this.props.emojiList,i=n[t],a=v["default"].codeToEmoji[i];this.keyboardSelectEmoji(e,a)}},keyboardSelectRow:function(e,t){var n=this.getEmojiRowLength(),i=this.props.emojiList,a=i.length,s=0;s=t*n>=a?a-a%n:n*t;var r=i[s];if(r){this.stopEvent(e);var o=v["default"].codeToEmoji[r];this.keyboardSelectEmoji(e,o)}},keyboardSelectEmoji:function(e,t){if(v["default"].skinToneEmojis[t]){var n=this.getEmojiVariant(t);this.props.tab===A.Tab.RECENT?this.onEmoji(n||t):n?this.onEmoji(n):(this.stopEvent(e),this._onContextMenu(t,e.target,!0))}else this.onEmoji(t)},focusElement:function(e){(0,S.focus)(e),this.lastFocusedElement=e},focusEmoji:function(e){if(!(0>e)){var t=o["default"].findDOMNode(this.refs.emojis).children;if(!(e>=t.length)){var n=t[e];this.focusElement(n),this.props.scrollEmojiIntoViewIfNeeded&&this.props.scrollEmojiIntoViewIfNeeded(n)}}},focusRow:function(e){var t=this.getEmojiRowLength();e*t>=this.props.emojiList.length?this.focusLastRow(0):this.focusEmoji(t*e)},focusFirstRow:function(e){var t=this.getEmojiRowLength();this.focusEmoji(Math.min(t-1,e))},focusLastRow:function(e){var t=this.getEmojiRowLength(),n=this.props.emojiList.length,i=n-n%t+e;i=Math.min(i,n-1),this.focusEmoji(i)},restoreFocus:function(){this.lastFocusedElement&&this.focusElement(this.lastFocusedElement)},render:function(){var e=void 0;this.state.skinTonePicker&&(e=s["default"].createElement(I["default"],{displayName:"SkinTonePicker",popable:!0,escapable:!0,requestDismiss:this.closeSkinTonePicker},s["default"].createElement(T["default"],{tooltip:this.state.skinTonePicker})));var t=this.props.emojiList,n=void 0;return n=this.props.tab===A.Tab.RECENT&&!t||this.props.tab===A.Tab.SEARCH_RESULT?null:s["default"].createElement("div",{className:"emoji-panel-title"},this.props.tab.title()),s["default"].createElement("div",{ref:"emojiPanel",className:this.props.tab.className},n,this.getEmoji(t),e)}});L.contextTypes={uim:s["default"].PropTypes.instanceOf(D["default"])},e.exports=L},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){switch((0,g.gifProvider)()){case"giphy":return s(e);case"tenor":return o(e);default:throw new Error("Unrecognized provider "+(0,g.gifProvider)())}}function s(e){var t=!e,n=void 0;if(t)n=w.request("https://api.giphy.com/v1/gifs/trending","GET",{api_key:O,limit:100,rating:"pg-13"},"json");else{var i=l10n.getLocale(),a=void 0;_.indexOf(g.GIPHY_LOCALES,i)>=0&&(a=i),n=w.request("https://api.giphy.com/v1/gifs/search","GET",{q:e,api_key:O,limit:100,rating:"pg-13",lang:a},"json")}return n["catch"](function(){return null}).then(function(e){return e&&e.status<300&&r(e.response,t)})}function r(e,t){if(!e||!_.isArray(e.data))return[];for(var n=e.data,i=[],a=0;a<n.length;a++){var s=n[a];if(s&&s.images){var r=s.images.downsizedSmall,o=s.images.fixed_height,l=s.images.fixed_width,c=void 0,u=void 0;if(l&&l.mp4){var d=parseInt(l.height,10);d===d&&R>d&&(c=l,u=R*g.TARGET_GIF_HEIGHT/d)}if(o&&o.mp4){var p=parseInt(l.width,10);p===p&&R>p&&(c=o,u=p*g.TARGET_GIF_HEIGHT/R)}c&&i.push(new g.GifInfo(i.length,r&&r.url||c.mp4,c.mp4,c.webp||c.gif||void 0,Math.round(u),g.GIPHY,t))}}return i}function o(e){var t=!e,n=l10n.lng().replace("-","_"),i=void 0;return i=t?w.request("https://api.tenor.co/v1/trending","GET",{key:D,limit:50,safesearch:"moderate",locale:n},"json"):w.request("https://api.tenor.co/v1/search","GET",{tag:e,key:D,limit:50,safesearch:"moderate",locale:n},"json"),i["catch"](function(){return null}).then(function(e){return e&&e.status<300&&l(e.response)})}function l(e,t){if(!e||!_.isArray(e.results))return[];for(var n=e.results,i=[],a=0;a<n.length;a++){var s=n[a];if(s&&s.media&&s.media[0]){var r=s.media[0],o=r.tinymp4,l=r.previewmp4,c=r.previewgif;if(o){var u=(0,d["default"])(o.dims,2),p=u[0],h=u[1];i.push(new g.GifInfo(i.length,o.url,l&&l.url||void 0,c&&c.url||void 0,Math.round(p*g.TARGET_GIF_HEIGHT/h),g.TENOR,t))}}}return i}function c(e,t){for(var n=[],i=.9*t,a=e,s=null,r=.05;1>r&&a.length;r+=.05){a.sort(function(e,t){var n=e.rank-t.rank;return Math.abs(n)>8?n:t.width-e.width});for(var o=(1+r)*t,l=[],c=[],u=0;u<a.length;u++){for(var d=a[u],p=!1,h=Math.min(o-d.width,i),f=0;!p&&f<l.length;f++)l[f]<h&&(l[f]+=d.width+g.GAP_SIZE,c[f].push(d),p=!0);p||(l.push(d.width),c.push([d]))}if(1===c.length){a=[];var m=t-l[0]-g.GAP_SIZE;s={gifs:c[0],blankStr:m>0?m+"px":void 0}}else{a=[];for(var v=0;v<c.length;v++)l[v]>i?n.push(c[v]):a.push.apply(a,c[v])}}n.forEach(function(e){return e.sort(function(e,t){return e.rank-t.rank})}),n.sort(function(e,t){return e[0].rank-t[0].rank});var y=n.map(function(e){return{gifs:e,blankStr:void 0}});return s&&y.push(s),y}var u=n(35),d=i(u),p=n(2),h=i(p),f=n(458),m=i(f),g=n(1413),v=n(1477),y=i(v),E=n(8),S=n(45),M=n(13),C=n(41),b=n(78),T=n(55),P=n(1376),k=n(40),N=n(1731),w=n(95),x=n(1607),O="3o85xmWDYKgihhIKSA",D="DLAQBEYLJJIM",R=200,I={giphy:C.GIF_SEARCH_PROVIDER.GIPHY,tenor:C.GIF_SEARCH_PROVIDER.TENOR},A={giphy:m["default"].GIF_ATTRIBUTION.GIPHY,tenor:m["default"].GIF_ATTRIBUTION.TENOR},L=new N(a,{maxCached:6,maxAge:36e4,shouldCache:function(e){return!(!e||!e.length)}}),F=E.createClass({displayName:"GifSearch",mixins:[P],propTypes:{searchText:E.PropTypes.string,onGif:E.PropTypes.func.isRequired},getInitialState:function(){return this._scrollTop=0,this._animatingRow=null,this._containerDom=null,this._didSendGif=!1,{gifRows:[],width:0}},componentWillReceiveProps:function(e){e.searchText!==this.props.searchText&&this.scheduleQuery()},shouldComponentUpdate:function(e,t){return e.onGif!==this.props.onGif||t.gifRows!==this.state.gifRows},componentWillMount:function(){var e=this;this._searchTimer=new T(this.searchForAndSetGifs),this._animateTimer=new T(this.animateGif),this._onlineRestarter=h["default"].loop(function(){return k.waitForBBEvent(b,"change:online",function(){return b.online}).then(function(){return e.scheduleQuery()})}).cancellable(),this._onlineRestarter["catch"](h["default"].CancellationError,_.noop),this.searchForAndSetGifs(),new C.GifSearchSessionStarted({gifSearchProvider:I[(0,g.gifProvider)()]}).commit()},componentWillUnmount:function(){this._animateTimer.cancel(),this._searchTimer.cancel(),this._onlineRestarter.cancel(),this._didSendGif||new C.GifSearchCancelled({gifSearchProvider:I[(0,g.gifProvider)()]}).commit()},scheduleQuery:function(){this._searchTimer.debounceAndCap(200,2e3)},animateOnScroll:function(e){this._scrollTop=e.scrollTop,this._animateTimer.debounce(200)},onSend:function(e){var t=I[e.attribution];
new C.GifFromProviderSent({gifSearchProvider:t}).commit(),e.trending||new C.GifSearchResultTapped({gifSearchProvider:t,rank:e.rank}).commit(),this._didSendGif=!0,this.props.onGif(e.url,A[e.attribution])},setGifAnimating:function(e,t){var n=this.refs[e];n&&n.setShouldAnimate(t)},animateGif:function(){var e=this,t=this._animatingRow,n=this._scrollTop+g.GAP_SIZE;this._starredGifsDom&&(n-=this._starredGifsDom.clientHeight);var i=Math.round(n/(g.TARGET_GIF_HEIGHT+g.GAP_SIZE)),a=this.state.gifRows[i];if(a&&a.gifs.length&&a!==t){if(this._animatingRow=a,t)for(var s=0;s<t.gifs.length;s++)this.setGifAnimating(t.gifs[s].gifId,!1);for(var r=0;r<a.gifs.length;r++)this.setGifAnimating(a.gifs[r].gifId,!0)}[i+1,i-1].forEach(function(t){if(e.state.gifRows[t])for(var n=e.state.gifRows[t].gifs,i=0;i<n.length;i++)e.setGifAnimating(n[i].gifId,!1)})},searchForAndSetGifs:function(){var e=this,t=I[(0,g.gifProvider)()],n=this.props.searchText,i=L.getOrRun(n);i=i.then(),this._pendingQuery=i,i.checkpoint(this.rejectOnUnmount()).then(function(a){if(a&&0===a.length&&new C.GifSearchNoResults({gifSearchProvider:t}).commit(),i===e._pendingQuery&&(e._pendingQuery=null,a)){n||new C.GifTrendingViewed({gifSearchProvider:t}).commit();var s=e._containerDom.clientWidth;s-=2*g.GAP_SIZE,e._resetScroll=!0,e._animateTimer.debounce(0),e.setState({gifRows:c(a,s),width:s})}})["catch"](M.Unmount,h["default"].CancellationError,_.noop),n&&setTimeout(function(){e.rejectOnUnmount().isPending()&&n===e.props.searchText&&new C.GifSearchPerformed({gifSearchProvider:t}).commit()},500)},onStarredGifsMount:function(e){this._starredGifsDom=S.findDOMNode(e)},onContainerMount:function(e){this._containerDom=e,null!==e&&this._resetScroll&&(e.scrollTop=0)},render:function(){var e=this,t=this.state.gifRows;this._gifPreviews={};var n=t.map(function(t,n){var i=t.gifs.map(function(t,n){return E.createElement(y["default"],{key:t.gifId,ref:t.gifId,gif:t,display:!0,onSend:e.onSend})}),a=null;return t.blankStr&&(a=E.createElement("div",{className:"gif-search-blank",style:{flexBasis:t.blankStr}})),E.createElement("div",{key:n,className:"gif-search-row"},i,a)}),i=void 0;n.length&&!this.props.searchText&&(i=E.createElement("div",{className:"gif-section-title"},l10n.t("gif_trending_title")));var a=void 0;return this.props.searchText||(a=E.createElement(x,{onSend:this.onSend,ref:this.onStarredGifsMount})),E.createElement("div",{className:"gif-search-container",ref:this.onContainerMount},a,E.createElement("div",{className:"gifs-section"},i,n))}});e.exports=F},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(8),s=i(a),r=n(44),o=i(r),l=n(156),c=i(l),u=n(1477),d=i(u),p=n(1413),h=n(458),f=i(h),m=n(235),g=i(m),v=n(1410),y=i(v),_=n(10),E=i(_),S=n(233),M=i(S),C=s["default"].createClass({displayName:"StarredGifPreview",mixins:[c["default"]],propTypes:{msg:s["default"].PropTypes.instanceOf(f["default"]).isRequired,onSend:s["default"].PropTypes.func.isRequired},animateGif:function(){var e=this;this.uiIdle(function(){e._gifRef&&e._gifRef.setShouldAnimate(!0)})},componentDidMount:function(){this.animateGif()},componentDidUpdate:function(){this.animateGif()},componentWillMount:function(){var e=this.props.msg;this.addObserver(e,"change:mediaData.mediaStage"),this.uiIdle(function(){e.downloadMedia()})},setGifRef:function(e){this._gifRef=e},getGifProvider:function(){var e=this.props.msg.gifAttribution;switch(e){case f["default"].GIF_ATTRIBUTION.GIPHY:return p.GIPHY;case f["default"].GIF_ATTRIBUTION.TENOR:return p.TENOR;default:return}},handleClick:function(e){e.stopPropagation();var t=this.props.msg.mediaData;switch(t.mediaStage){case g["default"].STAGE.NEED_POKE:this.props.msg.downloadMedia(!0);break;case g["default"].STAGE.FETCHING:this.props.msg.cancelDownload();break;case g["default"].STAGE.UPLOADING:this.props.msg.cancelUpload();break;case g["default"].STAGE.ERROR_MISSING:E["default"].openModal(s["default"].createElement(M["default"],{title:l10n.t("missing_photo_title"),onOK:E["default"].closeModal.bind(E["default"]),okText:l10n.t("web_ok")},l10n.t("missing_photo_text")))}},onUnstarMsg:function(){var e=this.props.msg;E["default"].sendUnstarMsgs(e.chat,[e])},render:function(){var e=this.props.msg,t=e.mediaData,n=new p.GifInfo(void 0,t.renderableUrl,void 0,void 0,Math.round(t.aspectRatio*p.TARGET_GIF_HEIGHT),this.getGifProvider(),!1);if(t.mediaStage===g["default"].STAGE.RESOLVED)return s["default"].createElement(d["default"],{key:e.filehash,ref:this.setGifRef,gif:n,display:!0,onSend:this.props.onSend,isStarred:!0,onUnstarMsg:this.onUnstarMsg});var i=t.preview?t.preview.url():null,a=void 0;switch(t.mediaStage){case g["default"].STAGE.ERROR_MISSING:break;case g["default"].STAGE.NEED_POKE:a=s["default"].createElement(y["default"].Download,null);break;case g["default"].STAGE.FETCHING:case g["default"].STAGE.UPLOADING:a=s["default"].createElement(y["default"].PendingCancel,null);break;default:a=s["default"].createElement(y["default"].Pending,null)}var r=(0,o["default"])("image-thumb-body","image-thumb-gif",{blur:t.mediaStage===g["default"].STAGE.ERROR_MISSING}),l=s["default"].createElement("div",{className:r,style:{backgroundImage:"url("+i+")",height:p.TARGET_GIF_HEIGHT+"px"}});return s["default"].createElement("div",{className:"gif-search-gif-wrapper",style:{flexBasis:n.widthStr},key:e.filehash},s["default"].createElement("div",{style:{width:n.widthStr},onClick:this.handleClick},s["default"].createElement("div",null,a,l)),s["default"].createElement("span",{className:"icon-s icon-star-light",onClick:this.onUnstarMsg}))}});e.exports=C},function(e,t,n){"use strict";var i=n(8),a=n(44),s=n(156),r=n(1606),o=n(1413),l=o.TARGET_GIF_HEIGHT,c=o.GAP_SIZE,u={RIGHT:"RIGHT",LEFT:"LEFT"},d=4,p=i.createClass({displayName:"StarredGifs",mixins:[s],propTypes:{onSend:i.PropTypes.func.isRequired},getInitialState:function(){return{curIndex:0,direction:u.RIGHT}},componentWillMount:function(){var e=Store.StarredGifMsgs;this.addObserver(e,"add remove reset"),e.isSynced||e.sync()},onSlideLeft:function(){this.setState({curIndex:this.state.curIndex-1,direction:u.LEFT})},onSlideRight:function(){this.setState({curIndex:this.state.curIndex+1,direction:u.RIGHT})},render:function(){var e=this,t=Store.StarredGifMsgs.models;if(0===t.length)return i.createElement("div",null);if(t.length<=d){var n=0,s=t.map(function(t){return n+=Math.round(t.mediaData.aspectRatio*l),i.createElement(r,{key:t.filehash,msg:t,onSend:e.props.onSend})});return n+=(s.length-1)*c,i.createElement("div",{className:"gifs-section"},i.createElement("div",{className:"gif-section-title"},l10n.t("gif_starred_title")),i.createElement("div",{className:"gif-search-row",style:{maxWidth:n+"px"}},s))}var o=void 0,u=void 0,p=this.state.curIndex>0,h=this.state.curIndex+d<t.length,f=p?this.onSlideLeft:null,m=h?this.onSlideRight:null,g=a("star-gifs-pager gifs-pager-left",{"gifs-pager-disabled":!p}),v=a("star-gifs-pager gifs-pager-right",{"gifs-pager-disabled":!h});o=i.createElement("div",{className:g,onClick:f},i.createElement("span",{className:"icon icon-chevron-left-alt"})),u=i.createElement("div",{className:v,onClick:m},i.createElement("span",{className:"icon icon-chevron-right-alt"}));var y=t.slice(this.state.curIndex,this.state.curIndex+d).map(function(t){return i.createElement(r,{key:t.filehash,msg:t,onSend:e.props.onSend})});return i.createElement("div",{className:"gifs-section"},i.createElement("div",{className:"gif-section-title"},l10n.t("gif_starred_title")),i.createElement("div",{className:"gif-search-row"},o,i.createElement("div",{className:"starred-gifs-body"},y),u))}});e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(236),s=i(a),r=n(237),o=i(r),l=n(1371),c=i(l),u=n(8),d=n(1383),p=n(233),h=n(10),f=n(1642),m=u.createClass({displayName:"AddContactToGroupFlow",mixins:[d],propTypes:{contact:u.PropTypes.instanceOf(o["default"]).isRequired},getDefaultTransition:function(){var e;return e={},(0,s["default"])(e,d.Dir.PUSH,d.Transition.NONE),(0,s["default"])(e,d.Dir.POP,d.Transition.NONE),e},filter:function(e){var t=e.groupMetadata;return!e.isGroup||e.isGroup&&!t.participants.iAmMember()?!1:t.participants.get(this.props.contact.id)?l10n.t("already_added_to_group"):t.participants.iAmAdmin()?!0:l10n.t("chat_not_an_admin")},componentWillMount:function(){this.push(u.createElement(f,{chats:Store.Chat.filter(function(e){return e.isGroup}),filter:this.filter,onCancel:this.pop,onGroup:this.confirmAddToGroup}))},confirmAddToGroup:function(e){this.push(u.createElement(p,{onOK:this.addToGroup.bind(null,e),okText:l10n.t("add_group_participant"),onCancel:this.pop,cancelText:l10n.t("web_cancel")},u.createElement(c["default"],{text:l10n.t("confirm_add_group_participant",{participant:this.props.contact.formattedName,subject:e.contact.name})})))},addToGroup:function(e){e.groupMetadata.participants.addParticipant(this.props.contact).then(function(){h.openChatFromUnread(e).then(function(t){t&&h.focusChatTextInput(e)})})["catch"](_.noop),this.endFlow()}});e.exports=m},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(236),s=i(a),r=n(1370),o=i(r),l=n(1371),c=i(l),u=n(8),d=n(1383),p=n(233),h=n(1446),f=n(10),m=u.createClass({displayName:"AddGroupParticipantFlow",mixins:[d],propTypes:{chat:u.PropTypes.instanceOf(o["default"]).isRequired},getDefaultTransition:function(){var e;return e={},(0,s["default"])(e,d.Dir.PUSH,d.Transition.NONE),(0,s["default"])(e,d.Dir.POP,d.Transition.NONE),e},componentWillMount:function(){this.push(u.createElement(h,{title:l10n.t("add_group_participant"),filter:this.contactFilter,onCancel:this._pop,onSelect:this.confirmAddParticipant}))},contactFilter:function(e){var t=this.props.chat.groupMetadata;return Store.Contact.isFilteredContact(e)?t.participants.get(e.id)?l10n.t("already_added_to_group"):!0:!1},confirmAddParticipant:function(e){var t=this.onAddParticipant.bind(this,e),n=l10n.t("confirm_add_group_participant",{participant:e.formattedName,subject:this.props.chat.contact.name});this.push(u.createElement(p,{onOK:t,okText:l10n.t("add_group_participant"),onCancel:this._pop,cancelText:l10n.t("web_cancel")},u.createElement(c["default"],{text:n})))},_pop:function(){this.pop()},onAddParticipant:function(e){this.props.chat.groupMetadata.participants.addParticipant(e)["catch"](_.noop),f.closeModal()}});e.exports=m},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1370),s=i(a),r=n(8),o=n(1383),l=n(156),c=n(1625),u=n(10),d=n(54),p=n(1665),h=r.createClass({displayName:"AttachMediaFlow",mixins:[o,l],propTypes:{files:r.PropTypes.array,chat:r.PropTypes.instanceOf(s["default"]).isRequired},getInitialState:function(){this.mediaCollection=new p},componentWillMount:function(){u.closeContextMenu(),u.closeTooltip(),this.push(r.createElement(c,{chat:this.props.chat,files:this.props.files,onBack:this.endFlow,onSendMedia:_.once(this.sendMedia),onDropText:_.once(this.setText),mediaCollection:this.mediaCollection}))},componentDidMount:function(){var e=this;this.uiIdle(function(){e.initializeFiles()})},componentWillUnmount:function(){var e=this;d.isGecko?_.defer(function(){return u.focusChatTextInput(e.props.chat)}):u.focusChatTextInput(this.props.chat),this.mediaCollection&&this.mediaCollection["delete"]()},initializeFiles:function(){var e=this.props.files;e&&this.mediaCollection.processFiles(e,this.props.chat)},sendMedia:function(e){var t=this.props.chat;_.delay(function(){e.forEach(function(e,n){var i={};0===n&&(i.quotedMsg=t.composeQuotedMsg,t.composeQuotedMsg=null),i.caption=e.caption,e.mediaPrep.sendToChat(t,i)})},300),this.endFlow()},setText:function(e){var t=this.props.chat;_.delay(function(){u.pasteChatTextInput(t,e)},300),this.endFlow()}});e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1370),s=i(a),r=n(1390),o=i(r),l=n(468),c=n(8),u=n(1383),d=n(1416),p=n(1482),h=c.createClass({displayName:"CaptureFlow",mixins:[u],propTypes:{chat:c.PropTypes.instanceOf(s["default"]).isRequired,stream:c.PropTypes.object.isRequired},componentWillMount:function(){this.push(c.createElement(p,{onBack:this.endFlow,caption:!0,layoutType:o["default"].TYPES.CONTAIN,onSend:this.sendMedia,stream:this.props.stream}))},componentWillUnmount:function(){this.props.stream&&d.stop(this.props.stream)},sendMedia:function(e){var t=e.file,n=e.caption,i=this.props.chat,a=i.composeQuotedMsg;i.composeQuotedMsg=null,(0,l.prepRawMedia)(t,{}).sendToChat(i,{caption:n||void 0,quotedMsg:a||void 0}),this.endFlow()}});e.exports=h},function(e,t,n){"use strict";var i=n(8),a=n(1383),s=n(1416),r=n(1390),o=n(1482),l=n(1485),c=i.createClass({displayName:"EditCaptureFlow",mixins:[a],propTypes:{stream:i.PropTypes.object.isRequired,onFinished:i.PropTypes.func.isRequired},pushCaptureDrawer:function(){this.push(i.createElement(o,{onBack:this.cleanUp,onCaptured:this.onCaptured,onSend:_.noop,layoutType:r.TYPES.COVER,stream:this.props.stream}))},componentWillMount:function(){this.pushCaptureDrawer()},componentWillUnmount:function(){this.closeStream()},closeStream:function(){this.props.stream&&s.stop(this.props.stream)},onFinished:function(e,t){this.props.onFinished(e,t),this.cleanUp()},cleanUp:function(){this.closeStream(),this.endFlow()},onCaptured:function(e){this.push(i.createElement(l,{onCancel:this.cleanUp,onRetake:this.pop,retryText:l.RetryOptions.RETAKE,onFinished:this.onFinished,img:e}))}});e.exports=c},function(e,t,n){"use strict";var i=n(8),a=n(1383),s=n(1485),r=i.createClass({displayName:"EditImageFlow",mixins:[a],propTypes:{img:i.PropTypes.oneOfType([i.PropTypes.instanceOf(File),i.PropTypes.instanceOf(Blob)]),onFinished:i.PropTypes.func.isRequired,onRetake:i.PropTypes.func.isRequired},componentWillMount:function(){this.push(i.createElement(s,{onCancel:this.pop,onFinished:this.onFinished,onRetake:this.props.onRetake,retryText:s.RetryOptions.RESTART,img:this.props.img}))},onFinished:function(e,t){this.props.onFinished(e,t),this.endFlow()}});e.exports=r},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(236),s=i(a),r=n(1370),o=i(r),l=n(8),c=n(1640),u=n(1383),d=l.createClass({displayName:"GroupInviteRevokeFlow",mixins:[u],propTypes:{chat:l.PropTypes.instanceOf(o["default"]).isRequired,onConfirm:l.PropTypes.func.isRequired},getDefaultTransition:function(){var e;return e={},(0,s["default"])(e,u.Dir.PUSH,u.Transition.NONE),(0,s["default"])(e,u.Dir.POP,u.Transition.NONE),e},componentWillMount:function(){this.push(l.createElement(c,{chat:this.props.chat,onConfirm:this.props.onConfirm}))}});e.exports=d},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(460),s=i(a),r=n(458),o=i(r),l=n(8),c=n(45),u=n(9),d=n(10),p=n(158),h=n(1376),f=n(156),m=n(1646),g=n(1461),v=n(235),y=n(157),E=n(1),S=n(41),M=n(61),C=n(13),b=n(44),T=n(110),P=l.createClass({displayName:"MediaViewerFlow",mixins:[p,h,f],propTypes:{msg:l.PropTypes.instanceOf(o["default"]).isRequired,getZoomNode:l.PropTypes.func,startTime:l.PropTypes.number},getInitialState:function(){this.zoomIn=!0;var e=this.props.msg;return this.mediaMsgs=e.chat.constructMediaMsgs(e),this.handleScroll=_.throttle(this._handleScroll,100),e.type===o["default"].TYPE.IMAGE&&(this.uiActionEvent=new S.UiAction({uiActionType:S.UI_ACTION_TYPE.IMAGE_OPEN,uiActionPreloaded:e.mediaData.mediaStage===v.STAGE.RESOLVED})),{activeMsg:e,imgZoomed:!1}},componentWillMount:function(){this.regNativeListener(window,"keydown",this.onKeyDown)},componentDidMount:function(){var e=this;this.zoomIn=!1,M.supportsFeature(M.F.MEDIA_GALLERY)&&this.uiIdle(function(){e.mediaMsgs.loadMoreAroundIfNeeded(e.state.activeMsg)}),this.addObserver(this.mediaMsgs,"remove reset",function(t,n,i){if(e.mediaMsgs.indexOf(t)>-1||e.state.activeMsg!==t)return void e.forceUpdate();var a=i.index;0===e.mediaMsgs.length?e.endFlow():e.mediaMsgs.length===a?e.onSelectThumb(e.mediaMsgs.at(a-1)):e.onSelectThumb(e.mediaMsgs.at(a))}),this.addObserver(this.mediaMsgs,"query_media_after"),this.addObserver(this.mediaMsgs,"query_media_before",function(){var t=c.findDOMNode(e.refs.thumbs);t&&(e.prevScrollWidth=t.scrollWidth,e.forceUpdate())}),this.scrollToActive(),(0,s["default"])(this.refs.thumbsContainer,{opacity:[1,0],translateY:["0%","100%"]},{duration:300,delay:100,easing:[.1,.82,.25,1]})},componentWillUnmount:function(){this.handleScroll.cancel()},componentDidUpdate:function(e,t){if(t.activeMsg!==this.state.activeMsg)this.scrollToActive(!0);else{var n=c.findDOMNode(this.refs.thumbs);if(!n||!this.prevScrollWidth)return;n.scrollLeft+=n.scrollWidth-this.prevScrollWidth,this.prevScrollWidth=null}},onKeyDown:function(e){37===e.keyCode?this.onPrev():39===e.keyCode&&this.onNext()},onImageLoad:function(){this.uiActionEvent&&(this.uiActionEvent.markUiActionT(),this.uiActionEvent.commit(),delete this.uiActionEvent)},onScroll:function(e){this.handleScroll(e.target)},_handleScroll:function(e){var t=this;0!==this.mediaMsgs.length&&(this.mediaMsgs.hasMediaBefore&&e.scrollLeft<e.clientWidth&&!function(){var e=t.mediaMsgs.head();t.uiIdle(function(){t.mediaMsgs.queryMedia(e.chat,e),t.forceUpdate()})}(),this.mediaMsgs.hasMediaAfter&&e.scrollLeft+u.SCROLL_FUDGE>e.scrollWidth-2*e.clientWidth&&!function(){var e=t.mediaMsgs.last();t.uiIdle(function(){t.mediaMsgs.queryMedia(e.chat,e,"after"),t.forceUpdate()})}())},onNext:function(e){var t=this;if(e&&e.stopPropagation(),!this.state.imgZoomed){var n=this.state.activeMsg,i=this.mediaMsgs.getAfter(n);return i?void this.onSelectThumb(i):void(M.supportsFeature(M.F.MEDIA_GALLERY)&&this.mediaMsgs.hasMediaAfter&&(this._queryMediaAfter||(this._queryMediaAfter=this.mediaMsgs.queryMedia(n.chat,n,"after").checkpoint(this.rejectOnUnmount()).then(function(e){e.length>0&&t.state.activeMsg===n&&t.onNext()})["catch"](C.Unmount,_.noop)["catch"](function(e){E.error("query media msgs error: ",e)})["finally"](function(){t._queryMediaAfter=null}))))}},onPrev:function(e){var t=this;if(e&&e.stopPropagation(),!this.state.imgZoomed){var n=this.state.activeMsg,i=this.mediaMsgs.getBefore(n);return i?void this.onSelectThumb(i):void(M.supportsFeature(M.F.MEDIA_GALLERY)&&this.mediaMsgs.hasMediaBefore&&(this._queryMediaBefore||(this._queryMediaBefore=this.mediaMsgs.queryMedia(n.chat,n,"before").checkpoint(this.rejectOnUnmount()).then(function(e){e.length>0&&t.state.activeMsg===n&&t.onPrev()})["catch"](C.Unmount,_.noop)["catch"](function(e){E.error("query media msgs error: ",e)})["finally"](function(){t._queryMediaBefore=null}))))}},onImgZoomIn:function(e){this.setState({imgZoomed:e})},endFlow:function(){d.closeModalMedia()},willEndFlow:function(){(0,s["default"])(this.refs.thumbsContainer,{opacity:[0,1],translateY:["100%","0%"]},{duration:300,easing:[.1,.82,.25,1]})},onSelectThumb:function(e,t){var n=this;M.supportsFeature(M.F.MEDIA_GALLERY)&&this.uiIdle(function(){n.mediaMsgs.loadMoreAroundIfNeeded(e)}),this.setState({activeMsg:e})},scrollToActive:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!1,t=this.refs.thumbsContainer,n=c.findDOMNode(this.refs.thumbs),i=c.findDOMNode(this.refs.activeThumb);if(t&&n&&i){var a=i.clientWidth/2-t.clientWidth/2;(0,s["default"])(n,"stop");var r=0;e&&(r=300),(0,s["default"])(i,"scroll",{duration:r,container:n,offset:a,axis:"x",easing:[.1,.82,.25,1]})}},getThumbs:function(){var e=this,t=this.mediaMsgs.map(function(t){var n=b("media-thumb",{active:t===e.state.activeMsg});return l.createElement(g,{classes:n,msg:t,ref:t===e.state.activeMsg?"activeThumb":null,key:"media-"+t.id.id,onClick:e.onSelectThumb.bind(e,t)})});return t.push(l.createElement("div",{className:"media-thumb-spinner media-thumb",key:"spinner-right"},this.mediaMsgs.queryMediaAfter?l.createElement(y,{stroke:6,size:24}):null)),t.unshift(l.createElement("div",{className:"media-thumb-spinner media-thumb",key:"spinner-left"},this.mediaMsgs.queryMediaBefore?l.createElement(y,{stroke:6,size:24}):null)),t.push(l.createElement("div",{className:"media-thumb-padding",key:"padding-right"})),t.unshift(l.createElement("div",{className:"media-thumb-padding",key:"padding-left"})),t},render:function(){var e=this.mediaMsgs.last(),t=this.mediaMsgs.hasMediaAfter||this.state.activeMsg!==e?this.onNext:null,n=this.mediaMsgs.head(),i=this.mediaMsgs.hasMediaBefore||this.state.activeMsg!==n?this.onPrev:null,a=this.getThumbs(),s=M.supportsFeature(M.F.MEDIA_GALLERY)?this.onScroll:null;return l.createElement("div",{className:this.state.imgZoomed?"img-zoomed-in":null},l.createElement("div",{className:"media-collection media-viewer-thumbs-container",ref:"thumbsContainer"},l.createElement("div",{onScroll:s,style:{width:"100%"},dir:"ltr"},l.createElement(T,{className:"media-viewer-thumbs",ref:"thumbs",transitionName:"thumb-scale"},a))),l.createElement(m,{msg:this.state.activeMsg,onBack:this.endFlow,onExitAnimation:this.willEndFlow,onNext:t,onPrev:i,onImgZoomIn:this.onImgZoomIn,getZoomNode:this.props.getZoomNode,startTime:this.props.startTime,zoomIn:this.zoomIn,onImageLoad:this.uiActionEvent?this.onImageLoad:null}))}});e.exports=P},function(e,t,n){"use strict";var i=n(8),a=n(1383),s=n(1629),r=n(10),o=i.createClass({displayName:"NewChatFlow",mixins:[a],componentWillMount:function(){this.push(i.createElement(s,{title:l10n.t("new_chat_flow_title"),onBack:this.endFlow,onClick:this.onClick}))},onClick:function(e,t){Store.Chat.find(t.id).then(r.openChatFromUnread.bind(r)),this.endFlow()}});e.exports=o},function(e,t,n){"use strict";var i=n(8),a=n(1383),s=n(1649),r=n(1650),o=i.createClass({displayName:"NewGroupFlow",mixins:[a],componentWillMount:function(){this.push(i.createElement(s,{onBack:this.endFlow,onContinue:this.groupParticipants}))},groupParticipants:function(e,t,n){this.push(i.createElement(r,{subject:e,thumb:t,full:n,onBack:this.participantsBack,onContinue:_.once(this.createGroup)}))},createGroup:function(e,t,n,i){Store.Chat.createGroup(e,t,n,i),this.endFlow()},participantsBack:function(e,t,n){this.pop()}});e.exports=o},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(236),o=i(r),l=n(1370),c=i(l),u=n(1511),d=i(u),p=n(8),h=n(1383),f=n(10),m=n(9),g=n(1445),v=n(464),y=p.createClass({displayName:"SendGroupInviteFlow",mixins:[h],propTypes:{chat:p.PropTypes.instanceOf(c["default"]).isRequired},getDefaultTransition:function(){var e;return e={},(0,o["default"])(e,h.Dir.PUSH,h.Transition.NONE),(0,o["default"])(e,h.Dir.POP,h.Transition.NONE),e},componentWillMount:function(){var e=this;this.push(p.createElement(g,{onChat:this.onForwardConfirmed,title:l10n.t("group_invite_send_link_title")}));var t=this.props.chat;this.linkPreview={canonicalUrl:m.GROUP_INVITE_LINK_URL,description:l10n.t("whatsapp_group_invite"),matchedText:t.groupMetadata.groupInviteLink,title:t.title()};var n=t.contact.profilePicThumb;n&&n.imgFull?v.generateLinkPreview(n.imgFull).then(function(t){e.linkPreview.thumbnail=t}):(0,d["default"])(t.groupMetadata.groupInviteLink).then(function(t){var n=(t.url,t.data);(n.title||n.description)&&(e.linkPreview.thumbnail=n.thumbnail)})["catch"](_.noop)},onForwardConfirmed:function(e){var t=this;s["default"].map(e,function(e){var n=void 0;n=e.isUser&&e.contact.isBlocked()?e.contact.setBlock(!1):s["default"].resolve(!0),n.then(function(n){e.sendMessage(t.props.chat.groupMetadata.groupInviteLink,t.linkPreview)})}),this.endFlow(),f.openChatFromUnread(_.head(e))}});e.exports=y},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(8),o=n(1383),l=n(10),c=n(1445),u=n(18),d=r.createClass({displayName:"SendMsgMultiFlow",mixins:[o],propTypes:{msgText:r.PropTypes.string.isRequired},componentWillMount:function(){this.push(r.createElement(c,{onChat:this.onForwardConfirmed,title:l10n.t("msg_send_title")}))},onForwardConfirmed:function(e){var t=this.props.msgText;1===e.length?!function(){var n=void 0,i=u.head(e);n=i.isUser&&i.contact.isBlocked()?i.contact.setBlock(!1):s["default"].resolve(!0),n.then(function(e){return t&&i.setComposeContents({text:t}),l.openChatFromUnread(i).then(function(e){e&&l.focusChatTextInput(i)})})}():(s["default"].map(e,function(e){var n=void 0;n=e.isUser&&e.contact.isBlocked()?e.contact.setBlock(!1):s["default"].resolve(!0),n.then(function(n){e.sendMessage(t)})}),l.openChatFromUnread(u.head(e))),this.endFlow()}});e.exports=d},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1653),s=i(a),r=n(8),o=n(1383),l=n(1626),c=n(1488),u=n(1651),d=n(1643),p=n(1664),h=n(33),f=r.createClass({displayName:"SettingsFlow",mixins:[o],componentWillMount:function(){this.push(r.createElement(s["default"],{profileId:Store.Conn.me,onWallpaper:this.showWallpaperDrawer,onBlocked:this.showBlockedDrawer,onProfile:this.showProfileDrawer,onNotifications:this.showNotifications,onHelp:this.showHelp,onClose:this._pop}))},showWallpaperDrawer:function(){this.push(r.createElement(p,{onClose:this._pop}))},showBlockedDrawer:function(){this.push(r.createElement(l,{onClose:this._pop}))},showProfileDrawer:function(){this.push(r.createElement(c,{id:Store.Conn.me,onClose:this._pop}))},showNotifications:function(){this.push(r.createElement(u,{onClose:this._pop}))},showHelp:function(){h.upload("help-page-opened"),this.push(r.createElement(d,{onClose:this._pop}))},_pop:function(){this.pop()}});e.exports=f},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(8),m=i(f),g=n(1622),v=i(g),y=n(1656),_=i(y),E=n(1659),S=i(E),M=n(458),C=(i(M),n(1391)),b=(i(C),function(e){function t(){var e,n,i,a;(0,o["default"])(this,t);for(var r=arguments.length,l=Array(r),c=0;r>c;c++)l[c]=arguments[c];return n=i=(0,d["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(l))),i.openStatusViewer=function(e,t){i.push(m["default"].createElement(S["default"],{initialStatusV3:e,initialStatusMsg:t,closeStatusViewer:i.closeStatusViewer}),"status-v3-viewer")},i.closeStatusViewer=function(e){e?i.end():i.pop("status-v3-viewer")},a=n,(0,d["default"])(i,a)}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentWillMount",value:function(){this.push(m["default"].createElement(_["default"],{onOpenStatus:this.openStatusViewer,closeStatusViewer:this.closeStatusViewer}),"status-v3-modal")}}]),t}(v["default"]));e.exports=b},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(8),m=i(f),g=n(1),v=i(g),y=n(18),_=i(y),E=n(110),S=i(E),M=n(44),C=i(M),b=n(92),T=i(b),P=n(234),k=i(P),N=function(e){function t(){var e,n,i,a;(0,o["default"])(this,t);for(var r=arguments.length,l=Array(r),c=0;r>c;c++)l[c]=arguments[c];return n=i=(0,d["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(l))),i.state={_stack:[],_transition:"default",_activeKey:0},a=n,(0,d["default"])(i,a)}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"push",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";this.setState({_stack:this.state._stack.concat(e),_transition:t,_activeKey:++this.state._activeKey})}},{key:"pop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default",t=_["default"].dropRight(this.state._stack);t.length?this.setState({_stack:t,_transition:e,_activeKey:--this.state._activeKey}):this.end()}},{key:"end",value:function(e){this.context.uim.uie.requestDismiss(e)}},{key:"render",value:function(){var e=this,t=this.state,n=t._stack,i=t._transition,a=t._activeKey,s=_["default"].last(n);v["default"].assert(!!s,"empty-flow",s)(),s=m["default"].createElement(k["default"],{displayName:"FlowDrawer"+a,key:a,escapable:!0,requestDismiss:function(){return e.pop()}},s);var r=(0,C["default"])("flow-drawer-container");return m["default"].createElement(S["default"],{transitionName:i,className:r},this.props.removeTopDrawer?s:n)}}]),t}(f.Component);N.contextTypes={uim:m["default"].PropTypes.instanceOf(T["default"])},N.defaultProps={removeTopDrawer:!0},t["default"]=N},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(460),s=i(a),r=n(8),o=n(463),l=n(44),c=n(9),u=n(54),d=r.createClass({displayName:"IntroPanel",propTypes:{animate:r.PropTypes.bool,className:r.PropTypes.string},componentDidMount:function(){var e=this.refs.image,t=this.refs.text;this.props.animate?((0,s["default"])(e,{scale:[1,0],opacity:[1,0]},{delay:1340,duration:180,easing:[.05,1.02,0,1.01]}),(0,s["default"])(t,{translateY:[0,80],opacity:[1,0]},{delay:1300,duration:140,easing:[.05,1.02,0,1.01]})):(e.style.opacity=1,t.style.opacity=1)},render:function(){return r.createElement("div",{className:l("intro",this.props.className)},r.createElement("div",{className:"intro-body"},r.createElement("div",{ref:"image",className:"intro-image"}),r.createElement("div",{ref:"text",className:"intro-text-container"},r.createElement("h1",{"data-a8n":o.key("intro-title"),className:"intro-title"},l10n.t("intro_title")),r.createElement("div",{"data-a8n":o.key("intro-text"),className:"intro-text"},l10n.t("intro_connection")),r.createElement(p,null))))}}),p=r.createClass({displayName:"NativePromo",render:function(){var e=void 0;switch(u.os){case c.OS_TYPE.MAC:e=l10n.t("intro_native_mac");break;case c.OS_TYPE.WINDOWS:e=l10n.t("intro_native_windows")}if(e){var t='<a href="https://www.whatsapp.com/download" target="_blank">'+l10n.t("intro_native_link")+"</a>";return e=e.replace("__get_it_here__",t),r.createElement(h,null,r.createElement("span",{className:"icon icon-laptop intro-secondary-icon"}),r.createElement("span",{ref:"promoText",dangerouslySetInnerHTML:{__html:e}}))}return null}}),h=r.createClass({displayName:"IntroSecondary",propTypes:{children:r.PropTypes.node.isRequired},render:function(){return r.createElement("div",{className:"intro-secondary"},r.createElement("div",{className:"intro-divider"}),r.createElement("div",{className:"intro-secondary-text"},this.props.children))}});e.exports=d},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1389),s=i(a),r=n(1408),o=i(r),l=n(111),c=i(l),u=n(8),d=n(45),p=n(10),h=n(1373),f=n(1375),m=n(1374),g=n(1388),v=n(156),y=n(1386),_=n(91),E=n(92),S=u.createClass({displayName:"ArchivedDrawer",mixins:[v],getInitialState:function(){this.selection=new y([],function(e){return e.id})},componentDidMount:function(){this.addObserver(Store.Chat,"change:archive add remove"),this.refs.list&&_.focus(d.findDOMNode(this.refs.list))},onClick:function(e,t){p.openChatFromUnread(t).then(function(e){e&&p.focusChatTextInput(t)}),this.onClose()},onClose:function(){this.context.uim.uie.requestDismiss()},getList:function(){return Store.Chat.filter("archive")},onNextChat:function(e){e.preventDefault(),e.stopPropagation(),this.selection.setNext()},onPrevChat:function(e){e.preventDefault(),e.stopPropagation(),this.selection.setPrev()},render:function(){var e=this,t=void 0,n=this.getList();if(this.selection.init(n,!0),n.length>0){var i=n.map(function(t){return u.createElement(o["default"],{chat:t,mode:r.Mode.LAST,key:t.id,active:e.selection,onClick:e.onClick})}),a={down:this.onNextChat,up:this.onPrevChat};t=u.createElement(c["default"],{handlers:a,ref:"list",className:"drawer-section-main chatlist","data-list-scroll-container":!0},u.createElement(s["default"],{data:i,height:s["default"].DEFAULT_HEIGHT,extraItems:4}))}else t=u.createElement(g.Archived,null);return u.createElement(h,{id:"blocked",onCancel:this.onClose},u.createElement(f,{title:l10n.t("archived_flow_title"),onBack:this.onClose,type:f.Type.LARGE}),u.createElement(m,null,t))}});S.contextTypes={uim:u.PropTypes.instanceOf(E)},e.exports=S},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(458),s=i(a),r=n(111),o=i(r),l=n(1370),c=i(l),u=n(8),d=n(45),p=n(13),h=n(1492),f=n(158),m=n(160),g=n(1376),v=n(156),y=n(9),E=n(10),S=n(1507),M=n(44),C=n(1405),b=n(1429),T=n(1373),P=n(1375),k=n(1374),N=n(1432),w=n(1519),x=n(1517),O=n(1520),D=n(1518),R=n(91),I=n(62),A=n(157),L=n(461),F=n(110),U=n(462),j=s["default"].TYPE,G=j.IMAGE,B=j.VIDEO,H=j.DOCUMENT,V=j.AUDIO,q=n(116),W=_.pickBy(q.MIMETYPES,function(e){
return e.msgType===H}),z=function(e){return 150+15*e},Y=400,K=h.STATE.PROCESSING,Q=u.createClass({displayName:"AttachMediaDrawer",mixins:[f,m,g,v],propTypes:{chat:u.PropTypes.instanceOf(c["default"]),files:u.PropTypes.array,mediaCollection:u.PropTypes.object.isRequired,onBack:u.PropTypes.func.isRequired,onSendMedia:u.PropTypes.func.isRequired,onDropText:u.PropTypes.func.isRequired},getDefaultProps:function(){return{isDragging:!1}},getInitialState:function(){return this.transition="media-scale",{activeMedia:null}},componentWillMount:function(){this.regNativeListener(window,"drop",this.onWindowDrop)},componentDidMount:function(){this.addObserver(this.props.mediaCollection,"add remove reset"),this.addObserver(this.props.mediaCollection,"change:state",this.onProcessComplete),this.addObserver(this.props.mediaCollection,"max_upload_limit",this.showIgnoredToast)},componentWillUpdate:function(e,t){var n=t.activeMedia,i=this.state.activeMedia;return i&&n&&i!==n?void(this.props.mediaCollection.indexOf(n)>this.props.mediaCollection.indexOf(i)?this.transition="media-slide-forward":this.transition="media-slide-back"):void(this.transition="media-scale")},componentDidUpdate:function(e,t){!t.activeMedia&&this.state.activeMedia&&this.refs.emojiInput?this.refs.emojiInput.restoreFocus():!d.findDOMNode(this).contains(document.activeElement)&&this.refs.sendButton&&R.focus(this.refs.sendButton)},onProcessComplete:function(){if(!this.props.mediaCollection.some({state:K})){var e=this.props.mediaCollection.getValidMedias(),t=this.props.mediaCollection.uiProcessMsgs(),n=t.activeMedia,i=t.errorMsgs;i&&e.length>0&&E.openToast(u.createElement(L,{msg:i,id:L.genId()})),n?this.setState({activeMedia:n}):this.forceUpdate()}},showIgnoredToast:function(e){if(e>0){var t=l10n.t("too_many_files_uploaded",{number:e,_plural:e,max:y.MAX_FILES});E.openToast(u.createElement(L,{msg:t,id:L.genId()}))}},onDragStart:function(e){this.blockDrop=!0},onDragEnd:function(e){this.blockDrop=!1},onDragOver:function(e){this.state.isDragging||this.blockDrop||this.setState({isDragging:!0})},onWindowDrop:function(e){_.isEmpty(this.props.files)&&_.isEmpty(this.props.mediaCollection)&&this.props.onBack()},onDrop:function(e){this.blockDrop||(this.setState({isDragging:!1}),this.onFilePick(e))},onDragLeave:function(e){this.props.mediaCollection.length||this.props.onBack(),this.setState({isDragging:!1})},onKeyDown:function(e){if(this.state.activeMedia&&!e.repeat)if(37===e.keyCode){var t=this.state.activeMedia,n=this.refs.emojiInput&&this.refs.emojiInput.refs.inputLine;(t&&!t.caption||n&&(n.isAtBeginning()||null===n.getCursor()))&&this.onPrev()}else if(39===e.keyCode){var i=this.state.activeMedia,a=this.refs.emojiInput&&this.refs.emojiInput.refs.inputLine;(i&&!i.caption||a&&(a.isAtEnd()||null===a.getCursor()))&&this.onNext()}else 13===e.keyCode&&this.onSend()},onNext:function(){var e=this.props.mediaCollection.getAfter(this.state.activeMedia);e&&(this.refs.sendButton&&R.focus(this.refs.sendButton),this.setState({activeMedia:e}))},onPrev:function(){var e=this.props.mediaCollection.getBefore(this.state.activeMedia);e&&(this.refs.sendButton&&R.focus(this.refs.sendButton),this.setState({activeMedia:e}))},onSelectThumb:function(e,t){e!==this.state.activeMedia&&this.setState({activeMedia:e})},onSend:function(e){e&&e.preventDefault(),e&&e.shiftKey||this.props.onSendMedia(_.map(this.props.mediaCollection.getValidMedias(),function(e){var t=e.caption;return t&&(t=_.trim(e.caption)),t&&(t=U.emojify(t)),e.caption=t||void 0,e}))},onAddFileClick:function(e){var t=this.refs.input;t.click()},onFilePick:function(e){var t=this;S.getFiles(e).then(function(e){return t.props.mediaCollection.processFiles(e,t.props.chat)}).checkpoint(this.rejectOnUnmount())["catch"](p.Unmount,_.noop)["catch"](p.MediaDragDropError,function(e){if(t.props.mediaCollection.length)throw e;t.props.onDropText(e.src)}),e.target.value=""},onRemoveThumb:function(e,t){t.stopPropagation(),t.preventDefault();var n=this.props.mediaCollection.getBefore(e)||this.props.mediaCollection.getAfter(e);this.props.mediaCollection.remove(e),this.setState({activeMedia:n})},onCaptionChange:function(e){var t=this.state.activeMedia;t.caption=e.target.value,this.setState({media:t})},onPaste:function(e){e.preventDefault(),e.stopPropagation();var t=new b(e.clipboardData);t.hasFiles()&&this.onFiles(t)},onFiles:function(e){var t=_.filter(e.getFiles(),function(e){var t=I.typeFromMimetype(e.type);return"image"===t||"video"===t});this.props.mediaCollection.processFiles(t,this.props.chat)},getMedia:function(){var e=void 0,t=void 0,n=this.state.activeMedia;switch(n.media.type){case G:case B:var i=void 0;n.media.fullWidth&&n.media.fullHeight&&(i={width:n.media.fullWidth,height:n.media.fullHeight}),e=u.createElement(w,{mimeType:n.media.mimetype,url:n.url,isGif:!!n.media.isGif,size:i}),t=u.createElement("div",{className:"media-caption"},u.createElement(C,{ref:"emojiInput",editable:!0,value:n.caption,placeholder:l10n.t("add_a_caption"),maxLength:y.MAX_CAPTION_LENGTH,showRemaining:!0,onEnter:this.onSend,onChange:this.onCaptionChange,onFiles:this.onFiles,supportsEmoji:!0}));break;case V:e=u.createElement(x,{mimeType:n.media.mimetype,url:n.url});break;case H:switch(q.previewType(n.media.mimetype)){case"pdf":e=u.createElement(O,{preview:n.generatedPreview,mimeType:n.media.mimetype,filename:n.media.filename});break;case"msoffice":e=u.createElement(D,{preview:n.generatedPreview,mimeType:n.media.mimetype,filename:n.media.filename});break;default:e=u.createElement(N,{mimeType:n.media.mimetype,filename:n.media.filename})}}return u.createElement("div",{className:"media-body-container",key:n.id},e,t)},getThumbs:function(e){var t=this;return e.map(function(e,n){var i=M("media-thumb","stagger-delay",{active:e===t.state.activeMedia}),a=t.props.mediaCollection.indexOf(t.state.activeMedia),s=Math.max(t.props.mediaCollection.length-a-1,1),r=z(n)/s*Math.max(0,n-a)+"ms";return u.createElement(X,{className:i,key:"media-"+e.id,media:e,onClick:t.onSelectThumb.bind(null,e),onClose:t.onRemoveThumb.bind(null,e),staggerDelay:r})})},render:function(){var e=void 0,t=void 0,n=void 0,i=0,a=this.props.mediaCollection.getValidMedias();a.length>y.MAX_FILES&&(a=a.slice(0,y.MAX_FILES)),this.props.mediaCollection.some({state:K})?e=u.createElement(A,{key:"processing"}):this.state.activeMedia?e=this.getMedia():0===a.length&&this.props.mediaCollection.errorMsgs&&(e=u.createElement("div",{className:"invalid-media-container",key:"pending"},u.createElement("div",{className:"invalid-media"},this.props.mediaCollection.errorMsgs))),a.length>0&&(t=this.getThumbs(a),i=1===a.length?Y:Y+z(a.length),n=u.createElement("div",{className:"drawer-controls",tabIndex:"-1",ref:"sendButton",onKeyPress:function(e){return e.preventDefault()}},u.createElement("button",{className:"btn btn-round btn-l",onClick:this.onSend},u.createElement("span",{className:"icon icon-send-light"}))));var s=this.state.isDragging?u.createElement("div",{key:"container",className:"drag-drop"},u.createElement("div",{className:"stitching"},l10n.t("drag_media_here"))):null,r=a.length<y.MAX_FILES?u.createElement("div",{key:"media-more",className:"media-thumb btn-add-media",onClick:this.onAddFileClick},u.createElement("button",{className:"btn-fill"},u.createElement("span",{className:"icon icon-add-alt"}),l10n.t("add_media"))):null,l={enter:this.onKeyDown,left:this.onKeyDown,right:this.onKeyDown};return u.createElement(o["default"],{handlers:l},u.createElement(T,{key:"attach-image-modal",ref:"container",position:"right",id:"media",variant:"noheader",onDrop:this.onDrop,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave},u.createElement(P,{title:l10n.t("web_preview_msg"),type:P.Type.OFFSET,onCancel:this.props.onBack}),u.createElement(k,{tabIndex:"-1",onDragStart:this.onDragStart,onPaste:this.onPaste,onDragEnd:this.onDragEnd},s,u.createElement("div",{className:"media-body"},u.createElement(F,{transitionName:this.transition},e)),u.createElement(F,{transitionName:"thumb-scale",className:"media-collection"},t,r),u.createElement(F,{transitionName:"btn",delay:i},n),u.createElement("input",{ref:"input",type:"file",accept:y.IMAGE_MIMES+","+y.VIDEO_MIMES,style:{display:"none"},onChange:this.onFilePick,multiple:!0}))))}}),X=u.createClass({displayName:"AttachMediaThumb",propTypes:{media:u.PropTypes.instanceOf(h).isRequired,className:u.PropTypes.string,onClick:u.PropTypes.func,onClose:u.PropTypes.func},render:function(){var e=this.props,t=e.media,i=e.className,a=e.onClick,s=e.onClose,r=void 0,o=void 0,l=void 0;switch(t.media.type){case G:l={backgroundImage:"url("+t.url+")"},r=u.createElement("div",{className:"media-thumb-body",style:l});break;case B:l={backgroundImage:"url(data:image/jpeg;base64,"+t.preview+")"},r=u.createElement("div",{className:"media-thumb-body",style:l});break;case V:r=u.createElement("div",{className:"attach-media-audio-thumb"});break;case H:var c=n(1);if(c.log("media is",t)(),t.media.documentPreview&&t.media.documentPreview.thumbUrl){var d={backgroundImage:"url("+t.media.documentPreview.thumbUrl+")"};W[t.media.mimetype]&&(o=W[t.media.mimetype].icon),o=M(o,"icon-doc","icon-doc-thumb-filetype"),r=u.createElement("div",{className:"media-thumb-body",style:d},u.createElement("div",{className:o}));break}W[t.media.mimetype]&&(o=W[t.media.mimetype].icon);default:o=M(o,"icon-doc"),r=u.createElement("div",{className:"media-thumb-body"},u.createElement("div",{className:o}))}return u.createElement("div",{className:i,onClick:a},u.createElement("span",{className:"btn-delete icon icon-x-alt-light",onClick:s}),r)}});e.exports=Q},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1389),s=i(a),r=n(8),o=n(10),l=n(1373),c=n(1375),u=n(1374),d=n(1388),p=n(1393),h=n(233),f=n(156),m=n(1446),g=r.createClass({displayName:"BlockedDrawer",mixins:[f],propTypes:{onClose:r.PropTypes.func},componentWillMount:function(){this.addObserver(Store.Blocklist,"add remove")},onBlockConfirm:function(e){e.setBlock(!0)["catch"](_.noop),o.closeModal()},onBlock:function(e){var t=function(e){return Store.Contact.isFilteredContact(e)?Store.Blocklist.get(e.id)?l10n.t("participant_already_blocked"):!0:!1};o.openModal(r.createElement(m,{title:l10n.t("add_blocked_title"),filter:t,onCancel:o.closeModal.bind(o),onSelect:_.once(this.onBlockConfirm)}))},onUnblockConfirm:function(e){e.setBlock(!1)["catch"](_.noop),o.closeModal()},onUnblockCancel:function(){o.closeModal()},onUnblock:function(e,t){o.openModal(r.createElement(h,{okText:l10n.t("unblock_button"),onOK:this.onUnblockConfirm.bind(this,t),cancelText:l10n.t("web_cancel"),onCancel:this.onUnblockCancel},l10n.t("unblock_confirmation",{contact:t.formattedName})))},render:function(){var e=this,t=void 0,n=void 0;if(Store.Blocklist.length>0){var i=Store.Blocklist.map(function(t){return r.createElement(p,{contact:t.contact,key:t.contact.id,onClick:e.onUnblock,onDelete:e.onUnblock})});t=r.createElement("div",{className:"drawer-section-main chatlist","data-list-scroll-container":!0},r.createElement(s["default"],{data:i,height:s["default"].DEFAULT_HEIGHT,extraItems:4})),n=r.createElement("div",{className:"hint"},l10n.t("add_blocked_description"))}else t=r.createElement(d.Blocked,null);return r.createElement(l,{id:"blocked",onCancel:this.props.onClose},r.createElement(c,{title:l10n.t("blocked_flow_title"),onBack:this.props.onClose,type:c.Type.LARGE}),r.createElement(u,null,r.createElement("div",{className:"list-action",onClick:this.onBlock},r.createElement("div",{className:"list-action-icon"},r.createElement("span",{className:"icon icon-add-user"})),r.createElement("div",{className:"list-action-body"},l10n.t("add_blocked_title"))),t,n))}});e.exports=g},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1370),s=i(a),r=n(1389),o=i(r),l=n(8),c=n(1372),u=n(156),d=n(10),p=n(76),h=n(1393),f=n(1373),m=n(1374),g=n(1398),v=n(1406),y=n(1379),_=n(1418),E=n(92),S=n(61),M=l.createClass({displayName:"BroadcastInfoDrawer",mixins:[c,u],propTypes:{chat:l.PropTypes.instanceOf(s["default"]).isRequired},getInitialState:function(){return{everyoneEncrypted:this.async("chat.contact.plaintextDisabled")}},componentWillMount:function(){var e=this.props.chat.groupMetadata;this.addObserver(e.participants,"add remove sort reset")},onParticipantClick:function(e,t){Store.Conn.me!==t.id&&Store.Chat.find(t.id).then(function(e){d.openChatFromUnread(e).then(function(t){t&&d.focusChatTextInput(e)})})},onClose:function(){this.props.onClose?this.props.onClose():this.context.uim.uie.requestDismiss()},onDelete:function(){d.deleteOrExitChat(this.props.chat)},render:function(){var e=this.props.chat,t=e.groupMetadata,n=this.onParticipantClick,i=t.participants.map(function(e){var t=Store.Contact.get(e.id)||Store.Contact.add({id:e.id});return l.createElement(h,{contact:t,admin:!!e.isAdmin,onClick:n,key:e.id})}),a=null;if(this.props.onMediaGallery){var s=l.createElement("span",{className:"icon icon-chevron-right-alt"}),r=S.supportsFeature(S.F.LINK_DOC_GALLERY)?l10n.t("media_links_docs"):l10n.t("media");a=l.createElement(g,{title:r,titleOnClick:this.props.onMediaGallery,subtitle:s,classes:"animate-enter2",noContainer:!0},l.createElement(_,{chat:e,mediaMsgs:e.getMediaMsgs()}))}var c,u=null,d=i.length?l.createElement(g,{classes:"animate-enter1 well-simple-body",title:l10n.t("web_recipients_title"),subtitle:l10n.n(i.length),"data-list-scroll-offset":!0},l.createElement("div",{className:"drawer-section-body chatlist"},l.createElement(o["default"],{data:i,height:72,extraItems:4}))):null;e.canDelete()&&(c=l.createElement("div",{className:"drawer-section chatlist list-icons animate-enter2 well-simple"},l.createElement(v,{iconClass:"icon-delete-danger",a8n:"li-delete-broadcast",className:"danger first",onClick:this.onDelete},l10n.t("web_delete_list"))));var E;e.groupMetadata.creation?(E=p.timeStr(e.groupMetadata.creation),E=l.createElement("div",{className:"header-secondary"},l10n.t("web_group_creation_time",{when:E}))):E=null;var M=null,C=null;return(u||M)&&(C=l.createElement(g,{classes:"well-simple animate-enter2"},u,M)),l.createElement(f,{key:"contact-info-modal",id:"info",variant:"panel",onCancel:this.onClose},l.createElement("header",{className:"pane-header"},l.createElement("div",{className:"header-close"},l.createElement("button",{onClick:this.onClose},l.createElement("span",{className:"icon icon-x"}))),l.createElement("div",{className:"header-body"},l.createElement("div",{className:"header-main"},l.createElement("div",{className:"header-title"},l10n.t("broadcast_list_info")),E))),l.createElement(m,{expands:!!i.length,"data-list-scroll-container":!0},l.createElement(g,{classes:"drawer-scale drawer-section-photo"},l.createElement(y,{id:e.id,size:y.Size.LARGE})),a,C,d,c))}});M.contextTypes={uim:l.PropTypes.instanceOf(E)},e.exports=M},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1370),s=i(a),r=n(1371),o=i(r),l=n(8),c=n(463),u=n(10),d=n(61),p=n(1394),h=n(233),f=l.createClass({displayName:"ClearChatPopup",propTypes:{onCancel:l.PropTypes.func,onDeleteOrExit:l.PropTypes.func,chat:l.PropTypes.instanceOf(s["default"]).isRequired},getInitialState:function(){return{keepStarred:!0}},getText:function(){var e=this.props.chat;switch(e.kind){case s["default"].KIND.GROUP:return l10n.t("clear_chat_group",{name:e.title()});case s["default"].KIND.CHAT:return l10n.t("clear_chat_chat",{name:e.title()});case s["default"].KIND.BROADCAST:return l10n.t("clear_chat_broadcast");default:return""}},onCancel:function(){u.closeModal()},onClear:function(){var e=this.props.chat;e.pendingAction++,e.sendClear(d.supportsFeature(d.F.STARRED)&&d.supportsFeature(d.F.CHAT_CLEAR_STARRED)&&this.state.keepStarred)["finally"](function(){e.pendingAction--}),u.closeModal()},onToggleStarred:function(){this.setState({keepStarred:!this.state.keepStarred})},render:function(){var e=void 0;return d.supportsFeature(d.F.STARRED)&&d.supportsFeature(d.F.CHAT_CLEAR_STARRED)&&(e=l.createElement("div",{className:"controls-section controls-section-popup",onClick:this.onToggleStarred},l.createElement("div",{"data-a8n":c.key("menu-icon-clear-chat"),className:"control"},l.createElement(p,{onChange:this.onToggleStarred,checked:this.state.keepStarred})),l.createElement("div",{className:"label"},l10n.t("keep_starred")))),l.createElement(h,{title:l10n.t("are_you_sure"),onOK:this.onClear,okText:l10n.t("clear_button"),onCancel:this.onCancel},l.createElement("div",null,l.createElement(o["default"],{text:this.getText()}),e))}});e.exports=f},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1409),s=i(a),r=n(111),o=i(r),l=n(8),c=n(1373),u=n(1375),d=n(1374),p=n(1456),h=n(1388),f=n(160),m=n(91),g=n(1387),v=g.GetRef,y=l.createClass({displayName:"ContactDrawer",mixins:[f],propTypes:{onBack:l.PropTypes.func.isRequired,onClick:l.PropTypes.func.isRequired},getInitialState:function(){return{searchText:"",active:!1}},componentDidMount:function(){var e=this;this.safeDefer(function(){e.setState({active:!0})})},getFilteredContacts:function(){var e=Store.Contact.getFilteredContacts(),t=this.state.searchText;return t?(t=l10n.accentFold(t),e.filter(function(e){return e.searchMatch(t)})):e},onSearch:function(e){this.setState({searchText:e})},onFocusList:function(e){this.refs.list&&(e.preventDefault(),e.stopPropagation(),o["default"].flashFocus=Date.now(),this.refs.list.focusFirst())},onSelectFirst:function(e){e.preventDefault(),e.stopPropagation();var t=_.head(this.getFilteredContacts());t&&(o["default"].flashFocus=Date.now(),this.props.onClick(e,t))},onFocusSearch:function(e){o["default"].flashFocus=Date.now(),m.focus(this.search)},render:function(){var e=void 0;if(this.state.active){var t=this.getFilteredContacts();e=0===t.length?l.createElement(h.SearchContacts,null):l.createElement(p,{ref:"list",contacts:t,onFocusSearch:this.onFocusSearch,onClick:this.props.onClick})}else e=null;var n={down:this.onFocusList,enter:this.onSelectFirst};return l.createElement(c,{key:"contact-modal",onCancel:this.props.onBack},l.createElement(u,{title:this.props.title,type:u.Type.LARGE,onBack:this.props.onBack}),l.createElement(o["default"],{handlers:n},l.createElement(s["default"],{ref:v("search",this),onSearch:this.onSearch,placeholder:l10n.t("search_contacts")})),l.createElement(d,{"data-list-scroll-container":!0},e))}});e.exports=y},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1389),s=i(a),r=n(1408),o=i(r),l=n(1371),c=i(l),u=n(1437),d=i(u),p=n(237),h=i(p),f=n(8),m=n(1372),g=n(160),v=n(1376),y=n(156),E=n(1428),S=n(10),M=n(1),C=n(1487),b=n(233),T=n(1418),P=n(1373),k=n(1374),N=n(1406),w=n(1398),x=n(1379),O=n(1543),D=n(1436),R=n(13),I=n(61),A=n(92),L=n(1463),F=n(21),U=n(9),j=f.createClass({displayName:"ContactInfoDrawer",mixins:[m,g,v,y],propTypes:{contact:f.PropTypes.instanceOf(h["default"]).isRequired,onVerification:f.PropTypes.func},getInitialState:function(){return this.asyncState({status:"contact.Status.status",encryptionStatus:"contact.plaintextDisabled"},{commonGroups:void 0,contactIsBlocked:!!Store.Blocklist.get(this.props.contact.id)})},componentDidMount:function(){this.addObserver(Store.Blocklist,"add remove reset sync",this.onBlocklistChange),this.uiIdle(this._init)},_init:function(){var e=this;this.props.contact.findCommonGroups().checkpoint(this.rejectOnUnmount()).then(function(t){e.setState({commonGroups:t}),e.addObserver(Store.GroupMetadata,"group_participant_change",e.commonGroupsUpdate)})["catch"](R.Unmount,_.noop)["catch"](R.WapDrop,_.noop)["catch"](_.noop),I.supportsFeature(I.F.QUERY_IDENTITY)&&this.props.contact.queryIdentity()["catch"](function(e){M.error("contactInfoDrawer:queryIdentity error: "+e)()})},onBlocklistChange:function(e){this.state.contactIsBlocked!==!!Store.Blocklist.get(this.props.contact.id)&&this.setState({contactIsBlocked:!!Store.Blocklist.get(this.props.contact.id)})},commonGroupsUpdate:function(e){var t=this.state.commonGroups,n=this.props.contact.updateCommonGroups(t,e);n&&this.setState({commonGroups:n})},onDeleteChat:function(){var e=Store.Chat.get(this.props.contact.id);S.deleteOrExitChat(e)},onBlockContact:function(){S.openModal(f.createElement(b,{title:l10n.t("block"),onOK:this.blockContact,okText:l10n.t("block"),onCancel:S.closeModal.bind(S),cancelText:l10n.t("web_cancel")},l10n.t("block_confirmation",{contact:this.props.contact.formattedName})))},onUnblockContact:function(){S.openModal(f.createElement(b,{okText:l10n.t("unblock_button"),onOK:this.unblockContact,cancelText:l10n.t("web_cancel"),onCancel:S.closeModal.bind(S)},l10n.t("unblock_confirmation",{contact:this.props.contact.formattedName})))},blockContact:function(){this.props.contact.setBlock(!0),S.closeModal()},unblockContact:function(){this.props.contact.setBlock(!1),S.closeModal()},onClose:function(){this.props.onClose?this.props.onClose():this.context.uim.uie.requestDismiss()},onCopy:function(e){var t=E.extractIsolatedBlocks(window.getSelection());e.clipboardData.setData("text/plain",t),e.stopPropagation(),e.preventDefault()},onViewPicture:function(e){if(this.canViewPicture){var t=e.target,n=function(e){e(t)};S.openModalMedia(f.createElement(C,{contact:this.props.contact,animateBorderRadius:!0,getZoomNode:n}),"profile-viewer")}},onDetailImageLoad:function(e){this.canViewPicture=!0},onClick:function(e,t){S.openChatFromUnread(t).then(function(e){e&&S.focusChatTextInput(t)}),this.onClose()},render:function(){var e,t,n=this,i=this.props.contact,a=this.state.commonGroups;a=_.compact(_.values(a)),_.isArray(a)&&a.length&&(e=a.map(function(e){return f.createElement(o["default"],{chat:e,mode:r.Mode.INFO,onClick:n.onClick,key:e.id})}),e=f.createElement(w,{classes:"animate-enter well-simple-body",title:l10n.t("web_groups_participation_you_and_name"),subtitle:l10n.n(a.length),"data-list-scroll-offset":!0,noContainer:!0},f.createElement("div",{className:"drawer-section-body chatlist"},f.createElement(s["default"],{data:e,height:72,extraItems:4}))));var l=Store.Chat.get(i.id);_.isArray(a)&&l&&l.canDelete()&&(t=f.createElement("div",{className:"drawer-section chatlist list-icons animate-enter2 well-simple"},f.createElement(N,{iconClass:"icon-delete-danger",className:"danger first",a8n:"li-delete-chat",onClick:this.onDeleteChat},l10n.t("delete_chat"))));var u=null;this.props.contact.canBlock()&&(u=this.state.contactIsBlocked?f.createElement("div",{className:"drawer-section chatlist list-icons animate-enter2 well-simple"},f.createElement(N,{className:"success first",a8n:"li-unblock",iconClass:"icon-settings-blocked-success",onClick:this.onUnblockContact},l10n.t("unblock_contact"))):f.createElement("div",{className:"drawer-section chatlist list-icons animate-enter2 well-simple"},f.createElement(N,{className:"first",a8n:"li-block",iconClass:"icon-settings-blocked",onClick:this.onBlockContact},l10n.t("block_contact"))));var p=null;if(this.props.onMediaGallery&&l){var h=f.createElement("span",{className:"icon icon-chevron-right-alt"}),m=I.supportsFeature(I.F.LINK_DOC_GALLERY)?l10n.t("media_links_docs"):l10n.t("media");p=f.createElement(w,{title:m,titleOnClick:this.props.onMediaGallery,subtitle:h,classes:"animate-enter2",noContainer:!0},f.createElement(T,{chat:l,mediaMsgs:l.getMediaMsgs()}))}var g=null,v=l&&l.mute.canMute()?f.createElement(L,{chat:l}):null,y=null,E=null,S=null;(v||y||E)&&(S=f.createElement(w,{classes:"well-simple animate-enter2"},v,y,E));var M=U.STATUS_V2?f.createElement(D,{classes:"row-drawer-item"},f.createElement(O,{dir:"auto"},f.createElement(c["default"],{className:"title",selectable:!0,direction:"auto",text:this.state.status}))):null,C=f.createElement(D,{classes:"row-drawer-item last"},f.createElement(O,{className:"selectable-text title",dir:"auto"},F.formattedUser(i.id))),b=l10n.t("contact_info_status_phone"),R=l10n.t("contact_info_phone_number"),A=f.createElement(w,{classes:"animate-enter2 well-simple-body",title:U.STATUS_V2?b:R},M,C),j=l&&l.presence?f.createElement(d["default"],{presence:l.presence,chatstate:l.presence.chatstate,location:"list"}):null;return f.createElement(P,{key:"contact-info-modal",id:"info",variant:"panel"},f.createElement("header",{className:"pane-header"},f.createElement("div",{className:"header-close"},f.createElement("button",{onClick:this.onClose},f.createElement("span",{className:"icon icon-x"}))),f.createElement("div",{className:"header-body"},f.createElement("div",{className:"header-main"},f.createElement("div",{className:"header-title"},l10n.t("web_contact_info"))))),f.createElement(k,{"data-list-scroll-container":!0,onCopy:this.onCopy},f.createElement("div",{className:"well well-chat"},f.createElement(x,{id:i.id,size:x.Size.LARGE,loader:!0,className:"drawer-scale well-chat-avatar",onLoad:this.onDetailImageLoad,onClick:this.onViewPicture,quality:x.Quality.HIGH}),f.createElement("div",{className:"well-chat-name"},f.createElement(O,{dir:"auto"},f.createElement(c["default"],{selectable:!0,text:i.formattedUser}))),f.createElement("div",{className:"well-chat-secondary"},j)),p,S,A,g,e,u,t))}});j.contextTypes={uim:f.PropTypes.instanceOf(A)},e.exports=j},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(458),s=i(a),r=n(8),o=n(10),l=n(1372),c=n(156),u=n(1376),d=n(1373),p=n(1375),h=n(1374),f=n(1398),m=n(1524),g=n(1424),v=n(157),y=n(461),E=n(13),S=n(44),M=n(9),C=n(92),b=r.createClass({displayName:"ContactMsgInfoDrawer",mixins:[l,c,u],propTypes:{msg:r.PropTypes.instanceOf(s["default"])},getInitialState:function(){return{msgInfo:void 0,star:this.async("msg.star")}},componentWillMount:function(){var e=this;Store.MsgInfo.find(this.props.msg.id).checkpoint(this.rejectOnUnmount()).then(function(t){e.setState({msgInfo:t}),e.addObserver(t,"change:playedRemaining change:readRemaining change:deliveryRemaining")})["catch"](E.Unmount,_.noop)["catch"](function(){e.setState({unimplemented:!0}),o.openToast(r.createElement(y,{msg:l10n.t("msg_info_failed"),id:y.genId("msg_info_failed")}))})},componentDidMount:function(){if(this.props.msg.type===s["default"].TYPE.IMAGE&&(this.refs.scrollable.scrollTop=this.refs.scrollable.scrollHeight),this.props.msg.isGif){var e=this.getMsgComponent();e.play()}},isMsgVisible:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!1;return e===this.props.msg.id&&(t?!0:this.getMsgComponent())},getMsgComponent:function(){var e=this.refs.wrapper;return e?e.refs.component&&e.refs.component.refs.msg:void 0},onClose:function(){this.context.uim.uie.requestDismiss()},render:function(){var e=this.props.msg,t=this.state,n=t.msgInfo,i=t.star,a=t.unimplemented,o=void 0,l=void 0;if(n){var c=[],u=void 0,y=void 0,_=void 0;n.isPTT&&(l=l10n.t("message_info_seen"),u=n.played.head(),y=u&&u.t,_=r.createElement("span",{className:"icon icon-status icon-status-ptt-blue"}),c.push(r.createElement(m,{title:l10n.t("message_info_played"),t:y,icon:_,key:"played"}))),u=n.read.head(),y=u&&u.t,_=r.createElement("span",{className:"icon icon-ack icon-status-dblcheck-ack"}),l=l||l10n.t("message_info_read"),c.push(r.createElement(m,{title:l,t:y,icon:_,key:"read"})),u=n.delivery.head(),y=u&&u.t,_=r.createElement("span",{className:"icon icon-ack icon-status-dblcheck"}),c.push(r.createElement(m,{title:l10n.t("message_info_delivered"),t:y,icon:_,key:"delivery"})),o=r.createElement(f,{classes:"drawer-section-info well animate-enter"},c)}var E=void 0;n||a||(E=r.createElement(f,{classes:"drawer-section-spinner",key:"spinner"},r.createElement(v,{size:50,stroke:4})));var C=S("pane-preview-wrapper","pane-preview-wrapper-bg",{"pane-preview-resize":e.type===s["default"].TYPE.PTT||e.type===s["default"].TYPE.IMAGE||e.type===s["default"].TYPE.LOCATION||e.type===s["default"].TYPE.VCARD||e.isGif});return r.createElement(d,{key:"message-info-modal",id:"info",variant:"panel",onCancel:this.onClose},r.createElement(p,{title:l10n.t("message_info"),type:p.Type.SMALL,onCancel:this.onClose}),r.createElement("div",{className:C,ref:"scrollable"},r.createElement("div",{className:"pane-preview"},r.createElement("div",{className:"pane-chat-tile"}),r.createElement(g,{msg:e,key:"star-"+i.toString(),ref:"wrapper",displayType:M.DISP_TYPE.MSG_INFO,isMsgVisible:this.isMsgVisible,position:g.Position.END}))),r.createElement(h,{classes:"drawer-body-msg-info"},E,o))}});b.contextTypes={uim:r.PropTypes.instanceOf(C)},e.exports=b},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(458),s=i(a),r=n(111),o=i(r),l=n(8),c=n(10),u=n(1400),d=n(1373),p=n(1375),h=n(1374),f=n(1491),m=n(465),g=l.createClass({displayName:"ContactViewerModal",propTypes:{msg:l.PropTypes.instanceOf(s["default"]).isRequired},render:function(){return this.props.msg.vcard?l.createElement(u,{type:u.BOX},l.createElement(d,{key:"vcard-modal",onCancel:function(){return c.closeModal()}},l.createElement(p,{title:l10n.t("contact_viewer"),type:p.Type.POPUP,onCancel:function(){return c.closeModal()}}),l.createElement(h,null,l.createElement(o["default"],null,l.createElement(f,{parsedVCard:this.props.msg.vcard,thumbnail:m.thumbnail(this.props.msg.body),className:"chatlist column"}))))):null}});e.exports=g},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1370),s=i(a),r=n(233),o=i(r),l=n(1371),c=i(l),u=n(8),d=n(1),p=n(10),h=n(1372),f=u.createClass({displayName:"DeleteChatPopup",mixins:[h],propTypes:{onCancel:u.PropTypes.func,onDeleteOrExit:u.PropTypes.func,chat:u.PropTypes.instanceOf(s["default"]).isRequired},getInitialState:function(){return{isReadOnly:this.async("chat.isReadOnly")}},getText:function(){var e=this.props.chat,t=e.title();return e.isGroup?this.state.isReadOnly?l10n.t("web_delete_group_dialog_title",{groupName:t}):l10n.t("web_exit_group_dialog_title",{groupName:t}):e.isUser?l10n.t("delete_chat_dialog_title",{name:t}):e.isBroadcast?l10n.t("delete_list_dialog_title"):void 0},getButton:function(){var e=this.props.chat;return e.isGroup?this.state.isReadOnly?l10n.t("web_delete"):l10n.t("web_exit"):e.isUser||e.isBroadcast?l10n.t("web_delete"):void 0},onCancel:function(){p.closeModal(),_.isFunction(this.props.onCancel)&&this.props.onCancel()},onDelete:function(){var e,t=this.props.chat;t.isGroup?e=this.state.isReadOnly?t.sendDelete():t.sendExit():t.isUser||t.isBroadcast?e=t.sendDelete():d.error("deleteChatPopup:onDelete Unsupported chat type")(),_.isFunction(this.props.onDeleteOrExit)&&e&&this.props.onDeleteOrExit(e),p.closeModal()},render:function(){return u.createElement(o["default"],{onOK:this.onDelete,okText:this.getButton(),onCancel:this.onCancel},u.createElement(c["default"],{text:this.getText()}))}});e.exports=f},function(e,t,n){"use strict";var i=n(8),a=n(463),s=n(1),r=n(10),o=n(1394),l=n(461),c=n(44),u=n(0),d={title:0,hour:1,day:24,week:168},p=i.createClass({displayName:"DoNotDisturbSettings",getInitialState:function(){return{notifications:Store.Mute.getGlobalNotifications(),sounds:Store.Mute.getGlobalSounds(),previews:Store.Mute.getGlobalPreviews(),dnd:d.title}},componentWillUnmount:function(){this.state.dnd!==d.title&&r.openToast(i.createElement(l,{msg:this.globalMuteDurationLabel(this.state.dnd),id:l.genId()}))},globalMuteDurationLabel:function(e){switch(this.state.dnd){case 1:return l10n.t("global_muted_1hour");case 24:return l10n.t("global_muted_1day");case 168:return l10n.t("global_muted_1week");default:return s.log("DoNotDisturbSettings:globalMuteDurationLabel non standard global mute duration:"+e)(),l10n.t("global_muted")}},onSounds:function(){var e=!this.state.sounds;this.setState({sounds:e}),Store.Mute.setGlobalSounds(e)},onNotifications:function(){var e=!this.state.notifications;this.setState({notifications:e}),Store.Mute.setGlobalNotifications(e)},onPreviews:function(){var e=!this.state.previews;this.setState({previews:e}),Store.Mute.setGlobalPreviews(e)},onDND:function(e){var t=parseInt(e.target.value,10);if(0===t)return this.setState({dnd:d.title}),void Store.Mute.globalMute().unmute();this.setState({dnd:t});var n=u().unix()+60*e.target.value*60;Store.Mute.globalMute().mute(n);
},onClose:function(e){r.closeModal()},render:function(){var e=[];if(window.Notification){e.push(i.createElement("div",{className:"controls-section",onClick:this.onNotifications,key:0},i.createElement("div",{"data-a8n":a.key("menu-icon-notifications"),className:"control"},i.createElement(o,{onChange:this.onNotifications,checked:this.state.notifications})),i.createElement("div",{className:"label"},l10n.t("option_desktop_notifications"))));var t=c("controls-section",{disabled:!this.state.notifications});e.push(i.createElement("div",{className:t,onClick:this.onPreviews,key:1},i.createElement("div",{"data-a8n":a.key("menu-icon-notifications"),className:"control"},i.createElement(o,{onChange:this.onPreviews,checked:this.state.previews})),i.createElement("div",{className:"label"},l10n.t("option_msg_previews"),i.createElement("div",{className:"hint"},l10n.t("option_msg_previews_hint_text")))))}return i.createElement("div",{className:"controls-container drawer-section"},i.createElement("div",{className:"controls-section",onClick:this.onSounds},i.createElement("div",{"data-a8n":a.key("menu-icon-notifications"),className:"control"},i.createElement(o,{onChange:this.onSounds,checked:this.state.sounds})),i.createElement("div",{className:"label"},l10n.t("option_sounds"))),e,i.createElement("div",{className:"controls-section controls-section-wide"},i.createElement("div",{className:"select"},i.createElement("select",{value:this.state.dnd,onChange:this.onDND},i.createElement("option",{value:d.title,disabled:this.state.state===d.title},l10n.t("option_select_mute")),i.createElement("option",{value:d.hour,disabled:this.state.state===d.hour},l10n.t("mute_1hour")),i.createElement("option",{value:d.day,disabled:this.state.state===d.day},l10n.t("mute_1day")),i.createElement("option",{value:d.week,disabled:this.state.state===d.week},l10n.t("mute_1week"))))))}});e.exports=p},function(e,t,n){"use strict";var i=n(8),a=n(44),s=i.createClass({displayName:"DrawerSectionFooter",propTypes:{children:i.PropTypes.node.isRequired,separator:i.PropTypes.bool},getDefaultProps:function(){return{separator:!1}},render:function(){var e=a("drawer-section-footer",{separator:this.props.separator});return i.createElement("div",{className:e},i.createElement("div",{className:"col-main"},this.props.children))}});e.exports=s},function(e,t,n){"use strict";var i=n(8),a=n(10),s=n(9),r=n(47),o=n(21),l=n(233),c=n(92),u=i.createClass({displayName:"E2EInfoModal",propTypes:{e2eSubtype:i.PropTypes.string.isRequired,jid:i.PropTypes.string,chatId:i.PropTypes.string,unencryptedContact:i.PropTypes.string},onLearnMore:function(){var e;switch(this.props.e2eSubtype){case"info_encrypted":case"info_unencrypted":e=s.E2E_FAQ_LINK;break;case"identity":e=s.CODE_CHANGE_FAQ_LINK;break;case"encrypt":default:e=s.SECURITY_LINK}var t=r.build(e,{lg:Store.Conn.lg,lc:Store.Conn.lc});window.open(t,"_blank")},onVerificationClick:function(){a.closeModal(),a.verificationDrawer(this.props.jid)},render:function(){var e,t=null,n=null,s=a.closeModal.bind(a),r=l10n.t("web_ok");switch(this.props.e2eSubtype){case"info_encrypted":o.isGroup(this.props.chatId)?e=l10n.t("web_group_info_encrypted_description"):o.isBroadcast(this.props.chatId)&&(e=l10n.t("web_broadcast_info_encrypted_description"));break;case"info_unencrypted":e=o.isGroup(this.props.chatId)?l10n.t("web_group_info_unencrypted_description"):o.isBroadcast(this.props.chatId)?l10n.t("web_broadcast_info_unencrypted_description"):l10n.t("web_contact_info_unencrypted_description",{contact:this.props.unencryptedContact});break;case"identity":var c=Store.Contact.get(this.props.jid),u=c?c.formattedName:"";e=l10n.t("web_security_code_change_description",{name:u}),t=s,n=r,s=this.onVerificationClick,r=l10n.t("web_verify_button");break;case"encrypt":default:e=o.isGroup(this.props.chatId)?l10n.t("web_group_encryption_state_change_description"):o.isBroadcast(this.props.chatId)?l10n.t("web_broadcast_encryption_state_change_description"):l10n.t("web_individual_chat_encryption_state_change_description")}var d=i.createElement("span",{className:"action",onClick:this.onLearnMore},l10n.t("learn_more"));return i.createElement(l,{onOK:s,okText:r,onCancel:t,cancelText:n},e," ",d)}});u.contextTypes={uim:i.PropTypes.instanceOf(c)},e.exports=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1370),s=i(a),r=n(1389),o=i(r),l=n(1371),c=i(l),u=n(8),d=n(1372),p=n(156),h=n(10),f=n(76),m=n(1393),g=n(1418),v=n(1373),y=n(1374),_=n(1398),E=n(1406),S=n(1434),M=n(1382),C=n(233),b=n(1609),T=n(461),P=n(462),k=n(1405),N=n(1397),w=n(234),x=n(92),O=n(1463),D=n(61),R=n(9),I=T.genId("max_participant_toast"),A=u.createClass({displayName:"GroupInfoDrawer",mixins:[d,p],propTypes:{chat:u.PropTypes.instanceOf(s["default"]).isRequired},getInitialState:function(){return{imgFull:this.async("chat.ProfilePicThumb.imgFull"),name:this.async("chat.contact.name")||"",isReadOnly:this.async("chat.isReadOnly"),pendingSubject:!1,pendingPhoto:!1,everyoneEncrypted:this.async("chat.contact.plaintextDisabled"),contextMenu:!1}},componentWillMount:function(){var e=this.props.chat.groupMetadata;this.addObserver(e.participants,"add remove reset sort change:isAdmin")},onImageSet:function(e,t){var n=Store.ProfilePicThumb.get(this.props.chat.id);this.setState({pendingPhoto:!0});var i;i=e&&t?n.setPicture(e,t):n.deletePicture(),i.bind(this).then(function(){this.isMounted()&&this.setState({pendingPhoto:!1})})},onParticipantClick:function(e,t){Store.Conn.me!==t.id&&Store.Chat.find(t.id).then(function(e){h.openChatFromUnread(e).then(function(t){t&&h.focusChatTextInput(e)})})},menuEnabled:function(e){var t=this.props.chat.groupMetadata.participants,n=t.get(e.id);return n&&(t.canPromote(n)||t.canRemove(n)||t.canVerifyIdentity(n))},onParticipantMenu:function(e,t){var n=this.props.chat.groupMetadata.participants,i=n.get(t.id);if(this.menuEnabled(t)){var a=[];if(n.canPromote(i)){var s=this.confirmParticipantPromote.bind(this,i);a.push(u.createElement(M,{a8n:"mi-grp-promote-admin",key:"promote",action:s},l10n.t("menuitem_make_group_admin")))}if(n.canRemove(i)){var r=this.confirmParticipantRemove.bind(this,i);a.push(u.createElement(M,{a8n:"mi-grp-remove-participant",key:"remove",action:r,shortcut:"d"},l10n.t("menuitem_remove")))}e.event&&e.event.persist(),this.setState({contextMenu:{contactId:t.id,menu:a,anchor:e.anchor,event:e.event}})}},contextClose:function(){this.setState({contextMenu:!1})},confirmParticipantRemove:function(e){var t=this.onParticipantRemove.bind(this,e),n=l10n.t("confirm_remove_group_participant",{participant:e.contact.formattedName,subject:this.props.chat.contact.name});h.openModal(u.createElement(C,{onOK:t,okText:l10n.t("remove"),onCancel:h.closeModal.bind(h),cancelText:l10n.t("web_cancel")},u.createElement(c["default"],{text:n})))},onParticipantRemove:function(e){e.contact.pendingAction++,this.props.chat.groupMetadata.participants.removeParticipant(e).then(function(){e.contact.pendingAction--}),h.closeModal()},confirmParticipantPromote:function(e){var t=this.onParticipantPromote.bind(this,e),n=l10n.t("confirm_promote_group_participant",{participant:e.contact.formattedName,subject:this.props.chat.contact.name});h.openModal(u.createElement(C,{onOK:t,okText:l10n.t("menuitem_make_group_admin"),onCancel:h.closeModal.bind(h),cancelText:l10n.t("web_cancel")},u.createElement(c["default"],{text:n})))},onParticipantPromote:function(e){e.contact.pendingAction++,this.props.chat.groupMetadata.participants.promoteParticipant(e).then(function(){e.contact.pendingAction--}),h.closeModal()},onVerifyIdentity:function(e){this.props.onVerification(e.contact)},openAddGroupParticipantFlow:function(){if(this.props.chat.groupMetadata.participants.length>=R.MAX_GROUP_SIZE){var e=l10n.t("action_group_create_failed_participant",{max:R.MAX_GROUP_SIZE});h.openToast(u.createElement(T,{msg:e,id:I}))}else{var t=u.createElement(b,{chat:this.props.chat});h.openModal(t,"modal-flow")}},onClose:function(){this.props.onClose?this.props.onClose():this.context.uim.uie.requestDismiss()},onExitOrDeleteGroup:function(){h.deleteOrExitChat(this.props.chat)},onSubjectChange:function(e){this.setState({name:e.target.value})},validateSubject:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return!!e.trim()},onSetSubjectError:function(){h.openModal(u.createElement(C,{onOK:h.closeModal.bind(h),okText:l10n.t("web_ok")},l10n.t("action_group_subject_empty")))},onSetSubject:function(e){var t=this.props.chat,n=t.groupMetadata;if(n.canSetSubject()){var i=P.emojify(this.state.name);if(i===t.contact.name)return this.setState({name:i});this.setState({pendingSubject:!0}),t.setSubject(i).bind(this)["finally"](function(){this.isMounted()&&this.setState({name:t.contact.name,pendingSubject:!1})})}},onCancelSubject:function(){this.setState({name:this.props.chat.contact.name})},render:function(){var e,t,n=this.props.chat,i=n.groupMetadata,a=this,s=i.participants.map(function(e){var t=e.contact,n=a.state.contextMenu&&t.id===a.state.contextMenu.contactId;return u.createElement(m,{contact:t,key:e.id,admin:!!e.isAdmin,onClick:a.onParticipantClick,contextEnabled:a.menuEnabled.bind(a,t),contextMenu:n,onContext:a.onParticipantMenu,showNotifyName:!0})});n.canDelete()&&(t=u.createElement("div",{className:"drawer-section chatlist list-icons animate-enter2 well-simple"},u.createElement(E,{iconClass:"icon-exit",a8n:"li-delete-group",className:"danger first",onClick:this.onExitOrDeleteGroup},n.isReadOnly?l10n.t("web_delete_group"):l10n.t("web_exit_group")))),i.participants.canAdd()&&(e=u.createElement("div",{className:"list-action list-action-alt",title:l10n.t("add_group_participant"),onClick:this.openAddGroupParticipantFlow},u.createElement("div",{className:"list-action-icon"},u.createElement("span",{className:"icon icon-add-user-light"})),u.createElement("div",{className:"list-action-body ellipsify"},l10n.t("add_group_participant"))));var r=void 0;i.participants.iAmAdmin()&&this.props.onGroupInviteLink&&(r=u.createElement("div",{className:"list-action list-action-alt",title:l10n.t("group_invite_link"),onClick:this.props.onGroupInviteLink},u.createElement("div",{className:"list-action-icon"},u.createElement("span",{className:"icon icon-link"})),u.createElement("div",{className:"list-action-body ellipsify"},l10n.t("group_invite_link"))));var l=s.length?u.createElement(_,{title:l10n.t("web_participants_title"),subtitle:l10n.t("web_participants_count",{count:s.length,max:R.MAX_GROUP_SIZE}),"data-list-scroll-offset":!0,classes:"animate-enter2 well-simple-body",ref:"container",noContainer:!0},e,r,u.createElement("div",{className:"drawer-section-body chatlist"},u.createElement(o["default"],{data:s,height:o["default"].DEFAULT_HEIGHT,extraItems:4}))):null,c=null;if(this.props.onMediaGallery){var d=u.createElement("span",{className:"icon icon-chevron-right-alt"}),p=D.supportsFeature(D.F.LINK_DOC_GALLERY)?l10n.t("media_links_docs"):l10n.t("media");c=u.createElement(_,{title:p,titleOnClick:this.props.onMediaGallery,subtitle:d,classes:"animate-enter2",noContainer:!0},u.createElement(g,{chat:n,mediaMsgs:n.getMediaMsgs()}))}var h=n.contact.profilePicThumb,M=S.Type.GROUP,C=n.isReadOnly||!h.canDelete()&&!h.canSet(),b=u.createElement(S,{className:"well-chat-avatar",type:M,id:n.contact.id,pending:this.state.pendingPhoto,startImage:this.state.imgFull,readOnly:C,onImageSet:this.onImageSet}),T=null;n.groupMetadata.creation&&(T=u.createElement("div",{className:"well-chat-secondary well-chat-secondary-group"},l10n.t("web_group_creation_time",{when:f.relativeDateAndTimeStr(n.groupMetadata.creation)})));var P=null,x=n&&n.mute.canMute()?u.createElement(O,{chat:n}):null,I=null,A=void 0;this.state.contextMenu&&(A=u.createElement(w,{displayName:"ChatContextMenu",escapable:!0,popable:!0,requestDismiss:this.contextClose},u.createElement(N,{contextMenu:this.state.contextMenu})));var L=null;return(x||I||P)&&(L=u.createElement(_,{classes:"well-simple animate-enter2"},x,I,P)),u.createElement(v,{key:"contact-info-modal",id:"info",variant:"panel",onCancel:this.onClose},u.createElement("header",{className:"pane-header"},u.createElement("div",{className:"header-close"},u.createElement("button",{onClick:this.onClose},u.createElement("span",{className:"icon icon-x"}))),u.createElement("div",{className:"header-body"},u.createElement("div",{className:"header-main"},u.createElement("div",{className:"header-title"},l10n.t("web_group_info"))))),u.createElement(y,{"data-list-scroll-container":!0},u.createElement("div",{className:"well well-chat"},b,u.createElement("div",{className:"well-chat-name"},u.createElement(k,{value:this.state.name,editable:i.canSetSubject(),pending:this.state.pendingSubject,showRemaining:!0,validate:this.validateSubject,maxLength:R.MAX_SUBJECT_LENGTH,onChange:this.onSubjectChange,onSave:this.onSetSubject,onError:this.onSetSubjectError,onCancel:this.onCancelSubject,supportsEmoji:!0,lockable:!0,lowProfile:!0,className:"text-input-large"})),T),c,L,l,t),A)}});A.contextTypes={uim:u.PropTypes.instanceOf(x)},e.exports=A},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1370),o=i(r),l=n(1371),c=i(l),u=n(8),d=n(1373),p=n(1375),h=n(1374),f=n(157),m=n(1376),g=n(13),v=n(156),y=n(1379),E=n(1406),S=n(1614),M=n(1618),C=n(10),b=n(461),T={LOADING:0,REVOKING:1,SUCCESS:2},P=u.createClass({displayName:"GroupInviteLinkDrawer",mixins:[m,v],propTypes:{chat:u.PropTypes.instanceOf(o["default"]).isRequired,onBack:u.PropTypes.func.isRequired},getInitialState:function(){return{state:T.LOADING}},getErrorMessageFromStatusCode:function(e){switch(e){case 401:return l10n.t("group_invite_query_401");case 403:return l10n.t("group_invite_query_403");case 404:return l10n.t("group_invite_query_404");default:return l10n.t("group_invite_query_406")}},handleLoadingStatusCode:function(e){if(200===e)this.setState({state:T.SUCCESS});else{var t=this.getErrorMessageFromStatusCode(e);this.props.onBack(),C.openToast(u.createElement(b,{msg:t,id:b.genId()}))}},componentWillMount:function(){this.addObserver(this.props.chat.groupMetadata,"change:inviteCode"),this.props.chat.groupMetadata.groupInviteCode().checkpoint(this.rejectOnUnmount).then(this.handleLoadingStatusCode)["catch"](g.Unmount,_.noop)},onRevokeGroupInvite:function(){C.openModal(u.createElement(S,{chat:this.props.chat,onConfirm:this.onConfirmRevokeGroupInvite}),"modal-flow")},handleRevokingStatusCode:function(e){if(200===e)C.openToast(u.createElement(b,{msg:l10n.t("group_invite_revoke_success"),id:b.genId()})),this.setState({state:T.SUCCESS});else{var t=this.getErrorMessageFromStatusCode(e);this.props.onBack(),C.openToast(u.createElement(b,{msg:t,id:b.genId()}))}},onConfirmRevokeGroupInvite:function(){var e=this;this.setState({state:T.REVOKING}),s["default"].props({_:s["default"].delay(500),status:this.props.chat.groupMetadata.revokeGroupInvite()}).checkpoint(this.rejectOnUnmount).then(function(t){var n=t.status;e.handleRevokingStatusCode(n)})["catch"](g.Unmount,_.noop)},onSendGroupInviteLink:function(){C.openModal(u.createElement(M,{chat:this.props.chat}),"modal-flow")},onClickGroupInviteLink:function(e){e.preventDefault(),this.onSendGroupInviteLink()},onCopyLink:function(){window.getSelection().removeAllRanges();var e=document.querySelector("#group-invite-link-anchor"),t=document.createRange();t.selectNode(e),window.getSelection().addRange(t);var n=void 0;try{n=document.execCommand("copy"),window.getSelection().removeAllRanges()}catch(i){n=!1}n?C.openToast(u.createElement(b,{msg:l10n.t("group_invite_link_copy_success"),id:b.genId()})):C.openToast(u.createElement(b,{msg:l10n.t("group_invite_link_copy_failed"),id:b.genId()}))},renderDrawerBody:function(){var e=this.props.chat.groupMetadata,t=void 0;if(this.state.state===T.LOADING)t=u.createElement("div",{className:"group-invite-loading-container"},u.createElement(f,{className:"group-invite-spinner",size:55,stroke:3}),u.createElement("span",null,l10n.t("group_invite_check_link")));else if(this.state.state===T.REVOKING)t=u.createElement("div",{className:"group-invite-loading-container"},u.createElement(f,{className:"group-invite-spinner",size:55,stroke:3}),u.createElement("span",null,l10n.t("group_invite_revoke_in_progress",{groupName:this.props.chat.contact.name})));else{var n=e.groupInviteLink,i=null;document.queryCommandSupported("copy")&&(i=u.createElement(E,{iconClass:"icon-copy",a8n:"li-copy-link",onClick:this.onCopyLink},l10n.t("group_invite_drawer_copy_link"))),t=u.createElement(h,{wide:!0},u.createElement("div",{className:"chatlist list-identity list-invite"},u.createElement("div",{className:"chat chat-idle","data-ignore-capture":"any"},u.createElement("div",{className:"chat-avatar"},u.createElement(y,{id:this.props.chat.id,size:82,quality:y.Quality.HIGH})),u.createElement("div",{className:"chat-body"},u.createElement("div",{className:"chat-main"},u.createElement("div",{className:"chat-title"},u.createElement("span",{className:"emojitext ellipsify",dir:"auto"},u.createElement(c["default"],{text:this.props.chat.contact.name,direction:"auto"})))),u.createElement("div",{className:"chat-status"},u.createElement("a",{id:"group-invite-link-anchor",href:n,onClick:this.onClickGroupInviteLink},n))))),u.createElement("div",{className:"controls-container drawer-section"},u.createElement("div",{className:"controls-section"},l10n.t("group_invite_link_description"))),u.createElement("div",{className:"chatlist list-icons list-actions"},u.createElement(E,{iconClass:"icon-share",a8n:"li-share-link",onClick:this.onSendGroupInviteLink},l10n.t("group_invite_drawer_send_link")),i,u.createElement(E,{iconClass:"icon-revoke",a8n:"li-revoke-link",onClick:this.onRevokeGroupInvite},l10n.t("group_invite_drawer_revoke_link"))))}return t},render:function(){return u.createElement(d,{id:"invite",onCancel:this.props.onBack},u.createElement(p,{title:l10n.t("group_invite_link"),onBack:this.props.onBack,type:p.Type.SMALL}),this.renderDrawerBody())}});e.exports=P},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(114),o=i(r),l=n(1395),c=i(l),u=n(1426),d=i(u),p=n(8),h=n(233),f=n(157),m=n(1379),g=n(1376),v=n(10),y=n(13),E=n(9),S=n(46),M={LOADING:0,SUCCESS:1,ACCEPT_ERROR:2,QUERY_ERROR:3},C=p.createClass({displayName:"GroupInviteModal",mixins:[g],props:{groupCode:p.PropTypes.string.isRequired},getInitialState:function(){return{state:M.LOADING,status:void 0,groupMetadata:void 0}},componentWillMount:function(){var e=this;S.groupInviteInfo(this.props.groupCode).checkpoint(this.rejectOnUnmount).then(function(t){var n=t.status,i=(0,o["default"])(t,["status"]);if(200===n){var a=new d["default"](i);Store.Contact.gadd(i.id),e.setState({status:n,groupMetadata:a,state:M.SUCCESS})}else e.setState({status:n,state:M.QUERY_ERROR})})["catch"](y.Unmount,_.noop)},onViewGroup:function(){v.openChatFromUnread(Store.Chat.get(this.state.groupMetadata.id)),v.closeModal()},onJoinGroup:function(){var e=this;S.acceptGroupInvite(this.props.groupCode).then(function(e){var t=e.status,n=e.gid;return 200===t?Store.Chat.find(n):s["default"].reject(t)}).then(function(e){v.openChatFromUnread(e).then(function(t){t&&v.focusChatTextInput(e)}),v.closeModal()}).checkpoint(this.rejectOnUnmount)["catch"](y.Unmount,_.noop)["catch"](function(t){e.setState({state:M.ACCEPT_ERROR,status:t})})},onCancel:function(){v.closeModal()},render:function(){var e=this.state,t=e.state,n=e.status,i=e.groupMetadata,a={cancelText:l10n.t("group_invite_cancel"),onCancel:this.onCancel},s=void 0;if(t===M.LOADING)s=p.createElement("div",{className:"group-invite-loading-container"},p.createElement(f,{className:"group-invite-spinner",size:55,stroke:3}),p.createElement("span",null,l10n.t("group_invite_check_link")));else if(t===M.SUCCESS){var r=i.participants.map(function(e){return p.createElement("div",{key:e.id,className:"participant-wrapper"},p.createElement(m,{className:"participant-image",size:50,id:e.id}),p.createElement("span",{className:"participant-text"},e.contact.formattedName))}),o=Store.Contact.gadd(i.owner).formattedName,l=""+E.GROUP_INVITE_URL+this.props.groupCode;s=p.createElement("div",{className:"group-invite-modal"},p.createElement("div",{className:"metadata-container"},p.createElement("div",{className:"metadata-icon"},p.createElement("div",{className:"icon-group-default"}),p.createElement(c["default"],{src:l})),p.createElement("div",{className:"metadata-text"},p.createElement("span",{className:"metadata-title"},i.subject),p.createElement("span",{className:"metadata-subtitle"},l10n.t("group_invite_created_by",{participant:o})))),p.createElement("span",{className:"participants-title"},l10n.t("group_invite_participants",{count:r.length,_plural:r.length})),p.createElement("div",{className:"participants-container"},r));var u=Store.Chat.get(i.id),d=!!u&&!u.isReadOnly;a.onOK=d?this.onViewGroup:this.onJoinGroup,a.okText=d?l10n.t("group_invite_view"):l10n.t("group_invite_join")}else{var g=void 0;if(t===M.QUERY_ERROR)switch(n){case 401:g=l10n.t("group_invite_query_401");break;case 403:g=l10n.t("group_invite_query_403");break;case 404:g=l10n.t("group_invite_query_404");break;case 406:g=l10n.t("group_invite_query_406");break;case 410:g=l10n.t("group_invite_query_410");break;default:g=l10n.t("group_invite_query_500")}else if(t===M.ACCEPT_ERROR)switch(n){case 401:g=l10n.t("group_invite_accept_401");break;case 404:g=l10n.t("group_invite_accept_404");break;case 410:g=l10n.t("group_invite_accept_410");break;case 419:g=l10n.t("group_invite_accept_419");break;default:g=l10n.t("group_invite_accept_500")}a.cancelText=l10n.t("web_ok"),s=p.createElement("div",null,g)}return p.createElement(h,a,s)}});e.exports=C},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1370),s=i(a),r=n(8),o=n(233),l=n(10),c=r.createClass({displayName:"GroupInviteRevokeModal",propTypes:{chat:r.PropTypes.instanceOf(s["default"]).isRequired,onConfirm:r.PropTypes.func.isRequired},onCancel:function(){l.closeModal()},onOK:function(){this.props.onConfirm(),l.closeModal()},render:function(){return r.createElement(o,{title:l10n.t("group_invite_drawer_revoke_link"),onOK:this.onOK,okText:l10n.t("group_invite_drawer_revoke_link"),onCancel:this.onCancel,cancelText:l10n.t("web_cancel")},r.createElement("div",{className:"textfield-static"},l10n.t("group_invite_revoke_confirmation_text",{groupName:this.props.chat.contact.name})))}});e.exports=c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(458),s=i(a),r=n(8),o=n(10),l=n(1372),c=n(156),u=n(1376),d=n(1373),p=n(1375),h=n(1374),f=n(1398),m=n(1635),g=n(1525),v=n(1424),y=n(157),E=n(461),S=n(1728),M=n(13),C=n(44),b=n(92),T=n(9),P=r.createClass({displayName:"GroupMsgInfoDrawer",mixins:[l,c,u],propTypes:{msg:r.PropTypes.instanceOf(s["default"])},getInitialState:function(){return{msgInfo:void 0,star:this.async("msg.star")}},componentWillMount:function(){var e=this;Store.MsgInfo.find(this.props.msg.id).checkpoint(this.rejectOnUnmount()).then(function(t){e.setState({msgInfo:t}),e.addObserver(t.played,"add remove"),e.addObserver(t.read,"add remove"),e.addObserver(t.delivery,"add remove"),e.addObserver(t,"change:playedRemaining change:readRemaining change:deliveryRemaining")})["catch"](M.Unmount,_.noop)["catch"](function(){e.setState({unimplemented:!0}),o.openToast(r.createElement(E,{msg:l10n.t("msg_info_failed"),id:E.genId("msg_info_failed")}))})},getAnimateEnterClass:function(e){return"animate-enter"+(-1===e?"":e)},componentDidMount:function(){if(this.props.msg.type===s["default"].TYPE.IMAGE&&(this.refs.scrollable.scrollTop=this.refs.scrollable.scrollHeight),this.props.msg.isGif){var e=this.getMsgComponent();e.play()}},isMsgVisible:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!1;return e===this.props.msg.id&&(t?!0:this.getMsgComponent())},getMsgComponent:function(){var e=this.refs.wrapper;return e?e.refs.component&&e.refs.component.refs.msg:void 0},onClose:function(){this.context.uim.uie.requestDismiss()},render:function(){var e,t=this.props.msg,n=this.state,i=n.msgInfo,a=n.star,o=n.unimplemented,l=-1,c=24,u=26,_=void 0,E=void 0;if(i&&i.isPTT){var M=r.createElement("span",{className:"icon icon-status icon-status-ptt-blue"}),b=i.played.map(function(e){return r.createElement(g,{participant:e,key:e.id})}),P=b.length>0?r.createElement("div",{className:"chatlist chatlist-plain"},b):null,k=i.playedRemaining>0?r.createElement(m,null,l10n.t("message_info_remaining",{count:i.playedRemaining,_plural:i.playedRemaining})):null,N=C(this.getAnimateEnterClass(l),"well-simple-body");E=l10n.t("message_info_seen_by"),e=k?c+u:c,A=S.minHeight(b,e),_=r.createElement(f,{classes:N,key:"played-section",style:A,title:l10n.t("message_info_played_by"),subtitle:M,footer:k},P)}var w=void 0;if(i&&(i.read.length>0||i.playedRemaining>0)){var x=r.createElement("span",{className:"icon icon-ack icon-status-dblcheck-ack"}),O=i.read.map(function(e){return r.createElement(g,{participant:e,key:e.id})}),D=O.length>0?r.createElement("div",{className:"chatlist chatlist-plain"},O):null,R=i.readRemaining>0?r.createElement(m,null,l10n.t("message_info_remaining",{count:i.readRemaining,_plural:i.readRemaining})):null,I=C(this.getAnimateEnterClass(l),"well-simple-body");E=E||l10n.t("message_info_read_by"),e=R?c+u:c;var A=S.minHeight(O,e);w=r.createElement(f,{classes:I,key:"read-section",title:E,style:A,subtitle:x,footer:R},D)}var L=void 0;if(i&&(i.delivery.length>0||i.deliveryRemaining>0)){var F=r.createElement("span",{className:"icon icon-ack icon-status-dblcheck"}),U=i.delivery.map(function(e){return r.createElement(g,{participant:e,key:e.id})}),j=U.length>0?r.createElement("div",{className:"chatlist chatlist-plain"},U):null,G=i.deliveryRemaining>0?r.createElement(m,null,l10n.t("message_info_remaining",{count:i.deliveryRemaining,_plural:i.deliveryRemaining})):null,B=C(this.getAnimateEnterClass(l),"well-simple-body");e=G?c+u:c,A=S.minHeight(U,e),L=r.createElement(f,{classes:B,key:"delivered-section",style:A,title:l10n.t("message_info_delivered_to"),subtitle:F,footer:G},j)}var H=void 0;i||o||(H=r.createElement(f,{classes:"drawer-section-spinner",key:"spinner"},r.createElement(y,{size:50,stroke:4})));var V=C("pane-preview-wrapper","pane-preview-wrapper-bg",{"pane-preview-resize":t.type===s["default"].TYPE.PTT||t.type===s["default"].TYPE.IMAGE||t.type===s["default"].TYPE.LOCATION||t.type===s["default"].TYPE.VCARD||t.isGif});return r.createElement(d,{key:"message-info-modal",id:"info",variant:"panel",onCancel:this.onClose},r.createElement(p,{title:l10n.t("message_info"),type:p.Type.SMALL,onCancel:this.onClose}),r.createElement("div",{className:V,ref:"scrollable"},r.createElement("div",{className:"pane-preview"},r.createElement("div",{className:"pane-chat-tile"}),r.createElement(v,{msg:t,key:"star-"+a.toString(),ref:"wrapper",displayType:T.DISP_TYPE.MSG_INFO,isMsgVisible:this.isMsgVisible,position:v.Position.END}))),r.createElement(h,{classes:"drawer-body-msg-info"},H,_,w,L))}});P.contextTypes={uim:r.PropTypes.instanceOf(b)},e.exports=P},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1370),o=i(r),l=n(1408),c=i(l),u=n(8),d=n(1486),p=n(1386),h=n(1388),f=u.createClass({displayName:"GroupsModal",propTypes:{chats:u.PropTypes.arrayOf(u.PropTypes.instanceOf(o["default"])),filter:u.PropTypes.func,onCancel:u.PropTypes.func.isRequired,onGroup:u.PropTypes.func.isRequired},getDefaultProps:function(){return{filter:function(){return!0}}},getInitialState:function(){return this.selection=new p,{loading:!0,searchFilter:void 0}},componentWillMount:function(){var e=this,t=this.props.chats;s["default"].delay(300).then(function(){return s["default"].all(_.map(_.filter(t,function(e){return e.groupMetadata.stale}),function(e){return e.groupMetadata.update()["catch"](_.noop)}))}).then(function(){return e.setState({loading:!1})})},onSelect:function(e,t){var n=t.props.chat;this.props.filter(n)===!0&&this.props.onGroup(t.props.chat)},onSearch:function(e){this.setState({searchFilter:e})},render:function(){var e=this,t=this.props,n=t.chats,i=t.onGroup,a=t.filter,s=t.onCancel,r=void 0;return this.state.loading?r=u.createElement(h.Loading,null):!function(){var t=l10n.accentFold(e.state.searchFilter),s=n.filter(function(e){return a(e)&&(!t||t&&e.contact.searchMatch(t))});s.length?(e.selection.init(_.map(s.filter(function(e){return a(e)===!0}),"id")),r=s.map(function(t){var n=void 0,s=void 0;return _.isString(a(t))&&(n=u.createElement("div",{className:"chat-status ellipsify",title:a(t)},a(t)),s="member"),u.createElement(c["default"],{chat:t,mode:l.Mode.INFO,active:e.selection,secondary:n,noContext:!0,className:s,onClick:_.isString(a(t))?void 0:i.bind(null,t),key:t.id})})):r=u.createElement(h.SearchGroups,null)}(),u.createElement(d,{title:l10n.t("web_groups"),selection:this.selection,onSearch:this.onSearch,searchPlaceholder:l10n.t("search_groups"),onSelect:this.onSelect,onCancel:s},r)}});e.exports=f},function(e,t,n){"use strict";var i=n(8),a=n(1373),s=n(1375),r=n(1374),o=n(1406),l=n(1652),c=n(10),u=n(245),d=n(47),p=n(9),h="animated-doodle",f=n(1733),m={"class":".animated-doodle",low:{"default":f},high:{"default":f}},g=i.createClass({displayName:"HelpDrawer",propTypes:{onClose:i.PropTypes.func.isRequired},componentWillMount:function(){u.isAssetLoaded(h)||u.loadAsset(m,h)},onTOS:function(){var e="https://www.whatsapp.com/legal/";e=d.build(e,{lg:l10n.getLocale()}),window.open(e,"_blank")},onFAQ:function(){var e="http://www.whatsapp.com/faq/web";e=e=d.build(e,{lg:l10n.getLocale()}),window.open(e,"_blank")},onContactUs:function(){c.openModal(i.createElement(l,null))},render:function(){return i.createElement(a,{onCancel:this.onBack,id:"help"},i.createElement(s,{a8n:"drawer-title-help",title:l10n.t("help_drawer_title"),onBack:this.props.onClose,type:s.Type.LARGE}),i.createElement(r,{wide:!0},i.createElement("div",{className:"controls-section animated-doodle"}),i.createElement("div",{className:"controls-section version selectable-text"},l10n.t("version",{version:p.VERSION_STR})),i.createElement("div",{className:"chatlist list-icons list-actions"},i.createElement(o,{className:"drawer-list-item",a8n:"li-faq",onClick:this.onFAQ},l10n.t("web_settings_faq")),i.createElement(o,{className:"drawer-list-item",a8n:"li-contact-us",onClick:this.onContactUs},l10n.t("send_logs_title")),i.createElement(o,{className:"drawer-list-item",a8n:"li-tos",onClick:this.onTOS},l10n.t("terms_and_privacy_link")))))}});e.exports=g},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(1370),m=(i(f),n(458)),g=(i(m),n(113)),v=n(8),y=n(1418),_=n(1544),E=n(1538),S=n(234),M=n(1373),C=n(1375),b=n(1374),T=n(1504),P=n(1385),k=n(110),N=n(159),w=n(61),x=n(18),O=n(44),D={MEDIA:"media",DOCS:"docs",LINKS:"links"},R=function(e){function t(){(0,o["default"])(this,t);var e=(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments));return e.onSelectMessages=function(){e.state.selectable||e.setState({selectable:!0})},e.onCancelSelection=function(){e.state.selectable&&(e.selectedMessages.unsetAll(),e.setState({selectable:!1}))},e.onMessageSelect=function(t,n){e.onSelectMessages(),e.selectedMessages.setVal(t,n)},e.selectedMessages=new P([],function(e){return e.id.toString()}),e.state={selected:D.MEDIA,direction:null,selectable:!1},e}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"onSelectTab",value:function(e){var t=x.values(D).indexOf(this.state.selected),n=x.values(D).indexOf(e);t!==n&&this.selectedMessages.unsetAll();var i=n>t?"right":"left";this.setState({selected:e,direction:i,selectable:!1})}},{key:"getTabs",value:function(){var e=this;if(!w.supportsFeature(w.F.LINK_DOC_GALLERY))return null;var t=[{tab:D.MEDIA,title:N.t("media")},{tab:D.DOCS,title:N.t("docs")},{tab:D.LINKS,title:N.t("links")}].map(function(t){var n=O("menu-item",{active:e.state.selected===t.tab});return v.createElement("button",{
className:n,onClick:e.onSelectTab.bind(e,t.tab),key:t.tab,title:t.title},t.title)});return v.createElement("div",{className:"menu-tabs menu-tabs-lists","data-active-tab":this.state.selected},t)}},{key:"getContent",value:function(){var e=this.props.chat;if(!w.supportsFeature(w.F.LINK_DOC_GALLERY))return v.createElement(y,{chat:e,mediaMsgs:e.getMediaMsgs(),selectable:this.state.selectable,onMessageSelect:this.onMessageSelect,selectedMessages:this.selectedMessages,fullCollection:!0});var t=void 0;switch(this.state.selected){case D.MEDIA:t=v.createElement(y,{chat:e,mediaMsgs:e.getMediaMsgs(),selectable:this.state.selectable,onMessageSelect:this.onMessageSelect,selectedMessages:this.selectedMessages,fullCollection:!0});break;case D.LINKS:t=v.createElement(_,{chat:e,linkMsgs:e.getLinkMsgs(),selectable:this.state.selectable,onMessageSelect:this.onMessageSelect,selectedMessages:this.selectedMessages});break;case D.DOCS:t=v.createElement(E,{chat:e,docMsgs:e.getDocMsgs(),selectable:this.state.selectable,onMessageSelect:this.onMessageSelect,selectedMessages:this.selectedMessages})}return t}},{key:"render",value:function(){var e=this.props.chat,t=this.getTabs(),n=this.getContent(),i=this.state.selectable?v.createElement(S,{displayName:"MediaMultiSelect",escapable:!0,requestDismiss:this.onCancelSelection},v.createElement(T,{chat:e,noSortOnForward:!0,toastPosition:g.ActionToast.POSITION.RIGHT,downloadButton:this.state.selected!==D.LINKS,selectedMessages:this.selectedMessages,onCancel:this.onCancelSelection})):null,a="right"===this.state.direction?"slide-forward":"slide-back",s=w.supportsFeature(w.F.LINK_DOC_GALLERY)?" ":N.t("media");return v.createElement(M,{id:"multimedia-gallery",onCancel:this.props.onBack},v.createElement(C,{title:s,onBack:this.props.onBack,type:C.Type.LARGE}),i,t,v.createElement(b,{"data-list-scroll-container":!0},v.createElement(k,{transitionName:a,className:"column"},v.createElement("div",{className:"multimedia-gallery",key:this.state.selected},v.createElement("div",{className:"column"},n)))))}}]),t}(v.Component);e.exports=R},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1371),s=i(a),r=n(458),o=i(r),l=n(8),c=n(1372),u=n(76),d=n(44),p=n(1379),h=n(61),f=l.createClass({displayName:"MediaPanelHeader",propTypes:{msg:l.PropTypes.instanceOf(o["default"]).isRequired,onGoToMsgClick:l.PropTypes.func.isRequired,onUnstarClick:l.PropTypes.func.isRequired,onStarClick:l.PropTypes.func.isRequired,openForwardFlow:l.PropTypes.func.isRequired,onDownloadClick:l.PropTypes.func.isRequired,onClose:l.PropTypes.func.isRequired},mixins:[c],getInitialState:function(){return{renderableUrl:this.async("msg.mediaData.renderableUrl")}},getMenuBtns:function(){var e=this.props.msg,t=null,n=null,i=null,a=null,s=null,r="menu-item menu-item-hover";if(t=l.createElement("div",{className:r,onClick:this.props.onGoToMsgClick},l.createElement("span",{className:"icon icon-bubble",title:l10n.t("go_to_message")})),h.supportsFeature(h.F.STARRED)){var o=void 0,c=void 0,u=void 0;e.star?(o=this.props.onUnstarClick,c="icon icon-unstar-btn",u=l10n.t("unstar_message")):(o=this.props.onStarClick,c="icon icon-star-btn",u=l10n.t("star_message")),n=l.createElement("div",{className:r,onClick:o},l.createElement("span",{className:c,title:u}))}return i=l.createElement("div",{className:r,onClick:this.props.openForwardFlow},l.createElement("span",{className:"icon btn-media-forward icon-forward",title:l10n.t("forward")})),a=l.createElement("div",{className:d(r,{disabled:!this.state.renderableUrl}),onClick:this.props.onDownloadClick},l.createElement("a",{className:"icon icon-download",title:l10n.t("web_button_download")})),{btnGoToMsg:t,btnStar:n,btnForward:i,btnDownload:a,btnMinimize:s}},render:function(){var e=this.props.msg,t=e.displayName(!0,!0);e.isGroupMsg&&(t+=" @ "+e.chat.title());var n=this.getMenuBtns(),i=n.btnGoToMsg,a=n.btnStar,r=n.btnForward,o=n.btnDownload,c=n.btnMinimize,h=d("media-panel-header",{});return l.createElement("div",{className:h},l.createElement("div",{className:"chat media-chat"},l.createElement("div",{className:"chat-avatar"},l.createElement(p,{id:e.sender,size:40})),l.createElement("div",{className:"chat-body"},l.createElement("div",{className:"chat-main"},l.createElement(s["default"],{ellipsify:!0,text:t})),l.createElement("div",{className:"chat-secondary"},l.createElement("div",{className:"chat-status ellipsify"},u.relativeDateAndTimeStr(e.t))))),l.createElement("div",{className:"menu menu-horizontal media-panel-tools"},c,i,a,r,o,l.createElement("div",{className:"menu-item menu-item-hover"},l.createElement("button",{className:"icon icon-x-viewer",title:l10n.t("web_close"),onClick:this.props.onClose}))))}});e.exports=f},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(460),s=i(a),r=n(458),o=i(r),l=n(1371),c=i(l),u=n(1395),d=i(u),p=n(1387),h=n(478),f=n(1384),m=n(8),g=n(45),v=n(1372),y=n(158),E=n(1422),S=n(1457),M=n(1390),C=n(1410),b=n(10),T=n(1443),P=n(233),k=n(235),N=n(1645),w=n(466),x=n(61),O=n(1506),D=n(44),R=n(234),I=500,A=2,L=m.createClass({displayName:"MediaViewerModal",mixins:[v],propTypes:{msg:m.PropTypes.instanceOf(o["default"]).isRequired,zoomIn:m.PropTypes.bool,getZoomNode:m.PropTypes.func,onBack:m.PropTypes.func.isRequired,onExitAnimation:m.PropTypes.func,onNext:m.PropTypes.func,onPrev:m.PropTypes.func,onImgZoomIn:m.PropTypes.func,onImageLoad:m.PropTypes.func},getDefaultProps:function(){return{getZoomNode:_.noop}},getInitialState:function(){return this.handleMouseMove=_.throttle(this._handleMouseMove,42),{star:this.async("msg.star"),mediaStage:this.async("msg.mediaData.mediaStage"),imgZoomed:!1}},componentWillMount:function(){if(this.props.msg.mediaData.mediaStage===k.STAGE.RESOLVED&&this.props.zoomIn){var e=this.props.getZoomNode(this.props.msg.id);this.setState({zoomElement:e}),this.style={opacity:0}}},componentDidMount:function(){this.style={}},componentWillUnmount:function(){this.handleMouseMove.cancel()},onImageLoad:function(e){if(this.props.onImageLoad&&this.props.onImageLoad(),!this.zoomed){this.zoomed=!0;var t=this.state.zoomElement;t&&e&&this.props.zoomIn&&this.animateZoom(t,e)}},animateZoom:function(e,t){var n=t.getBoundingClientRect(),i=e.getBoundingClientRect(),a=i.top-n.top,r=i.left-n.left,o=e.clientWidth/t.clientWidth,l=(t.clientHeight-e.clientHeight)/2,c=(t.clientWidth-e.clientWidth)/2;a-=l,r-=c,(0,s["default"])(t,{opacity:[1,0],translateX:[0,r],translateY:[0,a],scale:[1,o]},{duration:I,easing:[.1,.82,.25,1]});var u=g.findDOMNode(this.refs.caption);u&&(0,s["default"])(u,{opacity:[1,0]},{duration:I})},openForwardFlow:function(e){e.stopPropagation();var t=this.props.msg;t.isUnsentMedia?b.openModal(m.createElement(P,{title:l10n.t("err_unsent_forward_title"),onOK:b.closeModal.bind(b),okText:l10n.t("web_ok")},l10n.t("err_unsent_forward_text"))):b.openModal(m.createElement(T,{msgs:[this.props.msg]}),"modal-flow")},onScroll:function(e){Math.abs(e.deltaY)>7&&this.onClose()},onImgZoomIn:function(e){if(e&&this.refs.media){var t=this.refs.media;this.listenToMouseMove=t.heightOveflow>0||t.widthOveflow>0}this.setState({imgZoomed:e}),this.props.onImgZoomIn(e)},onZoomOut:function(){this.refs.media&&this.state.imgZoomed&&this.refs.media.onImageClick()},onMouseMove:function(e){this.handleMouseMove(e.pageX,e.pageY)},_handleMouseMove:function(e,t){var n=this.refs.media&&this.refs.media.refs.image,i=g.findDOMNode(n);if(i){var a=i.parentNode,r=a.parentNode,o=this.refs.media.getTranslatePosition(r,e,t),l=o.translateX,c=o.translateY;(0,s["default"])(a,"stop"),(0,s["default"])(a,{translateX:l,translateY:c,scale:A},{duration:0})}},onDownloadClick:function(e){e.stopPropagation(),w.initDownload(this.props.msg)},onStarClick:function(e){e.stopPropagation();var t=this.props.msg;b.sendStarMsgs(t.chat,[t])},onUnstarClick:function(e){e.stopPropagation();var t=this.props.msg;b.sendUnstarMsgs(t.chat,[t])},onGoToMsgClick:function(e){e.stopPropagation(),this.onClose(),b.existsDrawerRight(function(e){e&&2===O.column&&b.closeDrawerRight()});var t=this.props.msg;b.openChatAt(t.chat,t.chat.getSearchContext(t))},getMenuBtns:function(){var e=this.props.msg,t=null,n=null,i=null,a=null,s=D("menu-item menu-item-hover",{disabled:!e.mediaData.renderableUrl});if(t=m.createElement("div",{className:"menu-item menu-item-hover",onClick:this.onGoToMsgClick},m.createElement("span",{className:"icon icon-bubble",title:l10n.t("go_to_message")})),x.supportsFeature(x.F.STARRED)){var r=void 0,o=void 0,l=void 0;e.star?(r=this.onUnstarClick,o="icon icon-unstar-btn",l=l10n.t("unstar_message")):(r=this.onStarClick,o="icon icon-star-btn",l=l10n.t("star_message")),n=m.createElement("div",{className:s,onClick:r},m.createElement("span",{className:o,title:l}))}return i=m.createElement("div",{className:s,onClick:this.openForwardFlow},m.createElement("span",{className:"icon btn-media-forward icon-forward",title:l10n.t("forward")})),a=m.createElement("div",{className:s,onClick:this.onDownloadClick},m.createElement("a",{className:"icon icon-download",title:l10n.t("web_button_download")})),{btnGoToMsg:t,btnStar:n,btnForward:i,btnDownload:a}},onClose:function(){var e=this;if(!this.closing){this.closing=!0,_.isFunction(this.props.onExitAnimation)&&this.props.onExitAnimation();var t=this.props.getZoomNode(this.props.msg.id);if(!t)return this.props.onBack();var n=this.refs.media,i=void 0;if(n&&n.refs){var a=this.props.msg.mediaData.type;a===k.TYPE.IMAGE?i=n.image:this.props.msg.mediaData.isGif&&(i=n.refs.player)}if(!i)return this.props.onBack();i=g.findDOMNode(i);var r=i.getBoundingClientRect(),o=t.getBoundingClientRect(),l=o.top-r.top,c=o.left-r.left,u=t.clientWidth/i.clientWidth,d=(i.clientHeight-t.clientHeight)/2,p=(i.clientWidth-t.clientWidth)/2;l-=d,c-=p,(0,s["default"])(i,{translateX:[c,0],translateY:[l,0],scale:[u,1]},{duration:200,easing:[.1,.82,.25,1]}).then(function(){e.props.onBack()});var h=g.findDOMNode(this.refs.caption);h&&(0,s["default"])(h,{opacity:[0,1]},{duration:200,easing:[.1,.82,.25,1]})}},onMinimizeClick:function(){var e=g.findDOMNode(this.refs.media).querySelector("video"),t=e.currentTime;b.videoPlayerFloater(this.props.msg,this.props.zoomNode,t),this.onClose()},render:function(){var e,t=this.props.msg,n=t.mediaData;switch(n.type){case k.TYPE.IMAGE:e=m.createElement(F,{msg:t,key:t.id,style:this.style,onLoad:this.onImageLoad,onImgZoomIn:this.onImgZoomIn,ref:"media"});break;case k.TYPE.VIDEO:e=m.createElement(U,{msg:t,key:t.id,onLoad:n.isGif?this.onImageLoad:null,startTime:this.props.startTime,ref:"media"});break;case k.TYPE.AUDIO:e=m.createElement(G,{msg:t,key:t.id})}var i=void 0;if(t.caption){var a=t.mentionMap(),s=this.props.zoomIn&&(n.isGif||n.type===k.TYPE.IMAGE);i=m.createElement(c["default"],{ref:"caption",className:{"media-caption":!0,"caption-hidden":s},formatters:f.Configuration.TrustedConversation(a),text:t.caption})}var r=D("media",{"media-with-caption":!!i}),o=m.createElement("span",{className:"icon icon-chevron-right icon-l",title:l10n.t("next_button")}),l=D("btn btn-round btn-media-next",{"disabled-btn":!this.props.onNext}),u=m.createElement("div",{role:"button",className:l,onClick:this.props.onNext||function(e){return e.stopPropagation()}},o),d=m.createElement("span",{className:"icon icon-chevron-left icon-l",title:l10n.t("previous_button")}),p=D("btn btn-round btn-media-prev",{"disabled-btn":!this.props.onPrev}),h=m.createElement("div",{role:"button",className:p,onClick:this.props.onPrev||function(e){return e.stopPropagation()}},d),g=D("media-viewer",{"media-viewer-animate":this.props.zoomIn,"cursor-zoom-out":this.state.imgZoomed}),v=this.state.imgZoomed?null:this.onScroll,y=this.state.imgZoomed?null:this.onClose,_=this.state.imgZoomed&&this.listenToMouseMove?this.onMouseMove:null,E=this.state.imgZoomed?this.onZoomOut:null;return m.createElement(R,{displayName:"MediaViewer",escapable:!0,requestDismiss:this.onClose},m.createElement("div",{className:g,onClick:E,onMouseMove:_},m.createElement(N,{msg:this.props.msg,onGoToMsgClick:this.onGoToMsgClick,onUnstarClick:this.onUnstarClick,onStarClick:this.onStarClick,openForwardFlow:this.openForwardFlow,onDownloadClick:this.onDownloadClick,onMinimizeClick:this.onMinimizeClick,onClose:this.onClose}),m.createElement("div",{className:"media-content",dir:"ltr",ref:"container",onWheel:v,onClick:y},h,m.createElement("div",{className:r},m.createElement(B,{msg:t}),e,i),u)))}}),F=m.createClass({displayName:"MediaImage",mixins:[v,y],propTypes:{msg:m.PropTypes.instanceOf(o["default"]).isRequired,style:m.PropTypes.object,onLoad:m.PropTypes.func,onImgZoomIn:m.PropTypes.func},getInitialState:function(){return{mediaStage:this.async("msg.mediaData.mediaStage"),zoomIn:null}},componentDidMount:function(){this.props.msg.forceDownloadMedia()},onImageClick:function(e){if(e&&e.stopPropagation(),this.state.zoomIn)return this.props.onImgZoomIn(!1),void this.setState({zoomIn:null});var t=g.findDOMNode(this.image),n=t.parentNode,i=n.parentNode;this.heightOveflow=n.clientHeight*A-i.clientHeight,this.widthOveflow=n.clientWidth*A-i.clientWidth;var a=this.getTranslatePosition(i,e.pageX,e.pageY),s=a.translateX,r=a.translateY;this.props.onImgZoomIn(!0),this.setState({zoomIn:{factor:A,translateX:s,translateY:r}})},getTranslatePosition:function(e,t,n){var i=window.innerWidth/2-t,a=window.innerHeight/2-n,s=this.widthOveflow>0?Math.round(1.5*i*this.widthOveflow/e.clientWidth):0,r=this.heightOveflow>0?Math.round(1.5*a*this.heightOveflow/e.clientHeight):0;return{translateX:s,translateY:r}},render:function(){var e=this,t=this.props.msg,n=t.mediaData,i=this.state.zoomIn,a=D("media-viewer-img",{"cursor-zoom-in":!i});if(n.mediaStage===k.STAGE.RESOLVED){var s={width:n.fullWidth,height:n.fullHeight},r=m.createElement(d["default"],{src:n.renderableUrl,ref:(0,p.GetRef)("image",this),onClick:this.onImageClick,style:this.props.style,className:a});return i&&(r=m.createElement(R,{displayName:"ZoomInImage",ref:"image",escapable:!0,requestDismiss:function(){return e.onImageClick()}},r)),m.createElement(M,{type:M.TYPES.ZOOM_IN,size:s,zoomIn:this.state.zoomIn,onObjectLoad:this.props.onLoad},r)}return m.createElement(j,{msg:t})}}),U=m.createClass({displayName:"MediaVideo",mixins:[v,y],propTypes:{msg:m.PropTypes.instanceOf(o["default"]).isRequired,style:m.PropTypes.object,onLoad:m.PropTypes.func},getInitialState:function(){return{played:!1,mediaStage:this.async("msg.mediaData.mediaStage"),size:{width:0,height:0}}},componentWillMount:function(){this.updateSize()},componentWillReceiveProps:function(){this.updateSize()},componentDidMount:function(){var e=this.props.msg;e.forceDownloadMedia()},updateSize:function(){var e=this.props.msg.mediaData;e.mediaStage===k.STAGE.RESOLVED&&e.fullWidth&&e.fullHeight&&this.setState({size:this.getSize()})},onPlayerError:function(e){},onPlayerClick:function(e){e.stopPropagation();var t=g.findDOMNode(this.refs.player);e.clientY>t.clientHeight+t.offsetTop-44||(t.paused?t.play():t.pause())},onResize:function(e){this.setState({size:e})},stopPropagation:function(e){e.stopPropagation()},getSize:function(){var e=this.props.msg.mediaData,t=330;return!e.isGif||e.fullWidth>=t?{width:e.fullWidth,height:e.fullHeight}:{width:t,height:e.fullHeight*t/e.fullWidth}},render:function(){var e=this.props.msg,t=e.mediaData,n=t.isGif,i=t.mediaStage===k.STAGE.RESOLVED;return i?m.createElement(M,{type:M.TYPES.SCALE_DOWN,size:this.state.size,onObjectLoad:this.props.onLoad,style:this.props.style},m.createElement(E,{msg:e,ref:"player",className:"media-viewer-img",onError:this.onPlayerError,onClick:n?this.stopPropagation:this.onPlayerClick,autoPlay:!0,controls:!n,loop:n,startTime:this.props.startTime,onResize:this.onResize},l10n.t("video_playback_not_supported"))):m.createElement(j,{msg:e})}}),j=m.createClass({displayName:"BlurredImage",stopPropagation:function(e){e.stopPropagation()},render:function(){var e=this.props.msg.mediaData,t=e.preview&&e.preview.url(),n=(0,h.aspectRatioScaled)(e.aspectRatio,500);return m.createElement("div",{className:"media-viewer-blur-crop",style:n,onClick:this.stopPropagation},m.createElement("img",{className:"media-viewer-blur-img",src:t}))}}),G=m.createClass({displayName:"MediaAudio",mixins:[v],propTypes:{msg:m.PropTypes.instanceOf(o["default"]).isRequired},getInitialState:function(){return{mediaStage:this.async("msg.mediaData.mediaStage")}},render:function(){var e=this.props.msg;return e.mediaData.mediaStage===k.STAGE.RESOLVED?m.createElement(S,{msg:e,className:"media-viewer-img media-viewer-audio",autoPlay:!0,controls:!0},l10n.t("audio_playback_not_supported")):m.createElement("div",{className:"image-audio"})}}),B=m.createClass({displayName:"MediaStage",mixins:[v],propTypes:{msg:m.PropTypes.instanceOf(o["default"]).isRequired},getInitialState:function(){return{mediaStage:this.async("msg.mediaData.mediaStage")}},onUnsupportedDownloadClick:function(e){var t=this;e.stopPropagation(),b.openModal(m.createElement(P,{onCancel:b.closeModal.bind(b),onOK:function(){b.closeModal(),w.initDownload(t.props.msg)},okText:l10n.t("web_button_download"),cancelText:l10n.t("web_cancel"),title:l10n.t("download_unsupported_media_title")},l10n.t("download_unsupported_media_prompt")))},downloadMedia:function(e){e.stopPropagation(),this.props.msg.forceDownloadMedia()},stopPropagation:function(e){e.stopPropagation()},render:function(){var e=this.props.msg.mediaData,t=null;switch(e.mediaStage){case k.STAGE.RESOLVED:case k.STAGE.ERROR_MISSING:return null;case k.STAGE.ERROR_UNSUPPORTED:return t=this.onUnsupportedDownloadClick,m.createElement(C.Download,{filesize:e.size,onClick:t});case k.STAGE.NEED_POKE:return t=this.downloadMedia,m.createElement(C.Download,{filesize:e.size,onClick:t});default:return t=this.stopPropagation,m.createElement("div",{onClick:t},m.createElement(C.Pending,null))}}});e.exports=L},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(458),s=i(a),r=n(111),o=i(r),l=n(8),c=n(1400),u=n(1373),d=n(1375),p=n(1374),h=n(10),f=n(465),m=n(1491),g=l.createClass({displayName:"MultiVCardModal",propTypes:{msg:l.PropTypes.instanceOf(s["default"]).isRequired},_renderVCard:function(e,t){var n=f.parse(e.vcard);return n?l.createElement(m,{key:t,parsedVCard:n,thumbnail:f.thumbnail(e.vcard),className:"multi-vcard-dialog-contact"}):null},render:function(){var e=this,t=this.props.msg;return l.createElement(c,{type:c.BOX},l.createElement(u,{onCancel:function(){return h.closeModal()}},l.createElement(d,{title:l10n.t("multi_vcard_number_of_contacts",{count:t.vcardList.length,_plural:t.vcardList.length}),type:d.Type.POPUP,onCancel:function(){return h.closeModal()}}),l.createElement(p,null,l.createElement(o["default"],null,l.createElement("div",{className:"multi-vcard-dialog-body"},t.vcardList.map(function(t,n){return e._renderVCard(t,n)}))))))}});e.exports=g},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1370),s=i(a),r=n(1371),o=i(r),l=n(8),c=n(45),u=n(10),d=n(0),p=n(91),h=function(){return[{label:l10n.t("web_mute_8hours"),duration:8},{label:l10n.t("web_mute_1week"),duration:168},{label:l10n.t("web_mute_1year"),duration:8760}]},f=l.createClass({displayName:"MutePopup",propTypes:{onCancel:l.PropTypes.func,onMute:l.PropTypes.func.isRequired,chat:l.PropTypes.instanceOf(s["default"]).isRequired},getInitialState:function(){return{mute:8}},onChange:function(e){this.setState({mute:parseInt(e.target.value,10)})},onMute:function(e){e.stopPropagation(),u.closeModal(),this.props.onMute(3600*this.state.mute+d().unix(),!0)},componentDidMount:function(){p.focus(c.findDOMNode(this.refs.button))},render:function(){var e=this.props.onCancel||function(){u.closeModal()},t=this.state.mute,n=this,i=h().map(function(e){var i=e.duration;return l.createElement("li",{key:"mute-"+i},l.createElement("label",null,l.createElement("input",{type:"radio",name:"duration",value:e.duration,checked:t===i,onChange:n.onChange}),e.label))});return l.createElement("div",{className:"backdrop"},l.createElement("div",{className:"popup-container"},l.createElement("div",{className:"popup"},l.createElement("div",{className:"popup-body"},l.createElement("div",{className:"popup-title",dir:"auto"},l.createElement(o["default"],{text:l10n.t("mute_time",{name:this.props.chat.title()})})),l.createElement("div",{className:"popup-contents"},l.createElement("form",{ref:"form"},l.createElement("ol",{className:"choices"},i)))),l.createElement("div",{className:"popup-controls"},l.createElement("button",{className:"btn-plain popup-controls-item",onClick:e},l10n.t("web_cancel")),l.createElement("button",{ref:"button",className:"btn-plain btn-default popup-controls-item",onClick:this.onMute},l10n.t("web_menuitem_mute"))))))}});e.exports=f},function(e,t,n){"use strict";var i=n(8),a=n(1373),s=n(1375),r=n(1374),o=n(1405),l=n(1434),c=n(110),u=n(462),d=i.createClass({displayName:"NewGroupDrawer",propTypes:{thumb:i.PropTypes.string,full:i.PropTypes.string,subject:i.PropTypes.string,onBack:i.PropTypes.func.isRequired,onContinue:i.PropTypes.func.isRequired},getInitialState:function(){return{text:this.props.subject||"",thumb:this.props.thumb,full:this.props.full,emojiActive:!1}},componentDidMount:function(){this.refs.emojiInput.restoreFocus()},preventBlur:function(e){e.preventDefault(),e.stopPropagation(),this.refs.emojiInput.restoreFocus()},onImageSet:function(e,t){this.setState({thumb:e,full:t})},onContinue:function(){var e=u.emojify(this.state.text.trim());this.props.onContinue(e,this.state.thumb,this.state.full)},onInputChange:function(e){var t=e.target.value;this.setState({text:t})},render:function(){var e=this.state.text.trim().length>0,t=e?i.createElement("div",{className:"drawer-section drawer-controls"},i.createElement("button",{className:"btn btn-round",onClick:this.onContinue},i.createElement("span",{className:"icon icon-forward-light icon-l"}))):null;return i.createElement(a,{id:"new-group",onCancel:this.props.onBack},i.createElement(s,{title:l10n.t("new_group_flow_title"),type:s.Type.LARGE,onBack:this.props.onBack}),i.createElement(r,{wide:!0},i.createElement("div",{className:"drawer-section"},i.createElement(l,{type:l.Type.GROUP,startImage:this.state.full,onImageSet:this.onImageSet,ref:"photoPicker"})),i.createElement("div",{className:"drawer-section",onMouseDown:this.preventBlur},i.createElement(o,{ref:"emojiInput",value:this.state.text,maxLength:25,showRemaining:!0,onChange:this.onInputChange,placeholder:l10n.t("group_subject"),onEnter:e?this.onContinue:_.noop,supportsEmoji:!0})),i.createElement(c,{transitionName:"btn"},t)))}});e.exports=d},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(111),s=i(a),r=n(8),o=n(1373),l=n(1375),c=n(1374),u=n(1456),d=n(1534),p=n(156),h=n(1376),f=n(9),m=n(10),g=n(461),v=n(91),y=n(233),E=n(13),S=n(157),M=n(110),C=g.genId("max_participant_toast"),b=r.createClass({displayName:"NewGroupParticipantsDrawer",mixins:[p,h],propTypes:{thumb:r.PropTypes.string,full:r.PropTypes.string,subject:r.PropTypes.string.isRequired,onBack:r.PropTypes.func.isRequired,onContinue:r.PropTypes.func.isRequired},getInitialState:function(){var e=this;return this.props.uimContext&&(this.props.uimContext.uimClose=function(){e.onBack()}),{searchText:"",participants:[],shouldFocus:!0,isBusy:!1}},getFilteredContacts:function(){var e=Store.Contact.getFilteredContacts();e=_.difference(e,this.state.participants);var t=this.state.searchText;return t?(t=l10n.accentFold(t),e.filter(function(e){return e.searchMatch(t)})):e},componentDidMount:function(){this.focus()},componentDidUpdate:function(){this.adjustInput()},onKeyDown:function(e){if("Backspace"!==e.key||this.state.searchText||_.isEmpty(this.state.participants))"Enter"===e.key&&_.size(this.state.participants)&&this.onContinue();else{e.preventDefault();var t=this.state.participants;this.setState({participants:t.slice(0,t.length-1),shouldFocus:!0})}},onInput:function(e){this.setState({searchText:e.target.value})},adjustInput:function(){var e=this.refs.input.offsetParent.offsetWidth-10,t=this.refs.sizer.offsetWidth,n=t>e?e:t;this.refs.input.style.width=n+"px";var i;i=e-this.refs.input.offsetLeft-n>0?e-this.refs.input.offsetLeft:e,this.refs.input.style.width=i+"px",this.state.shouldFocus&&this.focus()},onReset:function(){this.setState({searchText:"",shouldFocus:!0})},focus:function(){v.focus(this.refs.input)},onBack:function(){var e=this.props;e.onBack(e.subject,e.thumb,e.full)},onContinue:function(){var e=this.props;e.onContinue(e.subject,e.thumb,e.full,this.state.participants)},onDelete:function(e,t){var n=_.without(this.state.participants,t);this.setState({participants:n,shouldFocus:!n.length})},onContactClick:function(e,t){var n=this,i=_.includes(this.state.participants,t);i?this.removeContact(t):t.isBlocked()?m.openModal(r.createElement(y,{title:l10n.t("add_blocked_title"),onOK:function(){n.unblockAndAddContact(t),m.closeModal()},onCancel:m.closeModal.bind(m),okText:l10n.t("web_yes"),cancelText:l10n.t("web_no")},l10n.t("add_blocked_contact_to_group"))):this.addContact(t)},addContact:function(e){var t=this.state.participants;if(t.length>=f.MAX_GROUP_SIZE){var n=l10n.t("action_group_create_failed_participant",{max:f.MAX_GROUP_SIZE});m.openToast(r.createElement(g,{msg:n,id:C}))}else this.setState({participants:t.concat(e),searchText:"",shouldFocus:!0})},removeContact:function(e){var t=this.state.participants;this.setState({participants:_.without(t,e),shouldFocus:!0})},unblockAndAddContact:function(e){var t=this;this.setState({isBusy:!0}),e.setBlock(!1).checkpoint(this.rejectOnUnmount()).then(function(){t.addContact(e),t.setState({isBusy:!1})})["catch"](E.Unmount,_.noop)["catch"](function(e){t.setState({isBusy:!1})})},onFocusList:function(e){this.refs.list&&(e.preventDefault(),e.stopPropagation(),s["default"].flashFocus=Date.now(),this.refs.list.focusFirst())},onFocusParticipants:function(e){e.repeat||0!==this.refs.input.selectionStart||this.refs.participantList&&(e.preventDefault(),e.stopPropagation(),s["default"].flashFocus=null,this.refs.participantList.focusLast())},onSelectFirst:function(e){e.preventDefault(),e.stopPropagation();var t=_.head(this.getFilteredContacts());t&&this.onContactClick(e,t)},onFocusSearch:function(e){s["default"].flashFocus=Date.now(),v.focus(this.refs.input)},render:function(){var e=void 0;this.state.isBusy?e=r.createElement(S,null):_.size(this.state.participants)&&(e=r.createElement("button",{className:"btn btn-round",onClick:this.onContinue},r.createElement("span",{className:"icon icon-checkmark-light"})));var t=_.size(this.state.participants)?" ":l10n.t("group_participant_hint"),n={down:this.onFocusList,enter:this.state.searchText?this.onSelectFirst:_.size(this.state.participants)?this.onContinue:_.noop,up:this.onFocusParticipants};return n[l10n.LR("left","right")]=this.onFocusParticipants,r.createElement(o,{id:"new-group",onCancel:this.onBack},r.createElement(l,{title:l10n.t("add_group_participants_title"),type:l.Type.LARGE,onBack:this.onBack}),r.createElement(c,null,r.createElement("div",{className:"drawer-section new-group-search"},r.createElement("div",{className:"input-clear input-ext"},r.createElement(s["default"],{handlers:n,className:"input input-line"},r.createElement("div",{className:"list-names list-deletable new-group-preview"},r.createElement("div",{className:"new-group-participants","data-list-scroll-container":!0},r.createElement(d,{ref:"participantList",contacts:this.state.participants,onDelete:this.onDelete,onFocusSearch:this.onFocusSearch}))),r.createElement("input",{className:"inputarea",ref:"input",placeholder:t,onKeyDown:this.onKeyDown,onChange:this.onInput,value:this.state.searchText}),r.createElement("span",{className:"inputarea-sizer",ref:"sizer"},this.state.searchText)))),r.createElement("div",{className:"new-group-contacts","data-list-scroll-container":!0},r.createElement(u,{ref:"list",contacts:this.getFilteredContacts(),onFocusSearch:this.onFocusSearch,onClick:this.onContactClick})),r.createElement(M,{transitionName:"btn",className:"drawer-section drawer-controls"},e)))}});e.exports=b},function(e,t,n){"use strict";var i=n(8),a=n(1373),s=n(1375),r=n(1374),o=n(1634),l=i.createClass({displayName:"NotificationsDrawer",propTypes:{onClose:i.PropTypes.func.isRequired},render:function(){return i.createElement(a,{onCancel:this.onBack,id:"notifications"},i.createElement(s,{a8n:"drawer-title-notifications",title:l10n.t("notifications_drawer_title"),onBack:this.props.onClose,type:s.Type.LARGE}),i.createElement(r,{wide:!0},i.createElement(o,{key:"notifications"})))}});e.exports=l},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(111),s=i(a),r=n(8),o=n(160),l=n(233),c=n(10),u=n(241),d=n(482),p=n(33),h=n(1405),f=n(461),m=320,g=50,v=10,y=500,E=r.createClass({displayName:"SendLogsPopup",mixins:[o],getInitialState:function(){return{email:"",emailError:void 0,confirmEmail:"",confirmEmailError:void 0,subject:l10n.t("send_logs_default_subject"),subjectError:void 0,description:"",descriptionError:void 0}},componentDidMount:function(){this.refs.emailAddr.restoreFocus()},onSend:function(){var e={},t=this.state.email.trim(),n=this.state.confirmEmail.trim();if(this.validateEmail(t)||(e.emailError=l10n.t("send_logs_email_invalid")),this.validateConfirmEmail(n)||(e.confirmEmailError=l10n.t("send_logs_email_nomatch")),this.validateDescription()||(e.descriptionError=l10n.t("send_logs_too_short")),this.validateSubject()||(e.subjectError=l10n.t("send_logs_subject_error")),_.isEmpty(e)){this.setState({email:t,confirmEmail:n,emailError:void 0,confirmEmailError:void 0,descriptionError:void 0,subjectError:void 0});var i=Store.Conn.me?d.format(Store.Conn.me.split("@")[0]):null,a=this.state.subject.trim()||l10n.t("send_logs_default_subject");p.uploadUserReport(i,t,a,this.state.description),c.closeModal(),c.openToast(r.createElement(f,{msg:l10n.t("send_logs_sent"),id:f.genId()}))}else e.email=t,e.confirmEmail=n,this.setState(e)},onCancel:function(){c.closeModal()},onSubjectChange:function(e){var t={subject:e.target.value};this.state.subjectError&&this.validateSubject(t.subject)&&(t.subjectError=void 0),this.setState(t)},onSubjectBlur:function(){var e=void 0;this.validateSubject()||(e=l10n.t("send_logs_subject_error")),this.state.subjectError!==e&&this.setState({subjectError:e})},onDescriptionChange:function(e){var t={description:e.target.value};this.state.descriptionError&&this.validateDescription(t.description)&&(t.descriptionError=void 0),this.setState(t)},onDescriptionBlur:function(){var e=void 0;!this.state.description&&!this.state.descriptionError||this.validateDescription()||(e=l10n.t("send_logs_too_short")),this.state.descriptionError!==e&&this.setState({descriptionError:e})},onEmailChange:function(e){var t={email:e.target.value};this.state.emailError&&this.validateEmail(t.email)&&(t.emailError=void 0),this.setState(t)},onEmailBlur:function(){var e=void 0,t=this.state.email.trim(),n={};!this.state.email&&!this.state.emailError||this.validateEmail(t)||(e=l10n.t("send_logs_email_invalid")),this.state.emailError!==e&&(n.emailError=e),this.state.email!==t&&(n.email=t),_.isEmpty(n)||this.setState(n)},onConfirmEmailChange:function(e){var t={confirmEmail:e.target.value};this.state.confirmEmailError&&this.validateConfirmEmail(t.confirmEmail)&&(t.confirmEmailError=void 0),this.setState(t)},onConfirmEmailBlur:function(){var e=void 0,t=this.state.confirmEmail.trim(),n={};!this.state.confirmEmail&&!this.state.confirmEmailError||this.validateConfirmEmail(t)||(e=l10n.t("send_logs_email_nomatch")),this.state.confirmEmailError!==e&&(n.confirmEmailError=e),this.state.confirmEmail!==t&&(n.confirmEmail=t),_.isEmpty(n)||this.setState(n)},validateEmail:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state.email;return u.validateEmail(e)},validateConfirmEmail:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state.confirmEmail;return this.state.email===e},validateDescription:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state.description;
return e.length>v},validateSubject:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state.subject;return!0},stopPropagation:function(e){e.stopPropagation()},render:function(){var e={enter:this.stopPropagation};return r.createElement(l,{title:l10n.t("send_logs_title"),okText:l10n.t("send_logs_confirm"),onOK:this.onSend,onCancel:this.onCancel},r.createElement(s["default"],{handlers:e},r.createElement(h,{className:"send-logs-input",ref:"emailAddr",value:this.state.email,error:this.state.emailError,maxLength:m,onChange:this.onEmailChange,onBlur:this.onEmailBlur,placeholder:l10n.t("send_logs_email_address")}),r.createElement(h,{className:"send-logs-input",editable:!0,value:this.state.confirmEmail,error:this.state.confirmEmailError,maxLength:m,onChange:this.onConfirmEmailChange,onBlur:this.onConfirmEmailBlur,placeholder:l10n.t("send_logs_email_confirm")}),r.createElement(h,{className:"send-logs-input",value:this.state.subject,error:this.state.subjectError,maxLength:g,onChange:this.onSubjectChange,onBlur:this.onSubjectBlur,placeholder:l10n.t("send_logs_email_subject")}),r.createElement(h,{className:"send-logs-input",value:this.state.description,error:this.state.descriptionError,maxLength:y,onChange:this.onDescriptionChange,onBlur:this.onDescriptionBlur,placeholder:l10n.t("describe_logs"),multiline:!0})))}});e.exports=E},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(1427),m=(i(f),n(1377)),g=i(m),v=n(1371),y=i(v),_=n(8),E=n(1373),S=n(1375),M=n(1374),C=n(1406),b=n(159),T=n(1379),P=n(9),k=function(e){function t(){var e,n,i,a;(0,o["default"])(this,t);for(var r=arguments.length,l=Array(r),c=0;r>c;c++)l[c]=arguments[c];return n=i=(0,d["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(l))),i.status=window.Store.Status.gaddUp(i.props.profileId),a=n,(0,d["default"])(i,a)}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentWillMount",value:function(){this.props.listeners.add(this.status,"change:status")}},{key:"render",value:function(){var e=P.STATUS_V2?_.createElement("div",{className:"chat-status"},_.createElement("span",{className:"emojitext ellipsify",dir:"auto"},_.createElement(y["default"],{text:this.status.status||b.t("contact_status_loading"),direction:"auto"}))):null;return _.createElement(E,{id:"settings",onCancel:this.props.onClose},_.createElement(S,{title:b.t("settings_flow_title"),onBack:this.props.onClose,type:S.Type.LARGE}),_.createElement(M,null,_.createElement("div",{className:"chatlist list-identity"},_.createElement("div",{className:"chat",onClick:this.props.onProfile,"data-ignore-capture":"any"},_.createElement("div",{className:"chat-avatar"},_.createElement(T,{id:window.Store.Conn.me,size:82,quality:T.Quality.HIGH})),_.createElement("div",{className:"chat-body"},_.createElement("div",{className:"chat-main"},_.createElement("div",{className:"chat-title"},_.createElement("span",{className:"emojitext ellipsify",dir:"auto"},_.createElement(y["default"],{text:window.Store.Conn.pushname,direction:"auto"})))),e))),_.createElement("div",{className:"chatlist list-icons list-actions"},_.createElement(C,{a8n:"li-notifications",iconClass:"icon-settings-notifications",onClick:this.props.onNotifications},b.t("menuitem_notifications")),_.createElement(C,{a8n:"li-chat_wallpaper",iconClass:"icon-settings-wallpaper",onClick:this.props.onWallpaper},b.t("menuitem_wallpaper")),_.createElement(C,{a8n:"li-blocked",iconClass:"icon-settings-blocked",onClick:this.props.onBlocked},b.t("menuitem_blocked")),_.createElement(C,{a8n:"li-help",iconClass:"icon-settings-help",onClick:this.props.onHelp},b.t("menuitem_help")))))}}]),t}(_.Component);t["default"]=(0,g["default"])(k)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(1444),m=i(f),g=n(18),v=i(g),y=n(458),_=(i(y),n(8)),E=n(462),S=n(1476),M=n(1442),C=n(467),b=n(234),T=n(1397),P=n(1440),k=n(110),N=n(44),w=n(159),x=function(e){function t(){(0,o["default"])(this,t);var e=(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments));return e.state={replyCaption:void 0,focused:!1,emojiPicker:void 0,chat:void 0},e.onReplyCaptionChangeHandler=e.onReplyCaptionChange.bind(e),e.onSendHandler=e.onSend.bind(e),e.onFocus=e.onFocus.bind(e),e.onBlur=e.onBlur.bind(e),e.onEmojiPicker=e.onEmojiPicker.bind(e),e.onEmoji=e.onEmoji.bind(e),e.restoreFocus=e.restoreFocus.bind(e),e.restoreEmojiPickerFocus=e.restoreEmojiPickerFocus.bind(e),e.emojiPickerClose=e.emojiPickerClose.bind(e),e.isFocused=e.isFocused.bind(e),Store.Chat.find(e.props.msg.sender).checkpoint(e.props.rejectOnUnmount()).then(function(t){e.setState({chat:t})}),e}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentDidUpdate",value:function(e,t){this.shouldPausePlayback(t)&&!this.shouldPausePlayback(this.state)?this.props.playbackController.resume():!this.shouldPausePlayback(t)&&this.shouldPausePlayback(this.state)&&this.props.playbackController.pause()}},{key:"shouldPausePlayback",value:function(e,t){return e.emojiPicker||e.focused}},{key:"onReplyCaptionChange",value:function(e){this.setState({replyCaption:e.target.value})}},{key:"onSend",value:function(e){var t=this;if(e.preventDefault(),this.state.replyCaption){var n=this.state.replyCaption.trim();n.length&&(Store.Chat.find(this.props.msg.sender).then(function(e){e.sendMessage(E.emojify(n),{},t.props.msg)}),this.setState({replyCaption:void 0}),this.props.dismissReply())}}},{key:"onFocus",value:function(e){this.setState({focused:!0})}},{key:"onBlur",value:function(e){this.setState({focused:!1}),console.log("compose box blur")}},{key:"isFocused",value:function(){return this.state.focused}},{key:"onEmojiPicker",value:function(e){e&&(e.preventDefault(),e.stopPropagation());var t=_.createElement(M,{onEmoji:this.onEmoji,onFocusRelease:this.restoreFocus});this.setState({emojiPicker:{menu:t,menuDirection:{y:C.Direction.Y.TOP},type:C.Type.EMOJI_PICKER,anchor:e.target}})}},{key:"onEmoji",value:function(e){this.refs.inputLine.restoreFocus(!1),this.refs.inputLine.replaceSelection(e)}},{key:"restoreFocus",value:function(){this.refs.inputLine&&this.refs.inputLine.restoreFocus()}},{key:"restoreEmojiPickerFocus",value:function(){this.refs.emojiPickerUIE&&this.refs.emojiPickerUIE.getRef()&&this.refs.emojiPickerUIE.getRef().getElement()&&this.refs.emojiPickerUIE.getRef().getElement().restoreFocus()}},{key:"emojiPickerClose",value:function(){this.setState({emojiPicker:void 0})}},{key:"render",value:function(){var e,t=N("status-v3-compose-box-wrapper",{focused:this.state.focused});v["default"].isEmpty(this.state.replyCaption)&&(e=w.t("type_a_reply"));var n=void 0,i=void 0;this.state.emojiPicker&&(n=_.createElement(b,{displayName:"EmojiPicker",escapable:!0,popable:!0,ref:"emojiPickerUIE",requestDismiss:this.emojiPickerClose,requestFocus:this.restoreEmojiPickerFocus},_.createElement(T,{contextMenu:this.state.emojiPicker})),i=_.createElement(b,{displayName:"EmojiPicker",escapable:!0,requestFocus:this.restoreEmojiPickerFocus},_.createElement("div",null,n)));var a=void 0;return this.state.chat&&this.state.focused&&!this.state.emojiPicker&&(a=_.createElement(b,{displayName:"StatusV3Reply",escapable:!0,requestDismiss:this.props.dismissReply},_.createElement("div",{className:"compose-popup-panel"},_.createElement(P,{msg:this.props.msg,key:this.props.msg.id.toString(),chat:this.state.chat})))),_.createElement("div",null,_.createElement(k,{transitionName:"status-v3-quoted-msg",transitionAppear:!0},a),_.createElement("div",{className:t},_.createElement("button",{className:"icon icon-emoji icon-status-v3-smiley",onClick:this.onEmojiPicker}),_.createElement("div",{className:"status-v3-input-line-wrapper"},_.createElement(S,{ref:"inputLine",value:this.state.replyCaption,className:"input-text",spellCheck:!0,onFocus:this.onFocus,onBlur:this.onBlur,onChange:this.onReplyCaptionChangeHandler,onEnter:this.onSendHandler,editable:!0,focusOnMount:!1,focusOnChange:!1}),_.createElement("span",{className:"status-v3-input-placeholder"},e)),_.createElement("button",{className:"icon btn-icon icon-send-light",onClick:this.onSendHandler}),i))}}]),t}(_.Component);e.exports=(0,m["default"])(x)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(94),s=i(a),r=n(16),o=i(r),l=n(4),c=i(l),u=n(6),d=i(u),p=n(20),h=i(p),f=n(19),m=i(f),g=n(8),v=i(g),y=n(1460),_=i(y),E=n(1689),S=i(E),M=n(1391),C=(i(M),n(458)),b=(i(C),n(1377)),T=i(b),P=n(1505),k=i(P),N=n(159),w=i(N),x=n(76),O=i(x),D=n(1),R=i(D),I=n(18),A=i(I),L=n(44),F=i(L),U=0,j=1,G=function(e){function t(){var e,n,i,a;(0,c["default"])(this,t);for(var r=arguments.length,l=Array(r),u=0;r>u;u++)l[u]=arguments[u];return n=i=(0,h["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(l))),i.state={statusList:[].concat((0,s["default"])(i.getStatusList(!0)),(0,s["default"])(i.getStatusList(!1))),myStatus:Store.StatusV3.getMyStatus()},i.getSections=function(){var e=[U];return i.state.statusList.length&&e.push(j),e},i.numberOfSections=function(){return i.getSections().length},i.numberOfRowsInSection=function(e){var t=i.getSections();switch(t[e]){case U:return 1;case j:return i.state.statusList.length;default:R["default"].error("Unknown section "+t[e])()}},i.sectionForSection=function(e){var t=i.getSections();switch(t[e]){case U:return;case j:return v["default"].createElement("div",{className:"status-v3-list-section-sep"},v["default"].createElement("hr",null),v["default"].createElement("div",{className:"status-v3-list-section-text"},v["default"].createElement("span",null,w["default"].t("status_v3_updates"))))}},i.heightForItem=function(e){var t=e.section,n=i.getSections();switch(n[t]){case U:return 122;case j:return 64}return 0},i.heightForSection=function(e){var t=i.getSections();switch(t[e]){case j:return 42;case U:return 0}},i.keyForRowAtIndexPath=function(e){var t=e.row,n=e.section,a=i.getSections();switch(a[n]){case U:return"STATUS_V3_HEADER "+(i.state.myStatus?i.state.myStatus.t:"");case j:return i.state.statusList[t].id}},i.itemForRowAtIndexPath=function(e){var t=e.row,n=e.section,a=i.getSections();switch(a[n]){case U:var s=void 0,r=void 0;i.state.myStatus?(r=v["default"].createElement("span",{className:"secondary"},O["default"].relativeDateAndTimeStr(i.state.myStatus.t)),s=v["default"].createElement(k["default"],{statusV3:i.state.myStatus,onClick:function(){i.props.onOpenStatus(i.state.myStatus,i.state.myStatus.msgs.at(0))}})):s=v["default"].createElement("button",{className:"icon icon-status-v3-create-l"});var o=v["default"].createElement("div",{className:"status-v3-list-panel-header"},v["default"].createElement("div",{className:"status-v3-list-panel-header-buttons-primary"},s),v["default"].createElement("div",{className:"status-v3-list-panel-header-text"},v["default"].createElement("span",{className:"primary"},w["default"].t("status_v3_my_status")),r),v["default"].createElement("div",{className:"status-v3-list-panel-header-buttons-secondary"},v["default"].createElement("button",{className:"icon icon-status-v3-create"}),v["default"].createElement("button",{className:"icon icon-menu-white"})));return o;case j:var l=function(){var e=i.state.statusList[t],n=(0,F["default"])({dimmed:0===e.unreadCount}),a=v["default"].createElement("div",{className:n},v["default"].createElement(S["default"],{statusV3:e,onClick:function(){return i.props.onOpenStatus(e)},contact:e.contact}));return{v:a}}();if("object"==typeof l)return l.v}},i.onStatusAddRemove=function(){i.setState({statusList:A["default"].concat(i.getStatusList(!0),i.getStatusList(!1)),myStatus:Store.StatusV3.getMyStatus()})},a=n,(0,h["default"])(i,a)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentWillMount",value:function(){this.props.listeners.add(Store.StatusV3,"add remove change:unreadCount",this.onStatusAddRemove)}},{key:"getStatusList",value:function(e){return Store.StatusV3.getUnexpired(e)}},{key:"render",value:function(){return v["default"].createElement("div",{className:"status-v3-list-panel","data-list-scroll-container":!0},v["default"].createElement("div",{className:"status-v3-list-body"},v["default"].createElement(_["default"],{className:"statuslist",itemForRowAtIndexPath:this.itemForRowAtIndexPath,keyForRowAtIndexPath:this.keyForRowAtIndexPath,sectionForSection:this.sectionForSection,numberOfRowsInSection:this.numberOfRowsInSection,numberOfSections:this.numberOfSections,heightForSection:this.heightForSection,heightForItem:this.heightForItem})))}}]),t}(v["default"].Component);t["default"]=(0,T["default"])(G)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(1655),m=i(f),g=n(1657),v=i(g),y=n(1391),_=(i(y),n(458)),E=(i(_),n(1377)),S=i(E),M=n(8),C=function(e){function t(e){(0,o["default"])(this,t);var n=(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).call(this,e));return n.state={status:Store.StatusV3.getMyStatus()},n.onStatusAddRemove=n.onStatusAddRemove.bind(n),n}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"shouldComponentUpdate",value:function(e,t){return t.status!==this.state.status}},{key:"componentWillMount",value:function(){this.props.listeners.add(Store.StatusV3,"add remove change:unreadCount",this.onStatusAddRemove)}},{key:"render",value:function(){var e=this,t=this.props.onOpenStatus;return M.createElement("div",{className:"status-v3-modal-background"},M.createElement("div",{className:"status-v3-main-wrapper"},M.createElement(m["default"],{onOpenStatus:t}),M.createElement(v["default"],{status:this.state.status,onOpenStatus:t}),M.createElement("button",{className:"icon icon-status-v3-x",onClick:function(){return e.props.closeStatusViewer(!0)}})))}},{key:"onStatusAddRemove",value:function(){this.setState({status:Store.StatusV3.getMyStatus()})}}]),t}(M.Component);t["default"]=(0,S["default"])(C)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(159),m=i(f),g=n(18),v=i(g),y=n(1391),_=(i(y),n(458)),E=(i(_),n(1377)),S=i(E),M=n(1444),C=i(M),b=n(76),T=i(b),P=n(8),k=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){var e=void 0;return this.props.status&&(e=P.createElement(w,{statusV3:this.props.status,onOpenStatus:this.props.onOpenStatus})),P.createElement("div",{className:"status-v3-out-status-panel"},P.createElement("div",{className:"status-v3-update-wrapper"},P.createElement("div",{className:"status-v3-update-title"},m["default"].t("status_v3_update_status")),P.createElement("div",{className:"status-v3-upload-buttons"},P.createElement("div",{className:"status-v3-button-container"},P.createElement("button",{className:"icon icon-status-v3-upload"}),P.createElement("p",null,m["default"].t("status_v3_upload"))),P.createElement("div",{className:"status-v3-button-container"},P.createElement("button",{className:"icon icon-status-v3-camera"}),P.createElement("p",null,m["default"].t("status_v3_camera"))))),P.createElement("hr",null),e)}}]),t}(P.Component),N=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentWillMount",value:function(){this.props.listeners.add(this.props.statusV3.msgs,"add remove bulk_add"),this.props.listeners.add(this.props.statusV3.msgs,"change:last")}},{key:"render",value:function(){var e=this,t=void 0,n=this.props.statusV3;if(n&&n.msgs){var i=v["default"].reverse(v["default"].takeRight(n.msgs.models,n.totalCount));t=v["default"].map(i,function(t){return P.createElement(O,{key:t.id,msg:t,status:n,onOpenStatus:e.props.onOpenStatus})})}return P.createElement("div",{className:"status-v3-view-wrapper"},P.createElement("div",{className:"status-v3-view-title"},m["default"].t("status_v3_view_status")),P.createElement("div",{className:"status-v3-view-updates"},t))}}]),t}(P.Component),w=(0,S["default"])(N),x=function(e){function t(){(0,o["default"])(this,t);var e=(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments));return e.state={},e}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentWillMount",value:function(){var e=this;Store.MsgInfo.find(this.props.msg.id).checkpoint(this.props.rejectOnUnmount).then(function(t){e.props.listeners.add(t.read,"add remove",function(){e.setState({seenCount:t.read.length})}),e.setState({seenCount:t.read.length})})}},{key:"render",value:function(){var e=this,t=this.props,n=t.msg,i=t.status,a={backgroundImage:"url("+n.mediaData.preview.url()+")"};return P.createElement("div",{className:"status-v3-out-detail"},P.createElement("div",{className:"status-image",style:a,onClick:function(){return e.props.onOpenStatus(i,n)}}),P.createElement("div",{className:"status-v3-seen"},P.createElement("button",{className:"icon icon-status-v3-seen"}),P.createElement("div",{className:"status-v3-seen-count"},this.state.seenCount)),P.createElement("div",{className:"status-v3-timestamp"},T["default"].relativeDateAndTimeStr(n.t)))}}]),t}(P.Component),O=(0,C["default"])((0,S["default"])(x));t["default"]=k},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(8),m=i(f),g=n(1378),v=i(g),y=n(1395),_=i(y),E=n(1422),S=i(E),M=n(1371),C=i(M),b=n(1693),T=i(b),P=n(1692),k=n(111),N=i(k),w=n(157),x=i(w),O=n(458),D=(i(O),n(1391)),R=(i(D),n(1370)),I=(i(R),n(45)),A=n(44),L=n(1654),F=n(1379),U=n(234),j=n(92),G=n(1390),B=n(235),H=n(76),V=n(1),q=function(e){function t(){(0,o["default"])(this,t);var e=(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments));e.state={chat:void 0};var n=e.props.msg.mediaData;return n.type===B.TYPE.IMAGE?e.playbackController=new P.StatusV3CountdownController(3750):n.type===B.TYPE.VIDEO&&(e.props.msg.isGif?e.playbackController=new P.StatusV3GifController:e.playbackController=new P.StatusV3VideoController),e.onTab=e.onTab.bind(e),e.startReply=e.startReply.bind(e),e.dismissReply=e.dismissReply.bind(e),e}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentWillMount",value:function(){var e=this.props.msg.mediaData;e.mediaStage!==B.STAGE.RESOLVED&&this.props.msg.forceDownloadMedia()}},{key:"componentDidMount",value:function(){var e=this,t=this.refs.progressBar;this.playbackController.addListeners(t.onStart.bind(t),t.onPause.bind(t),function(){t.onEnded()["finally"](function(){e.props.onNext()})}),this.props.media.mediaStage===B.STAGE.RESOLVED&&(this.playbackController.play(),this.props.markRead(this.props.statusV3,this.props.msg));var n=I.findDOMNode(this.refs.wrapper);n.focus()}},{key:"componentDidUpdate",value:function(){this.props.media.mediaStage===B.STAGE.RESOLVED&&(this.playbackController.play(),this.props.markRead(this.props.statusV3,this.props.msg))}},{key:"componentWillUnmount",value:function(){this.playbackController.stop()}},{key:"onTab",value:function(e){if(e&&(e.stopPropagation(),e.preventDefault()),!this.props.statusV3.contact.isMe){var t=this.refs.composeBox.refs.component;t.isFocused()?this.dismissReply():this.startReply()}}},{key:"dismissReply",value:function(){var e=I.findDOMNode(this.refs.wrapper);e.focus()}},{key:"startReply",value:function(){var e=this.refs.composeBox.refs.component;e.restoreFocus()}},{key:"render",value:function(){var e,t=this,n=this.props.msg,i=this.props.statusV3,a=n.mediaData;a&&a.preview&&(e={backgroundImage:"url("+a.preview.url()+")"});var s;switch(a.type){case B.TYPE.IMAGE:s=m["default"].createElement(z,{ref:"media",media:n.mediaData,playbackController:this.playbackController});break;case B.TYPE.VIDEO:s=m["default"].createElement(K,{ref:"media",media:n.mediaData,msg:n,playbackController:this.playbackController});break;default:V.error("Invalid status v3 image type: "+a.type)()}var r=m["default"].createElement(T["default"],{ref:"progressBar",current:this.props.msgIdx,total:this.props.totalMsgs}),o=m["default"].createElement(C["default"],{ref:"caption",className:"media-caption",text:n.caption}),l=function(e){e||t.props.closeStatusViewer()},c=A("status-v3-profile",{}),u=m["default"].createElement("div",{className:c},m["default"].createElement("button",{className:"icon icon-back-light",onClick:function(){return t.props.closeStatusViewer()}}),m["default"].createElement(F,{id:i.contact.id,size:40}),m["default"].createElement("div",{className:"status-v3-msg-info"},m["default"].createElement(C["default"],{text:i.contact.formattedName}),m["default"].createElement("div",{className:"status-v3-timestamp"},H.relativeDateAndTimeStr(n.t)))),d=m["default"].createElement("button",{className:"icon icon-status-v3-x",onClick:function(){return t.props.closeStatusViewer(!0)}}),p={tab:this.onTab,"shift+tab":this.onTab},h=function(e){return e.stopPropagation()},f={left:h,right:h},g=this.props.media.mediaStage!==B.STAGE.RESOLVED,v=A("status-v3-player-content",{loading:g}),y=void 0;g&&(y=m["default"].createElement("div",{className:"media-state-controls"},m["default"].createElement("button",{className:"icon-media icon-media-disabled"},m["default"].createElement(x["default"],{size:50,stroke:4}))));var _=void 0;return this.props.statusV3.contact.isMe||(_=m["default"].createElement(N["default"],{handlers:f},m["default"].createElement(L,{msg:this.props.msg,dismissReply:this.dismissReply,playbackController:this.playbackController,ref:"composeBox"}))),m["default"].createElement(U,{displayName:"StatusV3Player",escapable:!0,requestDismiss:l,requestFocus:this.dismissReply},m["default"].createElement(N["default"],{handlers:p},m["default"].createElement("div",{className:"status-v3-player-wrapper",key:n.id,tabIndex:-1,ref:"wrapper"},u,d,m["default"].createElement("div",{className:"progress-bar-backdrop"}),r,m["default"].createElement("div",{className:"caption-backdrop"},o),m["default"].createElement("div",{className:"status-v3-player-background",style:e}),m["default"].createElement("div",{className:v},s),y,_)))}}]),t}(m["default"].Component);q.CONCERNS={media:["mediaStage"]},q.contextTypes={uim:m["default"].PropTypes.instanceOf(j)};var W=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){var e=this.props.media;return e.mediaStage===B.STAGE.RESOLVED?m["default"].createElement(G,{type:G.TYPES.CONTAIN,size:{width:e.fullWidth,height:e.fullHeight}},m["default"].createElement(_["default"],{src:e.renderableUrl})):m["default"].createElement(G,{type:G.TYPES.CONTAIN,size:{width:e.aspectRatio,height:1}},m["default"].createElement(_["default"],{src:e.preview.url()}))}}]),t}(m["default"].PureComponent);W.CONCERNS={media:["mediaStage","renderableUrl","preview","fullWidth","fullHeight","aspectRatio"]};var z=(0,v["default"])(W),Y=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){var e=this.props.media,t=e.preview?e.preview.url():void 0;return m["default"].createElement(S["default"],{msg:this.props.msg,ref:"player",poster:t})}},{key:"componentDidMount",value:function(){var e=I.findDOMNode(this.refs.player),t=this.props.playbackController;t.setVideo(e)}}]),t}(m["default"].Component);Y.CONCERNS={media:["preview"]};var K=(0,v["default"])(Y);e.exports=(0,v["default"])(q)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(8),m=i(f),g=n(1),v=i(g),y=n(111),_=i(y),E=n(1658),S=i(E),M=n(1391),C=(i(M),n(458)),b=(i(C),n(110)),T=n(18),P=n(235),k=function(e){function t(){(0,o["default"])(this,t);var e=(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments));e.statusSnapshot=e.getStatusSnapshot(e.props.initialStatusV3);var n=e.getFirstUnread(e.props.initialStatusV3,!0,e.props.initialStatusMsg);return n?e.state=n:v["default"].error("Status viewer initialization failed: getFirstUnread for initial status v3 returned null"),e.onNext=e.onNext.bind(e),e.onPrev=e.onPrev.bind(e),e.getNext=e.getNext.bind(e),e.getPrev=e.getPrev.bind(e),e.markRead=e.markRead.bind(e),e}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentDidMount",value:function(){this.preloadNextStatus()}},{key:"componentDidUpdate",value:function(){this.preloadNextStatus()}},{key:"render",value:function(){var e=this,t=this.statusSnapshot[this.state.statusIdx],n=t.statusV3,i=t.msgs[this.state.msgIdx],a=void 0,s=void 0;this.getPrev()&&(a=m["default"].createElement("button",{className:"icon icon-chevron-left"}),s=m["default"].createElement("div",{className:"icon-chevron-left-bg",onClick:this.onPrev}));var r=void 0,o=void 0;this.getNext()&&(r=m["default"].createElement("button",{className:"icon icon-chevron-right"}),o=m["default"].createElement("div",{className:"icon-chevron-right-bg",onClick:function(){e.onNext(),e.markRead(n,i)}}));var l={left:this.onPrev,right:this.onNext};return m["default"].createElement(_["default"],{handlers:l},m["default"].createElement("div",{className:"status-v3-viewer"},s,a,o,r,m["default"].createElement(b,{transitionName:"status-v3-player",transitionAppear:!0},m["default"].createElement("div",{className:"status-v3-player-container",key:n.id},m["default"].createElement(S["default"],{key:i.id,statusV3:n,msg:i,media:i.mediaData,msgIdx:this.state.msgIdx,totalMsgs:t.msgs.length,markRead:this.markRead,closeStatusViewer:this.props.closeStatusViewer,onNext:this.onNext,onPrev:this.onPrev})))))}},{key:"preloadNextStatus",value:function(){var e=this.getNext();if(e){var t=this.statusSnapshot[e.statusIdx],n=t.msgs[e.msgIdx],i=n.mediaData;i.mediaStage!==P.STAGE.RESOLVED&&n.forceDownloadMedia()}}},{key:"getStatusSnapshot",value:function(e){if(!(e.unreadCount>0)||e.contact.isMe){var t=T.takeRight(e.msgs.models,e.totalCount),n=T.map(t,function(e){return e.id}),i=[{statusV3:e,msgs:t,readMsgKeys:n}];return i}var a=function(){var e=Store.StatusV3.getUnexpired(!0),t=[];return T.forEach(e,function(e){var n=T.takeRight(e.msgs.models,e.totalCount),i=T.take(n,e.totalCount-e.unreadCount),a=T.map(i,function(e){return e.id});t.push({statusV3:e,msgs:n,readMsgKeys:a})}),{v:t}}();return"object"==typeof a?a.v:void 0}},{key:"getFirstUnread",value:function(e,t,n){var i=this,a=T.findIndex(this.statusSnapshot,{statusV3:e});if(-1===a)return v["default"].error("StatusV3 object not found in playback session")(),null;var s=function(){var e=i.statusSnapshot[a],s=e.readMsgKeys,r=void 0;return r=n?T.findIndex(e.msgs,function(e){return e===n}):T.findIndex(e.msgs,function(e){return-1===s.indexOf(e.id)}),-1===r&&(r=t?0:e.msgs.length-1),{v:{statusIdx:a,msgIdx:r}}}();return"object"==typeof s?s.v:void 0}},{key:"markRead",value:function(e,t){e.sendReadStatus(t.id,t.author);var n=T.find(this.statusSnapshot,{statusV3:e});n&&n.readMsgKeys.push(t.id)}},{key:"getNext",value:function(){var e=this.statusSnapshot[this.state.statusIdx];if(this.state.msgIdx+1<e.msgs.length)return{statusIdx:this.state.statusIdx,msgIdx:this.state.msgIdx+1};if(this.state.statusIdx+1<this.statusSnapshot.length){var t=this.statusSnapshot[this.state.statusIdx+1],n=this.getFirstUnread(t.statusV3,!0);return n}return null}},{key:"onNext",value:function(){var e=this.getNext();e?this.setState(e):this.props.closeStatusViewer()}},{key:"getPrev",value:function(){if(this.state.msgIdx>0)return{statusIdx:this.state.statusIdx,msgIdx:this.state.msgIdx-1};if(this.state.statusIdx>0){var e=this.statusSnapshot[this.state.statusIdx-1],t=this.getFirstUnread(e.statusV3,!1);return t}return null}},{key:"onPrev",value:function(){var e=this.getPrev();e&&this.setState(e)}}]),t}(m["default"].Component);e.exports=k},function(e,t,n){"use strict";var i=n(8),a=n(156),s=n(10),r=n(15),o=i.createClass({displayName:"TermsOfServiceModal",mixins:[a],componentDidMount:function(){this.addObserver(Store.Conn,"change:tos",this.close)},close:function(){0===Store.Conn.tos&&s.closeModal()},logout:function(){s.closeModal(),r.logout()},render:function(){var e,t=null;switch(Store.Conn.tos){default:case 1:e=l10n.t("web_terms_of_service_1"),t=i.createElement("div",{className:"popup-controls"},i.createElement("button",{className:"btn-plain btn-default popup-controls-item",onClick:s.closeModal.bind(s)},l10n.t("ok_got_it")));break;case 2:e=l10n.t("web_terms_of_service_2"),t=i.createElement("div",{className:"popup-controls"},i.createElement("button",{className:"btn-plain popup-controls-item",onClick:this.logout},l10n.t("menuitem_logout")))}return i.createElement("div",{className:"backdrop"},i.createElement("div",{className:"popup-container"},i.createElement("div",{className:"popup"},i.createElement("div",{className:"popup-body"},i.createElement("div",{className:"popup-contents"},e)),t)))}});e.exports=o},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1370),s=i(a),r=n(458),o=i(r),l=n(1371),c=i(l),u=n(8),d=n(10),p=n(233),h=u.createClass({displayName:"UnstarAllPopup",propTypes:{chat:u.PropTypes.instanceOf(s["default"]),msgs:u.PropTypes.arrayOf(u.PropTypes.instanceOf(o["default"]))},onCancel:function(){d.closeModal()},onUnstar:function(){var e=this.props.chat,t=this.props.msgs;e&&e.pendingAction++,Store.Chat.unstarAllMessages(t,e)["finally"](function(){e&&e.pendingAction--}),d.closeModal()},render:function(){return u.createElement(p,{title:l10n.t("are_you_sure"),onOK:this.onUnstar,okText:l10n.t("unstar_all_button"),onCancel:this.onCancel},u.createElement("div",null,u.createElement(c["default"],{text:l10n.t("unstar_all_confirm")})))}});e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(8),m=n(1400),g=n(1373),v=n(1375),y=n(1374),_=n(1484),E=n(21),S=n(465),M=window._,C=window.l10n,b=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"renderContacts",value:function(){var e=this,t=M.filter(this.props.vCard.TEL,function(e){return e.properties.waid});return t.map(function(t){var n=E.numberToWid(M.first(t.properties.waid));return f.createElement(_,{title:E.formattedUser(n),onClick:function(){return e.onSelect(n)},icon:f.createElement("span",{className:e.props.iconClass}),key:"vCard-"+t.index},S.getType(t))})}},{key:"onSelect",value:function(e){this.props.onSelect(e)}},{key:"render",value:function(){return f.createElement(m,{type:m.BOX},f.createElement(g,null,f.createElement(v,{onCancel:this.props.onCancel,type:v.Type.POPUP,title:C.t("choose_phone_number")}),f.createElement(y,null,f.createElement("div",{className:"chatlist column"},f.createElement("div",{className:"drawer-item-container-compact"},this.renderContacts())))))}}]),t}(f.Component);b.defaultProps={iconClass:"icon icon-chat",onCancel:M.noop,onSelect:M.noop},e.exports=b},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){var n=new Uint8Array(e),i=new Uint8Array(t),a=n.length,s=i.length;if(a!==s)return!1;for(var r=0;a>r;r++)if(n[r]!==i[r])return!1;return!0}var s=n(2),r=i(s),o=n(237),l=i(o),c=n(8),u=n(45),d=n(1372),p=n(10),h=n(1688).CombinedFingerprint,f=n(9),m=n(1373),g=n(1398),v=n(1374),y=n(13),E=n(1407),S=n(1),M=n(1416),C=n(1376),b=n(1367),T=n(480),P=n(157),k=n(160),N=n(1468),w=n(92),x=n(158),O=c.createClass({
displayName:"VerificationFilePicker",propTypes:{mime:c.PropTypes.string.isRequired,onPick:c.PropTypes.func.isRequired},stopPropagation:function(e){e.stopPropagation()},render:function(){return c.createElement("input",{accept:this.props.mime,type:"file",style:{display:"none"},onChange:this.props.onPick,onClick:this.stopPropagation})}}),D=c.createClass({displayName:"VerificationQRCode",propTypes:{binary:c.PropTypes.object,contact:c.PropTypes.instanceOf(l["default"]).isRequired,visible:c.PropTypes.bool},getDefaultProps:function(){return{binary:null}},getInitialState:function(){return{hover:!1,currentQRBinary:null,currentQRDataURL:null}},componentDidMount:function(){this.props.binary&&this.generateQRCode()},componentDidUpdate:function(e,t){this.generateQRCode()},shouldComponentUpdate:function(e,t){return!(this.compareBinary(e.binary,this.props.binary)&&this.compareBinary(t.currentQRBinary,this.state.currentQRBinary)&&e.visible===this.props.visible&&t.hover===this.state.hover&&t.currentQRDataURL===this.state.currentQRDataURL)},onMouseOver:function(e){this.state.hover||this.setState({hover:!0})},onMouseEnter:function(e){this.state.hover||this.setState({hover:!0})},onMouseLeave:function(e){this.state.hover&&this.setState({hover:!1})},fingerprintsMatched:function(e,t){return a(e.publicKey,t.publicKey)&&a(e.identifier,t.identifier)},compareBinary:function(e,t){if(!e&&!t)return!0;var n=h.parse(e),i=h.parse(t);if(!n&&!i)return!0;if(!(n.version||i.version||n.localFingerprint||i.localFingerprint||n.remoteFingerprint||i.remoteFingerprint))return!0;if(n.version!==i.version)return!1;var a=this.fingerprintsMatched(n.localFingerprint,i.localFingerprint),s=this.fingerprintsMatched(n.remoteFingerprint,i.remoteFingerprint);return a&&s},generateQRCode:function(){var e=u.findDOMNode(this.refs.QRCodeContainer),t=this.props.binary;if(!e||!t)return void this.setState({currentQRBinary:null,currentQRDataURL:null});if(!this.compareBinary(this.state.currentQRBinary,t)){this.qr&&delete this.qr,this.qr=new T(e,{text:t,width:f.QR_EDGE/2,height:f.QR_EDGE/2,correctLevel:T.CorrectLevel.L}),this.setState({currentQRBinary:t});var n=e.getElementsByTagName("canvas")[0];if(!n)return void this.setState({currentQRDataURL:null});var i=n.toDataURL("image/png");this.setState({currentQRDataURL:i})}},render:function(){var e=null;if(this.props.visible){var t=null;if(this.state.hover&&this.state.currentQRDataURL){var n=this.props.contact.formattedUser,i=Store.Contact.get(Store.Conn.me).formattedUser,a="Verification Code between "+i+" and "+n+".png";t=c.createElement("a",{href:this.state.currentQRDataURL,download:a},c.createElement("div",{className:"avatar-overlay",key:"avatar-overlay"},c.createElement("div",{className:"avatar-overlay-text"},l10n.t("web_verify_download_code"))))}e=c.createElement("div",{onMouseOver:this.onMouseOver,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},t,c.createElement("div",{className:"verification-circle",ref:"QRCodeContainer"}))}return e}}),R=c.createClass({displayName:"VerificationSpinner",propTypes:{visible:c.PropTypes.bool},render:function(){var e=null;return this.props.visible&&(e=c.createElement("div",{className:"verification-circle"},c.createElement("div",{className:"spinner"},c.createElement(P,{size:40,stroke:4})))),e}}),I=c.createClass({displayName:"VerificationCircle",propTypes:{binary:c.PropTypes.object,contact:c.PropTypes.instanceOf(l["default"]).isRequired,visible:c.PropTypes.bool},render:function(){var e=null;return this.props.visible&&(e=c.createElement("div",{className:"verification-circle-container"},c.createElement(D,{visible:!!this.props.binary,binary:this.props.binary,contact:this.props.contact}),c.createElement(R,{visible:!this.props.binary}))),e}}),A=c.createClass({displayName:"VerificationString",NUM_ROWS:3,NUM_BLOCKS_PER_ROW:4,NUM_DIGITS_PER_BLOCK:5,propTypes:{string:c.PropTypes.string},getDefaultProps:function(){return{string:null}},shouldComponentUpdate:function(e,t){return e.string!==this.props.string},numDigitsInVerificationString:function(){return this.NUM_ROWS*this.NUM_BLOCKS_PER_ROW*this.NUM_DIGITS_PER_BLOCK},render:function(){if(!this.props.string)return c.createElement("div",null,l10n.t("loading"));var e=this.props.string;if(e.length!==this.numDigitsInVerificationString())return S.error("verificationString:render this.props.stringshould be "+this.numDigitsInVerificationString()+" characters long instead of "+e.length+".")(),c.createElement("div",null,l10n.t("web_verify_string_error"));for(var t=[],n=0;n<this.NUM_ROWS;n++){for(var i=[],a=0;a<this.NUM_BLOCKS_PER_ROW;a++){for(var s=[],r=0;r<this.NUM_DIGITS_PER_BLOCK;r++){var o=e.charAt(n*this.NUM_DIGITS_PER_BLOCK*this.NUM_BLOCKS_PER_ROW+a*this.NUM_DIGITS_PER_BLOCK+r);s.push(c.createElement("span",{className:"digit",key:r},o))}i.push(c.createElement("span",{className:"block",key:a},s," "))}t.push(c.createElement("div",{className:"code-row",key:n},i))}return c.createElement("div",{className:"textfield-static selectable-text"},t)}}),L=c.createClass({displayName:"VerificationCheckmark",propTypes:{visible:c.PropTypes.bool},render:function(){var e=null;return this.props.visible&&(e=c.createElement("div",{className:"verification-checkmark-container"},c.createElement("div",{className:"verification-checkmark"},"✓ "))),e}}),F=c.createClass({displayName:"VerificationError",propTypes:{visible:c.PropTypes.bool},render:function(){var e=null;return this.props.visible&&(e=c.createElement("div",{className:"verification-error-container"},c.createElement("div",{className:"verification-error"},"!"))),e}}),U=c.createClass({displayName:"VerificationBanner",propTypes:{children:c.PropTypes.node.isRequired},render:function(){return c.createElement("div",{className:"error-banner"},this.props.children)}}),j=c.createClass({displayName:"VerificationWebcam",CAPTURE_INTERVAL:200,propTypes:{stream:c.PropTypes.object.isRequired,onCapture:c.PropTypes.func.isRequired,onClose:c.PropTypes.func.isRequired},mixins:[k,x],getInitialState:function(){return{videoURL:window.URL.createObjectURL(this.props.stream)}},componentDidMount:function(){this.regNativeListener(window,"resize",this.adjustOverlayPosition)},componentWillUnmount:function(){if(this.clearSafeInterval(this.captureInterval),this.state.videoURL){var e=this.props.stream;M.stop(e),window.URL.revokeObjectURL(this.state.videoURL)}},onVideoLoaded:function(e){this.captureInterval||(this.adjustOverlayPosition(),this.captureInterval=this.safeInterval(this.capture,this.CAPTURE_INTERVAL))},capture:function(){var e=this;if(this.refs.verificationVideo){var t=document.createElement("canvas"),n=u.findDOMNode(this.refs.verificationVideo);t.width=n.videoWidth/2,t.height=n.videoHeight/2;var i=t.getContext("2d");i.drawImage(n,t.width/2,t.height/2,t.width,t.height,0,0,t.width,t.height),t.toBlob(function(t){var n=window.URL.createObjectURL(t);S.log(n),e.props.onCapture(n)},"image/jpeg",1)}},adjustOverlayPosition:function(){var e=u.findDOMNode(this.refs.verificationVideo),t=u.findDOMNode(this.refs.verificationOverlay);if(e&&t){var n=e.offsetHeight,i=e.offsetWidth,a=i/3,s=a,r=(i-a)/2,o=(n-s)/2;t.style.width=a+"px",t.style.height=s+"px",t.style.margin=o+"px "+r+"px"}},render:function(){var e=null;return this.state.videoURL&&(e=c.createElement("div",{className:"webcam"},c.createElement(N,{autoPlay:!0,ref:"verificationVideo",onPlay:this.onVideoLoaded,src:this.state.videoURL}),c.createElement("div",{className:"overlay",ref:"verificationOverlay"}),c.createElement("button",{onClick:this.props.onClose},c.createElement("span",{className:"icon icon-x-alt"})))),e}}),G=c.createClass({displayName:"VerificationDrawer",ICON_DELAY:3e3,BANNER_DELAY:5e3,HINT_DELAY:7e3,ERROR_TYPE:{CORRECT:0,PUBLIC_KEY_MISMATCHED:1,REMOTE_MISMATCHED:2,LOCAL_MISMATCHED:3,BOTH_MISMATCHED:4,INVALID_QR_CODE:5},mixins:[d,C,k],propTypes:{contact:c.PropTypes.instanceOf(l["default"]).isRequired,isFirstLevel:c.PropTypes.bool},getInitialState:function(){return this.asyncState({binary:"contact.verificationBinary",string:"contact.verificationString"},{circleVisible:!0,checkmarkVisible:!1,errorIconVisible:!1,webcamVisible:!1,bannerVisible:!1,bannerText:null,stream:null,isDragging:!1})},componentDidUpdate:function(e,t){(t.binary&&!this.state.binary||t.string&&!this.state.string)&&this.props.contact.queryIdentity()["catch"](function(e){S.error("VerificationDrawer:queryIdentity error: "+e)()})},componentWillMount:function(){this.props.contact.queryIdentity()["catch"](function(e){S.error("verificationDrawer:queryIdentity error: "+e)()})},onDragStart:function(){this.blockDrop=!0},onDragEnd:function(){this.blockDrop=!1},onDragOver:function(){this.state.isDragging||this.blockDrop||this.setState({isDragging:!0})},onDrop:function(e){this.blockDrop||(this.setState({isDragging:!1}),this.state.binary&&this.state.string&&this.onUploadSelect(e))},onDragLeave:function(e){this.setState({isDragging:!1})},showWebcamStream:function(e){this.setState({webcamVisible:!0,circleVisible:!0,checkmarkVisible:!1,errorIconVisible:!1,stream:e}),this.hintTimer&&(this.clearSafeTimeout(this.hintTimer),delete this.hintTimer),this.hintTimer=this.safeDelay(this.showWebcamHint,this.HINT_DELAY)},showWebcamHint:function(){this.state.webcamVisible&&!this.state.bannerVisible&&this.showBanner(l10n.t("web_verify_webcam_hint"))},onWebcamOpen:function(e){var t=this,n=M.start("camera");r["default"].race([n,this.rejectOnUnmount()]).checkpoint(this.rejectOnUnmount()).then(function(e){return t.showWebcamStream(e)})["catch"](y.Unmount,function(){n.then(function(e){return M.stop(e)})["catch"](_.noop)})["catch"](y.GUM.PermissionDeniedError,function(){p.openModal(c.createElement(E,{title:"guide_desktop_camera_title",desc:"guide_desktop_camera_fail_description",type:E.TYPE.GUIDE_UNBLOCK}))})["catch"](y.GUM.GUMError,function(){p.openModal(c.createElement(E,{title:"guide_desktop_camera_missing_title",desc:"guide_desktop_camera_missing_description",type:E.TYPE.GUIDE_NONE}))})},onWebcamClose:function(e){this.setState({webcamVisible:!1,bannerVisible:!1,stream:null})},onWebcamCapture:function(e){this.verifyImage(e,!0)},onUploadClick:function(){u.findDOMNode(this.refs.verificationFilePicker).click()},onUploadSelect:function(e){e.stopPropagation();var t=e.target.files||e.dataTransfer.files;if(t&&t[0]){var n=t[0],i=URL.createObjectURL(n);this.verifyImage(i,!1);var a=u.findDOMNode(this.refs.verificationFilePickerForm);a&&a.reset()}},componentWillUnmount:function(){clearTimeout(this.iconTimer),clearTimeout(this.bannerTimer),clearTimeout(this.hintTimer)},onClose:function(e){this.props.onClose?this.props.onClose():this.context.uim.uie.requestDismiss()},getErrorBannerText:function(e){var t=void 0,n=this.props.contact.formattedShortName;switch(e){case this.ERROR_TYPE.REMOTE_MISMATCHED:t=l10n.t("web_verify_error_remote_mismatched",{contact:n});break;case this.ERROR_TYPE.LOCAL_MISMATCHED:case this.ERROR_TYPE.BOTH_MISMATCHED:t=l10n.t("web_verify_error_local_mismatched",{contact:n});break;case this.ERROR_TYPE.INVALID_QR_CODE:default:t=l10n.t("web_verify_error_invalid_upload")}return t},showCheckmark:function(){this.onWebcamClose(),this.setState({circleVisible:!1,checkmarkVisible:!0,errorIconVisible:!1,bannerVisible:!1}),this.iconTimer&&(this.clearSafeTimeout(this.iconTimer),delete this.iconTimer),this.iconTimer=this.safeDelay(this.hideCheckmark,this.ICON_DELAY)},showErrorIcon:function(){this.onWebcamClose(),this.setState({circleVisible:!1,checkmarkVisible:!1,errorIconVisible:!0,bannerVisible:!1}),this.iconTimer&&(this.clearSafeTimeout(this.iconTimer),delete this.iconTimer),this.iconTimer=this.safeDelay(this.hideError,this.ICON_DELAY)},showErrorBanner:function(e){var t=this.getErrorBannerText(e);this.showBanner(t)},showBanner:function(e){this.setState({circleVisible:!0,checkmarkVisible:!1,errorIconVisible:!1,bannerVisible:!0,bannerText:e}),this.bannerTimer&&(this.clearSafeTimeout(this.bannerTimer),delete this.bannerTimer),this.bannerTimer=this.safeDelay(this.hideBanner,this.BANNER_DELAY)},hideCheckmark:function(){this.state.errorIconVisible||this.setState({circleVisible:!0}),this.setState({checkmarkVisible:!1})},hideError:function(){this.state.checkmarkVisible||this.setState({circleVisible:!0}),this.setState({errorIconVisible:!1})},hideBanner:function(){this.setState({bannerVisible:!1})},validateFingerprint:function(e){if(!e||0===!e.version||!e.localFingerprint||!e.remoteFingerprint)return this.ERROR_TYPE.INVALID_QR_CODE;var t=h.parse(this.state.binary),n=a(e.remoteFingerprint.identifier,t.localFingerprint.identifier),i=a(e.localFingerprint.identifier,t.remoteFingerprint.identifier);if(!n&&!i)return this.ERROR_TYPE.BOTH_MISMATCHED;if(!n)return this.ERROR_TYPE.REMOTE_MISMATCHED;if(!i)return this.ERROR_TYPE.LOCAL_MISMATCHED;var s=a(e.remoteFingerprint.publicKey,t.localFingerprint.publicKey),r=a(e.localFingerprint.publicKey,t.remoteFingerprint.publicKey);return s&&r?this.ERROR_TYPE.CORRECT:this.ERROR_TYPE.PUBLIC_KEY_MISMATCHED},decodeQRCode:function(e){return new r["default"](function(t,n){b.callback=function(e,i){if(i)n(i);else if(e.length<1)n("QR decoder did not return decoded binary");else{var a=new Uint8Array(e[0]);t(a)}},b.decode(e)})},verifyImage:function(e,t){var n=this;this.decodeQRCode(e).then(h.parse).then(function(e){var i=n.validateFingerprint(e);i?t&&i===n.ERROR_TYPE.INVALID_QR_CODE||(n.setState({errorType:i}),i===n.ERROR_TYPE.PUBLIC_KEY_MISMATCHED?n.showErrorIcon():n.showErrorBanner(i)):n.showCheckmark()})["catch"](function(e){t||(n.setState({errorType:n.ERROR_TYPE.INVALID_QR_CODE}),n.showErrorBanner(n.ERROR_TYPE.INVALID_QR_CODE))})["finally"](function(){window.URL.revokeObjectURL(e)})},render:function(){var e=null,t=null,n=null;this.state.binary&&(navigator.getUserMedia&&(e=c.createElement(g,{classes:"animate-enter2"},c.createElement("button",{className:"btn btn-info",onClick:this.state.webcamVisible?this.onWebcamClose:this.onWebcamOpen},this.state.webcamVisible?l10n.t("web_verify_webcam_close_button"):l10n.t("web_verify_webcam_open_button")))),t=c.createElement(g,{classes:"animate-enter2"},c.createElement("button",{className:"btn btn-info",onClick:this.onUploadClick},l10n.t("web_verify_upload_button")),c.createElement("p",{className:"drag-and-drop-explanation"},this.state.isDragging?l10n.t("web_verify_drag_and_drop_dragging"):null)),n=c.createElement("form",{ref:"verificationFilePickerForm"},c.createElement(O,{mime:"image/*",onPick:this.onUploadSelect,ref:"verificationFilePicker"})));var i=null;this.state.webcamVisible&&(i=c.createElement(j,{stream:this.state.stream,onCapture:this.onWebcamCapture,onClose:this.onWebcamClose}));var a=null;this.state.bannerVisible&&(a=c.createElement(U,null,this.state.bannerText));var s="icon icon-";return s+=this.props.isFirstLevel?"x":"back",c.createElement(m,{id:"verification",onDrop:this.onDrop,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave,onCancel:this.onClose},c.createElement("header",{className:"pane-header"},c.createElement("div",{className:"header-close"},c.createElement("button",{onClick:this.onClose},c.createElement("span",{className:s}))),c.createElement("div",{className:"header-body"},c.createElement("div",{className:"header-main"},c.createElement("div",{className:"header-title"},l10n.t("web_verify_title"))),c.createElement("div",{className:"header-secondary"},l10n.t("web_you"),", ",this.props.contact.formattedUser))),i,a,c.createElement(v,{classes:this.state.webcamVisible?"webcam-visible":null,info:!0,onDragStart:this.onDragStart,onDragEnd:this.onDragEnd},c.createElement(g,{classes:"drawer-scale drawer-section-photo"},c.createElement(I,{binary:this.state.binary,contact:this.props.contact,visible:this.state.circleVisible}),c.createElement(L,{visible:this.state.checkmarkVisible}),c.createElement(F,{visible:this.state.errorIconVisible})),c.createElement(g,{classes:"animate-enter2"},c.createElement("div",{className:"verification-string"},c.createElement(A,{string:this.state.string}))),c.createElement(g,{classes:"animate-enter2"},c.createElement("p",{className:"verification-explanation"},c.createElement("span",null,l10n.t("web_verify_explanation")," "),c.createElement("a",{target:"_blank",href:f.E2E_FAQ_LINK},l10n.t("learn_more")))),e,t,n))}});G.contextTypes={uim:c.PropTypes.instanceOf(w)},e.exports=G},function(e,t,n){"use strict";var i=n(8),a=n(1373),s=n(1375),r=n(1374),o=n(1372),l=n(10),c=n(461),u=n(9),d=i.createClass({displayName:"ColorCanvas",propTypes:{colorHex:i.PropTypes.string.isRequired,isSelected:i.PropTypes.bool.isRequired,isDefault:i.PropTypes.bool.isRequired},getInitialState:function(){return{hover:!1}},onClick:function(e){var t=this.encodeColor(this.props.colorHex);t!==Store.ChatPreference.get("defaultPreference").wallpaperColor&&(Store.ChatPreference.get("defaultPreference").set("wallpaperColor",t),l.openToast(i.createElement(c,{msg:l10n.t("wallpaper_color_set"),id:c.genId()})))},onMouseOver:function(e){this.state.hover||(this.setState({hover:!0}),Store.ChatPreference.trigger("wallpaper_color_preview",this.encodeColor(this.props.colorHex)))},onMouseEnter:function(e){this.state.hover||(this.setState({hover:!0}),Store.ChatPreference.trigger("wallpaper_color_preview",this.encodeColor(this.props.colorHex)))},onMouseLeave:function(e){this.state.hover&&(this.setState({hover:!1}),Store.ChatPreference.trigger("wallpaper_color_preview"))},encodeColor:function(e){return"#ede9e4"===e?u.DEFAULT_CHAT_WALLPAPER:e},render:function(){var e="wallpaper-color-canvas";this.state.hover&&(e+=" canvas-hover"),this.props.isSelected&&(e+=" canvas-active");var t=this.props.isDefault?i.createElement("span",{className:"wallpaper-default-title"},l10n.t("default_wallpaper")):null;return i.createElement("span",{className:e,style:{backgroundColor:this.props.colorHex},onMouseOver:this.onMouseOver,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onClick:this.onClick},t)}}),p=i.createClass({displayName:"ColorGrid",mixins:[o],propTypes:{id:i.PropTypes.string.isRequired,colors:i.PropTypes.array.isRequired},getInitialState:function(){return{wallpaperColor:this.async("id.ChatPreference.wallpaperColor")}},render:function(){for(var e=!0,t=this.state.wallpaperColor,n=this.props.colors.map(function(n){var a=!1,s=!1;return(t===n||t===u.DEFAULT_CHAT_WALLPAPER&&e)&&(a=!0),e&&(s=!0,e=!1),i.createElement(d,{colorHex:n,isSelected:a,isDefault:s,key:n})}),a=0;2>a;a++)n.push(i.createElement("div",{key:"emptyEl"+a,className:"wallpaper-color-empty"}));return i.createElement("div",{className:"wallpaper-color-grid"},n)}}),h=i.createClass({displayName:"WallpaperDrawer",propTypes:{onClose:i.PropTypes.func},render:function(){var e=i.createElement(p,{colors:u.WALLPAPER_COLOR,id:"defaultPreference"});return i.createElement(a,{id:"wallpaper",onCancel:this.props.onClose},i.createElement(s,{title:l10n.t("wallpaper_flow_title"),onBack:this.props.onClose,type:s.Type.LARGE}),i.createElement(r,null,e))}});e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(459),o=n(1492),l=n(62),c=n(9),u=n(13),d=o.STATE,p=d.READY,h=d.ERROR,f=l.FILETYPE,m=f.IMAGE,g=f.VIDEO,v=f.DOCUMENT,y=f.AUDIO,_=1,E=r.extend({model:o,initialize:function(){this.errorMsgs=null,this.ignored=0,r.prototype.initialize.call(this)},removeSingleton:function(e,t){e.url&&window.URL.revokeObjectURL(e.url),e.original&&e.original.url&&window.URL.revokeObjectURL(e.original.url)},remove:function(e,t){var n=this;Array.isArray(e)?e.forEach(function(e){return n.removeSingleton(e,t)}):this.removeSingleton(e,t),r.prototype.remove.call(this,e,t)},"delete":function(){var e=this;this.models.forEach(function(t){return e.removeSingleton(t)}),r.prototype["delete"].call(this)},contains:function(e){return this.indexOf(e)>-1},getValidMedias:function(){return this.filter({state:p})},getAfter:function(e){var t=this.getValidMedias(),n=t.indexOf(e);return 0>n||n===t.length-1?null:t[n+1]},getBefore:function(e){var t=this.getValidMedias(),n=t.indexOf(e);return 0>=n?null:t[n-1]},processFiles:function(e,t){var n=this,i=this.getValidMedias().length,a=e.length+i>c.MAX_FILES?Math.max(c.MAX_FILES-i,0):e.length,r=e.length-a;0===a?r&&this.trigger("max_upload_limit",r):this.ignore(r);var l=e.slice(0,a).map(function(e){var i=_++,a=new o({id:i,file:e,chat:t,uiProcessed:!1});return n.add(a)});return s["default"].map(l,function(e){return e.processPromise})},ignore:function(e){e>0&&(this.ignored+=e)},uiProcessMsgs:function(){var e=[],t=void 0,n=void 0,i=0,a=0,s=0,r=0,o=0,l=!1,d=c.MAX_MEDIA_UPLOAD_SIZE/1024/1024;if(this.forEach(function(e){if(!e.uiProcessed&&(e.uiProcessed=!0,t||e.state!==p||(t=e),e.state===h))if(e.exception instanceof u.MediaFileTooLarge)switch(e.getFileType()){case m:i+=1;break;case g:a+=1;break;case y:s+=1;break;case v:r+=1}else e.exception instanceof u.MediaFileFailedLoad?l=!0:o+=1}),i>0&&e.push(l10n.t("image_too_big",{number:i,_plural:i,maxSize:d+"MB"})),a>0&&e.push(l10n.t("video_too_big",{number:a,_plural:a,maxSize:d+"MB"})),s>0&&e.push(l10n.t("audio_too_big",{number:s,_plural:s,maxSize:d+"MB"})),r>0&&e.push(l10n.t("document_too_big",{number:r,_plural:r,maxSize:d+"MB"})),o>0&&e.push(l10n.t("files_not_supported",{number:o,_plural:o})),l&&(e=[],e.push(l10n.t("media_failed_load"))),e.length>1){e=[];var f=i+a+s+r+o;0===o?e.push(l10n.t("files_too_big",{number:f,_plural:f,maxSize:d+"MB"})):e.push(l10n.t("files_not_added",{number:f,_plural:f}))}return this.errorMsgs=e.join(" "),this.ignore(this.getValidMedias().length-c.MAX_FILES),n=this.ignored,this.ignored=0,n&&this.trigger("max_upload_limit",n),{activeMedia:t,errorMsgs:this.errorMsgs}}});e.exports=E},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1493),s=i(a),r=n(459),o=r.extend({model:s["default"],handle:function(e){var t=e.shift(),n=t.blocklist,i=_.map(n,function(e){return{id:e}});this.set(i)}});e.exports=new o},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1494),s=i(a),r=n(470),o=i(r),l=n(459),c=l.extend({model:s["default"],handle:function(e){var t=e.shift();switch(t.type){case"offer":case"offer_video":case"accept":case"reject":case"terminate":o["default"].tosShowCallNotification&&this.add(t,{merge:!0})}}});e.exports=new c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(25),s=i(a),r=n(2),o=i(r),l=n(1370),c=i(l),u=n(462),d=i(u),p=n(8),h=n(9),f=n(1),m=n(459),g=n(46),v=n(40),y=n(30),E=n(10),S=n(13),M=n(113).ActionToast,C=n(113).ActionType,b=n(21),T=n(15),P=n(61),k=m.extend({model:c["default"],comparator:function(e,t){if(P.supportsFeature(P.F.PIN)){if(e.pin&&!t.pin)return-1;if(t.pin&&!e.pin)return 1;if(e.pin&&t.pin)return""+e.pin+e.id>""+t.pin+t.id?-1:1}return e.t?t.t?""+e.t+e.id>""+t.t+t.id?-1:1:-1:1},initialize:function(){var e=this;m.prototype.initialize.call(this),this.notSpam={},this.promises={sendUnstarAll:null},this.listenTo(this,"change:t change:pin change:isVisible",this.sort),this.listenTo(T,"change:stream",function(){T.stream===T.STREAM.RESUMING&&e.forEach(function(e){e.pendingMsgs=!1})})},active:function N(){var N=_.head(this.filter("active"));return N?N.id:void 0},_find:function(e){return o["default"].resolve({id:e,createdLocally:!0})},_findQuery:function(e){var t=this;return g.chatFindQuery(!!e.retry).then(function(e){return"preempted"===e?o["default"].reject("chats preempted"):(Store.Conn.platform===Store.Conn.PLATFORMS.IPHONE&&(_.isEmpty(e)?Store.Msg.trigger(h.COLLECTION_HAS_SYNCED):setTimeout(function(){Store.Msg.trigger(h.COLLECTION_HAS_SYNCED)},2500)),t.trigger(h.COLLECTION_HAS_SYNCED),o["default"].resolve(e))})},handle:function(e){var t=e.shift(),n=this;if(_.isArray(t)){var i=[],a=[];t.forEach(function(e){if("c.us"===e.id)a.push(e);else{var t=!!n.get(e.id),r=["delete","clear","archive","unarchive","star","unstar","spam","modify_tag","pin"].indexOf(e.type)>-1;r?t&&r?a.push(e):f.log("Model:chat:handle received junk chat record: "+(0,s["default"])(e))():i.push(e)}});var r=_.findIndex(i,function(e){return b.isPSA(e.id)});r>-1&&(i[r].name=l10n.t("whatsapp_psa_contact_name")),n.add(i,{merge:!0}),a.forEach(function(e){var t=e.type;if("c.us"===e.id)switch(t){case"clear":f.log("Model:chat:handle:clear:all before:"+e.before+" kind:"+e.kind)(),n.forEach(function(t){"number"==typeof e.before?t.deleteMsgsOlderThan(e.before,e.star,e.kind):t.deleteMsgs(e.star,e.kind)});break;case"delete":f.log("Model:chat:handle:delete:all")(),n.forEach(function(e){e["delete"]()});break;case"archive":f.log("Model:chat:handle:archive:all")(),n.forEach(function(e){e.archive=!0});break;case"unarchive":f.log("Model:chat:handle:unarchive:all")(),n.forEach(function(e){e.archive=!1});break;case"unstar":f.log("Model:chat:handle:unstar:all")(),Store.AllStarredMsgs["delete"](),n.forEach(function(e){e.unstarAll()});break;default:f.error("Model:chat:handle unknown "+(0,s["default"])(e),e)()}else{var i=n.get(e.id);if(!i)return;switch(t){case"clear":case"star":case"unstar":if(e.keys){for(var a=e.keys.length,r="star"===t,o=[],l=[],c=[],u=!1,d=0;a>d;d++){var p,h,m,g,v,E=e.keys[d];_.isArray(E)?(p=E[0],h=E[1],m=E[2],g=new y({fromMe:h,remote:e.id,id:p,participant:m}),v=Store.Msg.get(g),v?"clear"===t?v["delete"]():(v.star=r,r&&c.push(v)):r&&(u=!0)):_.isObject(E)&&"star"===t&&(g=E.id,v=Store.Msg.get(E.id),v?(v.star=!0,c.push(v)):l.push(E)),o.push(g.toString())}"star"!==t&&"unstar"!==t||Store.AllStarredMsgs.process(r,l,c,u),f.log("model:Chat:handle:messages:"+[t,e.id,o.join(),e.modifyTag].join())()}else"clear"===t?("number"==typeof e.before?i.deleteMsgsOlderThan(e.before,e.star,e.kind):i.deleteMsgs(e.star,e.kind),f.log("model:Chat:handle cleared chat:"+[e.id,e.before,e.modifyTag,e.kind].join())()):"unstar"===t&&(i.unstarAll(),f.log("model:Chat:handle unstarred chat: "+e.id)());isNaN(e.modifyTag)||(i.modifyTag=e.modifyTag);break;case"delete":i["delete"](),f.log("model:Chat:handle deleted chat for "+e.id)();break;case"archive":i.archive=!0;break;case"unarchive":i.archive=!1;break;case"spam":i.notSpam=e.notSpam;break;case"modify_tag":i.modifyTag=e.modifyTag;break;case"pin":i.pin=e.pin}}})}else if("leave"===t.cmd)t.gids.forEach(function(e){var t=n.get(e);t&&t.exit()});else if("preempt"===t.cmd)Store.Chat.add(t.response,{merge:!0}),Store.Conn.platform===Store.Conn.PLATFORMS.IPHONE&&(_.isEmpty(t.response)?Store.Msg.trigger(h.COLLECTION_HAS_SYNCED):setTimeout(function(){Store.Msg.trigger(h.COLLECTION_HAS_SYNCED)},2500)),this.trigger(h.COLLECTION_HAS_SYNCED);else if("action"===t.cmd){var o=t.id,l=t.data;if("create"===l[0]||"introduce"===l[0]){var c=l[1],u=l[2],d=_.map(u.admins,function(e){return{id:e,isAdmin:!0}}).concat(_.map(u.regulars,function(e){return{id:e,isAdmin:!1}}));Store.GroupMetadata.add({id:o,creation:u.creation,owner:c,participants:d,stale:!1},{merge:!0}),Store.Contact.add({id:o,name:u.subject},{merge:!0});var p=Store.Chat.get(o);if(!p)return;var m=p.msgs.last();if(!m)return;"gp2"===m.type&&"add"===m.subtype&&_.head(m.recipients)===Store.Conn.me&&E.alertNewMsg(m)}else{var g=Store.Chat.get(t.id);g?g.handleGroupAction.apply(g,t.data):f.error("model:chat: unknown chat for action "+(0,s["default"])(t))()}}else f.error("model:chat: unknown payload: "+(0,s["default"])(t))()},createGroup:function(e,t,n,i,a){var s=this,r=_.map(i,"id"),o=g.createGroup(e,r),l=new C(l10n.t("action_group_creating"));a=a||M.genId();var c=o.then(function(e){return 200===e.status?new C(l10n.t("action_group_created")):406===e.status?new C(l10n.t("action_group_create_failed")+" "+l10n.t("action_group_create_failed_406")):void 0})["catch"](function(r){return f.error("models:chatCollection:createGroup dropped")(r),new C(l10n.t("action_group_create_failed"),l10n.t("action_try_again"),s.createGroup.bind(s,e,t,n,i,a))});return E.openToast(p.createElement(M,{id:a,initialAction:l,pendingAction:c})),o.then(function(e){if(200===e.status&&e.gid&&Store.Chat.find(e.gid).then(function(e){E.openChatBottom(e).then(function(t){t&&E.focusChatTextInput(e)})}),200===e.status&&!e._duplicate&&t&&n){var i=Store.ProfilePicThumb.gadd(e.gid);return i.setPicture(t,n)}200===e.status&&e._duplicate&&f.error("createGroup failed to set picture.")()})},sync:function(){return this.findQuery({})["catch"](S.WapDrop,_.noop),o["default"].all([v.waitForBBEvent(this,h.COLLECTION_HAS_SYNCED),Store.Msg._hasSynced()])},resyncMessages:function(){f.log("ChatStore:resyncMessages")();var e=Store.Chat.filter(function(e){return e.isVisible}),t=e.map(function(e){var t=e.getAckedPhoneProps(),n=e.lastReceivedKey;return n&&(t.id=n.id,t.fromMe=n.fromMe.toString(),t.participant=n.participant),t});return g.resyncMessages(t).then(function(e){return e.status>=400?(f.error("ChatStore:resyncMessages resume error "+e.status)(),o["default"].reject(new Error("ChatStore:resyncMessages resume error "+e.status))):(f.log("ChatStore:resyncMessages resume success")(),e.checksum&&Store.Contact.resyncContacts(e.checksum),e.statusChecksum&&Store.StatusV3.sync(e.statusChecksum),e.data.forEach(function(e){if(e.disableUnreadAnchor=!1,"delete"!==e.type&&!b.isPSA(e.id)){var t=Store.Contact.get(e.id);t?e.name&&(t.name=e.name):Store.Contact.add({id:e.id,name:e.name})}var n=Store.Chat.get(e.id);return n?void("clear"===e.type?!function(){n.resetMediaMsgs();var t=[];n.msgs.forEach(function(e){return t.push(e)}),n.msgChunks.length&&n.msgChunks.forEach(function(e){e.models.forEach(function(e){return t.push(e)})}),n.set({t:e.t,unreadCount:e.unreadCount,createdLocally:!1,archive:e.archive,isReadOnly:e.isReadOnly,modifyTag:e.modifyTag,msgs:[],notSpam:e.notSpam,unreadMsgAnchor:void 0,disableUnreadAnchor:e.disableUnreadAnchor,pendingMsgs:e.pendingMsgs,pin:e.pin}),n.mute.setMute(e.muteExpiration),_.each(t,function(e){e["delete"]()}),f.log("model:chat:resume: cleared chat for "+e.id)()}():"delete"===e.type?(n["delete"](),f.log("model:chat:resume: deleted chat for "+e.id)()):(n.set(e,{merge:!0}),n.mute.setMute(e.muteExpiration))):void Store.Chat.add(e)}),o["default"].resolve())})["catch"](S.WapDrop,function(e){return f.error("ChatStore:resyncMessages resume dropped")(),o["default"].reject(e)})},unstarAllMessages:function(e,t){var n=this,i=t?t.promises:this.promises,a=t?t.id:void 0;if(i.sendUnstarAll)return i.sendUnstarAll;i.sendUnstarAll=g.sendUnstarAll(a);var s=new C(l10n.t("action_message_unstarring_all")),r=i.sendUnstarAll.then(function(e){return 200===e.status?new C(l10n.t("action_message_unstarred_all")):e.status>=400?new C(l10n.t("action_message_unstar_all_failed")):void 0})["catch"](function(i){return f.error("models:chat:sendUnstarAll dropped")(i),new C(l10n.t("action_message_unstar_all_failed"),l10n.t("action_try_again"),function(){return n.unstarAllMessages(e,t)})});return E.openToast(p.createElement(M,{id:M.genId(),initialAction:s,pendingAction:r})),i.sendUnstarAll.then(function(n){200===n.status&&(_.forEach(e,function(e){e.set("star",!1)}),t?Store.AllStarredMsgs.remove(e):(Store.AllStarredMsgs.reset(),Store.StarredGifMsgs.reset()))})["finally"](function(){i.sendUnstarAll=null})},forwardMessagesToChats:function(e,t){var n=o["default"].map(e,function(e){return o["default"].props({message:e,canForward:e.canForward()})});return o["default"].map(t,function(e){var t=void 0;return t=e.isUser&&e.contact.isBlocked()?e.contact.setBlock(!1):o["default"].resolve(!0),o["default"].all([n,t]).spread(function(t,n){var i=_.map(_.filter(t,{canForward:!0}),"message"),a=_.map(_.filter(t,{canForward:!1}),"message");return o["default"].props({chat:e,undelivered:e.forwardMessages(i),canForward:i,cannotForward:a})})}).then(function(e){var t=_.compact(e.map(function(e){var t=e.chat,n=e.undelivered,i=e.canForward,a=e.cannotForward,s=null;return(n.length||a.length)&&(s=d["default"].formatForwardError(t,n,i,a)),s?{chat:t,reason:s}:null}));if(t.length)throw new S.ForwardError("Forward Messages Error",t);return!0})}});e.exports=new k},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1499),s=i(a),r=n(459),o=n(9),l=r.extend({model:s["default"],initialize:function(){r.prototype.initialize.call(this,{CachePolicy:{id:"chat_preference",policy:r.CACHE_POLICY.LOAD,
delay:1e3}})},initializeFromCache:function(){this.get("defaultPreference")||this.add({id:"defaultPreference",wallpaperColor:o.DEFAULT_CHAT_WALLPAPER})},get:function(e,t){return r.prototype.get.call(this,e,t)||r.prototype.get.call(this,"defaultPreference")}});e.exports=new l},function(e,t,n){"use strict";var i=n(9),a=n(1),s=n(33),r=n(13),o={handle:function(e){var t=e.shift();switch(t.type){case"const":i[t.key]=t.value;break;case"read":if(t.isStatus){Store.StatusV3.handle([t]);break}case"unread":var n=Store.Chat.get(t.jid);n&&("read"===t.type?n.markSeen():"unread"===t.type&&n.markUnseen());break;case"picture":Store.ProfilePicThumb.imageChanged(t.jid,t.tag);break;case"log":s.upload("server-requested",!0,!0);break;case"privacy":t.jid?(Store.Presence.update(t.jid)["catch"](r.WapDrop,_.noop),Store.ProfilePicThumb.update(t.jid)["catch"](r.WapDrop,_.noop),Store.Status.update(t.jid)["catch"](r.WapDrop,_.noop)):a.error("Store:Cmd:handle:privacy no jid",t)();break;case"identity":if(t.jid){var o=Store.Contact.get(t.jid);o?o.updateIdentity(t):a.error("Store:Cmd:handle:identity no contact",t)()}else a.error("Store:Cmd:handle:identity no jid",t)();break;default:a.warn("Store.Cmd:handle:unknown "+t.type,t)()}}};e.exports=o},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1500),s=i(a),r=n(459),o=n(161),l=r.extend({model:s["default"],initialize:function(){r.prototype.initialize.call(this,{CachePolicy:{id:"emoji_variant_collection",policy:r.CACHE_POLICY.LOAD,delay:1e3}})},setVariant:function(e,t){var n=o.skinToneEmojis[e];if(!n)throw new Error("attempt to store variantless emoji");this.gadd({id:n,"char":n,variant:t})},getVariant:function(e){if(o.skinToneEmojis[e]){var t=this.get(e);return t?t.variant:null}throw new Error("attempt to get variantless emoji")}});e.exports=new l},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1426),o=i(r),l=n(1),c=n(459),u=n(46),d=n(13),p=n(21),h=c.extend({model:o["default"],initialize:function(){c.prototype.initialize.call(this,{staleCollection:!0})},onResume:function(){_.union(Store.Chat.where({active:!0}).filter(function(e){return e.isGroup||e.isBroadcast}),Store.Chat.where({isBroadcast:!0})).forEach(function(e){Store.GroupMetadata.find(e.id)["catch"](d.WapDrop,_.noop)})},_find:function(e){var t=this;if(p.isGroup(e)){var n=Store.Chat.get(e);return n&&n.isReadOnly?u.groupMetadataFindFromPhone(e).then(function(t){return"ok"===t.status?t.data:"missing"===t.status?void _.defer(function(){Store.Chat.get(e)["delete"]()}):"error"===t.status?(l.error("model:GroupMetadata:find error "+t.info)(),s["default"].reject(new Error("model:GroupMetadata:find error"))):void 0}):u.groupMetadataFind(e).then(function(n){if(n.status>=400)return{id:e,stale:!1};var i=[],a=t.get(e);return a?a.participants.set(n.participants):i=n.participants,t.updateSubject(e,n.subject),{id:n.id,owner:n.owner,creation:n.creation,participants:i}})}return p.isBroadcast(e)?u.contactFindBroadcast(e).then(function(t){if(200===t.status){var n=Store.GroupMetadata.get(e);if(n&&!n.stale)return s["default"].resolve(n);var i=[];return n?n.participants.set(t.recipients):i=t.recipients,{id:e,participants:i}}return 404===t.status?s["default"].reject("False broadcast list query."):(l.error("models:GroupMetadataCollection:_find:bclist error: "+t.status)(),s["default"].reject(new Error("models:GroupMetadataCollection:_find:bclist error: "+t.status)))}):(l.log("groupMetadata:find trying to fetch non-group/bclist wid "+e)(),s["default"].reject(new Error("groupMetadata:find trying to fetch non-group/bclist wid "+e)))},_handle:function(e){return e},updateSubject:function(e,t){_.isString(t)&&Store.Contact.find(e).then(function(e){e.name||(e.name=t)})}});e.exports=new h},function(e,t,n){"use strict";var i=n(1449),a=n(1682);e.exports={Blocklist:n(1666),Call:n(1667),Chat:n(1668),Cmd:n(1670),GroupMetadata:n(1672),Msg:n(1674),MsgInfo:n(1675),AllStarredMsgs:new i,StarredGifMsgs:new a,Mute:n(1676),Presence:n(1677),ProfilePicThumb:n(1678),Props:n(1679),RecentEmoji:n(1681),EmojiVariant:n(1671),Status:n(1683),ChatPreference:n(1669),StatusV3:n(1684),StatusV3Privacy:n(1685)}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){if(!T.supportsFeature(T.F.CONTACT_HAS_PUSHNAME)&&e.notifyName){var t=Store.Contact.get(e.sender);t&&!t.isMe&&(!t._notifyName||t._notifyName.t<e.t)&&(t._notifyName={name:e.notifyName,t:e.t},t.trigger("change:_notifyName",e.notifyName))}}function s(e,t,n,i){var s=[],r=[],o=[];t.forEach(function(t,l){t.id instanceof N||(S.error("msgCollection:_processMultipleMessages: el.id is not a MsgKey"+(new Error).stack)(),D.upload("forgot-to-create-msgkey"),t.id=new N({from:t.from,to:t.to,id:t.id,participant:t.participant,self:t.self})),_.isString(e)&&b.isBroadcast(e)&&delete t.broadcast,"ptt"===t.type&&!t.id.fromMe&&t.ack<0&&(t.ack=0);var c=Store.Msg.get(t.id);if(t.type===y["default"].TYPE.PROTOCOL)switch(t.subtype){case"revoke":if(c=Store.Msg.get(t.protocolMessageKey)){var d=new y["default"](t);c.sender===d.sender?c.revoke(d.id):S.warn("model:Msg:processMM revoke sender mismatch "+d.id.toString()+", "+c.id.toString())()}break;default:S.info("unknown protocolMessage "+t.id.toString())(t)}else if(c){var p;!function(){t.ack<c.ack&&delete t.ack;for(p in t)t.hasOwnProperty(p)&&"undefined"==typeof t[p]&&delete t[p];t.id.fromMe&&!c.clientUrl&&t.clientUrl&&(t.phoneUploading=!1),n.isHistory&&(t.isNewMsg=!1);var e=["t","id","from","to"],l=c.t?_.omit(t,e):t,d=c.applyUpdate(l)["return"](c);if(o.push(d),b.isBroadcast(c.id.remote)){var h=u(c);h&&h.forEach(function(e){var t=Store.Msg.get(e);t&&o.push(t.applyUpdate(l)["return"](c))})}n.isHistory&&(c.recvFresh||i)&&!c.search?(S.warn("model:Msg:handle:processMM:"+(c.recvFresh?"dup:":"overlap:")+c.id)(),r.push(c)):n.isHistory&&c.search?(c.search=!1,S.warn("model:Msg:handle:processMM load search as history "+c.id)(),s.push({id:c.id})):"search"!==n.add&&"resync"!==n.add||s.push({id:c.id}),a(c)}()}else y["default"].typeIsMMS(t.type)&&!t.clientUrl&&(t.phoneUploading=t.id.fromMe&&0===t.ack),"search"===n.add&&(t.search=!0),n.update||s.push(t)});var c=o.length?g["default"].all(o):g["default"].resolve();return c.then(function(){if(0===s.length&&0===r.length){if(e&&n.pendingMsgsDone){var o=Store.Chat.get(e);o&&(o.pendingMsgs=!1)}return t.map(function(e){return Store.Msg.get(e.id)})}var c=Store.Msg.add(s,{merge:!0}),u=g["default"].map(c,function(e){return a(e),e.waitForPrep()["catch"](function(e){S.assert(!1,"bad-msg-prep",""+e)(e)})});if(e){var p;if(b.isStatusV3(e)){var h=t[0],f=h.id.fromMe?Store.Conn.me:h.author;p=Store.StatusV3.find(f)}else p=Store.Chat.find(e);return u["return"](p).then(function(a){var s,o,u="after"===n.add||"last"===n.add,p=!n.isHistory,h=!1;if("unread"===n.add?(s=i,a.msgChunks.push(s),o=n.firstUnreadKey):"last"===n.add&&n.resume?(s=i,h=!0):s="function"==typeof i?i():i,l(t,c,r,a,u,s||a.msgs,o,h),n.pendingMsgsDone&&(a.pendingMsgs=!1),p&&b.isBroadcast(e)&&!b.isStatusV3(e)&&c.forEach(function(t){if("broadcast_notification"===t.type){var n=Store.GroupMetadata.get(e);"add"===t.subtype?n.participants.add({id:t.body},{merge:!0}):"remove"===t.subtype&&n.participants.remove(t.body),a.groupMetadata.stale=!1}else t.recvFresh&&!t.isNotification&&d(t)}),T.supportsFeature(T.F.RECENT_EMOJI_SYNC)&&!Store.RecentEmoji.syncDue)for(var f=0;f<c.length;f++){var m=c[f];if(m.isNewMsg&&m.isSentByMe&&m.containsEmoji){Store.RecentEmoji.periodicSync();break}}return t.map(function(e){return Store.Msg.get(e.id)})})}return u["return"](t.map(function(e){return Store.Msg.get(e.id)}).filter(function(e){return!!e.chat}))})}function r(e,t,n,i,a,s){var r=i||t.msgs;if(e=_.isArray(e)?e:[e],0!==e.length){var o=r===t.msgs;if(s){o&&S.error("models:msg:store:resetMostRecentMsgs .msgs === cmc !")(),o=!0,t.lastReceivedKey=_.last(e).id,r.add(e);var l=new O;l.replace(t.msgs),t.msgChunks.push(l),t.replaceMsgsCollection(r),t.msgs.trigger("change:last",t.msgs.last())}else n?(o&&(t.lastReceivedKey=_.last(e).id),r.add(e)):r.add(e,{at:0,silent:_.every(e,p)});if(n&&o||!Store.Msg.lastReceivedReceipt[t.id])for(var c=e.length,u=c-1;u>=0;u--){var d=e[u],h=d.id;if(h.fromMe&&!d.isNotification){Store.Msg.updateLastReceipt(h.remote,d.t);break}}a&&!t.unreadMsgAnchor&&(t.disableUnreadAnchor?t.disableUnreadAnchor=!1:t.unreadMsgAnchor=_.find(e,function(e){return e.id.toString()===a.toString()}))}}function o(e,t,n,i,a){var s,r,o,l={},c={},u=n.length,d=a;if(0===u)return{msgs:t,collection:d};for(s=0;u>s;s++)r=n[s],c[r.id]=r;for(u=t.length,s=0;u>s;s++)r=t[s],l[r.id]=r;var p=[];for(u=e.length,s=0;u>s;s++)if(r=e[s],o=l[r.id],o&&p.push(o),o=c[r.id])if(o.recvFresh)p.push(o),i.removeMsg(o),o.unset("recvFresh");else{var h=i.getAllCMCs(),f=_.find(h,function(e){return e.get(r.id)});a&&f===a||(f?(f.forEach(function(e){p.push(e),delete c[e.id]}),f===i.msgs?(i.replaceMsgsCollection(a),d=i.msgs):(i.notifyMsgCollectionMerge(a,f,a),i.removeMsgsCollection(f))):(S.error("models:Msg:reorder trying to merge CMC of orphaned message "+r.id,r)(),p.push(c[r.id])))}return{msgs:p,collection:d}}function l(e,t,n,i,a,s,l,c){var u=o(e,t,n,i,s);r(u.msgs,i,a,u.collection,l,c)}function c(e){return _.isObject(e)?JSON.parse((0,f["default"])(e)):e}function u(e){var t=void 0;if(e.recipients&&0!==e.recipients.length)t=e.recipients;else{var n=Store.GroupMetadata.get(e.id.remote);n?t=_.map(c(n.participants),"id"):S.log("model:msgs:broadcastFanout no group_metadata rec for bclist, cant fanout: "+e.id.remote)()}return t?t.map(function(t){return new N({from:e.from,to:t,id:e.id.id})}):void 0}function d(e){var t=void 0;if(!e.invis){var n=u(e);n&&(t=n.map(function(e){return e.remote}),n.forEach(function(t){Store.Msg.some(_.matches({id:t}))||!function(){var n=c(e);n.to=t.remote,n.id=t,n.broadcast=!0;var i=Store.Msg.add(n,{merge:!0});Store.Chat.find(t.remote).then(function(e){r(i,e,!0)})}()}))}return t}function p(e){return"i"===e.eventType}var h=n(25),f=i(h),m=n(2),g=i(m),v=n(458),y=i(v),E=n(9),S=n(1),M=n(459),C=n(13),b=n(21),T=n(61),P=n(40),k=n(47),N=n(30),w=n(15),x=n(46),O=n(1402),D=n(33),R=6e4,I=M.extend({model:y["default"],initialize:function(){M.prototype.initialize.call(this),this.lastReceivedReceipt={},this.preAck={},this.pendingAdd={},this.ftsCache={},this.listenTo(w,"change:stream",function(){w.stream===w.STREAM.DISCONNECTED&&(this.preAck={})}),this.listenTo(this,"remove",this.removeFromCollection)},removeFromCollection:function(e){e.chat&&e.chat.removeFromCollection(e)},_findQuery:function(e){var t,n=this;switch(e.direction){case"before":case"after":t=e.direction;break;default:t="before"}return x.msgFindQuery(t,e).then(function(i){if(i.status>=400)return S.error("model:Msg:findQuery error "+i.status)(),g["default"].reject(i.status);var a=function(){var t=n.get(e),i=Store.Chat.get(e.remote);return t?t.msgChunk:i?i.msgs:void 0};return i.forEach(function(e){e.invis=!0}),S.log("model:Msg:findQuery:got:"+i.length+":"+e.direction)(),n.processMultipleMessages(e.remote,i,{add:t,isHistory:!0},a)})},resyncChatMsgs:function(e,t){var n=this,i="number"!=typeof t||isNaN(t)?E.PAGE_SIZE:t;return x.msgFindQuery("before",{remote:e,count:i}).then(function(e){return e.status>=400?(S.error("model:Msg:resyncChatMsgs error "+e.status)(),g["default"].reject(e.status)):n.processMultipleMessages(void 0,e,{add:"resync"})})},getStarred:function(e,t,n,i){var a=this,s={count:"number"!=typeof t||isNaN(t)?E.PAGE_SIZE:t,chat:e&&_.isString(e)?e:void 0,remote:n&&n.remote,id:n&&n.id,fromMe:n&&n.fromMe,participant:n&&n.participant,media:i?"gif":void 0};return x.msgFindQuery("star",s).then(function(e){var t=e.status;return e.status>=400?(499===t?S.log("model:Msg:getStarred error 499 (unimplemented)")():S.error("model:Msg:getStarred error "+t)(),g["default"].reject(t)):a.processMultipleMessages(void 0,e,{add:"search"})})},incrementalStarredUpdate:function(e){return this.processMultipleMessages(void 0,e,{add:"search"})},search:function A(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=this,i=arguments[2],a=arguments[3];if(1!==t||a)return this._search(e,t,i,a);var s=this.ftsCache[e];if(s)return s;var A=this._search(e,t,i,a);this.ftsCache[e]=A;var r=function(){n.ftsCache[e]=null};return _.delay(r,R),A["catch"](r),A},_search:function(e,t,n,i){var a=this,s={searchTerm:e,page:t&&_.isNumber(t)?t:1,count:n&&_.isNumber(n)?n:E.PAGE_SIZE,remote:i};return x.msgFindQuery("search",s).then(function(e){if(e.status>=400)return S.error("model:Msg:search error "+e.status)(),g["default"].reject(e.status);var t=_.isArray(e)?e:e.messages,n=_.isArray(e)?!0:e.eof;return g["default"].props({messages:a.processMultipleMessages(void 0,t,{add:"search"}),eof:n})})},queryMedia:function(e,t,n,i,a){var s=this,r={remote:e,count:t&&_.isNumber(t)?t:E.PAGE_SIZE,id:i&&i.id,fromMe:i&&i.fromMe,participant:i&&i.participant,direction:n||"before",media:a};return x.msgFindQuery("media",r).then(function(e){return e.status>=400?(S.error("model:Msg:media error "+e.status)(),g["default"].reject(e.status)):a?s.processMultipleMessages(void 0,e,{add:"search"}):g["default"].props({docCount:e.docCount,linkCount:e.linkCount,mediaCount:e.mediaCount,messages:s.processMultipleMessages(void 0,e.messages,{add:"search"})})})},getContext:function(e,t){var n=this,i=this.get(e);return i?g["default"].all([x.msgFindQuery("before",e),x.msgFindQuery("after",e)]).spread(function(a,s){return _.isArray(a)&&_.isArray(s)?(i.search=!1,g["default"].all([n.processMultipleMessages(e.remote,a,{add:"before",isHistory:!0},t),n.processMultipleMessages(e.remote,s,{add:"after",isHistory:!0},t)])):(S.error("model:msg:getContext fetch error",a,s)(),g["default"].reject(a.status||s.status))}):x.msgFindQuery("after",e).then(function(i){return _.isArray(i)?b.isStatusV3(i[0].id.remote)?g["default"].reject("statusV3, stop querying before the msg"):n.processMultipleMessages(e.remote,i,{add:"after",isHistory:!0},t):(S.error("model:msg:getContext:after fetch error",i)(),g["default"].reject(i.status))}).then(function(t){var i=t[0],a=i.id.clone();return a.count=e.count+1,g["default"].all([x.msgFindQuery("before",a).then(function(t){if(!_.isArray(t))return S.error("model:msg:getContext:before fetch error",t)(),g["default"].reject(t.status);var a=t[t.length-1],s=a.id;if(!s.equals(e))return S.error("model:msg:getContext:before ctx message mismatch",t)(),g["default"].reject(405);var r=function(){return i.msgChunk};return n.processMultipleMessages(e.remote,t,{add:"before",isHistory:!0},r)}),g["default"].resolve(t)])})},handle:function(e){function t(e,t){var n=new N({from:r.from,to:e,id:t,participant:r.participant,selfDir:r.self||"out"}),i=s.get(n);if(i){i.updateAck(r.ack),s.updateLastReceipt(n.remote,r.t);var a=n.remote;b.isUser(a)&&(Store.MsgInfo.update(t,r.from,e,r.ack,a,r.t),b.isBroadcast(r.broadcast)&&Store.MsgInfo.update(t,r.from,r.broadcast,r.ack,a,r.t))}else S.log("Msg:out of order ack",r)(),s.preAck[n]=r}var n,i,a,s=this,r=e.shift();if("ack"===r.cmd){var o=[r.to];if(b.isBroadcast(r.to)&&1===r.ack){var l=Store.GroupMetadata.get(r.to);l&&Array.prototype.push.apply(o,_.map(l.participants.toArray(),"id"))}return o.forEach(function(e){t(e,r.id)}),!0}if("acks"===r.cmd)return r.id.forEach(function(e){t(r.to,e)}),!0;if(r.msg){var c="update"===r.meta.add;return b.isStatusV3(r.chat)&&!Store.StatusV3.handleUpdate(r.msg,r.meta.checksum,c)||(r.msg.recvFresh=!0,r.msg.isNewMsg=!0,this.processMultipleMessages(r.chat,[r.msg],{add:"after",update:c,isHistory:!1})["catch"](C.LogoutDrop,_.noop)),!0}if(r.msgs){var u=r.msgs.length;if(!u)return!1;i=r.meta,i.isHistory=!0,"unread"===i.add&&(i.firstUnreadKey=new N({fromMe:i.unreadFromMe,remote:r.chat,id:i.unreadId,participant:i.unreadParticipant}),a=new O);for(var d=0;u>d;d++)n=r.msgs[d],n.invis=!0;return Store.Conn.platform===Store.Conn.PLATFORMS.IPHONE&&this.trigger(E.COLLECTION_HAS_SYNCED),this.processMultipleMessages(r.chat,r.msgs,i,a)["catch"](C.LogoutDrop,_.noop),!0}if(r.recent){i=r.meta,delete r.recent,delete r.meta,this.trigger(E.COLLECTION_HAS_SYNCED),i.isHistory=!0;for(var p in r)"last"===i.add&&i.resume&&(a=new O),n=r[p],n.invis=!0,this.processMultipleMessages(p,[n],i,a)["catch"](C.LogoutDrop,_.noop)}else S.log("************** Msg else clause. something strange is going on")()},_hasSynced:function(){return P.waitForBBEvent(this,E.COLLECTION_HAS_SYNCED)},"delete":function(){M.prototype["delete"].call(this),this.lastReceivedReceipt={},this.preAck={}},send:function(e){return g["default"].callSynchronously(function(){var t=e.id,n=e.toJSON();if(T.supportsFeature(T.F.SPAM)&&Store.Chat.find(e.id.remote).then(function(e){e.isTrusted()||e.sendNotSpam()["catch"](_.noop)}),e.isNewMsg=!0,!e.isGroupMsg&&Store.Blocklist.get(e.to))return g["default"].reject(new C.ContactBlocked("Contact is blocked"));if(b.isBroadcast(n.to))var i=d(n);delete n.status,delete n.mimetype,delete n.height,delete n.width,delete n.recipients,delete n.chat,delete n.broadcast,delete n.ack,delete n.invis,delete n.filehash,delete n.recvFresh,delete n.mediaData,k.isHttp(e.url)||delete n.url,k.isHttp(e.clientUrl)||delete n.clientUrl;for(var a in n)null!==n[a]&&"undefined"!=typeof n[a]||delete n[a];return e.isMMS&&(n.avparams=e.isUnsentPhoneMsg()?{type:e.type}:e.avParams()),"chat"!==n.type||"url"!==n.subtype||T.supportsFeature(T.F.URL)||delete n.subtype,n.quotedMsg&&!T.supportsFeature(T.F.REPLIES_OUT)&&(delete n.quotedMsg,delete n.quotedStanzaID,delete n.quotedRemoteJid,delete n.quotedParticipant),n.mentionedJidList&&!T.supportsFeature(T.F.MENTIONS_OUT)&&delete n.mentionedJidList,Store.Chat.find(e.id.remote).then(function(t){return t.sendSeen(),g["default"].props({reply:x.msgCreateRecord(n,e.local),chat:t})}).then(function(n){var a=n.reply,s=n.chat;if(200===a.status){var r=t.remote,o=t.fromMe&&t.remote===Store.Conn.me?3:a.data?a.data.ack:1;return e.updateAck(o),s.lastReceivedKey=t,Store.Msg.updateLastReceipt(r,a.t),b.isBroadcast(r)&&(i?i.forEach(function(e){var n=new N({from:Store.Conn.me,to:e,id:t.id}),i=Store.Msg.get(n);i&&(i.ack=1,Store.Msg.updateLastReceipt(e,i.t),Store.Chat.find(e).then(function(e){e.lastReceivedKey=n}))}):S.log("model:msg:createRecord bclist server ack, no recipients")()),"success"}return 408!==a.status&&S.assert(!1,"send-not-200","Phone responded "+a.status)(),"dropped"})["catch"](function(e){return S.error("model:msg:createRecord dropped msg: "+n.id)(n.type),S.assert(!1,"send-msg-error","Got error "+e)(e),"dropped"})})["finally"](function(){e.promises.sendPromise&&e.promises.sendPromise.control.settled()})},resyncReceipts:function(){S.log("Msg:resyncReceipts")();var e=[];for(var t in Store.Msg.lastReceivedReceipt){var n,i=Store.Chat.get(t);if(n=i?T.gte([0,5])?i.getFirstMsgWithStatus():i.getFirstMsgFromMe():void 0){var a=n.id;a.t=Store.Msg.lastReceivedReceipt[t]||n.t||0,e.push(a)}else S.error("Msg:resyncReceipts wid in lastReceivedReceipt, but no msg: "+t)()}return 0===e.length?g["default"].resolve():x.resyncReceipts(e).then(function(e){_.isArray(e)?(S.log("Msg:resyncReceipts success")(),e.forEach(function(e){Store.Msg.updateLastReceipt(e.id,e.t),e.acks.forEach(function(t){if(4===t.length){var n=new N({fromMe:t[1],remote:e.id,id:t[0],participant:t[2]}),i=Store.Msg.get(n);i&&i.updateAck(t[3])}else S.error("Msg:resyncReceipts invalid response: "+(0,f["default"])(t))()})})):S.error("Msg:resyncReceipts error",e)()})["catch"](C.LogoutDrop,C.EphemeralDrop,C.BrowserReplacedDrop,_.noop)["catch"](function(e){throw S.error("Msg:resyncReceipts dropped "+e+" "+(e?e.stack:"no stack"))(),new Error("Msg:resyncReceipts dropped")})},updateLastReceipt:function(e,t){var n=this.lastReceivedReceipt[e];(!n||t>n)&&(this.lastReceivedReceipt[e]=t)},processMultipleMessages:function(e,t,n,i){var a=this,r=function(){return s.call(a,e,t,n,i)};if(e){var o,l=this.pendingAdd[e];return o=l?l.then(r):r(),o["finally"](function(){a.pendingAdd[e]===o&&(a.pendingAdd[e]=null)})["catch"](_.noop),this.pendingAdd[e]=o}return r()}});e.exports=new I},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(458),o=i(r),l=n(1502),c=i(l),u=n(1),d=n(21),p=n(30),h=n(459),f=n(15),m=n(46),g=h.extend({model:c["default"],initialize:function(){h.prototype.initialize.call(this,{staleCollection:!0})},_initializeStaleCollection:function(){var e=this;this.listenTo(f,"change:stream",function(){f.stream===f.STREAM.DISCONNECTED&&e.forEach(function(e){e.settled||e.set("stale",!0)})})},_find:function(e){var t=Store.Msg.get(e);return t?t.isSentByMe?m.queryMsgInfo(t.id).then(function(e){return e.status>=400?(u.log("model:MsgInfo:findQuery error "+e.status)(),s["default"].reject(e.status)):(e.id=t.id,e.isPTT=t.type===o["default"].TYPE.PTT,s["default"].resolve(e))}):s["default"].reject("message not sent by me"):s["default"].reject("No message found for id: "+e)},update:function(e,t,n,i,a,s){var r=new p({from:t,to:n,id:e,participant:a}),o=new p({from:t,to:n,id:e}),l=this.get(r)?this.get(r):this.get(o),c=d.isUser(o.remote),h=void 0,f=void 0;if(l)switch(i){case 4:if(h=l.played.get(a),h||(l.played.add({id:a,t:s}),l.playedRemaining-=1),c)break;case 3:if(f=l.read.filter(function(e){return e.id===a}),l.read.remove(f),3===i&&(l.read.add({id:a,t:s}),0===f.length&&(l.readRemaining-=1)),c)break;case 2:f=l.delivery.filter(function(e){return e.id===a}),l.delivery.remove(f),2===i&&(l.delivery.add({id:a,t:s}),0===f.length&&(l.deliveryRemaining-=1));break;default:u.error("model:MsgInfo:handle ack err: "+i,arguments)()}},handle:function(e){var t=this,n=e.shift();switch(n.cmd){case"ack":this.update(n.id,n.from,n.to,n.ack,n.participant,n.t);break;case"acks":n.id.forEach(function(e){t.update(e,n.from,n.to,n.ack,n.participant,n.t)})}}});e.exports=new g},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1447),s=i(a),r=n(1),o=n(459),l=n(29),c="global_mute",u=!0,d=!0,p=!0,h=o.extend({model:s["default"],initialize:function(){o.prototype.initialize.call(this,{CachePolicy:{id:"mute",policy:o.CACHE_POLICY.LOAD,delay:1e3}})},initializeFromCache:function(){var e=l.getGlobalSounds();this.setGlobalSounds(e);var t=l.getGlobalNotifications();this.setGlobalNotifications(t);var n=l.getGlobalPreviews();this.setGlobalPreviews(n)},saveToCache:function(){if(Store.Conn.me){var e=this._config.CachePolicy.id;r.log("models:mute:cache-save: "+e)(),l.setCollection(e,[this.globalMute().toJSON()])}},globalMute:function(){var e=this.get(c);return e?e:this.add({id:c})},getGlobalSounds:function(){return u},setGlobalSounds:function(e){u=e,l.setGlobalSounds(e)},getGlobalNotifications:function(){return d},setGlobalNotifications:function(e){d=e,l.setGlobalNotifications(e)},getGlobalPreviews:function(){return p},setGlobalPreviews:function(e){p=e,l.setGlobalPreviews(e)},handle:function(e){for(var t=0;t<e.length;t++){var n=e[t],i=Store.Chat.get(n.id);i&&"mute"===n.type&&i.mute.setMute(n.muteExpiration)}}});e.exports=new h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1414),o=i(r),l=n(1),c=n(459),u=n(46),d=n(13),p=c.extend({model:o["default"],initialize:function(){c.prototype.initialize.call(this,{staleCollection:!0}),this.listenTo(Store.Stream,"change:phoneActive",this.onPresenceSubscribabilityChange)},_find:function(e){var t=this.gadd(e);return t.isUser?(t.isSubscribed=!0,u.presenceSubscribe(e)["catch"](function(e){return t.isSubscribed=!1,s["default"].reject(e)})["catch"](d.WapDrop,_.noop),u.lastseenFind(e).then(function(n){return 423===n.status?{id:e,stale:!0,hasData:!1}:401===n.status?(t.handle({id:e,deny:!0}),{id:e}):(n.id=e,t.handle(n),{id:e})})):s["default"].resolve({id:e})},handle:function(e){var t=e.shift();if(t.id===Store.Conn.me)"unavailable"===t.type?this.forEach(function(e){"unavailable"===e.type||e.stale||this.add({id:e.id,type:"unavailable",t:t.t,stale:!1},{merge:!0})}.bind(this)):l.log('models:presence:handle for self is not "unavailable" !')();else{var n=this.get(t.id);n&&("unsubscribe"===t.type?n.set({isSubscribed:!1,stale:!0}):(n.handle(t),n.stale=!1))}},onPresenceSubscribabilityChange:function(){Store.Stream.phoneActive?Store.Chat.forEach(function(e){e.active&&e.presence.isUser&&e.presence.update()["catch"](d.WapDrop,_.noop)}):this.forEach(function(e){e.reset(),e.set({stale:!0,isSubscribed:!1})})}});e.exports=new p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1448),o=i(r),l=n(115),c=i(l),u=n(1),d=n(459),p=n(29),h=n(46),f=n(13),m=n(21),g=n(479),v=n(15),y=d.extend({model:o["default"],initialize:function(){d.prototype.initialize.call(this,{staleCollection:!0,CachePolicy:{id:"profile_pic_thumb",trigger:"change:tag change:raw",policy:d.CACHE_POLICY.LOAD,delay:5e3}}),this.listenTo(c["default"],"change:phoneActive",function(){c["default"].phoneActive&&this.onPhoneActive()})},get:function(e){var t=d.prototype.get.call(this,e);if(!_.isString(e))return t;var n=d.prototype.get.call(this,g(e));if(n){if(this.remove(n,{silent:!0}),t)return t;var i=n.toJSON();return i.id=e,this.add(i,{silent:!0})}return t?t:void 0},saveToCache:function(){if(Store.Conn.me){var e=this._config.CachePolicy.id,t=this.models.filter(function(e){return m.isWid(e.id)});t=t.map(function(e){return e=e.toJSON(),e.id=g(e.id),e}),u.log("models:profilePic:cache-save: "+e)(),p.setCollection(e,t)}},onPhoneActive:function(){if(v.stream===v.STREAM.CONNECTED){var e=[];this.forEach(function(t){t._uiObservers&&t.stale&&(t.tag||t.unset("tag",{silent:!0}),e.push(t))}),this.resyncPictures(e)}},onResume:function(){var e=this.filter(_.property("_uiObservers")).map(function(e){return e.tag||e.unset("tag",{silent:!0}),e});this.resyncPictures(e)},_find:function(e){var t=Store.Chat.get(e);return t&&t.isReadOnly?h.profilePicFindThumbFromPhone(e,this.get(e)):h.profilePicFind(e).then(function(t){return 401===t.status?{id:e,raw:void 0,tag:""}:423===t.status?{id:e,stale:!0}:t.status>=400?{id:e,tag:null}:"undefined"==typeof t.status?{id:e,tag:t.tag,raw:null,eurl:t.eurl}:void 0})["catch"](f.WapDrop,function(){return{id:e,stale:!0}})},imageChanged:function(e,t){var n=Store.ProfilePicThumb.get(e);n&&("remove"===t?n.unset("tag"):n.tag!==t&&n.update()["catch"](f.WapDrop,_.noop))},resyncPictures:function(e){return 0===e.length?s["default"].resolve():h.resyncPictures(e.map(function(e){return{id:e.id,tag:e.tag}})).then(function(e){if(423===e.status)u.warn("ProfilePicThumbStore:resyncPictures blocked")();else{if(e.status>=400)throw u.error("ProfilePicThumbStore:resyncPictures error "+e.status)(e),new Error("ProfilePicThumbStore:resyncPictures error");if(!_.isArray(e))throw u.error("ProfilePicThumbStore:resyncPictures unknown reply",e)(),new Error("ProfilePicThumbStore:resyncPictures unknown reply");u.log("ProfilePicThumbStore:resyncPictures success")(),e.forEach(function(e){var t=Store.ProfilePicThumb.get(e.id);t&&t.set({tag:e.tag,raw:void 0,stale:!1})})}})["catch"](f.WapDrop,_.noop)["catch"](function(e){u.error("ProfilePicThumbStore:resyncPictures dropped: "+e)()})}});e.exports=new y},function(e,t,n){"use strict";function i(e){return"number"==typeof e&&e>0?e-1:c.MAX_GROUP_SIZE}function a(e){return"number"==typeof e&&e>0?1024*e*1024:c.MAX_MEDIA_UPLOAD_SIZE}function s(e){return"number"==typeof e&&e>0?1024*e*1024:c.MAX_FILE_SIZE}function r(e){return"number"==typeof e&&e>0?1024*e:c.IMG_MAX_BYTES}function o(e){return d.updateDocMimes(e),e}function l(e){var t;u.Global.webcBucket=e.bucket||null;for(t in f)if("undefined"!=typeof e[t]){var n,i,a=f[t];_.isArray(a)?(n=a[0],i=a[1](e[t])):(n=a,i=e[t]),n&&(c[n]=i)}for(t in h.F)"undefined"!=typeof e[t]&&h.setFeature(t,e[t])}var c=n(9),u=n(41),d=n(116),p=n(46),h=n(61),f={bucket:null,gifSearch:"SHOW_GIF_SEARCH",imageMaxEdge:"IMG_MAX_EDGE",imageMaxKBytes:["IMG_MAX_BYTES",r],maxParticipants:["MAX_GROUP_SIZE",i],maxSubject:"MAX_SUBJECT_LENGTH",media:["MAX_MEDIA_UPLOAD_SIZE",a],maxFileSize:["MAX_FILE_SIZE",s],statusV2:"STATUS_V2",statusV3:"STATUS_V3",docTypes:["DOC_TYPES",o]},m={handle:function(e){var t=e.shift();"number"==typeof t.status&&t.status>=400||l(t)},fetch:function(){return p.queryServerProps().then(function(e){"number"==typeof e.status&&e.status>=400||l(e)})}};e.exports=m},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.MediaProxy=t.MsgLoadProxy=t.StatusV3Proxy=t.ContactProxy=t.StreamProxy=t.ConnProxy=t.ChatPreferenceProxy=t.StatusProxy=t.EmojiVariantProxy=t.RecentEmojiProxy=t.ProfilePicThumbProxy=t.ChatstateProxy=t.PresenceProxy=t.MuteProxy=t.MsgInfoProxy=t.MsgProxy=t.GroupMetadataProxy=t.ChatProxy=t.CallProxy=t.BlocklistProxy=void 0;var a=n(1493);Object.defineProperty(t,"BlocklistProxy",{enumerable:!0,get:function(){return a.BlocklistProxy}});var s=n(1494);Object.defineProperty(t,"CallProxy",{enumerable:!0,get:function(){return s.CallProxy}});var r=n(1370);Object.defineProperty(t,"ChatProxy",{enumerable:!0,get:function(){return r.ChatProxy}});var o=n(1426);Object.defineProperty(t,"GroupMetadataProxy",{enumerable:!0,get:function(){return o.GroupMetadataProxy}});var l=n(458);Object.defineProperty(t,"MsgProxy",{enumerable:!0,get:function(){return l.MsgProxy}});var c=n(1502);Object.defineProperty(t,"MsgInfoProxy",{enumerable:!0,get:function(){return c.MsgInfoProxy}});var u=n(1447);Object.defineProperty(t,"MuteProxy",{enumerable:!0,get:function(){return u.MuteProxy}});var d=n(1414);Object.defineProperty(t,"PresenceProxy",{enumerable:!0,get:function(){return d.PresenceProxy}}),Object.defineProperty(t,"ChatstateProxy",{enumerable:!0,get:function(){return d.ChatstateProxy}});var p=n(1448);Object.defineProperty(t,"ProfilePicThumbProxy",{enumerable:!0,get:function(){return p.ProfilePicThumbProxy}});var h=n(1503);Object.defineProperty(t,"RecentEmojiProxy",{enumerable:!0,get:function(){return h.RecentEmojiProxy}});var f=n(1500);Object.defineProperty(t,"EmojiVariantProxy",{enumerable:!0,get:function(){return f.EmojiVariantProxy}});var m=n(1427);Object.defineProperty(t,"StatusProxy",{enumerable:!0,get:function(){return m.StatusProxy}});var g=n(1499);Object.defineProperty(t,"ChatPreferenceProxy",{enumerable:!0,get:function(){return g.ChatPreferenceProxy}});var v=n(470);Object.defineProperty(t,"ConnProxy",{enumerable:!0,get:function(){return v.ConnProxy}});var y=n(115);Object.defineProperty(t,"StreamProxy",{enumerable:!0,get:function(){return y.StreamProxy}});var _=n(237);Object.defineProperty(t,"ContactProxy",{enumerable:!0,get:function(){return _.ContactProxy}});var E=n(1391);Object.defineProperty(t,"StatusV3Proxy",{enumerable:!0,get:function(){return E.StatusV3Proxy}});var S=n(1402);Object.defineProperty(t,"MsgLoadProxy",{enumerable:!0,get:function(){return S.MsgLoadProxy}});var M=n(235),C=i(M);t.MediaProxy=C["default"].Proxy},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1503),o=i(r),l=n(9),c=n(1),u=n(459),d=n(46),p=n(13),h=n(161),f=n(61),m=u.extend({model:o["default"],comparator:function(e,t){return e.weight>t.weight?-1:1},initialize:function(){u.prototype.initialize.call(this,{CachePolicy:{id:"recent_emoji_collection",policy:u.CACHE_POLICY.LOAD,delay:2e3}}),this.listenTo(this,"change:weight change:length",this.sortTrimScale),this.dirty=!1,this.syncDue=!1},"delete":function(){u.prototype["delete"].call(this),this.dirty=!1,this.syncDue=!1},_findQuery:function(e){return f.supportsFeature(f.F.RECENT_EMOJI_SYNC)?d.recentEmojiQuery(e?this.toArray():void 0).then(function(e){return _.isArray(e)?(e.forEach(function(e){e["char"]=h.normalizeEmoji(e["char"]),e.id=e["char"]}),s["default"].resolve(e)):(c.error("models:recentEmoji:findQuery error",e)(),s["default"].reject("recent emoji fetch error"))}):s["default"].reject("gk recent emoji sync unsupported")},sync:function(){var e=this;return this.findQuery(this.dirty)["finally"](function(){e.dirty=!1})["catch"](p.WapDrop,_.isString,_.noop)},_sync:_.throttle(function(e,t){e.sync()["finally"](t)},l.EMOJI_SYNC_DELAY,{leading:!1}),periodicSync:function(){f.supportsFeature(f.F.RECENT_EMOJI_SYNC)&&(c.log("models:recentEmoji:periodicSync due:"+this.syncDue+" dirty: "+this.dirty)(),
this.syncDue=!0,this._sync(this,function(){this.syncDue=!1}.bind(this)))},sortTrimScale:function(){var e=this.length;e&&(this.sort(),e>30&&this.remove(this.models.slice(30)),_.head(this.models).weight<10&&_.last(this.models).weight>.01||this.forEach(function(t,n){t.weight=1+3*((e-n)/e)}))},increment:function(e){this.forEach(function(t){t["char"]===e?t.weight+=1:t.weight*=.9,t.weight=Math.round(1e3*t.weight)/1e3}),this.get(e)||this.add({id:e,"char":e,weight:1}),this.dirty=!0,this.periodicSync()}});e.exports=new m},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(458),o=i(r),l=n(459),c=n(15),u=n(61),d=n(1),p=l.extend({model:o["default"],initialize:function(){var e=this;this.syncPromise=null,this.isSynced=!1,this.listenTo(c,"change:stream",function(){c.stream===c.STREAM.DISCONNECTED&&(e.isSynced=!1)})},comparator:function(e,t){return t.t-e.t},onResume:function(){this.isSynced=!1,this.sync()},sync:function(){var e=this;return this.isSynced?s["default"].resolve():this.syncPromise?this.syncPromise:u.supportsFeature(u.F.STARRED_GIFS)?(this.syncPromise=Store.Msg.getStarred(void 0,void 0,void 0,!0).then(function(t){var n=[];t&&t.length&&(n=_.filter(t,function(e){return e.isGif&&!e.isUnsentMedia})),e.set(n)})["catch"](function(e){499!==e&&d.error("starred gif msgs sync error: ",e)()})["finally"](function(){e.syncPromise=null,e.isSynced=!0}),this.syncPromise):s["default"].resolve()},add:function(e,t){if(e&&u.supportsFeature(u.F.STARRED_GIFS)&&(!this.isModel(e)||e.isGif&&!this.get(e))){var n=_.filter(e,function(e){return e.isGif});return l.prototype.add.call(this,n,t)}},remove:function(e,t){if(e&&u.supportsFeature(u.F.STARRED_GIFS)&&(!this.isModel(e)||e.isGif&&this.get(e))){var n=_.filter(e,function(e){return e.isGif});l.prototype.remove.call(this,n,t)}}});e.exports=p},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1427),o=i(r),l=n(115),c=i(l),u=n(8),d=n(1),p=n(459),h=n(46),f=n(13),m=n(15),g=n(10),v=n(61),y=n(113).ActionToast,E=n(113).ActionType,S=n(9),M=p.extend({model:o["default"],initialize:function(){p.prototype.initialize.call(this,{staleCollection:!0}),this.listenTo(c["default"],"change:phoneActive",function(){c["default"].phoneActive&&this.onPhoneActive()})},onPhoneActive:function(){m.stream===m.STREAM.CONNECTED&&this.onResume()},onResume:function(){this.filter(_.property("_uiObservers")).forEach(function(e){Store.Status.find(e.id)["catch"](f.WapDrop,_.noop)})},_find:function(e){var t=S.STATUS_V2?h.statusFind(e).then(function(t){return _.isNumber(t.status)?423===t.status?{id:e,stale:!0,status:""}:t.status>=400?{id:e,status:""}:void 0:{id:e,status:t.status}})["catch"](f.WapDrop,function(){return{id:e,stale:!0,status:""}}):s["default"].resolve({id:e,status:""});return t},_handle:function(e){return e},canSetMyStatus:function(){return v.supportsFeature(v.F.SET_STATUS)&&!!S.STATUS_V2},setMyStatus:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments[1];if(t=t.trim(),!t)return s["default"].reject(new f.ActionError);if(!this.canSetMyStatus())return s["default"].reject(new f.ActionError);var i=h.sendSetStatus(t),a=new E(l10n.t("action_status_setting")),r=this.get(Store.Conn.me).status;n=n||y.genId();var o=i.then(function(t){return 200===t.status?new E(l10n.t("action_status_set"),l10n.t("action_undo"),e.setMyStatus.bind(e,r,n)):t.status>=400?new E(l10n.t("action_status_set_failed")):void 0})["catch"](function(i){throw d.error("models:statusCollection:setMyStatus dropped")(i),new E(l10n.t("action_status_set_failed"),l10n.t("action_try_again"),e.setMyStatus.bind(e,t,n))});return g.openToast(u.createElement(y,{id:n,initialAction:a,pendingAction:o})),i.bind(this).then(function(e){200!==e.status||e._duplicate||(this.get(Store.Conn.me).status=t)})}});e.exports=new M},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1391),o=i(r),l=n(76),c=i(l),u=n(79),d=i(u),p=n(459),h=n(9),f=n(13),m=n(1),g=n(46),v=86400,y=p.extend({model:o["default"],initialize:function(){p.prototype.initialize.call(this)},"delete":function(){p.prototype["delete"].call(this),delete this.checksum},_find:function(e){return s["default"].resolve({id:e})},_findQuery:function(e){var t=this;return g.statusQuery().then(function(e){return t.checksum=e.checksum,e.statuses.map(function(e){return e.pic?s["default"].resolve(new d["default"]([e.pic])):e})})},loadMore:function(e,t,n){return g.statusQuery(e,t,n&&n.id,"after").then(function(e){return e.status>=400?(m.error("model:statusv3:findQuery error "+e.status)(),s["default"].reject(e.status)):(e.forEach(function(e){e.invis=!0}),m.log("model:statusv3:loadMore:"+e.length)(),Store.Msg.processMultipleMessages(h.STATUS_WID,e,{add:"after",isHistory:!0}))})},sync:function(e){return!e||this.checksum&&this.checksum!==e?this.findQuery({},{set:this.hasSynced()})["catch"](f.WapDrop,_.noop):s["default"].resolve(void 0)},hasSynced:function(){return!!this.checksum},handleUpdate:function(e,t,n){var i=e.id.fromMe?Store.Conn.me:e.author;if(this.updateChecksum(t),this.hasSynced()){if(n)return!0;var a=this.get(i);if(a){var s=a.totalCount===a.msgs.length;return e.invis||a.unreadCount++,a.totalCount++,a.t=e.t,!s&&e.body&&(a.pic=new d["default"]((0,u.createFromBase64)(e.body))),s}return this.add({id:i,t:e.t,unreadCount:e.invis?0:1,totalCount:1,_msgs:[e]}),!1}return!1},updateChecksum:function(e){e?this.hasSynced()&&(this.checksum=e):m.info("models:statusV3:no_checksum")()},handle:function(e){var t=e.shift();if(_.isArray(t))m.warn("models:statusV3:unexpected update")(t);else switch(t.type){case"read":this.updateChecksum(t.checksum);var n=this.get(t.chat);n?n.handleReadStatus(t.key):m.log("models:statusV3:read:no_status:"+[t.chat,t.key].join())(t);break;case"privacy":Store.StatusV3Privacy.update(t);break;default:m.warn("models:statusV3:unknown:"+t.type,t)()}},addStatusMessages:function(e,t){return Store.Msg.processMultipleMessages(h.STATUS_WID,t,{add:"after",isHistory:!0})},getUnexpired:function(e){var t=this.filter(function(e){return e.totalCount>0&&c["default"].globalUnixTime()-e.t<=v&&!e.contact.isMe});if(e){var n=_.sortBy(_.filter(t,function(e){return e.unreadCount>0}),function(e){return e.t});return n.reverse(),n}var i=_.sortBy(_.filter(t,function(e){return 0===e.unreadCount}),function(e){return e.t});return i.reverse(),i},getMyStatus:function(){var e=this.filter(function(e){return e.contact.isMe});return _.isEmpty(e)?void 0:c["default"].globalUnixTime()-e[0].t>v?void 0:e[0]}});e.exports=new y},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(77),o=i(r),l=n(1),c=n(15),u=n(46),d=n(21),p=(0,r.defineState)("StatusPrivacy",{props:{id:"number",blacklist:{type:"array","default":function(){return[]}},whitelist:{type:"array","default":function(){return[]}},type:"string"},session:{isValid:"boolean"},initialize:function(){var e=this;o["default"].prototype.initialize.call(this),this.isValid=!1,this.listenTo(c,"change:stream",function(){c.stream===c.STREAM.RESUMING&&(e.isValid=!1)})},query:function(){var e=this;return u.getStatusPrivacy().then(function(t){switch(t.status){case 200:e.set({blacklist:t.blacklist,whitelist:t.whitelist,type:t["default"],isValid:!0});break;case 404:e.set({type:"contacts",isValid:!0});break;default:return l.error("statusV3Privacy:query:error:"+t.status,t)(),s["default"].reject(t.status)}})},update:function(e){this.isValid&&(e.whitelist&&this.set({type:"whitelist",whitelist:e.whitelist}),e.blacklist&&this.set({type:"blacklist",blacklist:e.blacklist}),e.contacts&&(this.type="contacts"))},sendSetPrivacy:function(e,t){var n=this;if(!this.isValid)return s["default"].reject("called setPrivacy when isValid false");var i;switch(e){case"blacklist":case"whitelist":if(i=_.isArray(t)?t.filter(function(e){return d.isUser(e)}):void 0,!_.isArray(i)||0===i.length)return s["default"].reject("called setPrivacy blacklist/whitelist with no valid jids");break;case"contacts":break;default:e="contacts"}return u.setStatusPrivacy(e,i).then(function(t){if(200===t.status){var a={};a[e]=i,n.update(a)}return t})["catch"](function(e){})}}),h=p.StatusPrivacy;e.exports=new h({id:1})},function(e,t){"use strict";e.exports={Action:"keyboard_action",Event:"keyboard_event",Events:{LOGGED_IN:"logged_in",LOGGED_OUT:"logged_out",ARCHIVE:"archived",MUTE:"muted",READ:"read",READ_ONLY:"read_only",CHAT_KIND:"chat_kind",ZOOM:"zoom",LAUNCH:"launch"},Actions:{PREFERENCES:"preferences",NEW_CHAT:"new_chat",NEW_GROUP:"new_group",PROFILE_STATUS:"profile_status",LOGOUT:"logout",SEARCH:"search",ZOOM_IN:"zoom_in",ZOOM_OUT:"zoom_out",ZOOM_RESET:"zoom_reset",TOGGLE_UNREAD:"toggle_unread",DELETE_CHAT:"delete_chat",DELETE_GROUP:"delete_group",EXIT_GROUP:"exit_group",TOGGLE_ARCHIVE:"toggle_archive",TOGGLE_MUTE:"toggle_mute",SEARCH_CHAT:"search_chat",NEXT_CHAT:"next_chat",PREV_CHAT:"prev_chat",CONTACT_US:"contact_us",METRIC_UPDATE:"metric_update"},Metrics:{BETA_UPDATES:"beta_updates"}}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(115),o=i(r),l=n(8),c=n(9),u=n(93),d=n(156),p=n(158),h=n(21),f=n(13),m=n(462),g=n(250),v=l.createClass({displayName:"NotificationManager",mixins:[u,d,p],componentWillMount:function(){this.tone=new Audio(c.NOTIFICATION_TONE_PATH),this.regCmd("alert_new_msg",this.alertNewMsg),this.regCmd("alert_call",this.showCallNotification),this.regCmd("cancel_call",this.cancelCallNotification),this.addObserver(Store.Chat,"add remove reset change:archive change:unreadCount",this.updateUnreadCount),this.addObserver(Store.Chat,"change:hasUnread",this.closeNotifications),this.addObserver(o["default"],"change:displayInfo",this.updateUnreadCount)},componentDidMount:function(){this.updateUnreadCount()},componentWillUnmount:function(){g.setTitleAndIcon(0),g.closeAllNotifications()},closeNotifications:function(e,t){t||g.closeChatNotifications(e.id)},updateUnreadCount:function(){var e;e=o["default"].displayInfo===o["default"].INFO.OFFLINE?-1:o["default"].displayInfo===o["default"].INFO.TIMEOUT?-1:Store.Chat.filter(function(e){return!e.archive&&e.isDirty()}).length,this.count!==e&&(this.count=e,g.setTitleAndIcon(e))},alertNewMsg:function(e){var t=e.chat;if(!(document.hasFocus()&&t.get("active")||Store.Mute.globalMute().isMuted)){if(t.mute.isMuted){if(!e.isGroupMsg)return;if(!e.isMentioned(Store.Conn.me)&&!e.isQuoted(Store.Conn.me))return;var n=Store.Chat.get(e.sender);if(n&&n.mute.isMuted)return}if(Store.Mute.getGlobalNotifications()&&this.showDesktopNotification(e),Store.Mute.getGlobalSounds())if(t.isGroup){var i=Date.now(),a=t.squelch||0;i>a&&(this.playAudioNotification(),Store.GroupMetadata.find(t.id).then(function(e){var n=e.participants.length,a=1e3*Math.min(120,30+5*n);t.squelch=i+a})["catch"](f.WapDrop,function(){t.squelch=i+6e4}))}else this.playAudioNotification()}},showCallNotification:function(e,t,n){if(window.Notification&&window.Notification.permission===c.PERMISSION_ALLOWED){var i=Store.Contact.get(t),a=i?i.get("formattedName"):h.formattedUser(t),r=n?l10n.t("incoming_video_call_notification_title",{name:a}):l10n.t("incoming_voice_call_notification_title",{name:a}),o=l10n.t("incoming_call_notification_text");Store.ProfilePicThumb.find(t).timeout(1e3,"showCallNotificationTimeout").then(function(n){var i=n&&n.img?n.img:c.USER_DEFAULT_ICON;g.showNotification(t,e,r,o,i,!0)})["catch"](f.WapDrop,s["default"].TimeoutError,function(n){g.showNotification(t,e,r,o,c.USER_DEFAULT_ICON,!0)}),Store.Mute.getGlobalSounds()&&this.playAudioNotification()}},cancelCallNotification:function(e){g.closeNotification(e),Store.Call.remove(Store.Call.get(e))},showDesktopNotification:function(e){if(window.Notification&&window.Notification.permission===c.PERMISSION_ALLOWED){var t=e.get("chat"),n=t.get("id"),i=m.asDesktopNotification(e);i&&i.charCodeAt(0)>=128&&(i=" "+i);var a=t.isGroup?c.GROUP_DEFAULT_ICON:c.USER_DEFAULT_ICON,r=t.isGroup?l10n.t("default_group_message_notification_title"):l10n.t("default_contact_message_notification_title");Store.ProfilePicThumb.find(n).timeout(1500,"showDesktopNotificationTimeout").then(function(s){var o=t.contact.formattedName||r,l=s?s.img:"";g.showNotification(n,e.id,o,i,l||a,!1)})["catch"](f.WapDrop,s["default"].TimeoutError,function(s){var o=t.contact.formattedName||r;g.showNotification(n,e.id,o,i,a,!1)})}},playAudioNotification:function(){this.tone.play()},render:function(){return null}});e.exports=v},function(e,t,n){"use strict";function i(e){o(this,i,e)}function a(e){o(this,a,e)}var s=n(118),r=s.defineProtobufClass,o=s.construct,l=3,c=13,u=14;r(i,{publicKey:[1,c],identifier:[2,c]}),r(a,{version:[1,l],localFingerprint:[2,u,i],remoteFingerprint:[3,u,i]}),e.exports={FingerprintData:i,CombinedFingerprint:a}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(8),m=i(f),g=n(1378),v=i(g),y=n(1396),_=i(y),E=n(1505),S=i(E),M=n(1391),C=(i(M),n(237)),b=(i(C),n(76)),T=i(b),P=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"render",value:function(){var e=this.props,t=e.statusV3,n=e.contact;return m["default"].createElement(_["default"],{id:t.id,key:t.id,image:m["default"].createElement(S["default"],{statusV3:t}),primary:n.formattedName,secondary:T["default"].relativeDateAndTimeStr(t.t),onClick:this.props.onClick,contextEnabled:function(){return!1}})}}]),t}(f.PureComponent);P.CONCERNS={statusV3:["id","t","unreadCount","totalCount"],contact:["formattedName"]},t["default"]=(0,v["default"])(P)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(112),s=i(a),r=n(16),o=i(r),l=n(4),c=i(l),u=n(6),d=i(u),p=n(20),h=i(p),f=n(19),m=i(f),g=n(8),v=i(g),y=n(1378),_=i(y),E=n(1391),S=(i(E),n(44)),M=i(S),C=50,b=10,T=function(e){function t(){return(0,c["default"])(this,t),(0,h["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"genCircle",value:function(e){var t=2*C+this.props.stroke;return v["default"].createElement("circle",(0,s["default"])({cx:t/2,cy:t/2,r:C,fill:"none",strokeLinecap:"round",strokeWidth:this.props.stroke},e))}},{key:"genDasharray",value:function(e,t,n){for(var i="",a=0;e>a;a++)i+=a===e-1?t+" "+(n-e*(b+t)+b)+" ":t+" "+b+" ";return i}},{key:"render",value:function(){var e=this.props,t=e.statusV3,n=e.stroke,i=e.size,a=2*C+n,s="0 0 "+a+" "+a,r=Math.PI*C*2,o=(r-b*t.totalCount)/t.totalCount,l=r/4-b/2,c=void 0,u=t.totalCount-t.unreadCount;if(u){var d=l+t.totalCount*(b+o),p=void 0;1!==t.totalCount&&(p=this.genDasharray(u,o,r)),c=this.genCircle({strokeDashoffset:d,strokeDasharray:p,className:"image-ring-read"})}var h=void 0;if(t.unreadCount){var f=l+t.unreadCount*(b+o),m=void 0;1!==t.totalCount&&(m=this.genDasharray(t.unreadCount,o,r)),h=this.genCircle({strokeDashoffset:f,strokeDasharray:m,className:"image-ring-unread"})}return v["default"].createElement("svg",{className:(0,M["default"])("status-image-ring",this.props.className),width:i,height:i,viewBox:s},c,h)}}]),t}(g.PureComponent);T.CONCERNS={statusV3:["unreadCount","totalCount"]},T.defaultProps={size:48,stroke:4},t["default"]=(0,_["default"])(T)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(8),m=i(f),g=n(1377),v=i(g),y=n(159),_=i(y),E=n(1621),S=i(E),M=n(10),C=i(M),b=n(18),T=i(b),P=n(1411),k=P.MenuBarItem,N=function(e){function t(){var e,n,i,a;(0,o["default"])(this,t);for(var r=arguments.length,l=Array(r),c=0;r>c;c++)l[c]=arguments[c];return n=i=(0,d["default"])(this,(e=t.__proto__||(0,s["default"])(t)).call.apply(e,[this].concat(l))),i.state={hasUnread:!1},i.onUnreadChange=function(){var e=T["default"].some(Store.StatusV3.getUnexpired(!0),function(e){return e.unreadCount>0});e!==i.state.hasUnread&&i.setState({hasUnread:e})},a=n,(0,d["default"])(i,a)}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"componentWillMount",value:function(){this.props.listeners.add(Store.StatusV3,"add remove change:unreadCount",this.onUnreadChange)}},{key:"onStatus",value:function(e){e.preventDefault(),C["default"].openModalMedia(m["default"].createElement(S["default"],{removeTopDrawer:!1}),"status-v3-modal")}},{key:"render",value:function(){var e=this.state.hasUnread?"status-v3-unread":"status-v3";return m["default"].createElement(k,{icon:e,a8n:"menu-bar-status",title:_["default"].t("web_menuitem_status"),onClick:this.onStatus})}}]),t}(f.PureComponent);N.CONCERNS={statusV3:["unreadCount"]},t["default"]=(0,v["default"])(N)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0}),t.StatusV3GifController=t.StatusV3CountdownController=t.StatusV3VideoController=void 0;var a=n(4),s=i(a),r=n(6),o=i(r),l=n(1),c=t.StatusV3VideoController=function(){function e(){(0,s["default"])(this,e),this._onPlayingHandler=this._onPlayingHandler.bind(this),this._onPauseHandler=this._onPauseHandler.bind(this),this._onEndedHandler=this._onEndedHandler.bind(this)}return(0,o["default"])(e,[{key:"addListeners",value:function(e,t,n){this._onStart=e,this._onPause=t,this._onEnded=n}},{key:"setVideo",value:function(e){this._video=e,this._video.addEventListener("playing",this._onPlayingHandler),this._video.addEventListener("pause",this._onPauseHandler),this._video.addEventListener("ended",this._onEndedHandler)}},{key:"play",value:function(){this._video&&this._video.play()}},{key:"pause",value:function(){this._video&&!this._video.paused&&this._video.pause()}},{key:"resume",value:function(){this._video&&this._video.play()}},{key:"stop",value:function(){this._video&&!this._video.paused&&this._video.pause()}},{key:"_onPlayingHandler",value:function(){var e=this._onStart;e&&e(1e3*(this._video.duration-this._video.currentTime),1e3*this._video.duration)}},{key:"_onPauseHandler",value:function(){var e=this._onPause;e&&e()}},{key:"_onEndedHandler",value:function(){var e=this._onEnded;e&&e()}}]),e}(),u=t.StatusV3CountdownController=function(){function e(t){(0,s["default"])(this,e),this._duration=t,this._timeout=this._duration,this._start=0,this._onTimeup=this._onTimeup.bind(this)}return(0,o["default"])(e,[{key:"addListeners",value:function(e,t,n){this._onStart=e,this._onPause=t,this._onEnded=n}},{key:"play",value:function(){if(this._timer)return void l.error("Duplicate timer start")();this._timer=setTimeout(this._onTimeup,this._timeout),this._start=(new Date).getTime();var e=this._onStart;e&&e(this._timeout,this._duration)}},{key:"stop",value:function(){if(this._timer){clearTimeout(this._timer),this._timer=null;var e=(new Date).getTime();this._timeout-=e-this._start;var t=this._onPause;t&&t()}else l.error("Timer stop called on stopped timer")()}},{key:"resume",value:function(){this.play()}},{key:"pause",value:function(){this.stop()}},{key:"_onTimeup",value:function(){var e=this._onEnded;e&&e()}}]),e}(),d=6e3,p=3;t.StatusV3GifController=function(){function e(){(0,s["default"])(this,e),this._playCounter=0,this._timerEnded=!1,this._videoEnded=!1,this._onVideoStartHandler=this._onVideoStartHandler.bind(this),this._onVideoPauseHandler=this._onVideoPauseHandler.bind(this),this._onVideoEndedHandler=this._onVideoEndedHandler.bind(this),this._onTimerEndedHandler=this._onTimerEndedHandler.bind(this),this._videoController=new c,this._countdownController=new u(d),this._videoController.addListeners(this._onVideoStartHandler,this._onVideoPauseHandler,this._onVideoEndedHandler),this._countdownController.addListeners(null,null,this._onTimerEndedHandler)}return(0,o["default"])(e,[{key:"addListeners",value:function(e,t,n){this._onStart=e,this._onPause=t,this._onEnded=n}},{key:"setVideo",value:function(e){this._video=e,this._videoController.setVideo(e)}},{key:"_onVideoStartHandler",value:function(){var e=this._onStart,t=Math.max(p*this._video.duration*1e3,d);e&&e(t-1e3*this._video.duration*this._playCounter-1e3*this._video.currentTime,t)}},{key:"_onVideoPauseHandler",value:function(){var e=this._onPause;e&&e()}},{key:"_onVideoEndedHandler",value:function(){var e=this;this._playCounter++;var t=this._onEnded;this._playCounter===p&&(this._videoEnded=!0,this._timerEnded&&t&&t()),this._video.currentTime=0,this._videoEnded&&this._timerEnded||setTimeout(function(){e._videoController.play()},0)}},{key:"_onTimerEndedHandler",value:function(){var e=this._onEnded;this._timerEnded=!0,e&&this._videoEnded&&e()}},{key:"play",value:function(){this._videoController.play(),this._countdownController.play()}},{key:"stop",value:function(){this._videoController.stop(),this._countdownController.stop()}},{key:"resume",value:function(){this._videoController.resume(),this._countdownController.resume()}},{key:"pause",value:function(){this._videoController.pause(),this._countdownController.pause()}}]),e}()},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(16),o=i(r),l=n(4),c=i(l),u=n(6),d=i(u),p=n(20),h=i(p),f=n(19),m=i(f),g=n(8),v=i(g),y=n(460),_=i(y),E=n(45),S=n(44),M=function(e){function t(){return(0,c["default"])(this,t),(0,h["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"render",value:function(){for(var e=[],t=100/this.props.total+"%",n=0;n<this.props.total;++n){var i=S("progress-bar-fg",{"v3-pgbar-filled":n<this.props.current,"v3-pgbar-empty":n>this.props.current,"v3-pgbar-active":n===this.props.current}),a={width:t},s=void 0;n===this.props.current&&(s="bar");var r=v["default"].createElement("div",{className:"progress-bar-wrapper",style:a,key:n},v["default"].createElement("div",{className:"progress-bar-bg"}),v["default"].createElement("div",{className:"progress-bar-mask"},v["default"].createElement("div",{className:i,ref:s})));e.push(r)}return v["default"].createElement("div",{className:"progress-bar-container"},e)}},{key:"onStart",value:function(e,t){var n=E.findDOMNode(this.refs.bar),i="-"+e/t*100+"%";(0,_["default"])(n,"stop"),this.barAnimation=(0,_["default"])(n,{translateX:["0%",i]},{duration:e,easing:"linear"})}},{key:"onPause",value:function(){var e=E.findDOMNode(this.refs.bar);(0,_["default"])(e,"stop")}},{key:"onEnded",value:function(){return this.barAnimation?this.barAnimation:s["default"].resolve()}}]),t}(v["default"].Component);e.exports=M},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(2),s=i(a),r=n(1730),o=n(116),l=n(1),c={enrich:function(e){switch(o.previewType(e.mimetype)){case"pdf":return this.enrichPdf(e);case"msoffice":return this.enrichDoc(e);default:return s["default"].resolve({media:e})}},enrichPdf:function(e){var t,n=e.mediaBlob;return r.fileToPdf(n).then(function(n){return t=n,r.pdfToImg(n,1).then(function(t){var i=t;return i.pdfPages=n.numPages,{media:e,documentPreview:i}})})["catch"](function(t){return l.log("pdf preview generation failed",t)(),{media:e}})["finally"](function(){t&&r.releasePdf(t)})},enrichDoc:function(e){return s["default"].resolve({media:e})}};e.exports=c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){return d["default"].loop(function(t,i,a){var s=d["default"].delay(M["default"].expBackoff(a,12e4,1e3,.1));return n(1514)("./"+e+"/translation.json")().then(t)["catch"](function(){return s})})["catch"](function(){return{}})}function s(){var e=["en"],t=l10n.getLocale();"en"!==t&&_.indexOf(N,t)>=0&&e.push(t),w=d["default"].map(e,function(e){return a(e)}).then(function(e){var t=e[0];e.length>1&&(t=_.assign({},t,e[1]));var n=_.map(t,function(e,t){var n=t.substring(0,5);return{value:e,keyword:t,shortKeyword:n}});k=(0,h["default"])(n,"shortKeyword")})["catch"](_.noop)["finally"](function(){w=null})}function r(e){if(!k)return[];if(e.length<=5)return k.getMatches(e);var t=e.substring(0,5),n=k.getMatches(t);return n=_.filter(n,function(t){return _.startsWith(t.keyword,e)})}function o(e){var t=[];if(e){var n=l(e.toLowerCase());t=_.uniq(n)}return t}function l(e){var t=r(e),n=_.flatMap(_.filter(t,{keyword:e}),"value");t=_.flatMap(t,"value");var i=_.intersection(_.map(Store.RecentEmoji.models,"char"),t),a=_.intersection(T,t);return n=_.compact(_.map(n,function(e){return m["default"].emojiMap[e]})),n=c(n),i=_.compact(_.map(i,function(e){return m["default"].emojiMap[e]})),a=_.compact(_.map(a,function(e){return m["default"].emojiMap[e]})),t=_.compact(_.map(t,function(e){return m["default"].emojiMap[e]})),t=_.difference(t,_.union(n,i,a)),t=c(t),_.union(n,i,a,t)}function c(e){var t={};return _.forEach(P,function(e){t[e]=[]}),_.forEach(e,function(e){var n=m["default"].getCategoryString(e);t[n].push(e)}),_.forEach(t,function(e,n){e.length>0&&(t[n]=_.intersection(v["default"][n],e))}),_.flatMap(t)}Object.defineProperty(t,"__esModule",{value:!0});var u=n(2),d=i(u);t["default"]=o;var p=n(1282),h=i(p),f=n(161),m=i(f),g=n(477),v=i(g),y=n(10),E=i(y),S=n(63),M=i(S),C=n(40),b=i(C),T=["😂","😍","😘","🤣","😀","❤️","😉","😊","🤔","😭","😁","😜","👏","😎","👍","😬","😆","🙂","😇","😠","😅","☺️","🤗","😄","😒","😃","😏","😌","👌","😝","🙃","😋","🎂","😡","😱","🙏","😔","😢","😳","😞","🤤","👊","😛","😚","🙄","💕","✌️","💪","💞","🌹"],P=["SMILEYS_PEOPLE","ANIMALS_NATURE","FOOD_DRINK","ACTIVITY","TRAVEL_PLACES","OBJECTS","SYMBOLS","FLAGS","VARIATION"],k=null,N=["en","de","es","it","pt","ru"],w=null;E["default"].on("locale_change",function(){w&&w.cancel(),s()}),b["default"].waitForBBEvent(Store.Stream,"change:mode",function(){return Store.Stream.mode===Store.Stream.MODE.MAIN}).then(function(){w||s()})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1712),a={selectable:!0},s={selectable:!1},r=[[[i.Code,a]],[[i.Link,a]],[[i.Bold,a],[i.Italic,a],[i.Strikethrough,a]],[[i.Break],[i.Emoji,a]]],o=[[[i.Code,a]],[[i.Bold,a],[i.Italic,a],[i.Strikethrough,a]],[[i.Break],[i.Emoji,a]]],l=[[[i.Code,s]],[[i.Bold,s],[i.Italic,s],[i.Strikethrough,s]],[[i.Break],[i.Emoji,s]]],c=[[[i.Emoji,a]]],u=[[[i.Emoji,{selectable:!0,large:!0}]]];t["default"]={EmojiOnly:function(){return c},LargeEmojiOnly:function(){return u},Compatibility:function(){return[[[i.Break],[i.Emoji,a]]]},TrustedConversation:function(e){return e?[[[i.Code,a]],[[i.Link,a]],[[i.Bold,a],[i.Italic,a],[i.Strikethrough,a]],[[i.Mention,e]],[[i.Break],[i.Emoji,a]]]:r},UntrustedConversation:function(e){return e?[[[i.Code,a]],[[i.Bold,a],[i.Italic,a],[i.Strikethrough,a]],[[i.Mention,e]],[[i.Break],[i.Emoji,a]]]:o},Highlight:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!1;return[[[i.Highlight,{terms:e,boundary:t,selectable:!1}]],[[i.Emoji,s]]]},LastMessage:function(e){return e?[[[i.Code,s]],[[i.Bold,s],[i.Italic,s],[i.Strikethrough,s]],[[i.TextMention,e]],[[i.Break],[i.Emoji,s]]]:l},FTSMessage:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:!1;return[[[i.Code,s]],[[i.Bold,s],[i.Italic,s],[i.Strikethrough,s]],[[i.TextMention,e]],[[i.Highlight,{terms:t,boundary:n,selectable:!1}]],[[i.Break],[i.Emoji,s]]]},Format:function(e){return[[[i.Code,a]],[[i.Bold,a],[i.Italic,a],[i.Strikethrough,a]],[[i.Mention,e]],[[i.Break],[i.Emoji,a]]]},ComposeBox:function(){return[[[i.Code,s]],[[i.Link,s]],[[i.Bold,s],[i.Italic,s],[i.Strikethrough,s]],[[i.Emoticon]]]}}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e.index,i=(0,r["default"])(e,1),a=i[0],s=n+a.length-1,o=[n,n,s,s,e];if(t){var l=e[t];o[1]=n+a.indexOf(l),o[2]=o[1]+l.length-1}return o}Object.defineProperty(t,"__esModule",{value:!0});var s=n(35),r=i(s);t["default"]=a},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(8),m=i(f),g=n(1701),v=i(g),y=n(1450),_=i(y),E=n(1404),S=i(E),M=/(?:^|[\s\W_])\*(\S|\S[^\n]*?\S)\*(?=$|[[\s\W_])/g,C=(0,_["default"])("*"),b=(0,S["default"])(M,1,C),T=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,null,[{key:"jsx",value:function(e,t,n){var i=n.selectable;return m["default"].createElement(v["default"],{selectable:i},e)}}]),t}(b);t["default"]=T},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(35),s=i(a),r=n(16),o=i(r),l=n(4),c=i(l),u=n(6),d=i(u),p=n(20),h=i(p),f=n(19),m=i(f),g=n(1430),v=i(g),y=n(1415),_=i(y),E=n(244),S=n(54),M=15,C=new RegExp("("+E.arabic+"{"+M+"})("+E.arabic+")","g"),b=function(e){function t(){return(0,c["default"])(this,t),(0,h["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,m["default"])(t,e),(0,d["default"])(t,null,[{key:"match",value:function(e){return!S.isWebkit||e.length<M?[]:(0,v["default"])(e,C)}}]),t}(_["default"]);b.fragment=!0,b.compatibility=!0,b.mutates=!0,b.mutate=function(e,t){var n=(0,s["default"])(t,3),i=n[1],a=n[2];return i+"​"+a},b.jsx=function(){},t["default"]=b},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(8),m=i(f),g=n(1404),v=i(g),y=n(1702),_=i(y),E=/```([\s\S]*?\S[\s\S]*?)```/g,S=(0,v["default"])(E,1),M=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,null,[{key:"jsx",value:function(e,t,n){var i=n.selectable;return m["default"].createElement(_["default"],{selectable:i},e)}}]),t}(S);M.nestable=!1,M.format=!1,t["default"]=M},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(8),s=i(a),r=n(44),o=i(r);t["default"]=function(e){var t=e.selectable,n=e.children;return s["default"].createElement("strong",{className:(0,o["default"])({"selectable-text":t})||void 0},n)}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(8),s=i(a),r=n(44),o=i(r);t["default"]=function(e){var t=e.selectable,n=e.children;return s["default"].createElement("code",{className:(0,o["default"])({"selectable-text":t})||void 0},n)}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(8),s=i(a),r=n(1541),o=i(r),l=n(44),c=i(l);t["default"]=function(e){var t=e.emoji,n=e.large,i=e.selectable;return s["default"].createElement(o["default"],{emoji:t,size:n?"large":"small",className:(0,c["default"])({"selectable-text":i})})}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(8),s=i(a),r=n(44),o=i(r);t["default"]=function(e){var t=e.href,n=e.selectable,i=e.children;return s["default"].createElement("a",{href:t,className:(0,o["default"])({"selectable-text":n}),target:"_blank",rel:"noopener noreferrer"},i)}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(8),s=i(a),r=n(44),o=i(r);t["default"]=function(e){var t=e.selectable,n=e.children;return s["default"].createElement("em",{className:(0,o["default"])({"selectable-text":t})||void 0},n)}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}
Object.defineProperty(t,"__esModule",{value:!0});var a=n(8),s=i(a),r=n(44),o=i(r);t["default"]=function(e){var t=e.href,n=e.selectable,i=e.children;return s["default"].createElement("a",{className:(0,o["default"])({"selectable-text":n}),href:t,title:t,target:"_blank",rel:"noopener noreferrer"},i)}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(8),s=i(a),r=n(10),o=i(r),l=n(240);t["default"]=function(e){var t=e.jid,n=e.display,i=(0,l.dir)(n)||"auto",a=function(){var e=Store.Contact.gadd({id:t}),n=Store.Chat.gadd(e.id);o["default"].chatInfoDrawer(n)};return s["default"].createElement("span",{onClick:a,"data-jid":t,"data-display":n,className:"matched-mention"},s["default"].createElement("span",{className:"at-symbol selectable-text"},"@"),s["default"].createElement("span",{dir:i,className:"selectable-text"},n))}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(8),s=i(a),r=n(44),o=i(r);t["default"]=function(e){var t=e.selectable,n=e.children;return s["default"].createElement("del",{className:(0,o["default"])({"selectable-text":t})||void 0},n)}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){return S.emojiMap[e[0]]?e:null}Object.defineProperty(t,"__esModule",{value:!0});var s=n(35),r=i(s),o=n(16),l=i(o),c=n(4),u=i(c),d=n(6),p=i(d),h=n(20),f=i(h),m=n(19),g=i(m),v=n(8),y=i(v),_=n(1404),E=i(_),S=n(161),M=n(1703),C=i(M),b=(0,E["default"])((0,S.emojiRegex)(),0,a),T=function(e){function t(){return(0,u["default"])(this,t),(0,f["default"])(this,(t.__proto__||(0,l["default"])(t)).apply(this,arguments))}return(0,g["default"])(t,e),(0,p["default"])(t,null,[{key:"jsx",value:function(e,t,n){var i=(0,r["default"])(t,1),a=i[0],s=n.large,o=n.selectable;return y["default"].createElement(C["default"],{emoji:a,large:s,selectable:o},e)}}]),t}(b);T.compatibility=!0,t["default"]=T},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){var n=(0,r["default"])(e,2),i=n[1];return i&&(e.index+=i.length,e[0]=e[0].slice(i.length)),e}Object.defineProperty(t,"__esModule",{value:!0});var s=n(35),r=i(s),o=n(16),l=i(o),c=n(4),u=i(c),d=n(6),p=i(d),h=n(20),f=i(h),m=n(19),g=i(m),v=n(18),y=i(v),_=n(1404),E=i(_),S=n(161),M={"(y)":"👍","(n)":"👎",":-)":"🙂",":-(":"🙁",":-p":"😛",":-|":"😐",":-\\":"😕",":-d":"😀",":-*":"😘","<3":"❤","^_^":"😁",">_<":"😆",";-)":"😉"},C=y["default"].keys(M).map(y["default"].escapeRegExp).join("|"),b="\\s|```|[*_~]",T=new RegExp("(^|"+b+")((?:"+C+")+)(?=$|"+b+")","ig"),P=new RegExp("("+C+")","i"),k=(0,E["default"])(T,2,a),N=function(e){function t(){return(0,u["default"])(this,t),(0,f["default"])(this,(t.__proto__||(0,l["default"])(t)).apply(this,arguments))}return(0,g["default"])(t,e),(0,p["default"])(t,null,[{key:"mutate",value:function(e){return e.split(P).map(function(e){var t=M[e.toLowerCase()];return t?S.skinToneEmojis[t]?Store.EmojiVariant.getVariant(t)||t:t:e}).join("")}}]),t}(k);N.fragment=!0,N.mutates=!0,t["default"]=N},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!1,n=e.map(g["default"].escapeRegExp).join("|");return new RegExp((t?"(?:^|\\b)":"")+"("+n+")","ig")}Object.defineProperty(t,"__esModule",{value:!0});var s=n(16),r=i(s),o=n(4),l=i(o),c=n(6),u=i(c),d=n(20),p=i(d),h=n(19),f=i(h),m=n(18),g=i(m),v=n(44),y=i(v),_=n(1430),E=i(_),S=n(1415),M=i(S),C=n(8),b=i(C),T=function(e){function t(){return(0,l["default"])(this,t),(0,p["default"])(this,(t.__proto__||(0,r["default"])(t)).apply(this,arguments))}return(0,f["default"])(t,e),(0,u["default"])(t,null,[{key:"match",value:function(e,t){var n=t.terms,i=t.boundary;return n.length?(0,E["default"])(e,a(n,i)):[]}}]),t}(M["default"]);T.jsx=function(e,t,n){var i=n.selectable;return b["default"].createElement("span",{className:(0,y["default"])("matched-text",{"selectable-text":i})},e)},t["default"]=T},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(1698);Object.defineProperty(t,"Bold",{enumerable:!0,get:function(){return i(a)["default"]}});var s=n(1699);Object.defineProperty(t,"Break",{enumerable:!0,get:function(){return i(s)["default"]}});var r=n(1700);Object.defineProperty(t,"Code",{enumerable:!0,get:function(){return i(r)["default"]}});var o=n(1709);Object.defineProperty(t,"Emoji",{enumerable:!0,get:function(){return i(o)["default"]}});var l=n(1710);Object.defineProperty(t,"Emoticon",{enumerable:!0,get:function(){return i(l)["default"]}});var c=n(1711);Object.defineProperty(t,"Highlight",{enumerable:!0,get:function(){return i(c)["default"]}});var u=n(1713);Object.defineProperty(t,"Intern",{enumerable:!0,get:function(){return i(u)["default"]}});var d=n(1714);Object.defineProperty(t,"Italic",{enumerable:!0,get:function(){return i(d)["default"]}});var p=n(1715);Object.defineProperty(t,"Link",{enumerable:!0,get:function(){return i(p)["default"]}});var h=n(1508);Object.defineProperty(t,"Mention",{enumerable:!0,get:function(){return i(h)["default"]}});var f=n(1716);Object.defineProperty(t,"Strikethrough",{enumerable:!0,get:function(){return i(f)["default"]}});var m=n(1717);Object.defineProperty(t,"TextMention",{enumerable:!0,get:function(){return i(m)["default"]}})},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){var n=(0,o["default"])(e,7),i=n[1],a=n[6];return!a||k.test(a)&&N.test(a)?(i&&(e.index+=i.length,e[0]=e[0].slice(i.length)),e):null}function s(e){var t=(0,o["default"])(e,7),n=t[4],i=t[5],a=t[6];if(a)return""+O+a.toLowerCase();switch(n){case"T":case"t":case"#":return""+x+i;default:return""+w+n+i}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(35),o=i(r),l=n(16),c=i(l),u=n(4),d=i(u),p=n(6),h=i(p),f=n(20),m=i(f),g=n(19),v=i(g),y=n(8),_=i(y),E=n(1404),S=i(E),M=n(1704),C=i(M),b=/(^|\s)(((#|t|T|D|P|r)([0-9]{3,16}))|([0-9a-fA-F]{7,40}))(?=$|\b)/g,T=(0,S["default"])(b,2,a),P=function(e){function t(){return(0,d["default"])(this,t),(0,m["default"])(this,(t.__proto__||(0,c["default"])(t)).apply(this,arguments))}return(0,v["default"])(t,e),(0,h["default"])(t,null,[{key:"jsx",value:function(e,t,n){var i=n.selectable,a=s(t);return _["default"].createElement(C["default"],{href:a,selectable:i},e)}}]),t}(T);t["default"]=P;var k=/[a-fA-F]/,N=/[0-9]/,w="https://phabricator.intern.facebook.com/",x="https://our.intern.facebook.com/intern/tasks/?t=",O="https://phabricator.intern.facebook.com/jump/?jump="},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(8),m=i(f),g=n(1450),v=i(g),y=n(1404),_=i(y),E=n(1705),S=i(E),M=/(?:^|\s|_|[^\w\\])_(\S|\S[^\n]*?\S)_(?=$|[[\s\W_])/g,C=(0,v["default"])("_"),b=(0,_["default"])(M,1,C),T=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,null,[{key:"jsx",value:function(e,t,n){var i=n.selectable;return m["default"].createElement(S["default"],{selectable:i},e)}}]),t}(b);t["default"]=T},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){var t=e.index,n=e.url,i=t+n.length-1;return[t,t,i,i,e]}Object.defineProperty(t,"__esModule",{value:!0});var s=n(16),r=i(s),o=n(4),l=i(o),c=n(6),u=i(c),d=n(20),p=i(d),h=n(19),f=i(h),m=n(8),g=i(m),v=n(1415),y=i(v),_=n(241),E=n(1706),S=i(E),M=function(e){function t(){return(0,l["default"])(this,t),(0,p["default"])(this,(t.__proto__||(0,r["default"])(t)).apply(this,arguments))}return(0,f["default"])(t,e),(0,u["default"])(t,null,[{key:"jsx",value:function(e,t,n){var i=t.href,a=n.selectable;return g["default"].createElement(S["default"],{href:i,selectable:a},e)}}]),t}(y["default"]);M.format=!1,M.match=function(e){return(0,_.findLinks)(e).map(a)},t["default"]=M},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(16),s=i(a),r=n(4),o=i(r),l=n(6),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(8),m=i(f),g=n(1708),v=i(g),y=n(1450),_=i(y),E=n(1404),S=i(E),M=/(?:^|[\s\W_])~(\S|\S[^\n]*?\S)~(?=$|[[\s\W_])/g,C=(0,_["default"])("_"),b=(0,S["default"])(M,1,C),T=function(e){function t(){return(0,o["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,null,[{key:"jsx",value:function(e,t,n){var i=n.selectable;return m["default"].createElement(v["default"],{selectable:i},e)}}]),t}(b);t["default"]=T},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(16),s=i(a),r=n(4),o=i(r),l=n(20),c=i(l),u=n(19),d=i(u),p=n(1508),h=i(p),f=n(8),m=i(f),g=n(240),v=function(e){function t(){return(0,o["default"])(this,t),(0,c["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,d["default"])(t,e),t}(h["default"]);v.jsx=function(e,t){var n=t.jid,i=t.display,a=(0,g.dir)(i)||"auto";return m["default"].createElement("span",{"data-jid":n,"data-display":i,className:"matched-mention"},m["default"].createElement("span",{className:"at-symbol selectable-text"},"@"),m["default"].createElement("span",{dir:a,className:"selectable-text"},i))},t["default"]=v},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(1===e.length)return e;for(var n=[],i=void 0;i=e.pop();){for(var a=i,s=(0,r["default"])(a,5),o=s[0],l=s[3],c=s[4],u=(0,r["default"])(t[c],3),d=u[0],p=d.nestable,h=d.compatibility,f=u[2],m=!0,g=n.length,v=g-1;v>=0;--v){var y=(0,r["default"])(n[v],5),_=y[2],E=y[3],S=y[4];if(o>E)break;var M=(0,r["default"])(t[S],3),C=M[0],b=C.mutates,T=C.format,P=C.compatibility,k=M[2];if(l>_){if(k>f&&n.splice(v,1))continue;m=!1;break}if(b&&!(m=!1))break;if(h)break;if((p||P||!(k>f)||!n.splice(v,1))&&!h&&!T){m=!1;break}}m&&n.push(i)}return n}Object.defineProperty(t,"__esModule",{value:!0});var s=n(35),r=i(s);t["default"]=a},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){for(var t=[],n=0;n<e.length;++n)for(var i=0;i<e[n].length;++i){var a=(0,r["default"])(e[n][i],2),s=a[0],o=a[1];t.push([s,o,n])}return t}Object.defineProperty(t,"__esModule",{value:!0});var s=n(35),r=i(s);t["default"]=a},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){for(var n=[],i=0;i<t.length;++i){for(var a=(0,r["default"])(t[i],2),s=a[0],o=a[1],l=s.match(e,o),c=[],u=l.length,d=0,p=l[d];u>d;p=l[++d])c[d]=[p[0],p[1],p[2],p[3],i,p[4]];c.length&&n.push(c)}for(var h=[],f=0;f<n.length;++f)h[f]=n[f].length-1;for(var m=[],g=0;n.length;){for(var v=0,y=-1;v<n.length;++v)n[v][h[v]][0]>y&&(g=v,y=n[v][h[v]][0]);m.push(n[g][h[g]]),--h[g]<0&&(n.splice(g,1),h.splice(g,1))}return m}Object.defineProperty(t,"__esModule",{value:!0});var s=n(35),r=i(s);t["default"]=a},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t,n){for(var i={children:[]},a=0,s=i,l=0,c=0;c<t.length;++c){for(var u=t[c],d=(0,r["default"])(u,2),p=d[0],h=d[1];s.parent&&p>(l=s.match[2]);){if(l>=a&&s.children.push({type:"text",value:e.substring(a,l+1)}),a=s.match[3]+1,s.mutator.fragment){var f=s.parent.children;f.pop(),f.push.apply(f,s.children)}l!==s.match[3]&&s.parent.children.push({type:"delimiter",value:e.substring(l+1,a)}),s=s.parent}p>a&&s.children.push({type:"text",value:e.substring(a,p)});var m=(0,r["default"])(n[u[4]],2),g=m[0],v=m[1],y=g.mutates;a=h,p!==h&&s.children.push({type:"delimiter",value:e.substring(p,h)});var _={children:[],match:u,mutator:g,opts:v,parent:s};if(y){var E=e.substring(u[1],u[2]+1),S=g.mutate(E,u[5]),M=(0,o._parse)(S,n);_.children=M.children,a=u[2]+1}s.children.push(_),s=_}do if(s.match){var C=(0,r["default"])(s.match,4),b=C[2],T=C[3];if(b>=a&&s.children.push({type:"text",value:e.substring(a,b+1)}),a=T+1,s.mutator.fragment){var P=s.parent.children;P.pop(),P.push.apply(P,s.children)}b!==T&&s.parent.children.push({type:"delimiter",value:e.substring(b+1,a)})}while(s.parent&&(s=s.parent)&&s.parent);return a!==e.length&&s.children.push({type:"text",value:e.substring(a)}),i}Object.defineProperty(t,"__esModule",{value:!0});var s=n(35),r=i(s);t["default"]=a;var o=n(1509)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e,t,n){return e.onRoot(r(e,t.children,n),n)}function s(e,t,n){if(t.type){var i=t.value;switch(t.type){case"text":return e.onText(i,n);case"delimiter":return e.onDelimiter(i,n);default:(0,l["default"])(!1,"Invalid node type")}}return e.onMutator(t.mutator,r(e,t.children,n),t.match[5],t.opts,n)}function r(e,t,n){return t.reduce(function(t,i){return t.push(s(e,i,n)),t},[])}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=a;var o=n(472),l=i(o)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){return(0,m["default"])(e.reduce(s,{}))}function s(e,t){return e["jsx-child-"+S++]=t,e}Object.defineProperty(t,"__esModule",{value:!0});var r=n(16),o=i(r),l=n(4),c=i(l),u=n(20),d=i(u),p=n(19),h=i(p),f=n(1368),m=i(f),g=n(1451),v=i(g),y=n(1724),_=i(y),E=function(e){function t(){return(0,c["default"])(this,t),(0,d["default"])(this,(t.__proto__||(0,o["default"])(t)).apply(this,arguments))}return(0,h["default"])(t,e),t}(v["default"]);E.onText=_["default"],E.onDelimiter=function(e){},E.onRoot=function(e){return a(e)},E.onMutator=function(e,t,n,i){return e.jsx(a(t),n,i)},t["default"]=E;var S=0},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(e){return e}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(16),s=i(a),r=n(4),o=i(r),l=n(20),c=i(l),u=n(19),d=i(u),p=n(1451),h=i(p),f=function(e){function t(){return(0,o["default"])(this,t),(0,c["default"])(this,(t.__proto__||(0,s["default"])(t)).apply(this,arguments))}return(0,d["default"])(t,e),t}(h["default"]);f.onDelimiter=function(e){return e},f.onMutator=function(e,t){return t.join("")},f.onRoot=function(e){return e.join("")},f.onText=function(e){return e},t["default"]=f},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(e){return e.filter(function(e){return!!e}).join("")}Object.defineProperty(t,"__esModule",{value:!0});var s=n(16),r=i(s),o=n(4),l=i(o),c=n(20),u=i(c),d=n(19),p=i(d),h=n(1451),f=i(h),m=function(e){function t(){return(0,l["default"])(this,t),(0,u["default"])(this,(t.__proto__||(0,r["default"])(t)).apply(this,arguments))}return(0,p["default"])(t,e),t}(f["default"]);m.onDelimiter=function(){},m.onMutator=function(e,t){return a(t)},m.onRoot=function(e){return a(e)},m.onText=function(e){return e},t["default"]=m},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(4),s=i(a),r=n(6),o=i(r),l=function(){function e(){(0,s["default"])(this,e)}return(0,o["default"])(e,[{key:"trigger",value:function(e){}}]),e}();e.exports=new l},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(1389),s=i(a),r=3;e.exports={minHeight:function(e,t){return{minHeight:e.length>r?r*s["default"].DEFAULT_HEIGHT+t:e.length*s["default"].DEFAULT_HEIGHT+t}}}},function(e,t,n){"use strict";var i=n(490),a=function s(e){if(!s.isRecordingSupported())throw"Recording is not supported in this browser";this.audioContext=new window.AudioContext,this.config=e=e||{},this.config.command="encode-init",this.config.bufferLength=e.bufferLength||4096,this.config.monitorGain=e.monitorGain||0,this.config.numberOfChannels=e.numberOfChannels||1,this.config.originalSampleRate=this.audioContext.sampleRate,this.config.encoderSampleRate=e.encoderSampleRate||48e3,this.config.streamPages=e.streamPages||!1,this.config.leaveStreamOpen=e.leaveStreamOpen||!1,this.config.maxBuffersPerPage=e.maxBuffersPerPage||40,this.config.encoderApplication=e.encoderApplication||2049,this.config.encoderFrameSize=e.encoderFrameSize||20,this.config.streamOptions=e.streamOptions||{optional:[],mandatory:{googEchoCancellation:!1,googAutoGainControl:!1,googNoiseSuppression:!1,googHighpassFilter:!1}},this.storePage=this._storePage.bind(this),this.streamPage=this._streamPage.bind(this),this.state="inactive",this.eventTarget=document.createDocumentFragment(),this.createAudioNodes()};a.isRecordingSupported=function(){return window.AudioContext&&navigator.getUserMedia},a.prototype.addEventListener=function(e,t,n){this.eventTarget.addEventListener(e,t,n)},a.prototype.clearStream=function(){this.stream&&(this.stream.getTracks().forEach(function(e){e.stop()}),delete this.stream)},a.prototype.createAudioNodes=function(){var e=this;this.scriptProcessorNode=this.audioContext.createScriptProcessor(this.config.bufferLength,this.config.numberOfChannels,this.config.numberOfChannels),this.scriptProcessorNode.onaudioprocess=function(t){e.encodeBuffers(t.inputBuffer)},this.monitorNode=this.audioContext.createGain(),this.setMonitorGain(this.config.monitorGain),this.config.sampleRate<this.audioContext.sampleRate&&this.createButterworthFilter()},a.prototype.createButterworthFilter=function(){this.filterNode=this.audioContext.createBiquadFilter(),this.filterNode2=this.audioContext.createBiquadFilter(),this.filterNode3=this.audioContext.createBiquadFilter(),this.filterNode.type=this.filterNode2.type=this.filterNode3.type="lowpass";var e=this.config.sampleRate/2;this.filterNode.frequency.value=this.filterNode2.frequency.value=this.filterNode3.frequency.value=e-e/3.5355,this.filterNode.Q.value=.51764,this.filterNode2.Q.value=.70711,this.filterNode3.Q.value=1.93184,this.filterNode.connect(this.filterNode2),this.filterNode2.connect(this.filterNode3),this.filterNode3.connect(this.scriptProcessorNode)},a.prototype.encodeBuffers=function(e){if("recording"===this.state){for(var t=[],n=0;n<e.numberOfChannels;n++)t[n]=e.getChannelData(n);this.encoder.postMessage({command:"encode",buffers:t}),this.duration+=e.duration,this.eventTarget.dispatchEvent(new CustomEvent("duration",{detail:this.duration}))}},a.prototype.initStream=function(e){if(this.stream)return void this.eventTarget.dispatchEvent(new Event("streamReady"));if(e)return this.stream=e,this.sourceNode=this.audioContext.createMediaStreamSource(e),this.sourceNode.connect(this.filterNode||this.scriptProcessorNode),this.sourceNode.connect(this.monitorNode),void this.eventTarget.dispatchEvent(new Event("streamReady"));var t=this;navigator.getUserMedia({audio:this.config.streamOptions},function(e){t.stream=e,t.sourceNode=t.audioContext.createMediaStreamSource(e),t.sourceNode.connect(t.filterNode||t.scriptProcessorNode),t.sourceNode.connect(t.monitorNode),t.eventTarget.dispatchEvent(new Event("streamReady"))},function(e){t.eventTarget.dispatchEvent(new ErrorEvent("streamError",{error:e}))})},a.prototype.pause=function(){"recording"===this.state&&(this.state="paused",this.eventTarget.dispatchEvent(new Event("pause")))},a.prototype.removeEventListener=function(e,t,n){this.eventTarget.removeEventListener(e,t,n)},a.prototype.resume=function(){"paused"===this.state&&(this.state="recording",this.eventTarget.dispatchEvent(new Event("resume")))},a.prototype.setMonitorGain=function(e){this.monitorNode.gain.value=e},a.prototype.start=function(){"inactive"===this.state&&this.stream&&(this.encoder=new i,this.config.streamPages?this.encoder.addEventListener("message",this.streamPage):(this.recordedPages=[],this.totalLength=0,this.encoder.addEventListener("message",this.storePage)),this.encodeBuffers=function(){delete this.encodeBuffers},this.duration=0,this.state="recording",this.monitorNode.connect(this.audioContext.destination),this.scriptProcessorNode.connect(this.audioContext.destination),this.eventTarget.dispatchEvent(new Event("start")),this.eventTarget.dispatchEvent(new CustomEvent("duration",{detail:this.duration})),this.encoder.postMessage(this.config))},a.prototype.stop=function(){"inactive"!==this.state&&(this.state="inactive",this.audioContext.close&&this.audioContext.close(),this.monitorNode.disconnect(),this.scriptProcessorNode.disconnect(),this.config.leaveStreamOpen||this.clearStream(),this.encoder.postMessage({command:"encode-done"}))},a.prototype._storePage=function(e){var t=e.data;if(this.recordedPages.push(t),this.totalLength+=t.length,4&t[5]){this.encoder.removeEventListener("message",this.storePage);for(var n=new Uint8Array(this.totalLength),i=0,a=0;a<this.recordedPages.length;a++)n.set(this.recordedPages[a],i),i+=this.recordedPages[a].length;this.eventTarget.dispatchEvent(new CustomEvent("dataAvailable",{detail:new Blob([n],{type:"audio/ogg; codecs=opus"})})),this.recordedPages=[],this.eventTarget.dispatchEvent(new Event("stop"))}},a.prototype._streamPage=function(e){var t=e.data;this.eventTarget.dispatchEvent(new CustomEvent("dataAvailable",{detail:new Blob([t],{type:"audio/ogg; codecs=opus"})})),4&t[5]&&(this.encoder.removeEventListener("message",this.streamPage),this.eventTarget.dispatchEvent(new Event("stop")))},e.exports=a},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function a(){return u["default"].loop(function(e,t,i){var a=u["default"].delay(p.expBackoff(i,12e4,0,0));return new u["default"](function(t,i){n.e(91).then(function(i){var a=n(1453);a.PDFJS.workerSrc="./pdf.worker.js",e(a),t(a)}.bind(null,n))["catch"](function(e){n.oe(e)})})["catch"](function(e){return a})})}var s=n(4),r=i(s),o=n(6),l=i(o),c=n(2),u=i(c),d=n(464),p=n(63);n(1740);var h=function(){function e(){(0,r["default"])(this,e)}return(0,l["default"])(e,null,[{key:"fileToPdf",value:function(e){var t=URL.createObjectURL(e);return a().then(function(e){return e.PDFJS.getDocument(t)})}},{key:"releasePdf",value:function(e){return e.destroy()}},{key:"pdfToImg",value:function(e,t){var n=document.createElement("canvas");return e.getPage(t).then(function(e){var t=e.getViewport(1),i=n.getContext("2d");n.height=t.height,n.width=t.width;var a={canvasContext:i,viewport:t};return e.render(a)}).then(function(){return d.canvasToBlob(n)}).then(function(e){var t=n.height,i=n.width,a=URL.createObjectURL(e);return{url:a,thumbUrl:a,width:i,height:t}})}}]),e}();e.exports=h},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var a=n(22),s=i(a),r=n(6),o=i(r),l=n(4),c=i(l),u=function p(e){(0,c["default"])(this,p),this.promise=e,this.lastUsedTime=this.createdTime=+Date.now()},d=function(){function e(t,n){var i=n.maxCached,a=void 0===i?10:i,s=n.maxAge,r=void 0===s?1/0:s,o=n.shouldCache;(0,c["default"])(this,e),this._cache={},this._maxCached=a,this._maxAge=r,this._createPromiseFunc=t,this._shouldCacheFunc=o}return(0,o["default"])(e,[{key:"getOrRun",value:function(){for(var e=this,t=arguments.length,n=Array(t),i=0;t>i;i++)n[i]=arguments[i];var a=n[0],r=this._cache;if(this._maxAge!==1/0)for(var o=Date.now()-this._maxAge,l=(0,s["default"])(r),c=0;c<l.length;c++){var d=l[c];r[d].createdTime<o&&delete r[d]}var p=r[a];if(p)return p.lastUsedTime=+Date.now(),p.promise;var h=(0,s["default"])(r);if(h.length>=this._maxCached){for(var f=void 0,m=void 0,g=0;g<h.length;g++){var v=h[g],y=r[v];(!m||y.lastUsedTime<m)&&(m=y.lastUsedTime,f=v)}delete r[f]}var _=this._createPromiseFunc.apply(void 0,n);return r[a]=new u(_),_.then(function(t){var n=e._shouldCacheFunc;n&&e._cache[a]===_&&!n(t)&&delete e._cache[a]})["catch"](function(){e._cache[a]===_&&delete e._cache[a]}),_}}]),e}();e.exports=d},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var a,s,r=n(16),o=i(r),l=n(4),c=i(l),u=n(6),d=i(u),p=n(20),h=i(p),f=n(19),m=i(f),g=n(8),v=i(g),y=n(45),_=n(157),E=i(_),S=n(1422),M=i(S),C=n(10),b=i(C),T=n(1377),P=i(T),k=n(1378),N=i(k),w=n(235),x=i(w),O=n(478),D=n(159),R=i(D),I=n(110),A=i(I),L=(0,N["default"])((s=a=function(e){function t(){var e,n,i,a;(0,c["default"])(this,t);for(var s=arguments.length,r=Array(s),l=0;s>l;l++)r[l]=arguments[l];return n=i=(0,h["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(r))),i.handleFullscreen=function(){var e=i.props.onFullscreen;e&&e(i.getCurrentTime())},a=n,(0,h["default"])(i,a)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"getMsg",value:function(){return Store.Msg.get(this.props.msg.id)}},{key:"isResolved",value:function(e){return e.media.mediaStage===x["default"].STAGE.RESOLVED}},{key:"getCurrentTime",value:function(){var e=(0,y.findDOMNode)(this.refs.player);return e.currentTime}},{key:"getMediaDimensions",value:function(){return(0,O.aspectRatioScaled)(this.props.media.aspectRatio,240)}},{key:"renderMedia",value:function(){if(this.isResolved(this.props))return v["default"].createElement(M["default"],{msg:this.getMsg(),autoPlay:!0,className:"media-viewer-img",ref:"player",startTime:this.props.startTime},R["default"].t("video_playback_not_supported"));var e=this.props.media.preview;return e?v["default"].createElement("div",null,v["default"].createElement(E["default"],{size:50,stroke:3}),v["default"].createElement("img",{src:e.url()})):null}},{key:"render",value:function(){return v["default"].createElement("div",{className:"video-floater"},v["default"].createElement("button",{className:"video-floater-close",onClick:this.props.onClose},R["default"].t("web_close")),v["default"].createElement("button",{className:"video-floater-fullscreen",onClick:this.handleFullscreen},v["default"].createElement("i",{className:"icon icon-search-light"})),v["default"].createElement("div",{className:"video-floater-media",style:this.getMediaDimensions()},this.renderMedia()))}}]),t}(g.Component),a.CONCERNS={msg:["id"],media:["mediaStage","aspectRatio","preview"]},s));L.displayName="VideoPlayer";var F=function(e){function t(){var e,n,i,a;(0,c["default"])(this,t);for(var s=arguments.length,r=Array(s),l=0;s>l;l++)r[l]=arguments[l];return n=i=(0,h["default"])(this,(e=t.__proto__||(0,o["default"])(t)).call.apply(e,[this].concat(r))),i.state={msg:null,zoomNode:null,startTime:null},i.handleMediaRequest=function(e,t,n){e.forceDownloadMedia(),i.setState({msg:e,zoomNode:t,startTime:n})},i.handleClose=function(){i.setState({msg:null,zoomNode:null,startTime:null})},i.handleFullscreen=function(e){i.handleClose(),b["default"].mediaViewerModal(i.state.msg,i.state.zoomNode,e)},a=n,(0,h["default"])(i,a)}return(0,m["default"])(t,e),(0,d["default"])(t,[{key:"componentDidMount",value:function(){this.props.listeners.add(b["default"],"media_viewer_modal",this.handleClose),this.props.listeners.add(b["default"],"video_player_floater",this.handleMediaRequest)}},{key:"renderVideoPlayer",value:function(){return this.state.msg?v["default"].createElement(L,{key:this.state.msg.id,msg:this.state.msg,media:this.state.msg.mediaData,startTime:this.state.startTime,onClose:this.handleClose,onFullscreen:this.handleFullscreen}):null}},{key:"render",value:function(){return v["default"].createElement(A["default"],{transitionName:"pop"},this.renderVideoPlayer())}}]),t}(g.Component);t["default"]=(0,P["default"])(F)},function(e,t,n){e.exports=n.p+"img/600127bdb5f7627ede5cd4ef320f55b0.png"},,,,,,,function(e,t,n){e.exports=function(){return new Worker(n.p+"pdf.worker.js")}},function(e,t,n){e.exports=function(){return new Promise(function(e,t){n.e(4).then(function(t){e(n(1734))}.bind(null,n))["catch"](function(e){n.oe(e)})["catch"](function(){t()})})}},function(e,t,n){e.exports=function(){return new Promise(function(e,t){n.e(5).then(function(t){e(n(1735))}.bind(null,n))["catch"](function(e){n.oe(e)})["catch"](function(){t()})})}},function(e,t,n){e.exports=function(){return new Promise(function(e,t){n.e(3).then(function(t){e(n(1736))}.bind(null,n))["catch"](function(e){n.oe(e)})["catch"](function(){t()})})}},function(e,t,n){e.exports=function(){return new Promise(function(e,t){n.e(2).then(function(t){e(n(1737))}.bind(null,n))["catch"](function(e){n.oe(e)})["catch"](function(){t()})})}},function(e,t,n){e.exports=function(){return new Promise(function(e,t){n.e(1).then(function(t){e(n(1738))}.bind(null,n))["catch"](function(e){n.oe(e)})["catch"](function(){t()})})}},function(e,t,n){e.exports=function(){return new Promise(function(e,t){n.e(0).then(function(t){e(n(1739))}.bind(null,n))["catch"](function(e){n.oe(e)})["catch"](function(){t()})})}}]));